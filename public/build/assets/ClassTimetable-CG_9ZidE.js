import{j as g,i as $,I as O,c as i,a as R,u as H,h as J,w as F,b as s,d as j,f as P,t as c,o as d,F as p,r as v,k as T,p as V}from"./app-Cz2Em4mz.js";import{_ as W}from"./AuthenticatedLayout-Be6eAHMN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"flex flex-wrap items-center justify-between gap-3"},G={class:"flex flex-wrap items-center gap-2"},Q=["value"],X=["value"],Z={class:"py-6"},ee={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},te={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},se={class:"flex items-start justify-between gap-3"},re={class:"mt-0.5 text-xs text-gray-500"},ae={key:0},le={key:1},oe={key:0,class:"rounded-md bg-amber-50 px-3 py-2 text-xs font-semibold text-amber-900 ring-1 ring-amber-200"},ne={class:"mt-4 overflow-x-auto"},ie={class:"min-w-full border-collapse text-[11px] text-gray-800"},de={class:"border border-gray-200 px-2 py-2 text-left font-semibold"},ue={class:"font-semibold"},ce={class:"text-[10px] text-gray-600"},be={class:"font-semibold"},me={class:"text-[10px] text-gray-600"},ye={class:"font-semibold"},xe={class:"text-[10px] text-gray-600"},ge={key:1,class:"border border-gray-200 px-2 py-2",colspan:"11"},ve={__name:"ClassTimetable",props:{school:{type:Object,default:null},classes:{type:Array,default:()=>[]},timetable:{type:Object,default:null}},setup(h){const _=h,S=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],U=r=>{try{let e=r;if(!e)return{};if(typeof e=="string"){const a=String(e).trim();if(!a)return{};e=JSON.parse(a)}if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(a=>{const u=Array.isArray(e[a])?e[a]:[];t[a]=u.map(l=>{const o=Array.isArray(l==null?void 0:l.slots)?l.slots:[],m=Array.from({length:9}).map((x,y)=>{const n=o[y];if(n==null)return null;if(typeof n=="string"){const A=String(n||"").trim();return A?{subject:A,teacher:"",teacher_initials:"",teacher_name:""}:null}if(typeof n=="object"){const A=String((n==null?void 0:n.subject)??"").trim(),E=String((n==null?void 0:n.teacher)??"").trim(),I=String((n==null?void 0:n.teacher_initials)??E).trim(),D=String((n==null?void 0:n.teacher_name)??"").trim();return!A&&!E&&!I&&!D?null:{subject:A,teacher:E,teacher_initials:I,teacher_name:D}}return null});return{...l||{},slots:m}})}),t}catch{return{}}},w=g(()=>{var r;return U((r=_.timetable)==null?void 0:r.schedule_json)}),k=r=>String(r||"").trim().toUpperCase(),Y=g(()=>{const r=new Map;return(_.classes||[]).forEach(e=>{const t=Number((e==null?void 0:e.id)||0);t&&r.set(t,e)}),r}),C=r=>{const e=Number((r==null?void 0:r.id)||0),t=Number((r==null?void 0:r.parent_class_id)||0);return t>0?t:e},K=r=>{const e=String((r==null?void 0:r.name)||"").trim();return e||String((r==null?void 0:r.level)||"").trim()},L=g(()=>{const r=new Map;return(_.classes||[]).forEach(e=>{const t=C(e);if(t&&!r.has(t)){const a=Y.value.get(t)||null;r.set(t,{id:t,label:K(a||e)||`Class ${t}`})}}),Array.from(r.values()).sort((e,t)=>Number(e.id)-Number(t.id))}),M=g(()=>{const r=Number(f.value||0)||null;if(!r)return[];const e=new Set;return(_.classes||[]).forEach(t=>{if(C(t)!==r)return;const a=k(t==null?void 0:t.stream);a&&e.add(a)}),Array.from(e.values()).sort((t,a)=>t.localeCompare(a))}),f=$(null),N=$("ALL");O(L,r=>{f.value||r&&r.length&&(f.value=r[0].id)},{immediate:!0}),O(f,()=>{N.value="ALL"});const B=g(()=>{const r=Number(f.value||0)||null;if(!r)return[];const e=k(N.value),t=[];return(_.classes||[]).forEach(a=>{if(C(a)!==r)return;const u=Number((a==null?void 0:a.id)||0);if(!u)return;const l=k(a==null?void 0:a.stream);e!=="ALL"&&l!==e||t.push(u)}),!t.length&&e==="ALL"&&t.push(r),t});g(()=>{const r=new Set((B.value||[]).map(t=>Number(t))),e={};return S.forEach(t=>{var u;const a=((u=w.value)==null?void 0:u[t])||[];e[t]=a.filter(l=>r.has(Number((l==null?void 0:l.school_class_id)||0)))}),e});const b=g(()=>{const r=(B.value||[]).map(a=>Number(a)),e=r.length?r[0]:null,t={};return S.forEach(a=>{var l;const u=((l=w.value)==null?void 0:l[a])||[];t[a]=u.find(o=>Number((o==null?void 0:o.school_class_id)||0)===Number(e||0))||null}),t}),z=g(()=>{const r=w.value||{};return Object.keys(r).length>0});return(r,e)=>(d(),i(p,null,[R(H(J),{title:"Class Timetable"}),R(W,null,{header:F(()=>[s("div",q,[e[5]||(e[5]=s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Class Timetable "),s("p",{class:"mt-1 text-sm text-gray-500"}," Choose a class and stream to preview its timetable. ")],-1)),s("div",G,[e[3]||(e[3]=s("div",{class:"text-xs font-semibold text-gray-700"},"Class:",-1)),T(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[(d(!0),i(p,null,v(L.value,t=>(d(),i("option",{key:t.id,value:t.id},c(t.label),9,Q))),128))],512),[[V,f.value]]),e[4]||(e[4]=s("div",{class:"text-xs font-semibold text-gray-700"},"Stream:",-1)),T(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[2]||(e[2]=s("option",{value:"ALL"},"All",-1)),(d(!0),i(p,null,v(M.value,t=>(d(),i("option",{key:t,value:t},c(t),9,X))),128))],512),[[V,N.value]])])])]),default:F(()=>{var t,a,u;return[s("div",Z,[s("div",ee,[s("div",te,[s("div",se,[s("div",null,[e[6]||(e[6]=s("div",{class:"text-sm font-semibold text-gray-800"},"Preview",-1)),s("div",re,[P(c(((t=h.timetable)==null?void 0:t.title)||"Latest timetable")+" ",1),(a=h.timetable)!=null&&a.academic_year?(d(),i("span",ae," · "+c(h.timetable.academic_year),1)):j("",!0),(u=h.timetable)!=null&&u.term?(d(),i("span",le," · "+c(h.timetable.term),1)):j("",!0)])]),z.value?j("",!0):(d(),i("div",oe," No timetable schedule found yet. "))]),s("div",ne,[s("table",ie,[e[10]||(e[10]=s("thead",null,[s("tr",null,[s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-left"},"Day"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"08:00"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"08:40"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"09:20"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"10:00"),s("th",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center"},"BREAK"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"11:05"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"11:45"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"12:25"),s("th",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center"},"BREAK"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"13:20"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"14:00")])],-1)),s("tbody",null,[(d(),i(p,null,v(S,l=>s("tr",{key:l,class:"hover:bg-gray-50"},[s("td",de,c(l),1),b.value[l]?(d(),i(p,{key:0},[(d(),i(p,null,v(4,o=>{var m,x,y;return s("td",{key:`am-${l}-${o}`,class:"border border-gray-200 px-2 py-2 text-center"},[s("div",ue,c(((m=b.value[l].slots[o-1])==null?void 0:m.subject)||""),1),s("div",ce,c(((x=b.value[l].slots[o-1])==null?void 0:x.teacher_initials)||((y=b.value[l].slots[o-1])==null?void 0:y.teacher)||""),1)])}),64)),e[7]||(e[7]=s("td",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center font-semibold text-sky-900"},"BREAK",-1)),(d(),i(p,null,v(3,o=>{var m,x,y;return s("td",{key:`mid-${l}-${o}`,class:"border border-gray-200 px-2 py-2 text-center"},[s("div",be,c(((m=b.value[l].slots[3+o])==null?void 0:m.subject)||""),1),s("div",me,c(((x=b.value[l].slots[3+o])==null?void 0:x.teacher_initials)||((y=b.value[l].slots[3+o])==null?void 0:y.teacher)||""),1)])}),64)),e[8]||(e[8]=s("td",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center font-semibold text-sky-900"},"BREAK",-1)),(d(),i(p,null,v(2,o=>{var m,x,y;return s("td",{key:`pm-${l}-${o}`,class:"border border-gray-200 px-2 py-2 text-center"},[s("div",ye,c(((m=b.value[l].slots[6+o])==null?void 0:m.subject)||""),1),s("div",xe,c(((x=b.value[l].slots[6+o])==null?void 0:x.teacher_initials)||((y=b.value[l].slots[6+o])==null?void 0:y.teacher)||""),1)])}),64))],64)):(d(),i("td",ge,[...e[9]||(e[9]=[s("span",{class:"text-xs text-gray-500"},"No row found for selected class/stream on this day.",-1)])]))])),64))])])]),e[11]||(e[11]=s("div",{class:"mt-3 text-xs text-gray-500"}," Coming soon: editing tools and full multi-stream view. ",-1))])])])]}),_:1})],64))}};export{ve as default};

import{j as b,i as V,I as Y,c as i,a as U,u as X,h as Z,w as K,b as s,f as L,d as S,t as n,o as d,F as y,r as A,k as z,p as H,m as ee}from"./app-D5pxZNti.js";import{_ as te}from"./AuthenticatedLayout-BuRdYloQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"flex flex-wrap items-center justify-between gap-3"},re={class:"flex flex-wrap items-center gap-2"},le=["value"],ae=["value"],oe={class:"py-6"},ne={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},ie={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},de={class:"flex items-start justify-between gap-3"},ue={class:"mt-0.5 text-xs text-gray-500"},ce={key:0},be={key:1},me={class:"flex flex-wrap items-center gap-2"},xe={key:0,class:"rounded-md bg-amber-50 px-3 py-2 text-xs font-semibold text-amber-900 ring-1 ring-amber-200"},pe={class:"mt-4 overflow-hidden rounded-lg border border-gray-300 bg-white text-[11px] text-gray-800"},ge={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},fe={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},he={key:0,class:"text-[9px] text-gray-600"},ve={key:0},ye={key:1,class:"text-[9px] text-gray-700"},_e={class:"font-semibold"},we={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},Se={class:"min-w-full border-collapse text-[10px] leading-tight"},Ae={class:"border border-slate-300 bg-white px-1 py-1 text-center font-semibold"},Ne={class:"border border-slate-300 bg-white px-1 py-1 text-center"},ke={class:"border border-slate-300 bg-white px-1 py-1 text-center"},Le={class:"font-semibold"},Ce={class:"text-[9px] text-gray-600"},Ee={class:"font-semibold"},je={class:"text-[9px] text-gray-600"},Ie={class:"font-semibold"},Be={class:"text-[9px] text-gray-600"},$e={key:1,class:"border border-slate-300 bg-white px-1 py-1",colspan:"11"},Re={__name:"ClassTimetable",props:{school:{type:Object,default:null},classes:{type:Array,default:()=>[]},timetable:{type:Object,default:null}},setup(w){const f=w,C=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],G=t=>{try{let e=t;if(!e)return{};if(typeof e=="string"){const l=String(e).trim();if(!l)return{};e=JSON.parse(l)}if(!e||typeof e!="object")return{};const r={};return Object.keys(e).forEach(l=>{const u=Array.isArray(e[l])?e[l]:[];r[l]=u.map(a=>{const v=Array.isArray(a==null?void 0:a.slots)?a.slots:[],c=Array.from({length:9}).map((g,x)=>{const o=v[x];if(o==null)return null;if(typeof o=="string"){const N=String(o||"").trim();return N?{subject:N,teacher:"",teacher_initials:"",teacher_name:""}:null}if(typeof o=="object"){const N=String((o==null?void 0:o.subject)??"").trim(),O=String((o==null?void 0:o.teacher)??"").trim(),F=String((o==null?void 0:o.teacher_initials)??O).trim(),M=String((o==null?void 0:o.teacher_name)??"").trim();return!N&&!O&&!F&&!M?null:{subject:N,teacher:O,teacher_initials:F,teacher_name:M}}return null});return{...a||{},slots:c}})}),r}catch{return{}}},E=b(()=>{var t;return G((t=f.timetable)==null?void 0:t.schedule_json)}),_=t=>String(t||"").trim().toUpperCase(),j=b(()=>{const t=new Map;return(f.classes||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r&&t.set(r,e)}),t}),k=t=>{const e=Number((t==null?void 0:t.id)||0),r=Number((t==null?void 0:t.parent_class_id)||0);return r>0?r:e},P=t=>{const e=String((t==null?void 0:t.name)||"").trim();return e||String((t==null?void 0:t.level)||"").trim()},R=b(()=>{const t=new Map;return(f.classes||[]).forEach(e=>{const r=k(e);if(r&&!t.has(r)){const l=j.value.get(r)||null;t.set(r,{id:r,label:P(l||e)||`Class ${r}`})}}),Array.from(t.values()).sort((e,r)=>Number(e.id)-Number(r.id))}),J=b(()=>{const t=Number(h.value||0)||null;if(!t)return[];const e=new Set;return(f.classes||[]).forEach(r=>{if(k(r)!==t)return;const l=_(r==null?void 0:r.stream);l&&e.add(l)}),Array.from(e.values()).sort((r,l)=>r.localeCompare(l))}),h=V(null),p=V("ALL");Y(R,t=>{h.value||t&&t.length&&(h.value=t[0].id)},{immediate:!0}),Y(h,()=>{p.value="ALL"});const I=b(()=>{const t=Number(h.value||0)||null;if(!t)return[];const e=_(p.value),r=[];return(f.classes||[]).forEach(l=>{if(k(l)!==t)return;const u=Number((l==null?void 0:l.id)||0);if(!u)return;const a=_(l==null?void 0:l.stream);e!=="ALL"&&a!==e||r.push(u)}),!r.length&&e==="ALL"&&r.push(t),r});b(()=>{const t=new Set((I.value||[]).map(r=>Number(r))),e={};return C.forEach(r=>{var u;const l=((u=E.value)==null?void 0:u[r])||[];e[r]=l.filter(a=>t.has(Number((a==null?void 0:a.school_class_id)||0)))}),e});const m=b(()=>{const t=(I.value||[]).map(l=>Number(l)),e=t.length?t[0]:null,r={};return C.forEach(l=>{var a;const u=((a=E.value)==null?void 0:a[l])||[];r[l]=u.find(v=>Number((v==null?void 0:v.school_class_id)||0)===Number(e||0))||null}),r}),W=b(()=>{const t=E.value||{};return Object.keys(t).length>0}),q=b(()=>{var t;return String(((t=f.school)==null?void 0:t.name)||"").trim()}),B=b(()=>{var t;return String(((t=f.school)==null?void 0:t.address)||"").trim()}),$=b(()=>{var t;return String(((t=f.school)==null?void 0:t.region)||"").trim()}),T=b(()=>{const t=Number((I.value||[])[0]||0);return t&&j.value.get(t)||null}),D=b(()=>{const t=T.value;if(!t)return"";const e=k(t),r=j.value.get(Number(e))||t,l=P(r),u=_(p.value);if(u&&u!=="ALL")return`${l} ${u}`;const a=String((t==null?void 0:t.stream)||"").trim();return a?`${l} ${a}`:l}),Q=()=>{ee.get(route("timetables.create"),{school_class_id:Number(h.value||0)||void 0,stream:_(p.value)!=="ALL"?_(p.value):void 0})};return(t,e)=>(d(),i(y,null,[U(X(Z),{title:"Class Timetable"}),U(te,null,{header:K(()=>[s("div",se,[e[5]||(e[5]=s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Class Timetable "),s("p",{class:"mt-1 text-sm text-gray-500"}," Choose a class and stream to preview its timetable. ")],-1)),s("div",re,[e[3]||(e[3]=s("div",{class:"text-xs font-semibold text-gray-700"},"Class:",-1)),z(s("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>h.value=r),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[(d(!0),i(y,null,A(R.value,r=>(d(),i("option",{key:r.id,value:r.id},n(r.label),9,le))),128))],512),[[H,h.value]]),e[4]||(e[4]=s("div",{class:"text-xs font-semibold text-gray-700"},"Stream:",-1)),z(s("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>p.value=r),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[2]||(e[2]=s("option",{value:"ALL"},"All",-1)),(d(!0),i(y,null,A(J.value,r=>(d(),i("option",{key:r,value:r},n(r),9,ae))),128))],512),[[H,p.value]])])])]),default:K(()=>{var r,l,u;return[s("div",oe,[s("div",ne,[s("div",ie,[s("div",de,[s("div",null,[e[6]||(e[6]=s("div",{class:"text-sm font-semibold text-gray-800"},"Preview",-1)),s("div",ue,[L(n(((r=w.timetable)==null?void 0:r.title)||"Latest timetable")+" ",1),(l=w.timetable)!=null&&l.academic_year?(d(),i("span",ce," · "+n(w.timetable.academic_year),1)):S("",!0),(u=w.timetable)!=null&&u.term?(d(),i("span",be," · "+n(w.timetable.term),1)):S("",!0)])]),s("div",me,[s("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:Q}," Generate "),W.value?S("",!0):(d(),i("div",xe," No timetable schedule found yet. "))])]),s("div",pe,[s("div",ge,[e[8]||(e[8]=s("div",{class:"mb-1 flex justify-center"},[s("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),s("div",fe,n(q.value||"SCHOOL"),1),B.value||$.value?(d(),i("div",he,[L(n(B.value),1),B.value&&$.value?(d(),i("span",ve," · ")):S("",!0),L(n($.value),1)])):S("",!0),e[9]||(e[9]=s("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," CLASS TIME TABLE ",-1)),D.value?(d(),i("div",ye,[e[7]||(e[7]=L(" Darasa: ",-1)),s("span",_e,n(D.value),1)])):S("",!0)]),s("div",we,[s("table",Se,[e[13]||(e[13]=s("thead",null,[s("tr",null,[s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"DAY"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"CLASS"),s("th",{class:"w-16 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"STREAM"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P1"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P2"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P3"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P4"),s("th",{class:"w-14 border border-slate-300 bg-sky-100 px-1 py-1 text-center align-middle"},"BREAK"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P5"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P6"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P7"),s("th",{class:"w-14 border border-slate-300 bg-sky-100 px-1 py-1 text-center align-middle"},"BREAK"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P8"),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"},"P9")])],-1)),s("tbody",null,[(d(),i(y,null,A(C,a=>{var v;return s("tr",{key:a,class:"hover:bg-white/40"},[s("td",Ae,n(a),1),s("td",Ne,n(D.value||"-"),1),s("td",ke,n(_(p.value)==="ALL"?((v=T.value)==null?void 0:v.stream)||"-":p.value),1),m.value[a]?(d(),i(y,{key:0},[(d(),i(y,null,A(4,c=>{var g,x,o;return s("td",{key:`p${c}-${a}`,class:"border border-slate-300 bg-white px-1 py-1 text-center"},[s("div",Le,n(((g=m.value[a].slots[c-1])==null?void 0:g.subject)||""),1),s("div",Ce,n(((x=m.value[a].slots[c-1])==null?void 0:x.teacher_initials)||((o=m.value[a].slots[c-1])==null?void 0:o.teacher)||""),1)])}),64)),e[10]||(e[10]=s("td",{class:"border border-slate-300 bg-sky-100 px-1 py-1 text-center text-[9px] font-semibold text-sky-900"}," BREAK ",-1)),(d(),i(y,null,A(3,c=>{var g,x,o;return s("td",{key:`p${4+c}-${a}`,class:"border border-slate-300 bg-white px-1 py-1 text-center"},[s("div",Ee,n(((g=m.value[a].slots[3+c])==null?void 0:g.subject)||""),1),s("div",je,n(((x=m.value[a].slots[3+c])==null?void 0:x.teacher_initials)||((o=m.value[a].slots[3+c])==null?void 0:o.teacher)||""),1)])}),64)),e[11]||(e[11]=s("td",{class:"border border-slate-300 bg-sky-100 px-1 py-1 text-center text-[9px] font-semibold text-sky-900"}," BREAK ",-1)),(d(),i(y,null,A(2,c=>{var g,x,o;return s("td",{key:`p${7+c}-${a}`,class:"border border-slate-300 bg-white px-1 py-1 text-center"},[s("div",Ie,n(((g=m.value[a].slots[6+c])==null?void 0:g.subject)||""),1),s("div",Be,n(((x=m.value[a].slots[6+c])==null?void 0:x.teacher_initials)||((o=m.value[a].slots[6+c])==null?void 0:o.teacher)||""),1)])}),64))],64)):(d(),i("td",$e,[...e[12]||(e[12]=[s("span",{class:"text-[10px] text-gray-500"},"No row found for selected class/stream.",-1)])]))])}),64))])])])]),e[14]||(e[14]=s("div",{class:"mt-3 text-xs text-gray-500"}," Coming soon: editing tools and full multi-stream view. ",-1))])])])]}),_:1})],64))}};export{Re as default};

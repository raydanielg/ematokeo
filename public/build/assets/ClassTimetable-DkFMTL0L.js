import{j as f,i as $,I as O,c as i,a as R,u as M,h as H,w as F,b as s,d as j,f as J,t as c,o as d,F as g,r as v,k as T,p as V}from"./app-Cyq6ZS_5.js";import{_ as P}from"./AuthenticatedLayout-Cj0Jo1-0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"flex flex-wrap items-center justify-between gap-3"},q={class:"flex flex-wrap items-center gap-2"},G=["value"],Q=["value"],X={class:"py-6"},Z={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},ee={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},te={class:"flex items-start justify-between gap-3"},se={class:"mt-0.5 text-xs text-gray-500"},re={key:0},ae={key:1},le={key:0,class:"rounded-md bg-amber-50 px-3 py-2 text-xs font-semibold text-amber-900 ring-1 ring-amber-200"},oe={class:"mt-4 overflow-x-auto"},ne={class:"min-w-full border-collapse text-[11px] text-gray-800"},ie={class:"border border-gray-200 px-2 py-2 text-left font-semibold"},de={class:"font-semibold"},ue={class:"text-[10px] text-gray-600"},ce={class:"font-semibold"},be={class:"text-[10px] text-gray-600"},me={class:"font-semibold"},ye={class:"text-[10px] text-gray-600"},xe={key:1,class:"border border-gray-200 px-2 py-2",colspan:"11"},he={__name:"ClassTimetable",props:{school:{type:Object,default:null},classes:{type:Array,default:()=>[]},timetable:{type:Object,default:null}},setup(h){const A=h,N=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],U=r=>{try{let e=r;if(!e)return{};if(typeof e=="string"){const a=String(e).trim();if(!a)return{};e=JSON.parse(a)}if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(a=>{const u=Array.isArray(e[a])?e[a]:[];t[a]=u.map(l=>{const o=Array.isArray(l==null?void 0:l.slots)?l.slots:[],m=Array.from({length:9}).map((x,y)=>{const n=o[y];if(n==null)return null;if(typeof n=="string"){const _=String(n||"").trim();return _?{subject:_,teacher:"",teacher_initials:"",teacher_name:""}:null}if(typeof n=="object"){const _=String((n==null?void 0:n.subject)??"").trim(),E=String((n==null?void 0:n.teacher)??"").trim(),D=String((n==null?void 0:n.teacher_initials)??E).trim(),I=String((n==null?void 0:n.teacher_name)??"").trim();return!_&&!E&&!D&&!I?null:{subject:_,teacher:E,teacher_initials:D,teacher_name:I}}return null});return{...l||{},slots:m}})}),t}catch{return{}}},w=f(()=>{var r;return U((r=A.timetable)==null?void 0:r.schedule_json)}),k=r=>String(r||"").trim().toUpperCase(),C=r=>{const e=Number((r==null?void 0:r.id)||0),t=Number((r==null?void 0:r.parent_class_id)||0);return t>0?t:e},Y=r=>{const e=String((r==null?void 0:r.parent_name)||"").trim();if(e)return e;const t=String((r==null?void 0:r.name)||"").trim();return t||String((r==null?void 0:r.level)||"").trim()},L=f(()=>{const r=new Map;return(A.classes||[]).forEach(e=>{const t=C(e);t&&(r.has(t)||r.set(t,{id:t,label:Y(e)||`Class ${t}`}))}),Array.from(r.values()).sort((e,t)=>Number(e.id)-Number(t.id))}),K=f(()=>{const r=Number(p.value||0)||null;if(!r)return[];const e=new Set;return(A.classes||[]).forEach(t=>{if(C(t)!==r)return;const a=k(t==null?void 0:t.stream);a&&e.add(a)}),Array.from(e.values()).sort((t,a)=>t.localeCompare(a))}),p=$(null),S=$("ALL");O(L,r=>{p.value||r&&r.length&&(p.value=r[0].id)},{immediate:!0}),O(p,()=>{S.value="ALL"});const B=f(()=>{const r=Number(p.value||0)||null;if(!r)return[];const e=k(S.value),t=[];return(A.classes||[]).forEach(a=>{if(C(a)!==r)return;const u=Number((a==null?void 0:a.id)||0);if(!u)return;const l=k(a==null?void 0:a.stream);e!=="ALL"&&l!==e||t.push(u)}),!t.length&&e==="ALL"&&t.push(r),t});f(()=>{const r=new Set((B.value||[]).map(t=>Number(t))),e={};return N.forEach(t=>{var u;const a=((u=w.value)==null?void 0:u[t])||[];e[t]=a.filter(l=>r.has(Number((l==null?void 0:l.school_class_id)||0)))}),e});const b=f(()=>{const r=(B.value||[]).map(a=>Number(a)),e=r.length?r[0]:null,t={};return N.forEach(a=>{var l;const u=((l=w.value)==null?void 0:l[a])||[];t[a]=u.find(o=>Number((o==null?void 0:o.school_class_id)||0)===Number(e||0))||null}),t}),z=f(()=>{const r=w.value||{};return Object.keys(r).length>0});return(r,e)=>(d(),i(g,null,[R(M(H),{title:"Class Timetable"}),R(P,null,{header:F(()=>[s("div",W,[e[5]||(e[5]=s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Class Timetable "),s("p",{class:"mt-1 text-sm text-gray-500"}," Choose a class and stream to preview its timetable. ")],-1)),s("div",q,[e[3]||(e[3]=s("div",{class:"text-xs font-semibold text-gray-700"},"Class:",-1)),T(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[(d(!0),i(g,null,v(L.value,t=>(d(),i("option",{key:t.id,value:t.id},c(t.label),9,G))),128))],512),[[V,p.value]]),e[4]||(e[4]=s("div",{class:"text-xs font-semibold text-gray-700"},"Stream:",-1)),T(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>S.value=t),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[2]||(e[2]=s("option",{value:"ALL"},"All",-1)),(d(!0),i(g,null,v(K.value,t=>(d(),i("option",{key:t,value:t},c(t),9,Q))),128))],512),[[V,S.value]])])])]),default:F(()=>{var t,a,u;return[s("div",X,[s("div",Z,[s("div",ee,[s("div",te,[s("div",null,[e[6]||(e[6]=s("div",{class:"text-sm font-semibold text-gray-800"},"Preview",-1)),s("div",se,[J(c(((t=h.timetable)==null?void 0:t.title)||"Latest timetable")+" ",1),(a=h.timetable)!=null&&a.academic_year?(d(),i("span",re," · "+c(h.timetable.academic_year),1)):j("",!0),(u=h.timetable)!=null&&u.term?(d(),i("span",ae," · "+c(h.timetable.term),1)):j("",!0)])]),z.value?j("",!0):(d(),i("div",le," No timetable schedule found yet. "))]),s("div",oe,[s("table",ne,[e[10]||(e[10]=s("thead",null,[s("tr",null,[s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-left"},"Day"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"08:00"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"08:40"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"09:20"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"10:00"),s("th",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center"},"BREAK"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"11:05"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"11:45"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"12:25"),s("th",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center"},"BREAK"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"13:20"),s("th",{class:"border border-gray-200 bg-gray-50 px-2 py-2 text-center"},"14:00")])],-1)),s("tbody",null,[(d(),i(g,null,v(N,l=>s("tr",{key:l,class:"hover:bg-gray-50"},[s("td",ie,c(l),1),b.value[l]?(d(),i(g,{key:0},[(d(),i(g,null,v(4,o=>{var m,x,y;return s("td",{key:`am-${l}-${o}`,class:"border border-gray-200 px-2 py-2 text-center"},[s("div",de,c(((m=b.value[l].slots[o-1])==null?void 0:m.subject)||""),1),s("div",ue,c(((x=b.value[l].slots[o-1])==null?void 0:x.teacher_initials)||((y=b.value[l].slots[o-1])==null?void 0:y.teacher)||""),1)])}),64)),e[7]||(e[7]=s("td",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center font-semibold text-sky-900"},"BREAK",-1)),(d(),i(g,null,v(3,o=>{var m,x,y;return s("td",{key:`mid-${l}-${o}`,class:"border border-gray-200 px-2 py-2 text-center"},[s("div",ce,c(((m=b.value[l].slots[3+o])==null?void 0:m.subject)||""),1),s("div",be,c(((x=b.value[l].slots[3+o])==null?void 0:x.teacher_initials)||((y=b.value[l].slots[3+o])==null?void 0:y.teacher)||""),1)])}),64)),e[8]||(e[8]=s("td",{class:"border border-gray-200 bg-sky-50 px-2 py-2 text-center font-semibold text-sky-900"},"BREAK",-1)),(d(),i(g,null,v(2,o=>{var m,x,y;return s("td",{key:`pm-${l}-${o}`,class:"border border-gray-200 px-2 py-2 text-center"},[s("div",me,c(((m=b.value[l].slots[6+o])==null?void 0:m.subject)||""),1),s("div",ye,c(((x=b.value[l].slots[6+o])==null?void 0:x.teacher_initials)||((y=b.value[l].slots[6+o])==null?void 0:y.teacher)||""),1)])}),64))],64)):(d(),i("td",xe,[...e[9]||(e[9]=[s("span",{class:"text-xs text-gray-500"},"No row found for selected class/stream on this day.",-1)])]))])),64))])])]),e[11]||(e[11]=s("div",{class:"mt-3 text-xs text-gray-500"}," Coming soon: editing tools and full multi-stream view. ",-1))])])])]}),_:1})],64))}};export{he as default};

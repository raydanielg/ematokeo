import{j as g,i as M,I as N,m as Y,c as d,a as V,u as W,h as te,w as z,b as s,d as E,o as u,t as c,F as m,r as h,k as D,p as O}from"./app-CPAbp00B.js";import{_ as se}from"./AuthenticatedLayout-kN5sGNvB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"flex flex-wrap items-center justify-between gap-3 no-print"},re={class:"flex flex-wrap items-center gap-2"},ae={key:0,value:null},ne=["value"],oe=["value"],ie=["value"],de=["disabled"],ue=["disabled"],be={class:"py-6"},ce={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},me={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100 print-area"},pe={class:"mb-4 border-b border-gray-200 pb-3 text-center"},ge={key:0,class:"mx-auto mb-1 h-14 w-14 overflow-hidden rounded-full border border-gray-200 bg-white"},xe=["src"],fe={class:"text-[12px] font-extrabold uppercase tracking-wide text-gray-900"},ye={class:"mt-0.5 text-[10px] font-semibold uppercase tracking-wide text-gray-700"},he={class:"mt-2 text-[11px] font-extrabold uppercase tracking-wide text-emerald-800"},ve={class:"mt-0.5 text-[10px] font-semibold uppercase tracking-wide text-gray-800"},_e={key:0,class:"mb-3 rounded-md bg-amber-50 px-3 py-2 text-xs font-semibold text-amber-900 ring-1 ring-amber-200"},Ae={class:"mt-4 overflow-x-auto"},ke={class:"min-w-full border-collapse text-[10px] leading-tight"},Se=["rowspan"],Ne={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold"},Ee={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},Le={class:"font-semibold"},Ce={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},Ie={key:1},$e={class:"font-semibold"},Te={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},je={key:1},Be={class:"font-semibold"},Me={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},De={key:1,class:"font-semibold text-gray-400"},Oe={key:1},Re={class:"border border-slate-300 bg-sky-100 px-1 py-3 text-center text-[10px] font-semibold uppercase text-sky-900"},Ue={__name:"ClassTimetable",props:{school:{type:Object,default:null},classes:{type:Array,default:()=>[]},timetables:{type:Array,default:()=>[]},timetable:{type:Object,default:null}},setup(S){var F;const p=S,R=g(()=>{var e;const t=String(((e=p.school)==null?void 0:e.logo_path)||"").trim();return t?t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/")?t:`/storage/${t}`:""}),L=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],K=t=>{try{let e=t;if(!e)return{};if(typeof e=="string"){const a=String(e).trim();if(!a)return{};e=JSON.parse(a)}if(!e||typeof e!="object")return{};const l={};return Object.keys(e).forEach(a=>{const n=Array.isArray(e[a])?e[a]:[];l[a]=n.map(o=>{const r=Array.isArray(o==null?void 0:o.slots)?o.slots:[],v=Array.from({length:9}).map((b,x)=>{const i=r[x];if(i==null)return null;if(typeof i=="string"){const k=String(i||"").trim();return k?{subject:k,teacher:"",teacher_initials:"",teacher_name:""}:null}if(typeof i=="object"){const k=String((i==null?void 0:i.subject)??"").trim(),B=String((i==null?void 0:i.teacher)??"").trim(),P=String((i==null?void 0:i.teacher_initials)??B).trim(),U=String((i==null?void 0:i.teacher_name)??"").trim();return!k&&!B&&!P&&!U?null:{subject:k,teacher:B,teacher_initials:P,teacher_name:U}}return null});return{...o||{},slots:v}})}),l}catch{return{}}},_=M(((F=p.timetable)==null?void 0:F.id)||null);N(()=>{var t;return(t=p.timetable)==null?void 0:t.id},t=>{!_.value&&t&&(_.value=t)}),N(_,t=>{const e=Number(t||0)||null;e&&Y.get(route("timetables.class",{timetable_id:e}),{},{preserveScroll:!0})});const f=g(()=>{const t=Number(_.value||0)||null;return t&&(p.timetables||[]).find(e=>Number((e==null?void 0:e.id)||0)===t)||p.timetable}),C=g(()=>{var t;return K((t=f.value)==null?void 0:t.schedule_json)}),I=t=>String(t||"").trim().toUpperCase(),G=g(()=>{const t=new Map;return(p.classes||[]).forEach(e=>{const l=Number((e==null?void 0:e.id)||0);l&&t.set(l,e)}),t}),$=t=>{const e=Number((t==null?void 0:t.id)||0),l=Number((t==null?void 0:t.parent_class_id)||0);return l>0?l:e},H=t=>{const e=String((t==null?void 0:t.name)||"").trim();return e||String((t==null?void 0:t.level)||"").trim()},T=g(()=>{const t=new Map;return(p.classes||[]).forEach(e=>{const l=$(e);if(l&&!t.has(l)){const a=G.value.get(l)||null;t.set(l,{id:l,label:H(a||e)||`Class ${l}`})}}),Array.from(t.values()).sort((e,l)=>Number(e.id)-Number(l.id))}),J=g(()=>{var e;const t=Number(y.value||0)||null;return t&&((e=T.value.find(l=>Number(l.id)===t))==null?void 0:e.label)||""}),X=g(()=>{const t=String(J.value||"").trim(),e=String(A.value||"").trim();return t?!e||e==="ALL"?`${t} TIME TABLE`:`${t} - ${e} TIME TABLE`:"CLASS TIME TABLE"}),Z=g(()=>{const t=Number(y.value||0)||null;if(!t)return[];const e=new Set;return(p.classes||[]).forEach(l=>{if($(l)!==t)return;const a=I(l==null?void 0:l.stream);a&&e.add(a)}),Array.from(e.values()).sort((l,a)=>l.localeCompare(a))}),y=M(null),A=M("ALL");N(T,t=>{y.value||t&&t.length&&(y.value=t[0].id)},{immediate:!0}),N(y,()=>{A.value="ALL"});const w=g(()=>{const t=Number(y.value||0)||null;if(!t)return[];const e=I(A.value),l=[];return(p.classes||[]).forEach(a=>{if($(a)!==t)return;const n=Number((a==null?void 0:a.id)||0);if(!n)return;const o=I(a==null?void 0:a.stream);e!=="ALL"&&o!==e||l.push(n)}),!l.length&&e==="ALL"&&l.push(t),l}),j=g(()=>{const t=new Set((w.value||[]).map(l=>Number(l))),e={};return L.forEach(l=>{var n;const a=((n=C.value)==null?void 0:n[l])||[];e[l]=a.filter(o=>t.has(Number((o==null?void 0:o.school_class_id)||0)))}),e}),q=t=>{var a;const e=String(t||""),l=((a=j.value)==null?void 0:a[e])||[];return Array.isArray(l)&&l.length?l.length:1};g(()=>{const t=(w.value||[]).map(a=>Number(a)),e=t.length?t[0]:null,l={};return L.forEach(a=>{var o;const n=((o=C.value)==null?void 0:o[a])||[];l[a]=n.find(r=>Number((r==null?void 0:r.school_class_id)||0)===Number(e||0))||null}),l});const Q=g(()=>{const t=C.value||{};return Object.keys(t).length>0}),ee=()=>{window.print()};return(t,e)=>(u(),d(m,null,[V(W(te),{title:"Class Timetable"}),V(se,null,{header:z(()=>{var l,a;return[s("div",le,[e[9]||(e[9]=s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Class Timetable "),s("p",{class:"mt-1 text-sm text-gray-500"}," Choose a class and stream to preview its timetable. ")],-1)),s("div",re,[e[6]||(e[6]=s("div",{class:"text-xs font-semibold text-gray-700"},"Saved Timetable:",-1)),D(s("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[!S.timetables||S.timetables.length===0?(u(),d("option",ae,"No Published timetables")):E("",!0),(u(!0),d(m,null,h(S.timetables,n=>(u(),d("option",{key:n.id,value:n.id},c(n.title),9,ne))),128))],512),[[O,_.value]]),e[7]||(e[7]=s("div",{class:"text-xs font-semibold text-gray-700"},"Class:",-1)),D(s("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>y.value=n),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[(u(!0),d(m,null,h(T.value,n=>(u(),d("option",{key:n.id,value:n.id},c(n.label),9,oe))),128))],512),[[O,y.value]]),e[8]||(e[8]=s("div",{class:"text-xs font-semibold text-gray-700"},"Stream:",-1)),D(s("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>A.value=n),class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[5]||(e[5]=s("option",{value:"ALL"},"All",-1)),(u(!0),d(m,null,h(Z.value,n=>(u(),d("option",{key:n,value:n},c(n),9,ie))),128))],512),[[O,A.value]]),s("button",{type:"button",class:"ml-2 rounded-md bg-white px-3 py-1 text-xs font-semibold text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:ee}," Print "),s("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:!((l=f.value)!=null&&l.id),onClick:e[3]||(e[3]=n=>{var o;return((o=f.value)==null?void 0:o.id)&&W(Y).get(t.route("timetables.show",f.value.id))})}," Edit ",8,de),s("button",{type:"button",class:"rounded-md bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",disabled:!((a=f.value)!=null&&a.file_path),onClick:e[4]||(e[4]=n=>{var o;return((o=f.value)==null?void 0:o.file_path)&&t.window.open(t.route("timetables.download",f.value.id),"_blank")})}," PDF ",8,ue)])])]}),default:z(()=>{var l,a,n;return[s("div",be,[s("div",ce,[s("div",me,[s("div",pe,[e[10]||(e[10]=s("div",{class:"mb-1 text-[11px] font-semibold text-gray-700"},"Emblem",-1)),R.value?(u(),d("div",ge,[s("img",{src:R.value,alt:"School logo",class:"h-full w-full object-contain"},null,8,xe)])):E("",!0),s("div",fe,c(((l=p.school)==null?void 0:l.name)||"ANGELINA MABULA SECONDARY SCHOOL"),1),s("div",ye,c(((a=p.school)==null?void 0:a.address)||"P . O . BOX 523 · MWANZA"),1),s("div",he,c(X.value),1),s("div",ve," MWAKA: "+c(((n=f.value)==null?void 0:n.academic_year)||new Date().getFullYear()),1)]),Q.value?E("",!0):(u(),d("div",_e," No timetable schedule found yet. ")),s("div",Ae,[s("table",ke,[e[17]||(e[17]=s("thead",null,[s("tr",null,[s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),s("th",{class:"w-16 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),s("th",{class:"w-24 border border-slate-300 bg-sky-50 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),s("th",{class:"w-16 border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 "),s("th",{class:"w-16 border border-slate-300 bg-sky-200 px-1 py-1 text-center align-middle"}," 10:40 - 11:05 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 "),s("th",{class:"w-16 border border-slate-300 bg-sky-200 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 "),s("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),s("tbody",null,[(u(),d(m,null,h(L,o=>(u(),d(m,{key:o},[(j.value[o]||[]).length?(u(!0),d(m,{key:0},h(j.value[o],(r,v)=>(u(),d("tr",{key:`${o}-${(r==null?void 0:r.school_class_id)||v}`},[v===0?(u(),d("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-3 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:q(o)},c(o),9,Se)):E("",!0),s("td",Ne,c((r==null?void 0:r.class_label)||(r==null?void 0:r.form)||(r==null?void 0:r.class_name)||"-"),1),s("td",Ee,c((r==null?void 0:r.stream)||"-"),1),e[11]||(e[11]=s("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[s("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[12]||(e[12]=s("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(u(),d(m,null,h(4,b=>{var x,i;return s("td",{key:`am-${o}-${v}-${b}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center"},[(i=(x=r==null?void 0:r.slots)==null?void 0:x[b-1])!=null&&i.subject?(u(),d(m,{key:0},[s("div",Le,c(r.slots[b-1].subject),1),s("div",Ce,c(r.slots[b-1].teacher_initials||r.slots[b-1].teacher||""),1)],64)):(u(),d("div",Ie," "))])}),64)),e[13]||(e[13]=s("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(u(),d(m,null,h(3,b=>{var x,i;return s("td",{key:`mid-${o}-${v}-${b}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center"},[(i=(x=r==null?void 0:r.slots)==null?void 0:x[3+b])!=null&&i.subject?(u(),d(m,{key:0},[s("div",$e,c(r.slots[3+b].subject),1),s("div",Te,c(r.slots[3+b].teacher_initials||r.slots[3+b].teacher||""),1)],64)):(u(),d("div",je," "))])}),64)),e[14]||(e[14]=s("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(u(),d(m,null,h(2,b=>{var x,i;return s("td",{key:`pm-${o}-${v}-${b}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center"},[(i=(x=r==null?void 0:r.slots)==null?void 0:x[6+b])!=null&&i.subject?(u(),d(m,{key:0},[s("div",Be,c(r.slots[6+b].subject),1),s("div",Me,c(r.slots[6+b].teacher_initials||r.slots[6+b].teacher||""),1)],64)):(u(),d("div",De,"PS"))])}),64)),e[15]||(e[15]=s("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128)):(u(),d("tr",Oe,[s("td",Re,c(o),1),e[16]||(e[16]=s("td",{class:"border border-slate-300 bg-white px-2 py-2",colspan:"15"},[s("span",{class:"text-xs text-gray-500"},"No row found for selected class/stream on this day.")],-1))]))],64))),64))])])]),e[18]||(e[18]=s("div",{class:"mt-3 text-xs text-gray-500"}," Coming soon: editing tools and full multi-stream view. ",-1))])])])]}),_:1})],64))}};export{Ue as default};

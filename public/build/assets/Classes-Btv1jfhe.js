import{j as $,z,r as d,c as le,a as o,b as T,u as ae,h as oe,w as P,d as e,e as y,g as N,o as a,F as f,f as C,t as r,k as H,n as U,p as ne,s as de,v as ie,i as m}from"./app-Tl4Ohsz1.js";import{_ as re}from"./AuthenticatedLayout-D0sVaQjy.js";import{_ as ue}from"./Alert-BnUrdO_5.js";import"./ApplicationLogo-DaacQ1Vn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"flex items-center justify-between"},pe={class:"flex flex-wrap items-center gap-2"},me=["disabled"],ge={key:0,class:"inline-flex items-center gap-1"},ve={key:1},xe={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},be={class:"mb-5 flex flex-col gap-3 border-b border-gray-100 pb-4 text-xs text-gray-700"},ye={class:"flex flex-wrap items-end justify-between gap-3"},fe={class:"w-full max-w-xs"},he=["value"],_e={class:"flex gap-2"},ke=["disabled"],Ce={key:0},we={key:1},Se={key:0,class:"mt-2 rounded-md bg-gray-50 p-3"},je={class:"flex flex-wrap gap-2"},Ae=["value","checked","onChange"],Ie={class:"overflow-x-auto"},Fe={class:"min-w-full text-left text-sm"},Ee={class:"border-b border-gray-200 bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-500"},De={class:"w-10 px-3 py-2"},Be=["checked"],Ne={key:0},Ve={class:"px-3 py-2 align-top"},Me=["checked","onChange"],Oe={class:"px-3 py-2 align-top"},$e={class:"text-xs text-gray-500"},ze={class:"px-3 py-2 align-top"},Te={class:"flex flex-col"},Pe={class:"text-gray-800"},He={key:0,class:"text-[10px] text-gray-500"},Ue={class:"px-3 py-2 align-top"},Ge={class:"text-[11px] text-gray-700"},Le={class:"font-medium"},qe={class:"px-3 py-2 align-top"},Ke={class:"flex justify-end gap-2"},Re=["onClick"],Ye=["onClick"],Je={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4"},Qe={class:"w-full max-w-lg rounded-lg bg-white p-5 shadow-lg"},We={class:"mb-3 flex items-center justify-between"},Xe={class:"text-base font-semibold text-gray-800"},Ze={class:"grid grid-cols-2 gap-3"},es=["value"],ss={class:"flex flex-wrap gap-1"},ts=["onClick"],ls={class:"mt-4 flex justify-end gap-2"},as=["disabled"],os={key:0},ns={key:1},ds={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4"},is={class:"w-full max-w-sm rounded-lg bg-white p-5 shadow-lg"},rs={class:"mb-4 text-xs text-gray-600"},vs={__name:"Classes",props:{classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]}},setup(w){const F=w,c=$(F.classes.map(l=>({id:l.id,name:l.name,level:l.level,description:l.description,subject_ids:[...l.subject_ids]})));z(()=>F.classes,l=>{c.splice(0,c.length,...l.map(s=>({id:s.id,name:s.name,level:s.level,description:s.description,subject_ids:[...s.subject_ids]})))});const i=d([]),S=d(!1),v=d(null),u=d([]),h=d(!1),j=d(!1),_=d(null),n=$({name:"",level:"",description:""}),p=d([]),x=d(null),k=d(!1),E=d(!1),D=d(""),A=d(null),b=d(null),G=["Form I","Form II","Form III","Form IV"],L=["CIV","HIS","GEO","KIS","ENG","PHY","CHE","BIO","B/MAT"],q=le(()=>F.subjects.filter(l=>L.includes(l.subject_code)).map(l=>l.id)),K=()=>{_.value=null,n.name="",n.level="",n.description="",p.value=[],x.value=null,j.value=!0},R=l=>{const s=c.find(t=>t.id===l);if(!s){u.value=[];return}s.subject_ids&&s.subject_ids.length>0?u.value=[...s.subject_ids]:u.value=[...q.value]};z(()=>v.value,l=>{if(!l){u.value=[];return}R(l)});const Y=l=>{_.value=l.id,n.name=l.name,n.level=l.level||"",n.description=l.description||"",p.value=[...l.subject_ids],x.value=null,j.value=!0},I=()=>{j.value=!1},V=(l,s,t)=>{A.value=l,b.value=s,D.value=t,E.value=!0},M=()=>{E.value=!1,A.value=null,b.value=null,D.value=""},J=l=>{const s=i.value.indexOf(l);s===-1?i.value.push(l):i.value.splice(s,1)},O=()=>c.length>0&&i.value.length===c.length,Q=()=>{O()?i.value=[]:i.value=c.map(l=>l.id)},W=()=>{k.value=!0,x.value=null,_.value?m.post(route("classes.update",_.value),{name:n.name,level:n.level,description:n.description,subject_ids:p.value},{preserveScroll:!0,onSuccess:()=>{I(),m.reload({only:["classes"]})},onError:l=>{x.value=Object.values(l||{}).join(" ")},onFinish:()=>{k.value=!1}}):m.post(route("classes.store"),{name:n.name,level:n.level,description:n.description,subject_ids:p.value},{preserveScroll:!0,onSuccess:()=>{I(),m.reload({only:["classes"]})},onError:l=>{x.value=Object.values(l||{}).join(" ")},onFinish:()=>{k.value=!1}})},X=l=>{V("delete-single",l,"Are you sure you want to delete this class? This action cannot be undone.")},Z=()=>{i.value.length&&V("delete-bulk",[...i.value],"Are you sure you want to delete all selected classes? This action cannot be undone.")},ee=()=>{A.value==="delete-single"&&b.value?m.delete(route("classes.destroy",b.value),{preserveScroll:!0}):A.value==="delete-bulk"&&Array.isArray(b.value)&&(S.value=!0,m.post(route("classes.bulk-delete"),{ids:b.value},{preserveScroll:!0,onSuccess:()=>{m.reload({only:["classes"]})},onFinish:()=>{S.value=!1,i.value=[]}})),M()},se=l=>{const s=u.value.indexOf(l);s===-1?u.value.push(l):u.value.splice(s,1)},te=()=>{if(!v.value||h.value)return;h.value=!0;const l=[{class_id:v.value,subject_ids:u.value}];m.post("/classes/assign-subjects",{assignments:l},{preserveScroll:!0,onSuccess:()=>{m.reload({only:["classes"]})},onFinish:()=>{h.value=!1}})};return(l,s)=>(a(),o(f,null,[T(ae(oe),{title:"Classes"}),T(re,null,{header:P(()=>[e("div",ce,[s[4]||(s[4]=e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Classes "),e("p",{class:"mt-1 text-sm text-gray-500"}," Manage classes and inline assign subjects to each class. ")],-1)),e("div",pe,[e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700",onClick:K}," + Add Class "),e("button",{type:"button",class:"rounded-md bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 ring-1 ring-red-100 hover:bg-red-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!i.value.length||S.value,onClick:Z},[S.value?(a(),o("span",ge,[...s[3]||(s[3]=[e("span",{class:"inline-flex h-3 w-3 animate-spin rounded-full border border-red-500 border-t-transparent"},null,-1),e("span",null,"Deleting...",-1)])])):(a(),o("span",ve,"Bulk Delete"))],8,me)])])]),default:P(()=>[e("div",xe,[e("div",be,[s[8]||(s[8]=e("div",{class:"flex flex-wrap items-center gap-3"},[e("div",{class:"flex flex-col gap-1"},[e("span",{class:"text-[11px] font-semibold uppercase tracking-wide text-gray-500"}," Assign Subjects to a Class "),e("span",{class:"text-[11px] text-gray-500"}," Chagua darasa kisha weka alama kwenye masomo unayotaka lifundishwe; masomo ya msingi yatajiwekwa alama kiotomatiki kama darasa halina masomo bado. ")])],-1)),e("div",ye,[e("div",fe,[s[6]||(s[6]=e("label",{class:"mb-1 block text-[11px] font-medium text-gray-700"},"Select Class",-1)),N(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>v.value=t),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[s[5]||(s[5]=e("option",{value:"",disabled:""},"Select class...",-1)),(a(!0),o(f,null,C(c,t=>(a(),o("option",{key:t.id,value:t.id},r(t.name)+" (ID #"+r(t.id)+") ",9,he))),128))],512),[[H,v.value]])]),e("div",_e,[e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:!v.value||h.value,onClick:te},[h.value?(a(),o("span",we,"Saving...")):(a(),o("span",Ce,"Save Assignments"))],8,ke)])]),v.value?(a(),o("div",Se,[s[7]||(s[7]=e("p",{class:"mb-2 text-[11px] font-medium text-gray-700"},"Subjects",-1)),e("div",je,[(a(!0),o(f,null,C(w.subjects,t=>(a(),o("label",{key:t.id,class:U(["inline-flex items-center gap-1 rounded-full border px-2 py-1 text-[10px] font-medium",u.value.includes(t.id)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50"])},[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",value:t.id,checked:u.value.includes(t.id),onChange:g=>se(t.id)},null,40,Ae),e("span",null,r(t.subject_code),1)],2))),128))])])):y("",!0)]),e("div",Ie,[e("table",Fe,[e("thead",null,[e("tr",Ee,[e("th",De,[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:O(),onChange:Q},null,40,Be)]),s[9]||(s[9]=e("th",{class:"w-16 px-3 py-2"},"ID No",-1)),s[10]||(s[10]=e("th",{class:"px-3 py-2"},"Class",-1)),s[11]||(s[11]=e("th",{class:"px-3 py-2"},"Subjects Assigned",-1)),s[12]||(s[12]=e("th",{class:"px-3 py-2 text-right"},"Actions",-1))])]),e("tbody",null,[c.length===0?(a(),o("tr",Ne,[...s[13]||(s[13]=[e("td",{colspan:"4",class:"px-3 py-4 text-center text-xs text-gray-500"}," No classes defined yet. ",-1)])])):y("",!0),(a(!0),o(f,null,C(c,t=>(a(),o("tr",{key:t.id,class:"border-b border-gray-100 text-xs text-gray-700 hover:bg-gray-50"},[e("td",Ve,[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:i.value.includes(t.id),onChange:g=>J(t.id)},null,40,Me)]),e("td",Oe,[e("span",$e,"#"+r(t.id),1)]),e("td",ze,[e("div",Te,[e("span",Pe,r(t.name),1),t.description?(a(),o("span",He,r(t.description),1)):y("",!0)])]),e("td",Ue,[e("div",Ge,[e("span",Le,r(w.subjects.filter(g=>t.subject_ids.map(B=>String(B)).includes(String(g.id))).map(g=>g.subject_code).join(", ")||"None"),1)])]),e("td",qe,[e("div",Ke,[e("button",{type:"button",class:"rounded-md bg-blue-50 px-2 py-1 text-[11px] font-medium text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",onClick:g=>Y(t)}," Edit ",8,Re),e("button",{type:"button",class:"rounded-md bg-red-50 px-2 py-1 text-[11px] font-medium text-red-700 ring-1 ring-red-100 hover:bg-red-100",onClick:g=>X(t.id)}," Delete ",8,Ye)])])]))),128))])])])]),j.value?(a(),o("div",Je,[e("div",Qe,[e("div",We,[e("h3",Xe,r(_.value?"Edit Class":"Add Class"),1),e("button",{type:"button",class:"text-sm text-gray-400 hover:text-gray-600",onClick:I}," âœ• ")]),e("form",{class:"space-y-3 text-xs text-gray-700",onSubmit:ne(W,["prevent"])},[x.value?(a(),de(ue,{key:0,variant:"danger",title:"Could not save class",message:x.value},null,8,["message"])):y("",!0),e("div",Ze,[e("div",null,[s[14]||(s[14]=e("label",{class:"mb-1 block font-medium"},"Class Name",-1)),N(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.name=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A",required:""},null,512),[[ie,n.name]])]),e("div",null,[s[16]||(s[16]=e("label",{class:"mb-1 block font-medium"},"Level (optional)",-1)),N(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.level=t),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[s[15]||(s[15]=e("option",{value:""},"Select level...",-1)),(a(),o(f,null,C(G,t=>e("option",{key:t,value:t},r(t),9,es)),64))],512),[[H,n.level]])])]),e("div",null,[s[17]||(s[17]=e("label",{class:"mb-1 block font-medium"},"Assign Subjects",-1)),e("div",ss,[(a(!0),o(f,null,C(w.subjects,t=>(a(),o("button",{key:t.id,type:"button",class:U(["rounded-full px-2 py-0.5 text-[10px] font-medium ring-1",p.value.includes(t.id)?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:g=>p.value=p.value.includes(t.id)?p.value.filter(B=>B!==t.id):[...p.value,t.id]},r(t.subject_code),11,ts))),128))])]),e("div",ls,[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 text-xs font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:I}," Cancel "),e("button",{type:"submit",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:k.value},[k.value?(a(),o("span",os,"Saving...")):(a(),o("span",ns,"Save"))],8,as)])],32)])])):y("",!0),E.value?(a(),o("div",ds,[e("div",is,[s[18]||(s[18]=e("h3",{class:"mb-2 text-sm font-semibold text-gray-800"}," Please confirm ",-1)),e("p",rs,r(D.value),1),e("div",{class:"mt-2 flex justify-end gap-2 text-xs"},[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:M}," Cancel "),e("button",{type:"button",class:"rounded-md bg-red-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-red-700",onClick:ee}," Confirm ")])])])):y("",!0)]),_:1})],64))}};export{vs as default};

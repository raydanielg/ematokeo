import{j as O,z as V,r as d,c as se,a as n,b as z,u as te,h as le,w as T,d as e,e as y,g as P,o as a,F as k,f as I,t as u,k as ae,n as H,p as ne,s as oe,v as de,i as m}from"./app-ff-AdnyS.js";import{_ as ie}from"./AuthenticatedLayout-C1QmzU21.js";import{_ as re}from"./Alert-D7GYNkkT.js";import"./ApplicationLogo-no4VEeoL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"flex items-center justify-between"},ce={class:"flex flex-wrap items-center gap-2"},pe=["disabled"],me={key:0,class:"inline-flex items-center gap-1"},ge={key:1},ve={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},xe={class:"mb-5 flex flex-col gap-3 border-b border-gray-100 pb-4 text-xs text-gray-700"},be={class:"flex flex-wrap items-end justify-between gap-3"},ye={class:"w-full max-w-xs"},fe=["value"],he={class:"flex gap-2"},_e=["disabled"],ke={key:0},Ce={key:1},we={key:0,class:"mt-2 rounded-md bg-gray-50 p-3"},Se={class:"flex flex-wrap gap-2"},je=["value","checked","onChange"],Ae={class:"overflow-x-auto"},Ie={class:"min-w-full text-left text-sm"},Ee={class:"border-b border-gray-200 bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-500"},De={class:"w-10 px-3 py-2"},Fe=["checked"],Be={key:0},Ne={class:"px-3 py-2 align-top"},Me=["checked","onChange"],$e={class:"px-3 py-2 align-top"},Oe={class:"text-xs text-gray-500"},Ve={class:"px-3 py-2 align-top"},ze={class:"flex flex-col"},Te={class:"text-gray-800"},Pe={key:0,class:"text-[10px] text-gray-500"},He={class:"px-3 py-2 align-top"},Ge={class:"text-[11px] text-gray-700"},Ue={class:"font-medium"},qe={class:"px-3 py-2 align-top"},Ke={class:"flex justify-end gap-2"},Le=["onClick"],Re=["onClick"],Ye={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4"},Je={class:"w-full max-w-lg rounded-lg bg-white p-5 shadow-lg"},Qe={class:"mb-3 flex items-center justify-between"},We={class:"text-base font-semibold text-gray-800"},Xe={class:"flex flex-wrap gap-1"},Ze=["onClick"],es={class:"mt-4 flex justify-end gap-2"},ss=["disabled"],ts={key:0},ls={key:1},as={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4"},ns={class:"w-full max-w-sm rounded-lg bg-white p-5 shadow-lg"},os={class:"mb-4 text-xs text-gray-600"},ps={__name:"Classes",props:{classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]}},setup(C){const E=C,c=O(E.classes.map(t=>({id:t.id,name:t.name,level:t.level,description:t.description,subject_ids:[...t.subject_ids]})));V(()=>E.classes,t=>{c.splice(0,c.length,...t.map(s=>({id:s.id,name:s.name,level:s.level,description:s.description,subject_ids:[...s.subject_ids]})))});const i=d([]),w=d(!1),v=d(null),r=d([]),f=d(!1),S=d(!1),h=d(null),o=O({name:"",level:"",description:""}),p=d([]),x=d(null),_=d(!1),D=d(!1),F=d(""),j=d(null),b=d(null),G=["CIV","HIS","GEO","KIS","ENG","PHY","CHE","BIO","B/MAT"],U=se(()=>E.subjects.filter(t=>G.includes(t.subject_code)).map(t=>t.id)),q=()=>{h.value=null,o.name="",o.level="",o.description="",p.value=[],x.value=null,S.value=!0},K=t=>{const s=c.find(l=>l.id===t);if(!s){r.value=[];return}s.subject_ids&&s.subject_ids.length>0?r.value=[...s.subject_ids]:r.value=[...U.value]};V(()=>v.value,t=>{if(!t){r.value=[];return}K(t)});const L=t=>{h.value=t.id,o.name=t.name,o.level=t.level||"",o.description=t.description||"",p.value=[...t.subject_ids],x.value=null,S.value=!0},A=()=>{S.value=!1},N=(t,s,l)=>{j.value=t,b.value=s,F.value=l,D.value=!0},M=()=>{D.value=!1,j.value=null,b.value=null,F.value=""},R=t=>{const s=i.value.indexOf(t);s===-1?i.value.push(t):i.value.splice(s,1)},$=()=>c.length>0&&i.value.length===c.length,Y=()=>{$()?i.value=[]:i.value=c.map(t=>t.id)},J=()=>{_.value=!0,x.value=null,h.value?m.post(route("classes.update",h.value),{name:o.name,level:o.level,description:o.description,subject_ids:p.value},{preserveScroll:!0,onSuccess:()=>{A(),m.reload({only:["classes"]})},onError:t=>{x.value=Object.values(t||{}).join(" ")},onFinish:()=>{_.value=!1}}):m.post(route("classes.store"),{name:o.name,level:o.level,description:o.description,subject_ids:p.value},{preserveScroll:!0,onSuccess:()=>{A(),m.reload({only:["classes"]})},onError:t=>{x.value=Object.values(t||{}).join(" ")},onFinish:()=>{_.value=!1}})},Q=t=>{N("delete-single",t,"Are you sure you want to delete this class? This action cannot be undone.")},W=()=>{i.value.length&&N("delete-bulk",[...i.value],"Are you sure you want to delete all selected classes? This action cannot be undone.")},X=()=>{j.value==="delete-single"&&b.value?m.delete(route("classes.destroy",b.value),{preserveScroll:!0}):j.value==="delete-bulk"&&Array.isArray(b.value)&&(w.value=!0,m.post(route("classes.bulk-delete"),{ids:b.value},{preserveScroll:!0,onSuccess:()=>{m.reload({only:["classes"]})},onFinish:()=>{w.value=!1,i.value=[]}})),M()},Z=t=>{const s=r.value.indexOf(t);s===-1?r.value.push(t):r.value.splice(s,1)},ee=()=>{if(!v.value||f.value)return;f.value=!0;const t=[{class_id:v.value,subject_ids:r.value}];m.post("/classes/assign-subjects",{assignments:t},{preserveScroll:!0,onSuccess:()=>{m.reload({only:["classes"]})},onFinish:()=>{f.value=!1}})};return(t,s)=>(a(),n(k,null,[z(te(le),{title:"Classes"}),z(ie,null,{header:T(()=>[e("div",ue,[s[3]||(s[3]=e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Classes "),e("p",{class:"mt-1 text-sm text-gray-500"}," Manage classes and inline assign subjects to each class. ")],-1)),e("div",ce,[e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700",onClick:q}," + Add Class "),e("button",{type:"button",class:"rounded-md bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 ring-1 ring-red-100 hover:bg-red-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!i.value.length||w.value,onClick:W},[w.value?(a(),n("span",me,[...s[2]||(s[2]=[e("span",{class:"inline-flex h-3 w-3 animate-spin rounded-full border border-red-500 border-t-transparent"},null,-1),e("span",null,"Deleting...",-1)])])):(a(),n("span",ge,"Bulk Delete"))],8,pe)])])]),default:T(()=>[e("div",ve,[e("div",xe,[s[7]||(s[7]=e("div",{class:"flex flex-wrap items-center gap-3"},[e("div",{class:"flex flex-col gap-1"},[e("span",{class:"text-[11px] font-semibold uppercase tracking-wide text-gray-500"}," Assign Subjects to a Class "),e("span",{class:"text-[11px] text-gray-500"}," Chagua darasa kisha weka alama kwenye masomo unayotaka lifundishwe; masomo ya msingi yatajiwekwa alama kiotomatiki kama darasa halina masomo bado. ")])],-1)),e("div",be,[e("div",ye,[s[5]||(s[5]=e("label",{class:"mb-1 block text-[11px] font-medium text-gray-700"},"Select Class",-1)),P(e("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>v.value=l),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[s[4]||(s[4]=e("option",{value:"",disabled:""},"Select class...",-1)),(a(!0),n(k,null,I(c,l=>(a(),n("option",{key:l.id,value:l.id},u(l.name)+" (ID #"+u(l.id)+") ",9,fe))),128))],512),[[ae,v.value]])]),e("div",he,[e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:!v.value||f.value,onClick:ee},[f.value?(a(),n("span",Ce,"Saving...")):(a(),n("span",ke,"Save Assignments"))],8,_e)])]),v.value?(a(),n("div",we,[s[6]||(s[6]=e("p",{class:"mb-2 text-[11px] font-medium text-gray-700"},"Subjects",-1)),e("div",Se,[(a(!0),n(k,null,I(C.subjects,l=>(a(),n("label",{key:l.id,class:H(["inline-flex items-center gap-1 rounded-full border px-2 py-1 text-[10px] font-medium",r.value.includes(l.id)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50"])},[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",value:l.id,checked:r.value.includes(l.id),onChange:g=>Z(l.id)},null,40,je),e("span",null,u(l.subject_code),1)],2))),128))])])):y("",!0)]),e("div",Ae,[e("table",Ie,[e("thead",null,[e("tr",Ee,[e("th",De,[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:$(),onChange:Y},null,40,Fe)]),s[8]||(s[8]=e("th",{class:"w-16 px-3 py-2"},"ID No",-1)),s[9]||(s[9]=e("th",{class:"px-3 py-2"},"Class",-1)),s[10]||(s[10]=e("th",{class:"px-3 py-2"},"Subjects Assigned",-1)),s[11]||(s[11]=e("th",{class:"px-3 py-2 text-right"},"Actions",-1))])]),e("tbody",null,[c.length===0?(a(),n("tr",Be,[...s[12]||(s[12]=[e("td",{colspan:"4",class:"px-3 py-4 text-center text-xs text-gray-500"}," No classes defined yet. ",-1)])])):y("",!0),(a(!0),n(k,null,I(c,l=>(a(),n("tr",{key:l.id,class:"border-b border-gray-100 text-xs text-gray-700 hover:bg-gray-50"},[e("td",Ne,[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:i.value.includes(l.id),onChange:g=>R(l.id)},null,40,Me)]),e("td",$e,[e("span",Oe,"#"+u(l.id),1)]),e("td",Ve,[e("div",ze,[e("span",Te,u(l.name),1),l.description?(a(),n("span",Pe,u(l.description),1)):y("",!0)])]),e("td",He,[e("div",Ge,[e("span",Ue,u(C.subjects.filter(g=>l.subject_ids.map(B=>String(B)).includes(String(g.id))).map(g=>g.subject_code).join(", ")||"None"),1)])]),e("td",qe,[e("div",Ke,[e("button",{type:"button",class:"rounded-md bg-blue-50 px-2 py-1 text-[11px] font-medium text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",onClick:g=>L(l)}," Edit ",8,Le),e("button",{type:"button",class:"rounded-md bg-red-50 px-2 py-1 text-[11px] font-medium text-red-700 ring-1 ring-red-100 hover:bg-red-100",onClick:g=>Q(l.id)}," Delete ",8,Re)])])]))),128))])])])]),S.value?(a(),n("div",Ye,[e("div",Je,[e("div",Qe,[e("h3",We,u(h.value?"Edit Class":"Add Class"),1),e("button",{type:"button",class:"text-sm text-gray-400 hover:text-gray-600",onClick:A}," âœ• ")]),e("form",{class:"space-y-3 text-xs text-gray-700",onSubmit:ne(J,["prevent"])},[x.value?(a(),oe(re,{key:0,variant:"danger",title:"Could not save class",message:x.value},null,8,["message"])):y("",!0),e("div",null,[s[13]||(s[13]=e("label",{class:"mb-1 block font-medium"},"Class Name",-1)),P(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>o.name=l),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A",required:""},null,512),[[de,o.name]])]),e("div",null,[s[14]||(s[14]=e("label",{class:"mb-1 block font-medium"},"Assign Subjects",-1)),e("div",Xe,[(a(!0),n(k,null,I(C.subjects,l=>(a(),n("button",{key:l.id,type:"button",class:H(["rounded-full px-2 py-0.5 text-[10px] font-medium ring-1",p.value.includes(l.id)?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:g=>p.value=p.value.includes(l.id)?p.value.filter(B=>B!==l.id):[...p.value,l.id]},u(l.subject_code),11,Ze))),128))])]),e("div",es,[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 text-xs font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:A}," Cancel "),e("button",{type:"submit",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:_.value},[_.value?(a(),n("span",ts,"Saving...")):(a(),n("span",ls,"Save"))],8,ss)])],32)])])):y("",!0),D.value?(a(),n("div",as,[e("div",ns,[s[15]||(s[15]=e("h3",{class:"mb-2 text-sm font-semibold text-gray-800"}," Please confirm ",-1)),e("p",os,u(F.value),1),e("div",{class:"mt-2 flex justify-end gap-2 text-xs"},[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:M}," Cancel "),e("button",{type:"button",class:"rounded-md bg-red-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-red-700",onClick:X}," Confirm ")])])])):y("",!0)]),_:1})],64))}};export{ps as default};

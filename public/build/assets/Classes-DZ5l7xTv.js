import{n as $,C as T,i as n,j as te,c as o,a as z,u as le,h as ae,w as P,b as e,d as y,k as N,o as a,F as f,r as C,t as r,p as H,s as U,x as oe,e as ne,v as de,m}from"./app-CqTx4gPs.js";import{_ as ie}from"./AuthenticatedLayout-D-v0av_e.js";import{_ as re}from"./Alert-B8wXpzLR.js";import"./ApplicationLogo-BshLYHuK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"flex items-center justify-between"},ce={class:"flex flex-wrap items-center gap-2"},pe=["disabled"],me={key:0,class:"inline-flex items-center gap-1"},ge={key:1},xe={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},be={class:"mb-5 flex flex-col gap-3 border-b border-gray-100 pb-4 text-xs text-gray-700"},ve={class:"flex flex-wrap items-end justify-between gap-3"},ye={class:"w-full max-w-xs"},fe=["value"],he={class:"flex gap-2"},_e=["disabled"],ke={key:0},Ce={key:1},we={key:0,class:"mt-2 rounded-md bg-gray-50 p-3"},Se={class:"flex flex-wrap gap-2"},je=["value","checked","onChange"],Ae={class:"overflow-x-auto"},Ie={class:"min-w-full text-left text-sm"},Ee={class:"border-b border-gray-200 bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-500"},De={class:"w-10 px-3 py-2"},Fe=["checked"],Be={key:0},Ne={class:"px-3 py-2 align-top"},Me=["checked","onChange"],Oe={class:"px-3 py-2 align-top"},Ve={class:"text-xs text-gray-500"},$e={class:"px-3 py-2 align-top"},Te={class:"flex flex-col"},ze={class:"text-gray-800"},Pe={key:0,class:"text-[10px] text-gray-500"},He={class:"px-3 py-2 align-top"},Ue={class:"text-[11px] text-gray-700"},Ge={class:"font-medium"},Le={class:"px-3 py-2 align-top"},qe={class:"flex justify-end gap-2"},Ke=["onClick"],Re=["onClick"],Ye={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4"},Je={class:"w-full max-w-lg rounded-lg bg-white p-5 shadow-lg"},Qe={class:"mb-3 flex items-center justify-between"},We={class:"text-base font-semibold text-gray-800"},Xe={class:"grid grid-cols-2 gap-3"},Ze=["value"],es={class:"flex flex-wrap gap-1"},ss=["onClick"],ts={class:"mt-4 flex justify-end gap-2"},ls=["disabled"],as={key:0},os={key:1},ns={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4"},ds={class:"w-full max-w-sm rounded-lg bg-white p-5 shadow-lg"},is={class:"mb-4 text-xs text-gray-600"},gs={__name:"Classes",props:{classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]}},setup(w){const E=w,c=$(E.classes.map(l=>({id:l.id,name:l.name,level:l.level,description:l.description,subject_ids:[...l.subject_ids]})));T(()=>E.classes,l=>{c.splice(0,c.length,...l.map(s=>({id:s.id,name:s.name,level:s.level,description:s.description,subject_ids:[...s.subject_ids]})))});const i=n([]),S=n(!1),x=n(null),u=n([]),h=n(!1),j=n(!1),_=n(null),d=$({name:"",description:""}),p=n([]),b=n(null),k=n(!1),D=n(!1),F=n(""),A=n(null),v=n(null),G=["CIV","HIS","GEO","KIS","ENG","PHY","CHE","BIO","B/MAT"],L=te(()=>E.subjects.filter(l=>G.includes(l.subject_code)).map(l=>l.id)),q=()=>{_.value=null,d.name="",d.description="",p.value=[],b.value=null,j.value=!0},K=l=>{const s=c.find(t=>t.id===l);if(!s){u.value=[];return}s.subject_ids&&s.subject_ids.length>0?u.value=[...s.subject_ids]:u.value=[...L.value]};T(()=>x.value,l=>{if(!l){u.value=[];return}K(l)});const R=l=>{_.value=l.id,d.name=l.name,d.description=l.description||"",p.value=[...l.subject_ids],b.value=null,j.value=!0},I=()=>{j.value=!1},M=(l,s,t)=>{A.value=l,v.value=s,F.value=t,D.value=!0},O=()=>{D.value=!1,A.value=null,v.value=null,F.value=""},Y=l=>{const s=i.value.indexOf(l);s===-1?i.value.push(l):i.value.splice(s,1)},V=()=>c.length>0&&i.value.length===c.length,J=()=>{V()?i.value=[]:i.value=c.map(l=>l.id)},Q=()=>{k.value=!0,b.value=null,_.value?m.post(route("classes.update",_.value),{name:d.name,description:d.description,subject_ids:p.value},{preserveScroll:!0,onSuccess:()=>{I(),m.reload({only:["classes"]})},onError:l=>{b.value=Object.values(l||{}).join(" ")},onFinish:()=>{k.value=!1}}):m.post(route("classes.store"),{name:d.name,description:d.description,subject_ids:p.value},{preserveScroll:!0,onSuccess:()=>{I(),m.reload({only:["classes"]})},onError:l=>{b.value=Object.values(l||{}).join(" ")},onFinish:()=>{k.value=!1}})},W=l=>{M("delete-single",l,"Are you sure you want to delete this class? This action cannot be undone.")},X=()=>{i.value.length&&M("delete-bulk",[...i.value],"Are you sure you want to delete all selected classes? This action cannot be undone.")},Z=()=>{A.value==="delete-single"&&v.value?m.delete(route("classes.destroy",v.value),{preserveScroll:!0}):A.value==="delete-bulk"&&Array.isArray(v.value)&&(S.value=!0,m.post(route("classes.bulk-delete"),{ids:v.value},{preserveScroll:!0,onSuccess:()=>{m.reload({only:["classes"]})},onFinish:()=>{S.value=!1,i.value=[]}})),O()},ee=l=>{const s=u.value.indexOf(l);s===-1?u.value.push(l):u.value.splice(s,1)},se=()=>{if(!x.value||h.value)return;h.value=!0;const l=[{class_id:x.value,subject_ids:u.value}];m.post("/classes/assign-subjects",{assignments:l},{preserveScroll:!0,onSuccess:()=>{m.reload({only:["classes"]})},onFinish:()=>{h.value=!1}})};return(l,s)=>(a(),o(f,null,[z(le(ae),{title:"Classes"}),z(ie,null,{header:P(()=>[e("div",ue,[s[4]||(s[4]=e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Classes "),e("p",{class:"mt-1 text-sm text-gray-500"}," Manage classes and inline assign subjects to each class. ")],-1)),e("div",ce,[e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700",onClick:q}," + Add Class "),e("button",{type:"button",class:"rounded-md bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 ring-1 ring-red-100 hover:bg-red-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!i.value.length||S.value,onClick:X},[S.value?(a(),o("span",me,[...s[3]||(s[3]=[e("span",{class:"inline-flex h-3 w-3 animate-spin rounded-full border border-red-500 border-t-transparent"},null,-1),e("span",null,"Deleting...",-1)])])):(a(),o("span",ge,"Bulk Delete"))],8,pe)])])]),default:P(()=>[e("div",xe,[e("div",be,[s[8]||(s[8]=e("div",{class:"flex flex-wrap items-center gap-3"},[e("div",{class:"flex flex-col gap-1"},[e("span",{class:"text-[11px] font-semibold uppercase tracking-wide text-gray-500"}," Assign Subjects to a Class "),e("span",{class:"text-[11px] text-gray-500"}," Chagua darasa kisha weka alama kwenye masomo unayotaka lifundishwe; masomo ya msingi yatajiwekwa alama kiotomatiki kama darasa halina masomo bado. ")])],-1)),e("div",ve,[e("div",ye,[s[6]||(s[6]=e("label",{class:"mb-1 block text-[11px] font-medium text-gray-700"},"Select Class",-1)),N(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[s[5]||(s[5]=e("option",{value:"",disabled:""},"Select class...",-1)),(a(!0),o(f,null,C(c,t=>(a(),o("option",{key:t.id,value:t.id},r(t.name)+" (ID #"+r(t.id)+") ",9,fe))),128))],512),[[H,x.value]])]),e("div",he,[e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:!x.value||h.value,onClick:se},[h.value?(a(),o("span",Ce,"Saving...")):(a(),o("span",ke,"Save Assignments"))],8,_e)])]),x.value?(a(),o("div",we,[s[7]||(s[7]=e("p",{class:"mb-2 text-[11px] font-medium text-gray-700"},"Subjects",-1)),e("div",Se,[(a(!0),o(f,null,C(w.subjects,t=>(a(),o("label",{key:t.id,class:U(["inline-flex items-center gap-1 rounded-full border px-2 py-1 text-[10px] font-medium",u.value.includes(t.id)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50"])},[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",value:t.id,checked:u.value.includes(t.id),onChange:g=>ee(t.id)},null,40,je),e("span",null,r(t.subject_code),1)],2))),128))])])):y("",!0)]),e("div",Ae,[e("table",Ie,[e("thead",null,[e("tr",Ee,[e("th",De,[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:V(),onChange:J},null,40,Fe)]),s[9]||(s[9]=e("th",{class:"w-16 px-3 py-2"},"ID No",-1)),s[10]||(s[10]=e("th",{class:"px-3 py-2"},"Class",-1)),s[11]||(s[11]=e("th",{class:"px-3 py-2"},"Subjects Assigned",-1)),s[12]||(s[12]=e("th",{class:"px-3 py-2 text-right"},"Actions",-1))])]),e("tbody",null,[c.length===0?(a(),o("tr",Be,[...s[13]||(s[13]=[e("td",{colspan:"4",class:"px-3 py-4 text-center text-xs text-gray-500"}," No classes defined yet. ",-1)])])):y("",!0),(a(!0),o(f,null,C(c,t=>(a(),o("tr",{key:t.id,class:"border-b border-gray-100 text-xs text-gray-700 hover:bg-gray-50"},[e("td",Ne,[e("input",{type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:i.value.includes(t.id),onChange:g=>Y(t.id)},null,40,Me)]),e("td",Oe,[e("span",Ve,"#"+r(t.id),1)]),e("td",$e,[e("div",Te,[e("span",ze,r(t.name),1),t.description?(a(),o("span",Pe,r(t.description),1)):y("",!0)])]),e("td",He,[e("div",Ue,[e("span",Ge,r(w.subjects.filter(g=>t.subject_ids.map(B=>String(B)).includes(String(g.id))).map(g=>g.subject_code).join(", ")||"None"),1)])]),e("td",Le,[e("div",qe,[e("button",{type:"button",class:"rounded-md bg-blue-50 px-2 py-1 text-[11px] font-medium text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",onClick:g=>R(t)}," Edit ",8,Ke),e("button",{type:"button",class:"rounded-md bg-red-50 px-2 py-1 text-[11px] font-medium text-red-700 ring-1 ring-red-100 hover:bg-red-100",onClick:g=>W(t.id)}," Delete ",8,Re)])])]))),128))])])])]),j.value?(a(),o("div",Ye,[e("div",Je,[e("div",Qe,[e("h3",We,r(_.value?"Edit Class":"Add Class"),1),e("button",{type:"button",class:"text-sm text-gray-400 hover:text-gray-600",onClick:I}," âœ• ")]),e("form",{class:"space-y-3 text-xs text-gray-700",onSubmit:oe(Q,["prevent"])},[b.value?(a(),ne(re,{key:0,variant:"danger",title:"Could not save class",message:b.value},null,8,["message"])):y("",!0),e("div",Xe,[e("div",null,[s[14]||(s[14]=e("label",{class:"mb-1 block font-medium"},"Class Name",-1)),N(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>d.name=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A",required:""},null,512),[[de,d.name]])]),e("div",null,[s[16]||(s[16]=e("label",{class:"mb-1 block font-medium"},"Level (optional)",-1)),N(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>d.level=t),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[s[15]||(s[15]=e("option",{value:""},"Select level...",-1)),(a(!0),o(f,null,C(l.levelOptions,t=>(a(),o("option",{key:t,value:t},r(t),9,Ze))),128))],512),[[H,d.level]])])]),e("div",null,[s[17]||(s[17]=e("label",{class:"mb-1 block font-medium"},"Assign Subjects",-1)),e("div",es,[(a(!0),o(f,null,C(w.subjects,t=>(a(),o("button",{key:t.id,type:"button",class:U(["rounded-full px-2 py-0.5 text-[10px] font-medium ring-1",p.value.includes(t.id)?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:g=>p.value=p.value.includes(t.id)?p.value.filter(B=>B!==t.id):[...p.value,t.id]},r(t.subject_code),11,ss))),128))])]),e("div",ts,[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 text-xs font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:I}," Cancel "),e("button",{type:"submit",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:k.value},[k.value?(a(),o("span",as,"Saving...")):(a(),o("span",os,"Save"))],8,ls)])],32)])])):y("",!0),D.value?(a(),o("div",ns,[e("div",ds,[s[18]||(s[18]=e("h3",{class:"mb-2 text-sm font-semibold text-gray-800"}," Please confirm ",-1)),e("p",is,r(F.value),1),e("div",{class:"mt-2 flex justify-end gap-2 text-xs"},[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:O}," Cancel "),e("button",{type:"button",class:"rounded-md bg-red-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-red-700",onClick:Z}," Confirm ")])])])):y("",!0)]),_:1})],64))}};export{gs as default};

import{y as De,j as y,i as w,I as H,B as Ne,c as i,a as ue,u as g,h as Le,w as me,b as t,d as I,k as C,o as d,F as x,r as S,t as b,p as z,f as pe,x as J,s as U,v as R}from"./app-dOKA643X.js";import{_ as je}from"./AuthenticatedLayout-y1wcQ2Iu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"flex items-center justify-between"},Re={class:"flex items-center gap-2"},$e={class:"space-y-4"},Me={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},Fe={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},Ve={class:"flex flex-wrap items-center gap-2"},Oe=["value"],Ye={key:0,value:"",disabled:""},Ue=["value"],Pe={class:"flex flex-wrap items-center gap-2"},Be={id:"class-timetable-preview",class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[10px] text-gray-800"},Ke={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},We={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},qe={class:"text-[9px] text-gray-600"},Ge={class:"text-[9px] text-gray-700"},Xe={class:"font-semibold"},He={key:0},ze={class:"font-semibold"},Je={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},Qe={class:"ml-1"},Ze={class:"ml-1"},et={class:"text-right"},tt={class:"ml-1"},st={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},rt={class:"min-w-full border-collapse text-[9px] leading-tight"},lt=["rowspan"],ot=["rowspan"],at={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},nt=["draggable","onDragstart","onDrop"],it={class:"text-[8px] text-gray-600"},dt=["draggable","onDragstart","onDrop"],ut={key:0,class:"font-semibold text-orange-700"},mt={class:"text-[8px] text-gray-600"},pt=["draggable","onDragstart","onDrop"],bt={key:0},ct={key:1},gt={key:2},xt={class:"text-[8px] text-gray-600"},ft={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},yt={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},vt={class:"mb-3 flex items-center justify-between"},ht={class:"space-y-3"},_t={class:"grid grid-cols-3 gap-2"},wt={class:"grid grid-cols-2 gap-3"},St={class:"grid grid-cols-2 gap-3"},kt={class:"grid grid-cols-2 gap-2"},At={class:"mt-3 flex items-center justify-end gap-2"},Ct={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},It={class:"max-h-full w-full max-w-4xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},Tt={class:"mb-3 flex items-center justify-between"},Dt={class:"mb-3 flex flex-wrap items-end gap-3"},Nt=["value"],Lt={key:0,class:"text-[11px] text-gray-500"},jt={class:"overflow-hidden rounded-lg border border-gray-200"},Et={class:"min-w-full border-collapse text-[11px]"},Rt={key:0},$t={class:"border-b border-gray-100 px-3 py-2"},Mt={class:"font-medium text-gray-800"},Ft={class:"text-[10px] text-gray-500"},Vt={class:"border-b border-gray-100 px-3 py-2"},Ot={class:"font-medium text-gray-800"},Yt={class:"text-[10px] text-gray-500"},Ut={class:"border-b border-gray-100 px-3 py-2"},Pt=["disabled","value","onInput"],Bt={class:"mt-4 flex items-center justify-end gap-2"},Kt=["disabled"],Wt=["disabled"],Ht={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]}},setup(be){var oe,ae,ne,ie;const f=be,p=De({type:"class",title:((oe=f.timetable)==null?void 0:oe.title)||"",class_name:((ae=f.timetable)==null?void 0:ae.class_name)||"",academic_year:((ne=f.timetable)==null?void 0:ne.academic_year)||String(new Date().getFullYear()),term:((ie=f.timetable)==null?void 0:ie.term)||"",start_time:"07:30",end_time:"16:00"}),ce=y(()=>f.school.name||"Your School Name"),ge=y(()=>f.school.address||"P.O. Box 123, City"),xe=y(()=>f.school.region||"Region"),fe=y(()=>p.type==="invigilation"?"Invigilation Timetable":p.type==="exams"?"Exams Timetable":"School General Timetable"),ye=y(()=>(f.subjects||[]).map(r=>r.subject_code)),ve=y(()=>{const r={};return(f.subjects||[]).forEach(e=>{const s=(e.teachers||[])[0];s&&(r[e.subject_code]=s.initials||s.name)}),r}),Q=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],T=r=>{const e={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII"};if(r==null)return"";const s=String(r).trim();if(s==="")return"";const o=Number(s);if(!Number.isNaN(o)&&e[o])return e[o];const a=s.toUpperCase();if(/^[IVXLCDM]+$/.test(a))return a;const m=a.match(/\b(?:FORM|CLASS|STD|STANDARD)\s*([IVXLCDM]+|\d+)\b/);if(m){const l=m[1],n=Number(l);if(!Number.isNaN(n)&&e[n])return e[n];if(/^[IVXLCDM]+$/.test(l))return l}return""},$=r=>{if(!r)return null;const e=String(r).toUpperCase().trim();if(!e)return null;const s={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};let o=0,a=0;for(let m=e.length-1;m>=0;m-=1){const l=s[e[m]];if(!l)return null;l<a?o-=l:(o+=l,a=l)}return o},Z=r=>{const e=P(r);if(!e)return Number.POSITIVE_INFINITY;const s=$(e);return s===null?Number.POSITIVE_INFINITY:s},P=r=>T(r==null?void 0:r.parent_name)||T(r==null?void 0:r.level)||T(r==null?void 0:r.name),F=r=>{const e=((r==null?void 0:r.parent_name)||"").trim();if(e)return e;const s=((r==null?void 0:r.name)||"").trim();if(s&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(s))return s;const o=((r==null?void 0:r.level)||"").trim();if(o&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(o))return o;const a=P(r);return a?`Form ${a}`:o||s},V=y(()=>{const r=Array.isArray(f.classes)?f.classes:[],e=new Map;r.forEach(l=>{!l||!l.parent_class_id||!(l.stream&&String(l.stream).trim())||(e.has(l.parent_class_id)||e.set(l.parent_class_id,[]),e.get(l.parent_class_id).push(l))});const s=[];r.filter(l=>!(l!=null&&l.parent_class_id)).forEach(l=>{const n=e.get(l.id)||[];if(n.length){n.slice().sort((c,u)=>String(c.stream||"").localeCompare(String(u.stream||""))).forEach(c=>s.push(c));return}s.push(l)});const o=new Set(r.filter(l=>!(l!=null&&l.parent_class_id)).map(l=>l.id));r.filter(l=>(l==null?void 0:l.parent_class_id)&&!o.has(l.parent_class_id)).forEach(l=>s.push(l));const a=new Set;return s.filter(l=>{const n=l==null?void 0:l.id;return n==null||a.has(n)?!1:(a.add(n),!0)}).sort((l,n)=>{const c=Z(l),u=Z(n);if(c!==u)return c-u;const _=(l!=null&&l.stream?String(l.stream):"").toUpperCase(),Y=(n!=null&&n.stream?String(n.stream):"").toUpperCase(),de=_.localeCompare(Y);return de!==0?de:((l==null?void 0:l.id)||0)-((n==null?void 0:n.id)||0)})}),he=y(()=>{const r=new Set;return V.value.forEach(s=>{const o=F(s);o&&r.add(o)}),r.size===0?["Form I","Form II","Form III","Form IV"]:Array.from(r.values()).sort((s,o)=>{const a=T(s),m=T(o),l=$(a)??Number.POSITIVE_INFINITY,n=$(m)??Number.POSITIVE_INFINITY;return l!==n?l-n:String(s).localeCompare(String(o))})}),B=y(()=>{const r=new Set;return V.value.forEach(e=>{const s=e.stream?String(e.stream).toUpperCase().trim():"";if(s){if(v.value!=="ALL"){const o=F(e);if(o&&o!==v.value)return}r.add(s)}}),r.size===0?[]:Array.from(r.values())}),v=w("ALL"),k=w("ALL");H(v,()=>{k.value!=="ALL"&&(B.value.includes(k.value)||(k.value="ALL"))});const _e=y(()=>v.value!=="ALL"&&k.value!=="ALL"?`${v.value} ${k.value}`:v.value!=="ALL"?`${v.value}`:p.class_name||"____"),D=w({}),ee=y(()=>{var e;return`timetable_schedule_v1_${((e=f.school)==null?void 0:e.id)??"school"}`}),we=()=>{try{const r=window.localStorage.getItem(ee.value);if(!r)return null;const e=JSON.parse(r);return!e||typeof e!="object"?null:e}catch{return null}},te=()=>{try{window.localStorage.setItem(ee.value,JSON.stringify(D.value||{}))}catch{}},se=()=>{const r={},e=ye.value,s=ve.value;if(!e.length){D.value={};return}Q.forEach(o=>{r[o]=[],V.value.forEach(a=>{const m=P(a),l=F(a),n=a.stream?String(a.stream).toUpperCase().trim():"",c=Array.isArray(a.subject_codes)&&a.subject_codes.length?a.subject_codes:e,u={form:m,class_label:l,stream:n,class_name:a.name||`${l} ${n}`.trim(),slots:[]};for(let _=0;_<8;_+=1){const Y=c[Math.floor(Math.random()*c.length)];u.slots.push({subject:Y,teacher:s[Y]||""})}r[o].push(u)})}),D.value=r,te()},Se=r=>(D.value[r]||[]).map((s,o)=>({row:s,originalIndex:o})).filter(({row:s})=>(v.value==="ALL"||s.class_label===v.value)&&(k.value==="ALL"||s.stream===k.value)),re=r=>{const e=Se(r),s=[],o=new Map;return e.forEach(a=>{const m=a.row.class_label||a.row.form||"",l=m.trim()||"UNKNOWN";o.has(l)||(o.set(l,s.length),s.push({key:l,label:m,rows:[]})),s[o.get(l)].rows.push(a)}),s.sort((a,m)=>{const l=T(a.label),n=T(m.label),c=$(l)??Number.POSITIVE_INFINITY,u=$(n)??Number.POSITIVE_INFINITY;return c!==u?c-u:String(a.label||"").localeCompare(String(m.label||""))})},ke=r=>re(r).reduce((e,s)=>e+s.rows.length,0);Ne(()=>{const r=we();if(r){D.value=r;return}se()});const L=w(!1),Ae=()=>{p.post(route("timetables.store"),{preserveScroll:!0,onSuccess:()=>{L.value=!1}})},Ce=()=>{window.print()},N=w(!1),h=w(""),K=w(!1),M=w(!1),j=w({}),Ie=()=>{var r;return((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},W=y(()=>{const r=[];return(f.subjects||[]).forEach(e=>{(Array.isArray(e.teachers)?e.teachers:[]).forEach(o=>{o!=null&&o.id&&r.push({teacher_id:o.id,teacher_name:o.name,teacher_initials:o.initials,subject_id:e.id,subject_code:e.subject_code,subject_name:e.name})})}),r.sort((e,s)=>{const o=String(e.teacher_name||"").localeCompare(String(s.teacher_name||""));return o!==0?o:String(e.subject_code||"").localeCompare(String(s.subject_code||""))})}),q=y(()=>V.value.map(r=>{const e=F(r)||r.name||"",s=r.stream?String(r.stream).toUpperCase().trim():"",o=s?`${e} ${s}`:e;return{id:String(r.id),display:o}})),O=(r,e)=>`${r}:${e}`,le=async()=>{if(!h.value){j.value={};return}K.value=!0;try{const e=await(await fetch(`${route("timetables.weekly-limits.index")}?school_class_id=${encodeURIComponent(h.value)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json(),s={};((e==null?void 0:e.limits)||[]).forEach(o=>{s[O(o.teacher_id,o.subject_id)]=o.periods_per_week}),j.value=s}catch{j.value={}}finally{K.value=!1}},Te=async()=>{if(h.value){M.value=!0;try{const r=W.value.map(e=>{const s=O(e.teacher_id,e.subject_id),o=j.value[s];return{school_class_id:Number(h.value),subject_id:e.subject_id,teacher_id:e.teacher_id,periods_per_week:o===""||o===null||o===void 0?0:Number(o)}}).filter(e=>Number.isFinite(e.periods_per_week)&&e.periods_per_week>=0);await fetch(route("timetables.weekly-limits.save"),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Ie()},credentials:"same-origin",body:JSON.stringify({limits:r})}),N.value=!1}finally{M.value=!1}}};H(N,r=>{r&&(!h.value&&q.value.length&&(h.value=q.value[0].id),le())}),H(h,()=>{N.value&&le()});const E=w(null),A=(r,e)=>e>=0&&e<=2?!0:e>=3&&e<=5?!(r==="FRIDAY"&&e===5):e>=6&&e<=7?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(r):!1,G=(r,e,s)=>{E.value={day:r,rowIndex:e,slotIndex:s}},X=(r,e,s)=>{var n,c;if(!E.value)return;const o=E.value;if(o.day===r&&o.rowIndex===e&&o.slotIndex===s){E.value=null;return}const a=(n=D.value[o.day])==null?void 0:n[o.rowIndex],m=(c=D.value[r])==null?void 0:c[e];if(!a||!m){E.value=null;return}const l=a.slots[o.slotIndex];a.slots[o.slotIndex]=m.slots[s],m.slots[s]=l,te(),E.value=null};return(r,e)=>(d(),i(x,null,[ue(g(Le),{title:"Create School Timetable"}),ue(je,null,{header:me(()=>[t("div",Ee,[e[22]||(e[22]=t("div",null,[t("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),t("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),t("div",Re,[t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=s=>L.value=!0)}," Create / Edit Timetable Details ")])])]),default:me(()=>[t("div",$e,[t("div",Me,[e[40]||(e[40]=t("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),t("div",Fe,[t("div",Ve,[e[25]||(e[25]=t("span",{class:"font-semibold"},"View class:",-1)),C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[23]||(e[23]=t("option",{value:"ALL"},"All Classes",-1)),(d(!0),i(x,null,S(he.value,s=>(d(),i("option",{key:s,value:s},b(s),9,Oe))),128))],512),[[z,v.value]]),C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[24]||(e[24]=t("option",{value:"ALL"},"All Streams",-1)),B.value.length?I("",!0):(d(),i("option",Ye,"No streams")),(d(!0),i(x,null,S(B.value,s=>(d(),i("option",{key:s,value:s},"Stream "+b(s),9,Ue))),128))],512),[[z,k.value]])]),t("div",Pe,[t("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:se}," Regenerate Sample Timetable "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[3]||(e[3]=s=>N.value=!0)}," Limitations & More "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:Ce}," Print "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[4]||(e[4]=s=>L.value=!0)}," Open Timetable Details ")])]),t("div",Be,[t("div",Ke,[e[28]||(e[28]=t("div",{class:"mb-1 flex justify-center"},[t("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),t("div",We,b(ce.value),1),t("div",qe,b(ge.value)+" · "+b(xe.value),1),e[29]||(e[29]=t("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),t("div",Ge,[e[27]||(e[27]=pe(" Mwaka: ",-1)),t("span",Xe,b(g(p).academic_year||"____"),1),v.value!=="ALL"?(d(),i("span",He,[e[26]||(e[26]=pe(" · Darasa: ",-1)),t("span",ze,b(_e.value),1)])):I("",!0)])]),t("div",Je,[t("div",null,[e[30]||(e[30]=t("span",{class:"font-semibold"},"Kichwa:",-1)),t("span",Qe,b(g(p).title||"Ratiba ya Darasa"),1)]),t("div",null,[e[31]||(e[31]=t("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),t("span",Ze,b(g(p).start_time)+" - "+b(g(p).end_time),1)]),t("div",et,[e[32]||(e[32]=t("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),t("span",tt,b(fe.value),1)])]),t("div",st,[t("table",rt,[e[39]||(e[39]=t("thead",null,[t("tr",null,[t("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),t("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),t("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),t("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),t("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),t("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),t("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),t("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),t("tbody",null,[(d(),i(x,null,S(Q,s=>(d(),i(x,{key:s},[(d(!0),i(x,null,S(re(s),(o,a)=>(d(),i(x,{key:`${s}-${o.key}`},[(d(!0),i(x,null,S(o.rows,({row:m,originalIndex:l},n)=>(d(),i("tr",{key:`${s}-${o.key}-${m.stream}-${l}`},[a===0&&n===0?(d(),i("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:ke(s)||1},b(s),9,lt)):I("",!0),n===0?(d(),i("td",{key:1,class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold",rowspan:o.rows.length},b(o.label||m.class_label||m.form),9,ot)):I("",!0),t("td",at,b(m.stream),1),e[33]||(e[33]=t("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[t("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[34]||(e[34]=t("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(d(!0),i(x,null,S(m.slots.slice(0,3),(c,u)=>(d(),i("td",{key:`am-${u}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center",draggable:A(s,u),onDragstart:_=>A(s,u)&&G(s,l,u),onDragover:e[5]||(e[5]=J(()=>{},["prevent"])),onDrop:_=>A(s,u)&&X(s,l,u)},[t("div",null,b(c.subject),1),t("div",it,b(c.teacher),1)],40,nt))),128)),e[35]||(e[35]=t("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(d(!0),i(x,null,S(m.slots.slice(3,6),(c,u)=>(d(),i("td",{key:`mid-${u}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center",draggable:A(s,3+u),onDragstart:_=>A(s,3+u)&&G(s,l,3+u),onDragover:e[6]||(e[6]=J(()=>{},["prevent"])),onDrop:_=>A(s,3+u)&&X(s,l,3+u)},[s==="FRIDAY"&&u===2?(d(),i("div",ut,"MEWAKA")):(d(),i(x,{key:1},[t("div",null,b(c.subject),1),t("div",mt,b(c.teacher),1)],64))],40,dt))),128)),e[36]||(e[36]=t("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(d(!0),i(x,null,S(m.slots.slice(6,8),(c,u)=>(d(),i("td",{key:`pm-${u}`,class:U(["border border-slate-300 px-1 py-1 text-center",s==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":s==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":s==="FRIDAY"?"bg-lime-300 text-[9px] font-semibold text-lime-900":"bg-indigo-50"]),draggable:A(s,6+u),onDragstart:_=>A(s,6+u)&&G(s,l,6+u),onDragover:e[7]||(e[7]=J(()=>{},["prevent"])),onDrop:_=>A(s,6+u)&&X(s,l,6+u)},[s==="WEDNESDAY"?(d(),i("div",bt,"RELIGION")):s==="THURSDAY"?(d(),i("div",ct,"DEBATE OR CLUBS")):s==="FRIDAY"?(d(),i("div",gt,"SPORTS AND GAMES")):(d(),i(x,{key:3},[t("div",null,b(c.subject),1),t("div",xt,b(c.teacher),1)],64))],42,pt))),128)),e[37]||(e[37]=t("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128))],64))),128)),e[38]||(e[38]=t("tr",null,[t("td",{colspan:16,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])])]),L.value?(d(),i("div",ft,[t("div",yt,[t("div",vt,[e[41]||(e[41]=t("div",null,[t("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),t("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),t("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[8]||(e[8]=s=>L.value=!1)}," Close ")]),t("div",ht,[t("div",null,[e[42]||(e[42]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),t("div",_t,[t("button",{type:"button",class:U(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",g(p).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[9]||(e[9]=s=>g(p).type="class")}," Class Timetable ",2),t("button",{type:"button",class:U(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",g(p).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[10]||(e[10]=s=>g(p).type="invigilation")}," Invigilation ",2),t("button",{type:"button",class:U(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",g(p).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[11]||(e[11]=s=>g(p).type="exams")}," Exams Timetable ",2)])]),t("div",null,[e[43]||(e[43]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),C(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>g(p).title=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[R,g(p).title]])]),t("div",wt,[t("div",null,[e[44]||(e[44]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),C(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>g(p).class_name=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[R,g(p).class_name]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),C(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>g(p).term=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[R,g(p).term]])])]),t("div",St,[t("div",null,[e[46]||(e[46]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),C(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>g(p).academic_year=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[R,g(p).academic_year]])]),t("div",kt,[t("div",null,[e[47]||(e[47]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),C(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>g(p).start_time=s),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[R,g(p).start_time]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),C(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>g(p).end_time=s),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[R,g(p).end_time]])])])]),e[49]||(e[49]=t("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),t("div",At,[t("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[18]||(e[18]=s=>L.value=!1)}," Cancel "),t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:Ae}," Generate & Save Timetable ")])])])])):I("",!0),N.value?(d(),i("div",Ct,[t("div",It,[t("div",Tt,[e[50]||(e[50]=t("div",null,[t("h3",{class:"text-sm font-semibold text-gray-800"}," Limitations & More "),t("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Weka vipindi kwa wiki kwa kila mwalimu na somo kwa darasa/stream. ")],-1)),t("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[19]||(e[19]=s=>N.value=!1)}," Close ")]),t("div",Dt,[t("div",null,[e[52]||(e[52]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Stream",-1)),C(t("select",{"onUpdate:modelValue":e[20]||(e[20]=s=>h.value=s),class:"w-64 rounded-md border border-gray-300 bg-white px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[51]||(e[51]=t("option",{value:"",disabled:""},"Select class",-1)),(d(!0),i(x,null,S(q.value,s=>(d(),i("option",{key:s.id,value:s.id},b(s.display),9,Nt))),128))],512),[[z,h.value]])]),K.value?(d(),i("div",Lt,"Loading...")):I("",!0)]),t("div",jt,[t("table",Et,[e[54]||(e[54]=t("thead",null,[t("tr",{class:"bg-gray-50 text-left"},[t("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),t("th",{class:"border-b border-gray-200 px-3 py-2"},"Subject"),t("th",{class:"border-b border-gray-200 px-3 py-2"},"Periods / Week")])],-1)),t("tbody",null,[W.value.length?I("",!0):(d(),i("tr",Rt,[...e[53]||(e[53]=[t("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"}," No teacher-subject mappings found. ",-1)])])),(d(!0),i(x,null,S(W.value,s=>(d(),i("tr",{key:`${s.teacher_id}-${s.subject_id}`,class:"hover:bg-gray-50"},[t("td",$t,[t("div",Mt,b(s.teacher_name),1),t("div",Ft,b(s.teacher_initials),1)]),t("td",Vt,[t("div",Ot,b(s.subject_code),1),t("div",Yt,b(s.subject_name),1)]),t("td",Ut,[t("input",{type:"number",min:"0",max:"50",class:"w-24 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!h.value,value:j.value[O(s.teacher_id,s.subject_id)]??0,onInput:o=>{j.value[O(s.teacher_id,s.subject_id)]=o.target.value}},null,40,Pt)])]))),128))])])]),t("div",Bt,[t("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",disabled:M.value,onClick:e[21]||(e[21]=s=>N.value=!1)}," Cancel ",8,Kt),t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:M.value||!h.value,onClick:Te},b(M.value?"Saving...":"Save Limitations"),9,Wt)])])])):I("",!0)])]),_:1})],64))}};export{Ht as default};

import{i as F,j as U,I as Oe,y as zt,c as _,a as ot,u as D,h as Rt,w as at,d as O,b as s,o as v,x as me,f as se,t as A,F as M,r as H,s as be,k as Q,v as le,p as nt}from"./app-D_wv2evS.js";import{_ as Gt}from"./AuthenticatedLayout-CBksOQ8E.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Yt={class:"flex items-center justify-between"},Ht={key:0,class:"mb-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[10px] text-amber-900"},Wt={class:"mt-1 max-h-24 overflow-y-auto"},qt={class:"flex items-center gap-2"},Xt={class:"max-h-full w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},Jt={class:"mb-3 flex items-center justify-between"},Zt={class:"mb-3 flex flex-wrap items-center justify-between gap-2"},Qt={class:"text-[11px] text-gray-600"},es={class:"font-semibold"},ts={class:"font-semibold"},ss={class:"overflow-hidden rounded-lg border border-gray-200"},rs={class:"min-w-full border-collapse text-[11px]"},os={key:0},as={class:"border-b border-gray-100 px-3 py-2 font-semibold text-gray-800"},ns={class:"border-b border-gray-100 px-3 py-2"},ls={class:"border-b border-gray-100 px-3 py-2"},is={class:"max-h-full w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},ds={class:"mb-3 flex items-center justify-between"},cs={class:"mb-3 grid grid-cols-1 gap-2 sm:grid-cols-2"},us={class:"flex items-center justify-end gap-2"},ms={class:"max-h-[55vh] overflow-y-auto rounded-lg border border-gray-200 bg-gray-50 p-3"},bs={key:0,class:"py-6 text-center text-[11px] text-gray-500"},ps={key:1,class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},gs=["checked","onChange"],fs={class:"font-semibold text-gray-800"},hs={class:"mt-4 flex items-center justify-end gap-2"},xs={key:2,class:"fixed inset-0 z-50 pointer-events-none"},ys={class:"absolute inset-y-0 right-0 flex w-[340px] max-w-[90vw] pointer-events-auto"},_s={class:"flex h-full w-full flex-col overflow-hidden rounded-l-2xl bg-white shadow-2xl ring-1 ring-gray-200"},vs={class:"p-4"},Ss={class:"mb-3 text-[11px] text-gray-500"},ks={class:"font-semibold"},ws={key:0},js={class:"font-semibold"},Cs={class:"flex-1 overflow-y-auto rounded-lg border border-gray-200 bg-gray-50 p-2"},Ns={key:0,class:"px-2 py-6 text-center text-xs text-gray-500"},Bs={key:1,class:"flex flex-wrap gap-2"},As=["onDragstart"],Vs={class:"space-y-4"},Es={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},Is={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},Ds={class:"flex flex-wrap items-center gap-2"},Ts=["value"],Ls={key:0,value:"",disabled:""},$s=["value"],Ms={class:"flex flex-wrap items-center gap-2"},Us=["disabled"],Ps=["disabled"],Fs={key:1,class:"mb-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[10px] text-amber-900"},Os={class:"mt-1 max-h-24 overflow-y-auto"};const Ks={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},zs={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},Rs={class:"text-[9px] text-gray-600"},Gs={class:"text-[9px] text-gray-700"},Ys={class:"font-semibold"},Hs={key:0},Ws={class:"font-semibold"},qs={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},Xs={class:"ml-1"},Js={class:"ml-1"},Zs={class:"text-right"},Qs={class:"ml-1"},er={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},tr={class:"min-w-full border-collapse text-[10px] leading-tight"},sr=["rowspan"],rr=["rowspan"],or={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},ar=["draggable","onDragstart","onDrop"],nr={key:0,class:"ml-1 rounded bg-emerald-200 px-1 text-[8px] font-bold text-emerald-900"},lr={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},ir={key:1},dr=["draggable","onDragstart","onDrop"],cr={key:0,class:"font-semibold text-orange-700"},ur={key:0,class:"ml-1 rounded bg-indigo-200 px-1 text-[8px] font-bold text-indigo-900"},mr={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},br={key:1},pr=["draggable","onDragstart","onDrop"],gr={key:0},fr={key:1},hr={key:2},xr={key:0,class:"ml-1 rounded bg-slate-200 px-1 text-[8px] font-bold text-slate-900"},yr={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},_r={key:1,class:"font-semibold text-gray-400"},vr={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},Sr={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},kr={class:"mb-3 flex items-center justify-between"},wr={class:"space-y-3"},jr={class:"grid grid-cols-3 gap-2"},Cr={class:"grid grid-cols-2 gap-3"},Nr={class:"grid grid-cols-2 gap-3"},Br={class:"grid grid-cols-2 gap-2"},Ar={class:"mt-3 flex items-center justify-end gap-2"},Vr=["disabled"];const Mr={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},teacherAssignments:{type:Object,default:()=>({})}},setup(lt){var We,qe,Xe,Je,Ze;const L=lt,ve=F(""),ie=F({}),Se=F(!1),Ae=F(!1),pe=F(!1),ee=F({type:"",message:""}),ke=F(""),Ve=F(""),Er=U(()=>{var e;const r=ve.value?Number(ve.value):null;return!Number.isFinite(r)||!r?{}:((e=ie.value)==null?void 0:e[String(r)])||{}}),ge=U(()=>{const r=new Set;return(L.subjects||[]).forEach(e=>{const t=String((e==null?void 0:e.subject_code)||"").trim();t&&r.add(t)}),Array.from(r.values()).sort((e,t)=>String(e).localeCompare(String(t)))}),G=F([]);Oe(ge,r=>{(!Array.isArray(G.value)||G.value.length===0)&&(G.value=Array.isArray(r)?r.slice():[])},{immediate:!0});const Ke=U(()=>{const r=String(Ve.value||"").trim().toUpperCase();return r?(ge.value||[]).filter(e=>String(e).toUpperCase().includes(r)):ge.value}),it=()=>{Ae.value=!0},dt=()=>{Ae.value=!1,ke.value=""},ze=U(()=>{const r=new Set((G.value||[]).map(t=>String(t).trim())),e=String(ke.value||"").trim().toUpperCase();return(ge.value||[]).filter(t=>r.has(String(t).trim())).filter(t=>e?String(t).toUpperCase().includes(e):!0)}),Ir=(r,e)=>{const t=ve.value?Number(ve.value):null;!Number.isFinite(t)||!t||(ie.value[String(t)]||(ie.value[String(t)]={}),e==="morning"||e==="afternoon"?ie.value[String(t)][String(r)]=e:delete ie.value[String(t)][String(r)],jt())},I=zt({type:"class",title:((We=L.timetable)==null?void 0:We.title)||"",class_name:((qe=L.timetable)==null?void 0:qe.class_name)||"",academic_year:((Xe=L.timetable)==null?void 0:Xe.academic_year)||String(new Date().getFullYear()),term:((Je=L.timetable)==null?void 0:Je.term)||"",start_time:"07:30",end_time:"16:00",schedule_json:((Ze=L.timetable)==null?void 0:Ze.schedule_json)||null}),ct=U(()=>L.school.name||"Your School Name"),ut=U(()=>L.school.address||"P.O. Box 123, City"),mt=U(()=>L.school.region||"Region"),bt=U(()=>I.type==="invigilation"?"Invigilation Timetable":I.type==="exams"?"Exams Timetable":"School General Timetable"),pt=U(()=>(L.subjects||[]).map(r=>r.subject_code)),gt=U(()=>{const r={};return(L.classes||[]).forEach(e=>{e!=null&&e.id&&(r[String(e.id)]=e)}),r}),ft=U(()=>{const r={};return(L.subjects||[]).forEach(e=>{!(e!=null&&e.subject_code)||!(e!=null&&e.id)||(r[String(e.subject_code)]=Number(e.id))}),r});U(()=>{const r={};return(L.subjects||[]).forEach(e=>{(Array.isArray(e==null?void 0:e.teachers)?e.teachers:[]).forEach(d=>{if(!(d!=null&&d.id))return;const n=String((d==null?void 0:d.initials)||"").trim();n&&(r[n]||(r[n]=Number(d.id)))})}),r});const Ee=(r,e)=>{var c,x,f,N,C,p;const t=r?String(r):"",d=String(e||"").trim(),n=(c=gt.value)==null?void 0:c[t],m=n!=null&&n.parent_class_id?String(n.parent_class_id):"",i=(x=L.teacherAssignments)==null?void 0:x[t],a=i!==void 0?i:m?(f=L.teacherAssignments)==null?void 0:f[m]:null;if(a&&typeof a=="object"){const S=a==null?void 0:a[d];return S?String(S):""}const o=(C=(N=L.teacherAssignments)==null?void 0:N[t])==null?void 0:C[d];return o?String(o):((p=ht.value)==null?void 0:p[d])||""},te=(r,e,t,d)=>{const n=Ee(r,e),m=String(e||"").trim().toUpperCase(),a=String(n||"").split("/").map(f=>f.trim()).filter(Boolean).filter(f=>String(f).trim().toUpperCase()!==m);if(!a.length)return"";if(a.length===1)return a[0];if(a.length===2)return`${a[0]}/${a[1]}`;const o=String(t||"").toUpperCase(),c=V.indexOf(o),x=Math.max(0,c)*31+Number(d||0);return a[x%a.length]},ht=U(()=>{const r={};return(L.subjects||[]).forEach(e=>{const t=Array.isArray(e.teachers)?e.teachers:[];if(!(e!=null&&e.subject_code)||!t.length)return;const d=t.map(m=>String((m==null?void 0:m.initials)||"").trim()||simpleTeacherName(m==null?void 0:m.name)||String((m==null?void 0:m.name)||"").trim()).filter(Boolean);if(!d.length)return;const n=Array.from(new Set(d));r[e.subject_code]=n.join("/")}),r}),V=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],Ie=r=>{const e={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII"};if(r==null)return"";const t=String(r).trim();if(t==="")return"";const d=Number(t);if(!Number.isNaN(d)&&e[d])return e[d];const n=t.toUpperCase(),m={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7};if(m[n]&&e[m[n]])return e[m[n]];const i=n.match(/\b(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN)\b/);if(i){const o=m[i[1]];if(o&&e[o])return e[o]}if(/^[IVXLCDM]+$/.test(n))return n;const a=n.match(/\b(?:FORM|CLASS|STD|STANDARD)\s*(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN|[IVXLCDM]+|\d+)\b/);if(a){const o=a[1],c=m[o];if(c&&e[c])return e[c];const x=Number(o);if(!Number.isNaN(x)&&e[x])return e[x];if(/^[IVXLCDM]+$/.test(o))return o}return""},xt=r=>{if(!r)return null;const e=String(r).toUpperCase().trim();if(!e)return null;const t={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};let d=0,n=0;for(let m=e.length-1;m>=0;m-=1){const i=t[e[m]];if(!i)return null;i<n?d-=i:(d+=i,n=i)}return d},Re=r=>{const e=fe(r);if(!e)return Number.POSITIVE_INFINITY;const t=xt(e);return t===null?Number.POSITIVE_INFINITY:t},fe=r=>Ie(r==null?void 0:r.parent_name)||Ie(r==null?void 0:r.level)||Ie(r==null?void 0:r.name),de=r=>{const e=((r==null?void 0:r.parent_name)||"").trim();if(e)return e;const t=((r==null?void 0:r.name)||"").trim();if(t&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(t))return t;const d=((r==null?void 0:r.level)||"").trim();if(d&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(d))return d;const n=fe(r);return n?`Form ${n}`:d||t},ce=U(()=>{const r=Array.isArray(L.classes)?L.classes:[],e=new Map;r.forEach(i=>{!i||!i.parent_class_id||!(i.stream&&String(i.stream).trim())||(e.has(i.parent_class_id)||e.set(i.parent_class_id,[]),e.get(i.parent_class_id).push(i))});const t=[];r.filter(i=>!(i!=null&&i.parent_class_id)).forEach(i=>{const a=e.get(i.id)||[];if(a.length){a.slice().sort((o,c)=>String(o.stream||"").localeCompare(String(c.stream||""))).forEach(o=>t.push(o));return}t.push(i)});const d=new Set(r.filter(i=>!(i!=null&&i.parent_class_id)).map(i=>i.id));r.filter(i=>(i==null?void 0:i.parent_class_id)&&!d.has(i.parent_class_id)).forEach(i=>t.push(i));const n=new Set;return t.filter(i=>{const a=i==null?void 0:i.id;return a==null||n.has(a)?!1:(n.add(a),!0)}).sort((i,a)=>{const o=i!=null&&i.parent_class_id&&r.find(y=>Number(y==null?void 0:y.id)===Number(i.parent_class_id))||i,c=a!=null&&a.parent_class_id&&r.find(y=>Number(y==null?void 0:y.id)===Number(a.parent_class_id))||a,x=Re(o),f=Re(c);if(x!==f)return Number(x||0)-Number(f||0);const N=i!=null&&i.parent_class_id?Number(i.parent_class_id):Number((i==null?void 0:i.id)||0),C=a!=null&&a.parent_class_id?Number(a.parent_class_id):Number((a==null?void 0:a.id)||0);if(N!==C)return N-C;const p=(i!=null&&i.stream?String(i.stream):"").toUpperCase(),S=(a!=null&&a.stream?String(a.stream):"").toUpperCase(),k=p.localeCompare(S);return k!==0?k:Number((i==null?void 0:i.id)||0)-Number((a==null?void 0:a.id)||0)})}),yt=U(()=>{const r=new Set,e=[];return(ce.value||[]).forEach(t=>{const d=de(t);if(!d)return;const n=String(d);r.has(n)||(r.add(n),e.push(d))}),e}),De=U(()=>{const r=new Set;return ce.value.forEach(e=>{const t=e.stream?String(e.stream).toUpperCase().trim():"";if(t){if(Y.value!=="ALL"){const d=de(e);if(d&&d!==Y.value)return}r.add(t)}}),r.size===0?[]:Array.from(r.values())}),Y=F("ALL"),q=F("ALL");Oe(Y,()=>{q.value!=="ALL"&&(De.value.includes(q.value)||(q.value="ALL"))});const _t=U(()=>Y.value!=="ALL"&&q.value!=="ALL"?`${Y.value} ${q.value}`:Y.value!=="ALL"?`${Y.value}`:I.class_name||"____"),Ge=r=>{var i;const e=String(r||"").toUpperCase(),d=(Array.isArray((i=W.value)==null?void 0:i[e])?W.value[e]:[]).map((a,o)=>({row:a,originalIndex:o})).filter(({row:a})=>!(!a||Y.value!=="ALL"&&String(a.class_label||a.form||"").trim()!==Y.value||q.value!=="ALL"&&String(a.stream||"").toUpperCase().trim()!==String(q.value||"").toUpperCase().trim())),n=new Map;d.forEach(({row:a,originalIndex:o})=>{const c=String(a.class_label||a.form||"").trim()||"CLASS",x=c;n.has(x)||n.set(x,{key:x,label:c,rows:[]}),n.get(x).rows.push({row:a,originalIndex:o})});const m=Array.from(n.values());return m.forEach(a=>{a.rows.sort((o,c)=>{var x,f;return String(((x=o.row)==null?void 0:x.stream)||"").localeCompare(String(((f=c.row)==null?void 0:f.stream)||""))})}),m},vt=r=>Ge(r).reduce((e,t)=>{var d;return e+(((d=t==null?void 0:t.rows)==null?void 0:d.length)||0)},0),W=F({}),St=()=>{const r={};V.forEach(e=>{r[e]=[],(ce.value||[]).forEach(t=>{r[e].push({form:fe(t),class_label:de(t),stream:t!=null&&t.stream?String(t.stream).toUpperCase().trim():"",school_class_id:t!=null&&t.id?Number(t.id):null,class_name:(t==null?void 0:t.name)||`${de(t)} ${t!=null&&t.stream?String(t.stream).toUpperCase().trim():""}`.trim(),slots:Array.from({length:9}).map(()=>null)})})}),W.value=r};Oe(()=>ce.value,r=>{if(!r||!r.length)return;const e=W.value;e&&typeof e=="object"&&Object.keys(e).length||St()},{immediate:!0});const K=F([]),Te=F(0),kt=F(!1);F(!1),F({}),F({status:"idle",attempts:0,message:""});const wt=U(()=>{var e;return`timetable_subject_session_rules_v1_${((e=L.school)==null?void 0:e.id)??"school"}`}),jt=()=>{try{window.localStorage.setItem(wt.value,JSON.stringify(ie.value||{}))}catch{}},Ct=r=>r>=0&&r<=3?"morning":r>=7&&r<=8?"afternoon":"other",Nt=(r,e)=>{var n;if(!r||!e)return"any";const t=((n=ie.value)==null?void 0:n[String(r)])||{},d=t==null?void 0:t[String(e)];return d==="morning"||d==="afternoon"?d:"any"},X=(r,e,t)=>{var o;const d=new Set(["ENG","B/MAT"]),n=String(e||"").trim().toUpperCase(),m=Ct(t);if(d.has(n))return t===4?!0:m==="morning";const i=((o=ft.value)==null?void 0:o[String(e)])||null,a=Nt(r,i);return a==="any"?!0:m===a},z=(r,e)=>e>=7&&e<=8?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(r):!(r==="FRIDAY"&&e===6),J=(r,e)=>{const t=String(r||"").toUpperCase(),d=Number(e);return!Number.isFinite(d)||d<0||d>8?!1:z(t,d)},Bt=U(()=>{var e;return`timetable_schedule_v3_${((e=L.school)==null?void 0:e.id)??"school"}`}),Ye=r=>{if(!r||typeof r!="object")return{};const e={};return Object.keys(r).forEach(t=>{const d=Array.isArray(r[t])?r[t]:[];e[t]=d.map(n=>{const m=Array.isArray(n==null?void 0:n.slots)?n.slots:[],i=Array.from({length:9}).map((a,o)=>{const c=m[o];if(c==null)return null;if(typeof c=="string"){const x=String(c||"").trim();return x?{subject:x,teacher:"",teacher_initials:"",teacher_name:""}:{subject:"",teacher:"",teacher_initials:"",teacher_name:""}}if(typeof c=="object"){const x=String((c==null?void 0:c.subject)??"").trim(),f=String((c==null?void 0:c.teacher)??"").trim(),N=String((c==null?void 0:c.teacher_initials)??f).trim(),C=String((c==null?void 0:c.teacher_name)??"").trim();return!x&&!f&&!N&&!C?null:{subject:x,teacher:f,teacher_initials:N,teacher_name:C}}return null});return{...n||{},slots:i}})}),e},we=()=>{try{window.localStorage.setItem(Bt.value,JSON.stringify(W.value||{}))}catch{}},At=()=>{K.value=[];const r={};V.forEach(o=>{r[o]=[]}),pt.value;const e={};V.forEach(o=>{e[o]=Array.from({length:9}).map(()=>new Set)});const t=(o,c,x)=>{const f=String(o||"").toUpperCase(),N=Number(c);if(!e[f]||!e[f][N])return;String(x||"").split("/").map(p=>p.trim()).filter(Boolean).forEach(p=>e[f][N].add(p))},d=(o,c,x)=>{const f=String(o||"").toUpperCase(),N=Number(c);if(!e[f]||!e[f][N])return!0;const C=String(x||"").split("/").map(p=>p.trim()).filter(Boolean);return C.length?C.every(p=>!e[f][N].has(p)):!0},n=o=>String(o||"").trim().toUpperCase(),m=(o,c)=>c>=0&&c<=2?z(o,c)&&z(o,c+1):c===7?z(o,7)&&z(o,8):!1,i=o=>[0,1,2,7].filter(c=>m(o,c)),a={};(ce.value||[]).forEach(o=>{const c=o!=null&&o.id?Number(o.id):null,x=fe(o),f=de(o),N=o!=null&&o.stream?String(o.stream).toUpperCase().trim():"",C=o!=null&&o.parent_class_id?Number(o.parent_class_id):c||null,p=C?String(C):"",S=o!=null&&o.parent_class_id&&(Array.isArray(L.classes)?L.classes:[]).find(l=>Number(l==null?void 0:l.id)===Number(o.parent_class_id))||null,y=Array.isArray(o==null?void 0:o.subject_codes)&&o.subject_codes.length?o.subject_codes:Array.isArray(S==null?void 0:S.subject_codes)&&S.subject_codes.length?S.subject_codes:[],E=l=>{const u=n(l);return u?u==="PS"?!0:!!String(Ee(c,u)||"").trim():!1},w=(l,u,b)=>{const g=n(b);if(!g||g==="PS")return"";const h=Ee(c,g),j=String(h||"").split("/").map(ne=>ne.trim()).filter(Boolean).filter(ne=>String(ne).trim().toUpperCase()!==g);if(!j.length)return"";const B=String(l||"").toUpperCase(),Z=V.indexOf(B),oe=Math.max(0,Z)*31+Number(u||0),ae=j.slice(oe%j.length).concat(j.slice(0,oe%j.length));for(let ne=0;ne<ae.length;ne+=1){const rt=ae[ne];if(d(l,u,rt))return rt}return""},T=(y||[]).map(n).filter(Boolean).filter(l=>E(l)),he=Array.from(new Set(T)),xe=l=>he.includes(n(l)),re="PS",$={};V.forEach(l=>{const u={form:x,class_label:f,stream:N,school_class_id:c,class_name:(o==null?void 0:o.name)||`${f} ${N}`.trim(),slots:Array.from({length:9}).map(()=>null)};for(let b=0;b<9;b+=1)z(l,b)||(u.slots[b]={subject:"",teacher:"",teacher_initials:"",teacher_name:""});$[l]=u,r[l].push(u)});const R={},P={};["ENG","B/MAT"].forEach(l=>{xe(l)&&(R[l]=(R[l]||0)+3,P[l]=(P[l]||0)+2)}),he.forEach(l=>{l==="ENG"||l==="B/MAT"||(R[l]=(R[l]||0)+1,P[l]=(P[l]||0)+1)});const ue={},Qe=(l,u)=>{const b=n(l);ue[b]=(ue[b]||0)+u},je=(l,u)=>{var g,h;const b=(h=(g=$==null?void 0:$[l])==null?void 0:g.slots)==null?void 0:h[u];return b!=null&&b.subject?n(b.subject):""},et=(l,u)=>{const b=n(u),g=$==null?void 0:$[l],h=Array.isArray(g==null?void 0:g.slots)?g.slots:[],j=[];for(let B=0;B<h.length;B+=1)je(l,B)===b&&j.push(B);return j},ye=(l,u,b)=>{if(!m(l,u))return!1;const g=$[l];if(!g||g.slots[u]!==null||g.slots[u+1]!==null||n(b)!=="PS"&&et(l,b).length>0||!X(c,b,u)||!X(c,b,u+1))return!1;const h=n(b);return!(h!=="PS"&&(!w(l,u,h)||!w(l,u+1,h)))},Ce=(l,u,b)=>{const g=$[l];if(!g||!z(l,u)||g.slots[u]!==null)return!1;const h=et(l,b),j=n(b),B=h.length===1?h[0]:null,Z=B!==null&&Math.abs(B-u)===1;if(j!=="PS"&&(h.length>=2||h.length===1&&!Z)||!X(c,b,u)||j!=="PS"&&!w(l,u,j))return!1;const oe=u>0&&![4,7].includes(u)?je(l,u-1):"";if(oe&&oe===n(b)&&!Z)return!1;const ae=u+1<9&&![3,6].includes(u)?je(l,u+1):"";return!(ae&&ae===n(b)&&!Z)},_e=(l,u,b)=>{const g=$[l],h=c?w(l,u,b):"",j=c?w(l,u+1,b):"";if(g.slots[u]={subject:b,teacher:h,teacher_initials:h,teacher_name:""},g.slots[u+1]={subject:b,teacher:j,teacher_initials:j,teacher_name:""},t(l,u,h),t(l,u+1,j),Qe(b,2),p){a[p]||(a[p]={});const B=String(l||"").toUpperCase();a[p][B]||(a[p][B]={}),a[p][B][String(u)]=n(b)}},Ne=(l,u,b)=>{const g=$[l],h=c?w(l,u,b):"";g.slots[u]=b?{subject:b,teacher:h,teacher_initials:h,teacher_name:""}:null,t(l,u,h),Qe(b,1)},Lt=l=>l[Math.floor(Math.random()*l.length)],tt=[];V.forEach(l=>{i(l).forEach(u=>tt.push({day:l,i:u}))}),p&&a[p]&&V.forEach(l=>{var g;const u=String(l||"").toUpperCase(),b=((g=a[p])==null?void 0:g[u])||{};Object.keys(b).forEach(h=>{const j=Number(h),B=b[h];B&&((P[B]||0)<=0||ye(l,j,B)&&(_e(l,j,B),P[B]-=1))})}),Object.keys(P).forEach(l=>{const u=P[l]||0;for(let b=0;b<u;b+=1){const g=tt.filter(({day:B,i:Z})=>ye(B,Z,l));if(!g.length)break;const{day:h,i:j}=Lt(g);_e(h,j,l),P[l]-=1}});const Be=l=>{let u=0;return i(l).forEach(g=>{var B,Z,oe,ae;const h=(Z=(B=$==null?void 0:$[l])==null?void 0:B.slots)==null?void 0:Z[g],j=(ae=(oe=$==null?void 0:$[l])==null?void 0:oe.slots)==null?void 0:ae[g+1];h!=null&&h.subject&&(j!=null&&j.subject)&&String(h.subject)===String(j.subject)&&(u+=1)}),u},$t=(l,u)=>{const b=n(u),g=$==null?void 0:$[l];return g?(g.slots||[]).some(h=>(h==null?void 0:h.subject)&&n(h.subject)===b):!1},Mt=["ENG","B/MAT"].filter(l=>xe(l)),Ut=(l,u)=>{const b=[4,0,1,2,3,5,6,7,8];for(let g=0;g<b.length;g+=1){const h=b[g];if(Ce(l,h,u))return Ne(l,h,u),R[u]-=1,!0}return!1},Pt=(l,u)=>{const b=i(l);for(let g=0;g<b.length;g+=1){const h=b[g];if(ye(l,h,u))return _e(l,h,u),P[u]-=1,!0}return!1},Ft=l=>{const u=i(l),b=Object.keys(P).filter(g=>(P[g]||0)>0).sort((g,h)=>(ue[g]||0)-(ue[h]||0));for(let g=0;g<u.length;g+=1){const h=u[g];for(let j=0;j<b.length;j+=1){const B=b[j];if(ye(l,h,B))return _e(l,h,B),P[B]-=1,!0}}return!1},Ot=()=>Object.values(P).reduce((l,u)=>l+(Number(u)||0),0),st=2;for(;Ot()>0;){const l=V.slice().sort((b,g)=>Be(b)-Be(g));let u=!1;for(let b=0;b<l.length;b+=1){const g=l[b];if(!(Be(g)>=st)&&Ft(g)){u=!0;break}}if(!u)break}V.forEach(l=>{Mt.forEach(u=>{$t(l,u)||(P[u]||0)>0&&Be(l)<st&&Pt(l,u)||(R[u]||0)>0&&Ut(l,u)||K.value.push(`Could not place ${u} for ${f}${N?` ${N}`:""} on ${l}.`)})}),Object.keys(P).forEach(l=>{for(;(P[l]||0)>0;){let u=!1;for(let b=0;b<V.length&&!u;b+=1){const g=V[b],h=i(g);for(let j=0;j<h.length;j+=1){const B=h[j];if(ye(g,B,l)){_e(g,B,l),P[l]-=1,u=!0;break}}}if(!u){K.value.push(`Could not place all required double periods for ${l} in ${f}${N?` ${N}`:""}.`);break}}}),Object.keys(R).forEach(l=>{for(;(R[l]||0)>0;){let u=!1;for(let b=0;b<V.length&&!u;b+=1){const g=V[b],h=l==="ENG"||l==="B/MAT"?[4,0,1,2,3,5,6,7,8]:[0,1,2,3,4,5,6,7,8];for(let j=0;j<h.length;j+=1){const B=h[j];if(Ce(g,B,l)){Ne(g,B,l),R[l]-=1,u=!0;break}}}if(!u){K.value.push(`Could not place all required single periods for ${l} in ${f}${N?` ${N}`:""}.`);break}}}),V.forEach(l=>{for(let u=0;u<9;u+=1){if(!z(l,u)||$[l].slots[u]!==null)continue;const b=Object.keys(R).filter(h=>(R[h]||0)>0).filter(h=>Ce(l,u,h));if(!b.length)continue;b.sort((h,j)=>(R[j]||0)-(R[h]||0));const g=b[0];Ne(l,u,g),R[g]-=1}});const Kt=(l,u)=>{const b=u>0&&![4,7].includes(u)?je(l,u-1):"",g=he.filter(h=>Ce(l,u,h)).filter(h=>!b||b!==n(h));return g.length?(g.sort((h,j)=>(ue[h]||0)-(ue[j]||0)),g[0]||re):re};V.forEach(l=>{for(let u=0;u<9;u+=1){if(!z(l,u)||$[l].slots[u]!==null)continue;const b=Kt(l,u);b&&Ne(l,u,b)}})}),W.value=Ye(r),we()},Vt=()=>{At(),Te.value+=1},Et=()=>{K.value=[];const r={};V.forEach(n=>{r[n]=[]});const e={};V.forEach(n=>{e[n]=Array.from({length:9}).map(()=>new Set)});const t={};V.forEach(n=>{t[n]=Array.from({length:9}).map(()=>new Set)});const d={};(ce.value||[]).forEach(n=>{const m=n==null?void 0:n.id,i=de(n),a=n!=null&&n.stream?String(n.stream).toUpperCase().trim():"",o=Array.isArray(n==null?void 0:n.subject_codes)?n.subject_codes:[],c=[...new Set(o.map(p=>String(p).trim().toUpperCase()).filter(Boolean))],x=`${m}_${a}`;d[x]={},c.forEach(p=>{d[x][p]={doublesPlaced:0,singlesPlaced:0,totalPeriods:0,lastDay:null,doubleTarget:p==="ENG"||p==="B/MAT"?2:1,singleTarget:p==="ENG"||p==="B/MAT"?3:1}});const f={};V.forEach(p=>{const S={form:fe(n),class_label:i,stream:a,school_class_id:m,class_name:(n==null?void 0:n.name)||`${i} ${a}`.trim(),slots:Array.from({length:9}).map(()=>null)};f[p]=S,r[p].push(S)}),c.filter(p=>p==="ENG"||p==="B/MAT").forEach(p=>{const S=d[x][p];for(let k=0;k<2;k+=1){let y=!1;for(let E=0;E<V.length&&!y;E+=1){const w=V[E];if(S.lastDay!==w){for(let T=0;T<=2;T+=1)if(Le(w,T,p,m,f[w],e,t)){$e(w,T,p,m,f[w],e,t),S.doublesPlaced+=1,S.totalPeriods+=2,S.lastDay=w,y=!0;break}}}y||K.value.push(`Could not place double for ${p} in ${i}${a}`)}for(let k=0;k<V.length;k+=1){const y=V[k];if(S.lastDay!==y&&Me(y,4,p,m,f[y],e,t)){Ue(y,4,p,m,f[y],e,t),S.singlesPlaced+=1,S.totalPeriods+=1,S.lastDay=y;break}}for(let k=0;k<2;k+=1){let y=!1;for(let E=0;E<V.length&&!y;E+=1){const w=V[E];if(S.lastDay!==w){for(let T=0;T<9;T+=1)if(T!==4&&z(w,T)&&Me(w,T,p,m,f[w],e,t)){Ue(w,T,p,m,f[w],e,t),S.singlesPlaced+=1,S.totalPeriods+=1,S.lastDay=w,y=!0;break}}}y||K.value.push(`Could not place single for ${p} in ${i}${a}`)}}),c.filter(p=>p!=="ENG"&&p!=="B/MAT"&&p!=="PS").forEach(p=>{const S=d[x][p];let k=!1;for(let E=0;E<V.length&&!k;E+=1){const w=V[E];if(S.lastDay!==w){for(let T=0;T<=2;T+=1)if(Le(w,T,p,m,f[w],e,t)){$e(w,T,p,m,f[w],e,t),S.doublesPlaced+=1,S.totalPeriods+=2,S.lastDay=w,k=!0;break}!k&&Le(w,7,p,m,f[w],e,t)&&($e(w,7,p,m,f[w],e,t),S.doublesPlaced+=1,S.totalPeriods+=2,S.lastDay=w,k=!0)}}k||K.value.push(`Could not place double for ${p} in ${i}${a}`);let y=!1;for(let E=0;E<V.length&&!y;E+=1){const w=V[E];if(S.lastDay!==w){for(let T=0;T<9;T+=1)if(z(w,T)&&Me(w,T,p,m,f[w],e,t)){Ue(w,T,p,m,f[w],e,t),S.singlesPlaced+=1,S.totalPeriods+=1,S.lastDay=w,y=!0;break}}}y||K.value.push(`Could not place single for ${p} in ${i}${a}`)}),V.forEach(p=>{const S=f[p],k=String(p||"").toUpperCase();for(let y=0;y<9;y+=1)z(k,y)&&S.slots[y]===null&&X(m,"PS",y)&&!t[k][y].has("PS")&&(S.slots[y]={subject:"PS",teacher:"",teacher_initials:"",teacher_name:""},t[k][y].add("PS"))})}),W.value=Ye(r),we(),Te.value+=1},He=(r,e)=>{const t=String(e||"").trim().toUpperCase();return t?(Array.isArray(r==null?void 0:r.slots)?r.slots:[]).some(n=>(n==null?void 0:n.subject)&&String(n.subject).trim().toUpperCase()===t):!1},Le=(r,e,t,d,n,m,i)=>{var p,S,k,y;const a=String(r||"").toUpperCase(),o=String(t||"").trim().toUpperCase();if(!o||e<0||e>7||!z(a,e)||!z(a,e+1)||n.slots[e]!==null||n.slots[e+1]!==null||o!=="PS"&&He(n,o)||(S=(p=i==null?void 0:i[a])==null?void 0:p[e])!=null&&S.has(o)||(y=(k=i==null?void 0:i[a])==null?void 0:k[e+1])!=null&&y.has(o)||!X(d,o,e)||!X(d,o,e+1))return!1;const c=te(d,o,a,e),x=te(d,o,a,e+1);if(!c||!x)return!1;const f=c.split("/").map(E=>E.trim()).filter(Boolean),N=x.split("/").map(E=>E.trim()).filter(Boolean),C=[...f,...N];for(let E=0;E<C.length;E+=1){const w=C[E];if(m[a][e].has(w)||m[a][e+1].has(w))return!1}return!0},$e=(r,e,t,d,n,m,i)=>{const a=String(r||"").toUpperCase(),o=String(t||"").trim().toUpperCase(),c=te(d,o,a,e),x=te(d,o,a,e+1);n.slots[e]={subject:o,teacher:c,teacher_initials:c,teacher_name:""},n.slots[e+1]={subject:o,teacher:x,teacher_initials:x,teacher_name:""};const f=c.split("/").map(C=>C.trim()).filter(Boolean),N=x.split("/").map(C=>C.trim()).filter(Boolean);f.forEach(C=>m[a][e].add(C)),N.forEach(C=>m[a][e+1].add(C)),i[a][e].add(o),i[a][e+1].add(o)},Me=(r,e,t,d,n,m,i)=>{var f,N;const a=String(r||"").toUpperCase(),o=String(t||"").trim().toUpperCase();if(!o||!z(a,e)||n.slots[e]!==null||o!=="PS"&&He(n,o)||(N=(f=i==null?void 0:i[a])==null?void 0:f[e])!=null&&N.has(o)||!X(d,o,e))return!1;const c=te(d,o,a,e);if(!c&&o!=="PS")return!1;const x=c.split("/").map(C=>C.trim()).filter(Boolean);for(let C=0;C<x.length;C+=1){const p=x[C];if(m[a][e].has(p))return!1}return!0},Ue=(r,e,t,d,n,m,i)=>{const a=String(r||"").toUpperCase(),o=String(t||"").trim().toUpperCase(),c=te(d,o,a,e);n.slots[e]={subject:o,teacher:c,teacher_initials:c,teacher_name:""},c.split("/").map(f=>f.trim()).filter(Boolean).forEach(f=>m[a][e].add(f)),i[a][e].add(o)},It=(r,e,t,d)=>{var C,p;const n=String(r),m=Number(e),i=Number(t),a=String(d||"").trim();if(a&&!new Set((G.value||[]).map(k=>String(k).trim().toUpperCase())).has(a.toUpperCase()))return ee.value={type:"error",message:"This subject is not assigned. Use Assign to enable it."},!1;if(!J(n,i))return!1;const o=(p=(C=W.value)==null?void 0:C[n])==null?void 0:p[m];if(!o)return!1;const c=S=>String(S||"").trim().toUpperCase(),x=c(a);if(x&&x!=="PS"){const S=(Array.isArray(o==null?void 0:o.slots)?o.slots:[]).map((k,y)=>({idx:y,subject:c(k==null?void 0:k.subject)})).filter(({subject:k})=>k===x).map(({idx:k})=>k).filter(k=>k!==i);if(S.length>=2)return ee.value={type:"error",message:"This subject already appears twice today (max is 2)."},!1;if(S.length===1){const k=S[0];if(!(Math.abs(k-i)===1))return ee.value={type:"error",message:"This subject can only appear twice in a day as a double period (place it next to the first one)."},!1}}const f=Number((o==null?void 0:o.school_class_id)||(o==null?void 0:o.id)||(o==null?void 0:o.class_id)||0)||null;if(a&&!X(f,a,i))return ee.value={type:"error",message:"This subject is not allowed in this period."},!1;if(a&&Tt(n,i,m,a))return ee.value={type:"error",message:"Teacher clash detected for this period."},!1;ee.value={type:"",message:""};const N=a?te(f,a,n,i):"";return o.slots[i]=a?{subject:a,teacher:N,teacher_initials:N,teacher_name:""}:null,we(),!0},Pe=(r,e,t)=>{draggedCell.value={day:r,rowIndex:e,slotIndex:t}},Dt=r=>{draggedSubjectCode.value=String(r||"").trim(),draggedCell.value=null},Tt=(r,e,t,d)=>{var N,C,p,S;const n=String(r),m=Number(e),i=String(d||"").trim();if(!i)return!1;const a=(C=(N=W.value)==null?void 0:N[n])==null?void 0:C[Number(t)],o=Number((a==null?void 0:a.school_class_id)||(a==null?void 0:a.id)||(a==null?void 0:a.class_id)||(a==null?void 0:a.classId)||(a==null?void 0:a.schoolClassId)||0)||null,c=te(o,i,n,m),x=String(c||"").split("/").map(k=>k.trim()).filter(Boolean);if(!x.length)return!1;const f=((p=W.value)==null?void 0:p[n])||[];for(let k=0;k<f.length;k+=1){if(k===Number(t))continue;const y=f[k],E=(S=y==null?void 0:y.slots)==null?void 0:S[m],w=E!=null&&E.subject?String(E.subject):"";if(!w)continue;const T=Number((y==null?void 0:y.school_class_id)||(y==null?void 0:y.id)||(y==null?void 0:y.class_id)||(y==null?void 0:y.classId)||(y==null?void 0:y.schoolClassId)||0)||null,he=te(T,w,n,m),xe=String(he||"").split("/").map(re=>re.trim()).filter(Boolean);if(xe.length){for(let re=0;re<x.length;re+=1)if(xe.includes(x[re]))return!0}}return!1},Fe=(r,e,t)=>{var C,p;if(draggedSubjectCode.value){It(r,e,t,draggedSubjectCode.value),draggedSubjectCode.value="",draggedCell.value=null;return}if(!draggedCell.value)return;const d=draggedCell.value;if(d.day===r&&d.rowIndex===e&&d.slotIndex===t){draggedCell.value=null;return}const n=(C=W.value[d.day])==null?void 0:C[d.rowIndex],m=(p=W.value[r])==null?void 0:p[e];if(!n||!m){draggedCell.value=null;return}const i=n.slots[d.slotIndex],a=m.slots[t],o=i,c=Number((n==null?void 0:n.school_class_id)||(n==null?void 0:n.id)||(n==null?void 0:n.class_id)||(n==null?void 0:n.classId)||(n==null?void 0:n.schoolClassId)||0)||null,x=Number((m==null?void 0:m.school_class_id)||(m==null?void 0:m.id)||(m==null?void 0:m.class_id)||(m==null?void 0:m.classId)||(m==null?void 0:m.schoolClassId)||0)||null,f=!(a!=null&&a.subject)||X(c,a.subject,d.slotIndex),N=!(o!=null&&o.subject)||X(x,o.subject,t);if(!f||!N){draggedCell.value=null;return}n.slots[d.slotIndex]=a,m.slots[t]=o,we(),draggedCell.value=null};return(r,e)=>(v(),_(M,null,[ot(D(Rt),{title:"Create School Timetable"}),ot(Gt,null,{header:at(()=>[s("div",Yt,[e[42]||(e[42]=s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),s("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),K.value.length?(v(),_("div",Ht,[e[41]||(e[41]=s("div",{class:"font-semibold"},"Limitations check:",-1)),s("div",Wt,[(v(!0),_(M,null,H(K.value,(t,d)=>(v(),_("div",{key:d},A(t),1))),128))])])):O("",!0),s("div",qt,[s("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=t=>r.showDetailsModal=!0)}," Create / Edit Timetable Details ")])])]),default:at(()=>[Se.value?(v(),_("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[3]||(e[3]=me(t=>Se.value=!1,["self"]))},[s("div",Xt,[s("div",Jt,[e[43]||(e[43]=s("div",null,[s("h3",{class:"text-sm font-semibold text-gray-800"}," Teacher Initials Details "),s("p",{class:"mt-0.5 text-[11px] text-gray-500"},' Orodha ya walimu wote na initials zao. Zilizotumika kwenye ratiba zitaonyesha "Used". ')],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[1]||(e[1]=t=>Se.value=!1)}," Close ")]),s("div",Zt,[s("div",Qt,[e[44]||(e[44]=se(" Used initials: ",-1)),s("span",es,A(r.usedTeacherInitials.size),1),e[45]||(e[45]=se(" / Total teachers: ",-1)),s("span",ts,A(r.teacherInitialsList.length),1)]),s("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-emerald-500 focus:ring-offset-1",onClick:e[2]||(e[2]=(...t)=>r.downloadTeacherInitials&&r.downloadTeacherInitials(...t))}," Download (CSV) ")]),s("div",ss,[s("table",rs,[e[47]||(e[47]=s("thead",null,[s("tr",{class:"bg-gray-50 text-left"},[s("th",{class:"border-b border-gray-200 px-3 py-2"},"Initials"),s("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),s("th",{class:"border-b border-gray-200 px-3 py-2"},"Used")])],-1)),s("tbody",null,[r.teacherInitialsList.length?O("",!0):(v(),_("tr",os,[...e[46]||(e[46]=[s("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"}," No teachers found. ",-1)])])),(v(!0),_(M,null,H(r.teacherInitialsList,t=>(v(),_("tr",{key:t.id,class:"hover:bg-gray-50"},[s("td",as,A(t.initials),1),s("td",ns,A(t.simple_name||t.name),1),s("td",ls,[s("span",{class:be(["inline-flex rounded-full px-2 py-0.5 text-[10px] font-semibold",t.used?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-700"])},A(t.used?"Used":"Not used"),3)])]))),128))])])])])])):O("",!0),pe.value?(v(),_("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[9]||(e[9]=me(t=>pe.value=!1,["self"]))},[s("div",is,[s("div",ds,[e[48]||(e[48]=s("div",null,[s("div",{class:"text-sm font-semibold text-gray-800"},"Assign Subjects"),s("div",{class:"text-[11px] text-gray-500"},"Chagua masomo yatakayopatikana kwenye ratiba (palette).")],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[4]||(e[4]=t=>pe.value=!1)}," Close ")]),s("div",cs,[Q(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>Ve.value=t),type:"text",placeholder:"Search subject...",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[le,Ve.value]]),s("div",us,[s("button",{type:"button",class:"rounded-md bg-white px-3 py-2 text-[11px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[6]||(e[6]=t=>G.value=ge.value.slice())}," Select all "),s("button",{type:"button",class:"rounded-md bg-white px-3 py-2 text-[11px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[7]||(e[7]=t=>G.value=[])}," Clear ")])]),s("div",ms,[Ke.value.length?(v(),_("div",ps,[(v(!0),_(M,null,H(Ke.value,t=>(v(),_("label",{key:t,class:"flex items-center gap-2 rounded-md bg-white px-3 py-2 text-[11px] ring-1 ring-gray-200"},[s("input",{type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",checked:G.value.includes(t),onChange:d=>{d.target.checked?G.value.includes(t)||(G.value=G.value.concat([t])):G.value=G.value.filter(n=>n!==t)}},null,40,gs),s("span",fs,A(t),1)]))),128))])):(v(),_("div",bs," No subjects found. "))]),s("div",hs,[s("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-2 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[8]||(e[8]=t=>pe.value=!1)}," Done ")])])])):O("",!0),Ae.value?(v(),_("div",xs,[s("div",ys,[s("div",_s,[s("div",{class:"flex items-center justify-between border-b border-gray-100 px-4 py-3"},[e[49]||(e[49]=s("div",null,[s("h3",{class:"text-sm font-semibold text-gray-800"},"Subjects"),s("p",{class:"text-[11px] text-gray-500"},"Drag and drop into the timetable.")],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:dt}," Close ")]),s("div",vs,[Q(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>ke.value=t),type:"text",placeholder:"Search subject...",class:"mb-2 w-full rounded-md border border-gray-300 px-3 py-2 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[le,ke.value]]),s("div",Ss,[e[51]||(e[51]=se(" Filter: ",-1)),s("span",ks,A(Y.value),1),q.value!=="ALL"?(v(),_("span",ws,[e[50]||(e[50]=se(" · Stream ",-1)),s("span",js,A(q.value),1)])):O("",!0)]),s("div",Cs,[ze.value.length?(v(),_("div",Bs,[(v(!0),_(M,null,H(ze.value,t=>(v(),_("div",{key:t,draggable:"true",class:"cursor-grab select-none rounded-md bg-white px-3 py-2 text-xs font-semibold text-gray-800 shadow-sm ring-1 ring-gray-200 hover:bg-gray-50 active:cursor-grabbing",onDragstart:d=>Dt(t)},A(t),41,As))),128))])):(v(),_("div",Ns," No subjects found for this class/stream. "))])])])])])):O("",!0),s("div",Vs,[s("div",Es,[e[71]||(e[71]=s("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),s("div",Is,[s("div",Ds,[e[54]||(e[54]=s("span",{class:"font-semibold"},"View class:",-1)),Q(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>Y.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[52]||(e[52]=s("option",{value:"ALL"},"All Classes",-1)),(v(!0),_(M,null,H(yt.value,t=>(v(),_("option",{key:t,value:t},A(t),9,Ts))),128))],512),[[nt,Y.value]]),Q(s("select",{"onUpdate:modelValue":e[12]||(e[12]=t=>q.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[53]||(e[53]=s("option",{value:"ALL"},"All Streams",-1)),De.value.length?O("",!0):(v(),_("option",Ls,"No streams")),(v(!0),_(M,null,H(De.value,t=>(v(),_("option",{key:t,value:t},"Stream "+A(t),9,$s))),128))],512),[[nt,q.value]])]),s("div",Ms,[s("button",{type:"button",class:"rounded-md bg-amber-50 px-2 py-1 text-[10px] font-medium text-amber-800 ring-1 ring-amber-100 hover:bg-amber-100",disabled:!K.value.length,onClick:e[13]||(e[13]=t=>kt.value=!0)}," Resolve ("+A(K.value.length)+") ",9,Us),s("button",{type:"button",class:"rounded-md bg-blue-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-blue-700",onClick:Et}," Generate with New Rules "),s("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:Vt}," Regenerate Sample Timetable "),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:it}," Subjects "),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[14]||(e[14]=t=>pe.value=!0)}," Assign "),s("button",{type:"button",class:"rounded-md bg-emerald-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:D(I).processing,onClick:e[15]||(e[15]=(...t)=>r.saveTimetable&&r.saveTimetable(...t))},A(D(I).processing?"Saving...":"Save"),9,Ps),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[16]||(e[16]=t=>Se.value=!0)}," Teacher Initials Details "),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[17]||(e[17]=(...t)=>r.printTimetable&&r.printTimetable(...t))}," Print ")])]),ee.value.message?(v(),_("div",{key:0,class:be(["mb-3 rounded-md border px-3 py-2 text-[11px]",ee.value.type==="error"?"border-red-200 bg-red-50 text-red-900":"border-emerald-200 bg-emerald-50 text-emerald-900"])},A(ee.value.message),3)):O("",!0),K.value.length?(v(),_("div",Fs,[e[55]||(e[55]=s("div",{class:"font-semibold"},"Limitations check:",-1)),s("div",Os,[(v(!0),_(M,null,H(K.value,(t,d)=>(v(),_("div",{key:d},A(t),1))),128))])])):O("",!0),O("",!0),(v(),_("div",{id:"class-timetable-preview",key:Te.value,class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[11px] text-gray-800",onContextmenu:e[21]||(e[21]=me(()=>{},["prevent"]))},[s("div",Ks,[e[59]||(e[59]=s("div",{class:"mb-1 flex justify-center"},[s("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),s("div",zs,A(ct.value),1),s("div",Rs,A(ut.value)+" · "+A(mt.value),1),e[60]||(e[60]=s("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),s("div",Gs,[e[58]||(e[58]=se(" Mwaka: ",-1)),s("span",Ys,A(D(I).academic_year||"____"),1),Y.value!=="ALL"?(v(),_("span",Hs,[e[57]||(e[57]=se(" · Darasa: ",-1)),s("span",Ws,A(_t.value),1)])):O("",!0)])]),s("div",qs,[s("div",null,[e[61]||(e[61]=s("span",{class:"font-semibold"},"Kichwa:",-1)),s("span",Xs,A(D(I).title||"Ratiba ya Darasa"),1)]),s("div",null,[e[62]||(e[62]=s("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),s("span",Js,A(D(I).start_time)+" - "+A(D(I).end_time),1)]),s("div",Zs,[e[63]||(e[63]=s("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),s("span",Qs,A(bt.value),1)])]),s("div",er,[s("table",tr,[e[70]||(e[70]=s("thead",null,[s("tr",null,[s("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),s("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),s("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),s("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),s("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),s("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:40 - 11:05 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),s("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),s("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),s("tbody",null,[(v(),_(M,null,H(V,t=>(v(),_(M,{key:t},[(v(!0),_(M,null,H(Ge(t),(d,n)=>(v(),_(M,{key:`${t}-${d.key}`},[(v(!0),_(M,null,H(d.rows,({row:m,originalIndex:i},a)=>(v(),_("tr",{key:`${t}-${d.key}-${m.stream}-${i}`},[n===0&&a===0?(v(),_("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:vt(t)||1},A(t),9,sr)):O("",!0),a===0?(v(),_("td",{key:1,class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold",rowspan:d.rows.length},A(d.label||m.class_label||m.form),9,rr)):O("",!0),s("td",or,A(m.stream),1),e[64]||(e[64]=s("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[s("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[65]||(e[65]=s("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(v(!0),_(M,null,H(m.slots.slice(0,4),(o,c)=>{var x;return v(),_("td",{key:`am-${c}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center",draggable:J(t,c),onDragstart:f=>J(t,c)&&Pe(t,i,c),onDragover:e[18]||(e[18]=me(()=>{},["prevent"])),onDrop:f=>J(t,c)&&Fe(t,i,c)},[o&&o.subject?(v(),_(M,{key:0},[s("div",null,[se(A(o.subject)+" ",1),(x=m.slots[c+1])!=null&&x.subject&&m.slots[c+1].subject===o.subject?(v(),_("span",nr," D ")):O("",!0)]),s("div",lr,A(o.teacher),1)],64)):(v(),_("div",ir," "))],40,ar)}),128)),e[66]||(e[66]=s("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(v(!0),_(M,null,H(m.slots.slice(4,7),(o,c)=>{var x;return v(),_("td",{key:`mid-${c}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center",draggable:J(t,4+c),onDragstart:f=>J(t,4+c)&&Pe(t,i,4+c),onDragover:e[19]||(e[19]=me(()=>{},["prevent"])),onDrop:f=>J(t,4+c)&&Fe(t,i,4+c)},[t==="FRIDAY"&&c===2?(v(),_("div",cr,"MEWAKA")):(v(),_(M,{key:1},[o&&o.subject?(v(),_(M,{key:0},[s("div",null,[se(A(o.subject)+" ",1),(x=m.slots[4+c+1])!=null&&x.subject&&m.slots[4+c+1].subject===o.subject?(v(),_("span",ur," D ")):O("",!0)]),s("div",mr,A(o.teacher),1)],64)):(v(),_("div",br," "))],64))],40,dr)}),128)),e[67]||(e[67]=s("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(v(!0),_(M,null,H(m.slots.slice(7,9),(o,c)=>{var x;return v(),_("td",{key:`pm-${c}`,class:be(["border border-slate-300 px-1 py-1 text-center",t==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":t==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":t==="FRIDAY"?"bg-lime-300 text-[9px] font-semibold text-lime-900":"bg-indigo-50"]),draggable:J(t,7+c),onDragstart:f=>J(t,7+c)&&Pe(t,i,7+c),onDragover:e[20]||(e[20]=me(()=>{},["prevent"])),onDrop:f=>J(t,7+c)&&Fe(t,i,7+c)},[t==="WEDNESDAY"?(v(),_("div",gr,"RELIGION")):t==="THURSDAY"?(v(),_("div",fr,"DEBATE OR CLUBS")):t==="FRIDAY"?(v(),_("div",hr,"SPORTS AND GAMES")):(v(),_(M,{key:3},[o&&o.subject?(v(),_(M,{key:0},[s("div",null,[se(A(o.subject)+" ",1),(x=m.slots[7+c+1])!=null&&x.subject&&m.slots[7+c+1].subject===o.subject?(v(),_("span",xr," D ")):O("",!0)]),s("div",yr,A(o.teacher),1)],64)):(v(),_("div",_r," "))],64))],42,pr)}),128)),e[68]||(e[68]=s("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128))],64))),128)),e[69]||(e[69]=s("tr",null,[s("td",{colspan:17,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])],32))]),r.showDetailsModal?(v(),_("div",vr,[s("div",Sr,[s("div",kr,[e[72]||(e[72]=s("div",null,[s("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),s("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[22]||(e[22]=t=>r.showDetailsModal=!1)}," Close ")]),s("div",wr,[s("div",null,[e[73]||(e[73]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),s("div",jr,[s("button",{type:"button",class:be(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",D(I).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[23]||(e[23]=t=>D(I).type="class")}," Class Timetable ",2),s("button",{type:"button",class:be(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",D(I).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[24]||(e[24]=t=>D(I).type="invigilation")}," Invigilation ",2),s("button",{type:"button",class:be(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",D(I).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[25]||(e[25]=t=>D(I).type="exams")}," Exams Timetable ",2)])]),s("div",null,[e[74]||(e[74]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),Q(s("input",{"onUpdate:modelValue":e[26]||(e[26]=t=>D(I).title=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[le,D(I).title]])]),s("div",Cr,[s("div",null,[e[75]||(e[75]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),Q(s("input",{"onUpdate:modelValue":e[27]||(e[27]=t=>D(I).class_name=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[le,D(I).class_name]])]),s("div",null,[e[76]||(e[76]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),Q(s("input",{"onUpdate:modelValue":e[28]||(e[28]=t=>D(I).term=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[le,D(I).term]])])]),s("div",Nr,[s("div",null,[e[77]||(e[77]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),Q(s("input",{"onUpdate:modelValue":e[29]||(e[29]=t=>D(I).academic_year=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[le,D(I).academic_year]])]),s("div",Br,[s("div",null,[e[78]||(e[78]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),Q(s("input",{"onUpdate:modelValue":e[30]||(e[30]=t=>D(I).start_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[le,D(I).start_time]])]),s("div",null,[e[79]||(e[79]=s("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),Q(s("input",{"onUpdate:modelValue":e[31]||(e[31]=t=>D(I).end_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[le,D(I).end_time]])])])]),e[80]||(e[80]=s("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),s("div",Ar,[s("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[32]||(e[32]=t=>r.showDetailsModal=!1)}," Cancel "),s("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:D(I).processing,onClick:e[33]||(e[33]=(...t)=>r.saveTimetable&&r.saveTimetable(...t))},A(D(I).processing?"Saving...":"Generate & Save Timetable"),9,Vr)])])])])):O("",!0),O("",!0)])]),_:1})],64))}};export{Mr as default};

import{y as le,j as y,i as T,C as re,c as a,a as O,u as n,h as oe,w as B,b as t,d as M,k as h,o as i,F as c,r as w,t as m,p as G,f as R,x as $,s as L,v as _}from"./app-B6i2SZ1J.js";import{_ as ae}from"./AuthenticatedLayout-mYDbconH.js";import"./ApplicationLogo-Crttro7A.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"flex items-center justify-between"},ie={class:"flex items-center gap-2"},de={class:"space-y-4"},me={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},ue={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},be={class:"flex flex-wrap items-center gap-2"},pe=["value"],ge=["value"],xe={class:"flex flex-wrap items-center gap-2"},ce={id:"class-timetable-preview",class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[10px] text-gray-800"},fe={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},ye={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},ve={class:"text-[9px] text-gray-600"},he={class:"text-[9px] text-gray-700"},we={class:"font-semibold"},Ae={key:0},ke={class:"font-semibold"},De={class:"font-semibold"},_e={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},Se={class:"ml-1"},Te={class:"ml-1"},Le={class:"text-right"},Ee={class:"ml-1"},Ce={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},Me={class:"min-w-full border-collapse text-[9px] leading-tight"},Re=["rowspan"],$e={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold"},je={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},Ie=["draggable","onDragstart","onDrop"],Ye={class:"text-[8px] text-gray-600"},Fe=["draggable","onDragstart","onDrop"],Ne={key:0,class:"font-semibold text-orange-700"},Ue={class:"text-[8px] text-gray-600"},Ve=["draggable","onDragstart","onDrop"],Pe={key:0},Oe={key:1},Be={key:2},Ge={class:"text-[8px] text-gray-600"},ze={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},He={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},Ke={class:"mb-3 flex items-center justify-between"},We={class:"space-y-3"},qe={class:"grid grid-cols-3 gap-2"},Je={class:"grid grid-cols-2 gap-3"},Qe={class:"grid grid-cols-2 gap-3"},Xe={class:"grid grid-cols-2 gap-2"},Ze={class:"mt-3 flex items-center justify-end gap-2"},rt={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]}},setup(z){var F,N,U,V;const p=z,r=le({type:"class",title:((F=p.timetable)==null?void 0:F.title)||"",class_name:((N=p.timetable)==null?void 0:N.class_name)||"",academic_year:((U=p.timetable)==null?void 0:U.academic_year)||"",term:((V=p.timetable)==null?void 0:V.term)||"",start_time:"07:30",end_time:"16:00"}),H=y(()=>p.school.name||"Your School Name"),K=y(()=>p.school.address||"P.O. Box 123, City"),W=y(()=>p.school.region||"Region"),q=y(()=>r.type==="invigilation"?"Invigilation Timetable":r.type==="exams"?"Exams Timetable":"School General Timetable"),J=y(()=>(p.subjects||[]).map(l=>l.subject_code)),Q=y(()=>{const l={};return(p.subjects||[]).forEach(e=>{const s=(e.teachers||[])[0];s&&(l[e.subject_code]=s.initials||s.name)}),l}),j=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],I=l=>{const e={1:"I",2:"II",3:"III",4:"IV"};return l?e[l]||String(l):""},X=y(()=>{const l=new Set;return(p.classes||[]).forEach(e=>{e.level&&l.add(I(e.level))}),l.size===0?["I","II","III","IV"]:Array.from(l.values())}),Z=y(()=>{const l=new Set;return(p.classes||[]).forEach(e=>{e.stream&&l.add(String(e.stream).toUpperCase())}),l.size===0?["A"]:Array.from(l.values())}),g=T("ALL"),v=T("ALL"),ee=y(()=>g.value!=="ALL"&&v.value!=="ALL"?`Form ${g.value} ${v.value}`:g.value!=="ALL"?`Form ${g.value}`:r.class_name||"____"),A=T({}),Y=()=>{const l={},e=J.value,s=Q.value;if(!e.length){A.value={};return}j.forEach(d=>{l[d]=[],(p.classes||[]).forEach(b=>{const u=I(b.level),o=b.stream?String(b.stream).toUpperCase():"",x={form:u,stream:o,class_name:b.name||`${u} ${o}`.trim(),slots:[]};for(let S=0;S<8;S+=1){const P=e[Math.floor(Math.random()*e.length)];x.slots.push({subject:P,teacher:s[P]||""})}l[d].push(x)})}),A.value=l};re(()=>{Y()});const k=T(!1),te=()=>{r.post(route("timetables.store"),{preserveScroll:!0,onSuccess:()=>{k.value=!1}})},se=()=>{window.print()},D=T(null),f=(l,e)=>e>=0&&e<=2?!0:e>=3&&e<=5?!(l==="FRIDAY"&&e===5):e>=6&&e<=7?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(l):!1,E=(l,e,s)=>{D.value={day:l,rowIndex:e,slotIndex:s}},C=(l,e,s)=>{var x,S;if(!D.value)return;const d=D.value;if(d.day===l&&d.rowIndex===e&&d.slotIndex===s){D.value=null;return}const b=(x=A.value[d.day])==null?void 0:x[d.rowIndex],u=(S=A.value[l])==null?void 0:S[e];if(!b||!u){D.value=null;return}const o=b.slots[d.slotIndex];b.slots[d.slotIndex]=u.slots[s],u.slots[s]=o,D.value=null};return(l,e)=>(i(),a(c,null,[O(n(oe),{title:"Create School Timetable"}),O(ae,null,{header:B(()=>[t("div",ne,[e[18]||(e[18]=t("div",null,[t("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),t("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),t("div",ie,[t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=s=>k.value=!0)}," Create / Edit Timetable Details ")])])]),default:B(()=>[t("div",de,[t("div",me,[e[37]||(e[37]=t("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),t("div",ue,[t("div",be,[e[21]||(e[21]=t("span",{class:"font-semibold"},"View class:",-1)),h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[19]||(e[19]=t("option",{value:"ALL"},"All Forms",-1)),(i(!0),a(c,null,w(X.value,s=>(i(),a("option",{key:s,value:s},"Form "+m(s),9,pe))),128))],512),[[G,g.value]]),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>v.value=s),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[20]||(e[20]=t("option",{value:"ALL"},"All Streams",-1)),(i(!0),a(c,null,w(Z.value,s=>(i(),a("option",{key:s,value:s},"Stream "+m(s),9,ge))),128))],512),[[G,v.value]])]),t("div",xe,[t("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:Y}," Regenerate Sample Timetable "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:se}," Print "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[3]||(e[3]=s=>k.value=!0)}," Open Timetable Details ")])]),t("div",ce,[t("div",fe,[e[25]||(e[25]=t("div",{class:"mb-1 flex justify-center"},[t("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),t("div",ye,m(H.value),1),t("div",ve,m(K.value)+" · "+m(W.value),1),e[26]||(e[26]=t("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),t("div",he,[e[23]||(e[23]=R(" Mwaka: ",-1)),t("span",we,m(n(r).academic_year||"____"),1),g.value!=="ALL"?(i(),a("span",Ae,[e[22]||(e[22]=R(" · Darasa: ",-1)),t("span",ke,m(ee.value),1)])):M("",!0),e[24]||(e[24]=R(" · Kipindi: ",-1)),t("span",De,m(n(r).term||"____"),1)])]),t("div",_e,[t("div",null,[e[27]||(e[27]=t("span",{class:"font-semibold"},"Kichwa:",-1)),t("span",Se,m(n(r).title||"Ratiba ya Darasa"),1)]),t("div",null,[e[28]||(e[28]=t("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),t("span",Te,m(n(r).start_time)+" - "+m(n(r).end_time),1)]),t("div",Le,[e[29]||(e[29]=t("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),t("span",Ee,m(q.value),1)])]),t("div",Ce,[t("table",Me,[e[36]||(e[36]=t("thead",null,[t("tr",null,[t("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),t("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," FORM "),t("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),t("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),t("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),t("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),t("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),t("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),t("tbody",null,[(i(),a(c,null,w(j,s=>(i(),a(c,{key:s},[(i(!0),a(c,null,w((A.value[s]||[]).filter(d=>(g.value==="ALL"||d.form===g.value)&&(v.value==="ALL"||d.stream===v.value)),(d,b)=>(i(),a("tr",{key:`${s}-${d.form}-${d.stream}-${b}`},[b===0?(i(),a("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:(A.value[s]||[]).filter(u=>(g.value==="ALL"||u.form===g.value)&&(v.value==="ALL"||u.stream===v.value)).length||1},m(s),9,Re)):M("",!0),t("td",$e,m(d.form),1),t("td",je,m(d.stream),1),e[30]||(e[30]=t("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[t("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[31]||(e[31]=t("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(i(!0),a(c,null,w(d.slots.slice(0,3),(u,o)=>(i(),a("td",{key:`am-${o}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center",draggable:f(s,o),onDragstart:x=>f(s,o)&&E(s,b,o),onDragover:e[4]||(e[4]=$(()=>{},["prevent"])),onDrop:x=>f(s,o)&&C(s,b,o)},[t("div",null,m(u.subject),1),t("div",Ye,m(u.teacher),1)],40,Ie))),128)),e[32]||(e[32]=t("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(i(!0),a(c,null,w(d.slots.slice(3,6),(u,o)=>(i(),a("td",{key:`mid-${o}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center",draggable:f(s,3+o),onDragstart:x=>f(s,3+o)&&E(s,b,3+o),onDragover:e[5]||(e[5]=$(()=>{},["prevent"])),onDrop:x=>f(s,3+o)&&C(s,b,3+o)},[s==="FRIDAY"&&o===2?(i(),a("div",Ne,"MEWAKA")):(i(),a(c,{key:1},[t("div",null,m(u.subject),1),t("div",Ue,m(u.teacher),1)],64))],40,Fe))),128)),e[33]||(e[33]=t("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(i(!0),a(c,null,w(d.slots.slice(6,8),(u,o)=>(i(),a("td",{key:`pm-${o}`,class:L(["border border-slate-300 px-1 py-1 text-center",s==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":s==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":s==="FRIDAY"?"bg-lime-300 text-[9px] font-semibold text-lime-900":"bg-indigo-50"]),draggable:f(s,6+o),onDragstart:x=>f(s,6+o)&&E(s,b,6+o),onDragover:e[6]||(e[6]=$(()=>{},["prevent"])),onDrop:x=>f(s,6+o)&&C(s,b,6+o)},[s==="WEDNESDAY"?(i(),a("div",Pe,"RELIGION")):s==="THURSDAY"?(i(),a("div",Oe,"DEBATE OR CLUBS")):s==="FRIDAY"?(i(),a("div",Be,"SPORTS AND GAMES")):(i(),a(c,{key:3},[t("div",null,m(u.subject),1),t("div",Ge,m(u.teacher),1)],64))],42,Ve))),128)),e[34]||(e[34]=t("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128)),e[35]||(e[35]=t("tr",null,[t("td",{colspan:16,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])])]),k.value?(i(),a("div",ze,[t("div",He,[t("div",Ke,[e[38]||(e[38]=t("div",null,[t("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),t("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),t("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[7]||(e[7]=s=>k.value=!1)}," Close ")]),t("div",We,[t("div",null,[e[39]||(e[39]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),t("div",qe,[t("button",{type:"button",class:L(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",n(r).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[8]||(e[8]=s=>n(r).type="class")}," Class Timetable ",2),t("button",{type:"button",class:L(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",n(r).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[9]||(e[9]=s=>n(r).type="invigilation")}," Invigilation ",2),t("button",{type:"button",class:L(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",n(r).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[10]||(e[10]=s=>n(r).type="exams")}," Exams Timetable ",2)])]),t("div",null,[e[40]||(e[40]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),h(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>n(r).title=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[_,n(r).title]])]),t("div",Je,[t("div",null,[e[41]||(e[41]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),h(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>n(r).class_name=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[_,n(r).class_name]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),h(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>n(r).term=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[_,n(r).term]])])]),t("div",Qe,[t("div",null,[e[43]||(e[43]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),h(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>n(r).academic_year=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[_,n(r).academic_year]])]),t("div",Xe,[t("div",null,[e[44]||(e[44]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),h(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>n(r).start_time=s),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[_,n(r).start_time]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),h(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>n(r).end_time=s),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[_,n(r).end_time]])])])]),e[46]||(e[46]=t("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),t("div",Ze,[t("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[17]||(e[17]=s=>k.value=!1)}," Cancel "),t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:te}," Generate & Save Timetable ")])])])])):M("",!0)])]),_:1})],64))}};export{rt as default};

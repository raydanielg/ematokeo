import{j as M,i as j,y as As,I as Ie,B as Es,c as b,a as Rt,u as A,h as Ts,w as Ot,d as D,b as r,o as p,x as De,f as ce,t as _,F as E,r as K,s as _e,k as R,p as Ae,v as J,q as Vt,K as Ls}from"./app-CXaJsOnQ.js";import{_ as Ms}from"./AuthenticatedLayout-CAayGm0o.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ds={class:"flex items-center justify-between"},$s={key:0,class:"mb-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[10px] text-amber-900"},Us={class:"mt-1 max-h-24 overflow-y-auto"},Fs={class:"flex items-center gap-2"},Ps={class:"max-h-full w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},Bs={class:"mb-3 flex items-center justify-between"},Rs={class:"mb-3 flex flex-wrap items-center justify-between gap-2"},Os={class:"text-[11px] text-gray-600"},Vs={class:"font-semibold"},Ys={class:"font-semibold"},zs={class:"overflow-hidden rounded-lg border border-gray-200"},Hs={class:"min-w-full border-collapse text-[11px]"},Ks={key:0},Ws={class:"border-b border-gray-100 px-3 py-2 font-semibold text-gray-800"},Xs={class:"border-b border-gray-100 px-3 py-2"},Gs={class:"border-b border-gray-100 px-3 py-2"},qs={class:"space-y-4"},Js={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},Zs={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},Qs={class:"flex flex-wrap items-center gap-2"},er=["value"],tr={key:0,value:"",disabled:""},sr=["value"],rr={class:"flex flex-wrap items-center gap-2"},nr=["disabled"],lr=["disabled"],ar={key:0,class:"mb-3 overflow-hidden rounded-lg border border-amber-200 bg-amber-50"},or={class:"flex items-center justify-between gap-2 border-b border-amber-200 px-3 py-2"},ir={class:"text-[11px] font-semibold text-amber-900"},ur={class:"flex items-center gap-2"},dr=["disabled"],cr={class:"max-h-56 overflow-y-auto px-3 py-2"},mr={key:0,class:"text-[11px] text-amber-900"},br={key:1,class:"mb-2 text-[10px] font-semibold text-amber-900"},pr={class:"flex items-start justify-between gap-2"},fr={class:"flex-1 break-words"},gr=["disabled","onClick"],yr={key:0,class:"mt-1 text-[10px] text-amber-900"},vr={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},xr={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},hr={class:"text-[9px] text-gray-600"},_r={class:"text-[9px] text-gray-700"},Sr={class:"font-semibold"},kr={key:0},jr={class:"font-semibold"},Nr={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},Cr={class:"ml-1"},wr={class:"ml-1"},Ir={class:"text-right"},Ar={class:"ml-1"},Er={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},Tr={class:"min-w-full border-collapse text-[10px] leading-tight"},Lr=["rowspan"],Mr=["rowspan"],Dr={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},$r=["draggable","onDragstart","onContextmenu","onDrop"],Ur={key:0,class:"ml-1 rounded bg-emerald-200 px-1 text-[8px] font-bold text-emerald-900"},Fr={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},Pr={key:1},Br=["draggable","onDragstart","onContextmenu","onDrop"],Rr={key:0,class:"font-semibold text-orange-700"},Or={key:0,class:"ml-1 rounded bg-indigo-200 px-1 text-[8px] font-bold text-indigo-900"},Vr={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},Yr={key:1},zr=["draggable","onDragstart","onContextmenu","onDrop"],Hr={key:0},Kr={key:1},Wr={key:2},Xr={key:0,class:"ml-1 rounded bg-slate-200 px-1 text-[8px] font-bold text-slate-900"},Gr={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},qr={key:1,class:"font-semibold text-gray-400"},Jr={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},Zr={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},Qr={class:"mb-3 flex items-center justify-between"},en={class:"space-y-3"},tn={class:"grid grid-cols-3 gap-2"},sn={class:"grid grid-cols-2 gap-3"},rn={class:"grid grid-cols-2 gap-3"},nn={class:"grid grid-cols-2 gap-2"},ln={class:"mt-3 flex items-center justify-end gap-2"},an=["disabled"],on={class:"max-h-full w-full max-w-4xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},un={class:"sticky top-0 z-10 -mx-6 -mt-6 mb-3 border-b border-gray-200 bg-white/95 px-6 pt-6 pb-3 backdrop-blur"},dn={class:"flex items-center justify-between"},cn={class:"mt-3 flex flex-wrap items-end gap-3"},mn=["value"],bn={class:"flex items-center gap-2 text-[11px] text-gray-600"},pn={key:0,class:"text-[11px] text-gray-500"},fn={class:"overflow-hidden rounded-lg border border-gray-200"},gn={key:0,class:"min-w-full border-collapse text-[11px]"},yn={key:0},vn={colspan:"8",class:"px-3 py-3 text-center text-[11px] text-gray-500"},xn={key:0},hn={key:1},_n={key:2},Sn={class:"border-b border-gray-100 px-3 py-2"},kn={class:"font-medium text-gray-800"},jn={class:"text-[10px] text-gray-500"},Nn={class:"border-b border-gray-100 px-3 py-2"},Cn=["disabled","value","onChange"],wn={class:"border-b border-gray-100 px-3 py-2"},In=["onUpdate:modelValue","disabled"],An={class:"border-b border-gray-100 px-3 py-2"},En=["onUpdate:modelValue","disabled"],Tn={class:"border-b border-gray-100 px-3 py-2"},Ln=["onUpdate:modelValue","disabled"],Mn={class:"border-b border-gray-100 px-3 py-2"},Dn=["onUpdate:modelValue","disabled"],$n={class:"border-b border-gray-100 px-3 py-2"},Un=["onUpdate:modelValue","disabled"],Fn={class:"border-b border-gray-100 px-3 py-2"},Pn=["onUpdate:modelValue","disabled"],Bn={key:1,class:"min-w-full border-collapse text-[11px]"},Rn={key:0},On={colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"},Vn={key:0},Yn={key:1},zn={key:2},Hn={class:"border-b border-gray-100 px-3 py-2"},Kn={class:"font-medium text-gray-800"},Wn={class:"text-[10px] text-gray-500"},Xn={class:"border-b border-gray-100 px-3 py-2"},Gn={class:"font-medium text-gray-800"},qn={class:"text-[10px] text-gray-500"},Jn={class:"border-b border-gray-100 px-3 py-2"},Zn=["disabled","value","onInput"],Qn={class:"mt-4 flex items-center justify-end gap-2"},el=["disabled"],tl=["disabled"],sl={class:"w-72 overflow-hidden rounded-xl bg-white text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},rl={class:"border-t border-gray-100 px-3 py-2"},nl={class:"mb-2"},ll={key:0,class:"rounded-md bg-gray-50 px-2 py-1 text-[11px] text-gray-700 ring-1 ring-gray-200"},al={key:1,class:"grid grid-cols-2 gap-2"},ol=["value"],il={key:0,value:"",disabled:""},ul=["value"],dl={key:0,class:"mt-1 text-[10px] text-gray-500"},cl={key:1,class:"mt-1 text-[10px] text-gray-500"},ml={class:"max-h-56 overflow-y-auto border-t border-gray-100 p-2"},bl={key:0,class:"px-2 py-3 text-center text-[11px] text-gray-500"},pl=["disabled","draggable","onDragstart","onClick"],fl=["disabled","draggable"],ee=12,xl={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},teacherAssignments:{type:Object,default:()=>({})}},setup(Yt){var Tt,Lt,Mt,Dt,$t;const w=Yt,zt=M(()=>{var e;const s=C.value?Number(C.value):null;return!Number.isFinite(s)||!s?{}:((e=le.value)==null?void 0:e[String(s)])||{}}),Ht=(s,e)=>{const t=C.value?Number(C.value):null;!Number.isFinite(t)||!t||(le.value[String(t)]||(le.value[String(t)]={}),e==="morning"||e==="afternoon"?le.value[String(t)][String(s)]=e:delete le.value[String(t)][String(s)],ss())},N=As({type:"class",title:((Tt=w.timetable)==null?void 0:Tt.title)||"",class_name:((Lt=w.timetable)==null?void 0:Lt.class_name)||"",academic_year:((Mt=w.timetable)==null?void 0:Mt.academic_year)||String(new Date().getFullYear()),term:((Dt=w.timetable)==null?void 0:Dt.term)||"",start_time:"07:30",end_time:"16:00",schedule_json:(($t=w.timetable)==null?void 0:$t.schedule_json)||null}),Kt=M(()=>w.school.name||"Your School Name"),Wt=M(()=>w.school.address||"P.O. Box 123, City"),Xt=M(()=>w.school.region||"Region"),Gt=M(()=>N.type==="invigilation"?"Invigilation Timetable":N.type==="exams"?"Exams Timetable":"School General Timetable"),qt=M(()=>(w.subjects||[]).map(s=>s.subject_code)),$e=M(()=>{const s={};return(w.classes||[]).forEach(e=>{e!=null&&e.id&&(s[String(e.id)]=e)}),s}),pt=M(()=>{const s={};return(w.subjects||[]).forEach(e=>{!(e!=null&&e.subject_code)||!(e!=null&&e.id)||(s[String(e.subject_code)]=Number(e.id))}),s}),ft=s=>{var i,a;const e=Number(s);if(!Number.isFinite(e)||!e)return[];const t=((i=$e.value)==null?void 0:i[String(e)])||null,o=t!=null&&t.parent_class_id&&((a=$e.value)==null?void 0:a[String(t.parent_class_id)])||null;return((Array.isArray(t==null?void 0:t.subject_codes)&&t.subject_codes.length?t.subject_codes:Array.isArray(o==null?void 0:o.subject_codes)&&o.subject_codes.length?o.subject_codes:[])||[]).map(l=>String(l||"").trim().toUpperCase()).filter(Boolean)},Jt=(s,e)=>{const t=Number(s);if(!Number.isFinite(t)||!t)return!0;const o=String(e||"").trim().toUpperCase();if(!o||o==="PS")return!0;const n=ft(t);return n.length?n.includes(o):!0},Je=(s,e)=>{var d,f,y,h,S,U;const t=s?String(s):"",o=String(e||"").trim(),n=(d=$e.value)==null?void 0:d[t],i=n!=null&&n.parent_class_id?String(n.parent_class_id):"",a=(f=w.teacherAssignments)==null?void 0:f[t],l=a!==void 0?a:i?(y=w.teacherAssignments)==null?void 0:y[i]:null;if(l&&typeof l=="object"){const Y=l==null?void 0:l[o];return Y?String(Y):""}const u=(S=(h=w.teacherAssignments)==null?void 0:h[t])==null?void 0:S[o];return u?String(u):((U=Zt.value)==null?void 0:U[o])||""},Ze=(s,e,t,o)=>{const n=Je(s,e),i=String(e||"").trim().toUpperCase(),l=String(n||"").split("/").map(y=>y.trim()).filter(Boolean).filter(y=>String(y).trim().toUpperCase()!==i);if(!l.length)return"";if(l.length===1)return l[0];if(l.length===2)return`${l[0]}/${l[1]}`;const u=String(t||"").toUpperCase(),d=X.indexOf(u),f=Math.max(0,d)*31+Number(o||0);return l[f%l.length]},Zt=M(()=>{const s={};return(w.subjects||[]).forEach(e=>{const t=Array.isArray(e.teachers)?e.teachers:[];if(!(e!=null&&e.subject_code)||!t.length)return;const o=t.map(i=>String((i==null?void 0:i.initials)||"").trim()||kt(i==null?void 0:i.name)||String((i==null?void 0:i.name)||"").trim()).filter(Boolean);if(!o.length)return;const n=Array.from(new Set(o));s[e.subject_code]=n.join("/")}),s}),X=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],Qe=s=>{const e={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII"};if(s==null)return"";const t=String(s).trim();if(t==="")return"";const o=Number(t);if(!Number.isNaN(o)&&e[o])return e[o];const n=t.toUpperCase(),i={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7};if(i[n]&&e[i[n]])return e[i[n]];const a=n.match(/\b(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN)\b/);if(a){const u=i[a[1]];if(u&&e[u])return e[u]}if(/^[IVXLCDM]+$/.test(n))return n;const l=n.match(/\b(?:FORM|CLASS|STD|STANDARD)\s*(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN|[IVXLCDM]+|\d+)\b/);if(l){const u=l[1],d=i[u];if(d&&e[d])return e[d];const f=Number(u);if(!Number.isNaN(f)&&e[f])return e[f];if(/^[IVXLCDM]+$/.test(u))return u}return""},Qt=s=>{if(!s)return null;const e=String(s).toUpperCase().trim();if(!e)return null;const t={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};let o=0,n=0;for(let i=e.length-1;i>=0;i-=1){const a=t[e[i]];if(!a)return null;a<n?o-=a:(o+=a,n=a)}return o},Ue=s=>{const e=et(s);if(!e)return Number.POSITIVE_INFINITY;const t=Qt(e);return t===null?Number.POSITIVE_INFINITY:t},et=s=>Qe(s==null?void 0:s.parent_name)||Qe(s==null?void 0:s.level)||Qe(s==null?void 0:s.name),Se=s=>{const e=((s==null?void 0:s.parent_name)||"").trim();if(e)return e;const t=((s==null?void 0:s.name)||"").trim();if(t&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(t))return t;const o=((s==null?void 0:s.level)||"").trim();if(o&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(o))return o;const n=et(s);return n?`Form ${n}`:o||t},ke=M(()=>{const s=Array.isArray(w.classes)?w.classes:[],e=new Map;s.forEach(a=>{!a||!a.parent_class_id||!(a.stream&&String(a.stream).trim())||(e.has(a.parent_class_id)||e.set(a.parent_class_id,[]),e.get(a.parent_class_id).push(a))});const t=[];s.filter(a=>!(a!=null&&a.parent_class_id)).forEach(a=>{const l=e.get(a.id)||[];if(l.length){l.slice().sort((u,d)=>String(u.stream||"").localeCompare(String(d.stream||""))).forEach(u=>t.push(u));return}t.push(a)});const o=new Set(s.filter(a=>!(a!=null&&a.parent_class_id)).map(a=>a.id));s.filter(a=>(a==null?void 0:a.parent_class_id)&&!o.has(a.parent_class_id)).forEach(a=>t.push(a));const n=new Set;return t.filter(a=>{const l=a==null?void 0:a.id;return l==null||n.has(l)?!1:(n.add(l),!0)}).sort((a,l)=>{const u=a!=null&&a.parent_class_id&&s.find(I=>Number(I==null?void 0:I.id)===Number(a.parent_class_id))||a,d=l!=null&&l.parent_class_id&&s.find(I=>Number(I==null?void 0:I.id)===Number(l.parent_class_id))||l,f=Ue(u),y=Ue(d);if(f!==y)return Number(f||0)-Number(y||0);const h=a!=null&&a.parent_class_id?Number(a.parent_class_id):Number((a==null?void 0:a.id)||0),S=l!=null&&l.parent_class_id?Number(l.parent_class_id):Number((l==null?void 0:l.id)||0);if(h!==S)return h-S;const U=(a!=null&&a.stream?String(a.stream):"").toUpperCase(),Y=(l!=null&&l.stream?String(l.stream):"").toUpperCase(),$=U.localeCompare(Y);return $!==0?$:Number((a==null?void 0:a.id)||0)-Number((l==null?void 0:l.id)||0)})}),gt=M(()=>{const s=new Set,e=[];return(ke.value||[]).forEach(t=>{const o=Se(t);if(!o)return;const n=String(o);s.has(n)||(s.add(n),e.push(o))}),e}),Ee=M(()=>{const s=new Set;return ke.value.forEach(e=>{const t=e.stream?String(e.stream).toUpperCase().trim():"";if(t){if(O.value!=="ALL"){const o=Se(e);if(o&&o!==O.value)return}s.add(t)}}),s.size===0?[]:Array.from(s.values())}),O=j("ALL"),G=j("ALL");Ie(O,()=>{G.value!=="ALL"&&(Ee.value.includes(G.value)||(G.value="ALL"))});const es=M(()=>O.value!=="ALL"&&G.value!=="ALL"?`${O.value} ${G.value}`:O.value!=="ALL"?`${O.value}`:N.class_name||"____"),H=j({}),V=j([]),yt=j(0),tt=j(!1),re=j(!1),P=j({}),ne=j({status:"idle",attempts:0,message:""}),vt=M(()=>{var e;return`timetable_subject_session_rules_v1_${((e=w.school)==null?void 0:e.id)??"school"}`}),le=j({}),ts=()=>{try{const s=window.localStorage.getItem(vt.value);if(!s)return{};const e=JSON.parse(s);return e&&typeof e=="object"?e:{}}catch{return{}}},ss=()=>{try{window.localStorage.setItem(vt.value,JSON.stringify(le.value||{}))}catch{}},rs=s=>s>=0&&s<=3?"morning":s>=7&&s<=8?"afternoon":"other",ns=(s,e)=>{var n;if(!s||!e)return"any";const t=((n=le.value)==null?void 0:n[String(s)])||{},o=t==null?void 0:t[String(e)];return o==="morning"||o==="afternoon"?o:"any"},ae=(s,e,t)=>{var u;const o=new Set(["ENG","B/MAT"]),n=String(e||"").trim().toUpperCase(),i=rs(t);if(!Jt(s,n))return!1;if(o.has(n))return t===4?!0:i==="morning";const a=((u=pt.value)==null?void 0:u[String(e)])||null,l=ns(s,a);return l==="any"?!0:i===l},oe=(s,e)=>e>=7&&e<=8?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(s):!(s==="FRIDAY"&&e===6),st=M(()=>{var e;return`timetable_schedule_v3_${((e=w.school)==null?void 0:e.id)??"school"}`}),rt=s=>{if(!s||typeof s!="object")return{};const e={};return Object.keys(s).forEach(t=>{const o=Array.isArray(s[t])?s[t]:[];e[t]=o.map(n=>{const i=Array.isArray(n==null?void 0:n.slots)?n.slots:[],a=Array.from({length:9}).map((l,u)=>{const d=i[u];if(d==null)return null;if(typeof d=="string"){const f=String(d||"").trim();return f?{subject:f,teacher:"",teacher_initials:"",teacher_name:""}:{subject:"",teacher:"",teacher_initials:"",teacher_name:""}}if(typeof d=="object"){const f=String((d==null?void 0:d.subject)??"").trim(),y=String((d==null?void 0:d.teacher)??"").trim(),h=String((d==null?void 0:d.teacher_initials)??y).trim(),S=String((d==null?void 0:d.teacher_name)??"").trim();return!f&&!y&&!h&&!S?null:{subject:f,teacher:y,teacher_initials:h,teacher_name:S}}return null});return{...n||{},slots:a}})}),e},ls=()=>{try{const s=window.localStorage.getItem(st.value);if(!s)return null;const e=JSON.parse(s);return!e||typeof e!="object"?null:rt(e)}catch{return null}},Fe=()=>{try{window.localStorage.setItem(st.value,JSON.stringify(H.value||{}))}catch{}},xt=()=>{try{window.localStorage.removeItem(st.value)}catch{}},ht=()=>{V.value=[];const s={};X.forEach(l=>{s[l]=[]}),qt.value;const e={};X.forEach(l=>{e[l]=Array.from({length:9}).map(()=>new Set)});const t=(l,u,d)=>{const f=String(l||"").toUpperCase(),y=Number(u);if(!e[f]||!e[f][y])return;String(d||"").split("/").map(S=>S.trim()).filter(Boolean).forEach(S=>e[f][y].add(S))},o=(l,u,d)=>{const f=String(l||"").toUpperCase(),y=Number(u);if(!e[f]||!e[f][y])return!0;const h=String(d||"").split("/").map(S=>S.trim()).filter(Boolean);return h.length?h.every(S=>!e[f][y].has(S)):!0},n=l=>String(l||"").trim().toUpperCase(),i=(l,u)=>u>=0&&u<=2?oe(l,u)&&oe(l,u+1):u===7?oe(l,7)&&oe(l,8):!1,a=l=>[0,1,2,7].filter(u=>i(l,u));(ke.value||[]).forEach(l=>{const u=l!=null&&l.id?Number(l.id):null,d=et(l),f=Se(l),y=l!=null&&l.stream?String(l.stream).toUpperCase().trim():"",h=l!=null&&l.parent_class_id&&(Array.isArray(w.classes)?w.classes:[]).find(c=>Number(c==null?void 0:c.id)===Number(l.parent_class_id))||null,U=Array.isArray(l==null?void 0:l.subject_codes)&&l.subject_codes.length?l.subject_codes:Array.isArray(h==null?void 0:h.subject_codes)&&h.subject_codes.length?h.subject_codes:[],Y=c=>{const m=n(c);return m?m==="PS"?!0:!!String(Je(u,m)||"").trim():!1},$=(c,m,g)=>{const v=n(g);if(!v||v==="PS")return"";const x=Je(u,v),k=String(x||"").split("/").map(he=>he.trim()).filter(Boolean).filter(he=>String(he).trim().toUpperCase()!==v);if(!k.length)return"";const L=String(c||"").toUpperCase(),de=X.indexOf(L),we=Math.max(0,de)*31+Number(m||0),Me=k.slice(we%k.length).concat(k.slice(0,we%k.length));for(let he=0;he<Me.length;he+=1){const Bt=Me[he];if(o(c,m,Bt))return Bt}return""},I=(U||[]).map(n).filter(Boolean).filter(c=>Y(c)),ue=Array.from(new Set(I)),Ne=c=>ue.includes(n(c)),He=Ne("PS")?"PS":"",F={};X.forEach(c=>{const m={form:d,class_label:f,stream:y,school_class_id:u,class_name:(l==null?void 0:l.name)||`${f} ${y}`.trim(),slots:Array.from({length:9}).map(()=>null)};for(let g=0;g<9;g+=1)oe(c,g)||(m.slots[g]={subject:"",teacher:"",teacher_initials:"",teacher_name:""});F[c]=m,s[c].push(m)});const z={},T={};["ENG","B/MAT"].forEach(c=>{Ne(c)&&(z[c]=(z[c]||0)+3,T[c]=(T[c]||0)+2)}),ue.forEach(c=>{c==="ENG"||c==="B/MAT"||(z[c]=(z[c]||0)+1,T[c]=(T[c]||0)+1)});const Ce={},Ut=(c,m)=>{const g=n(c);Ce[g]=(Ce[g]||0)+m},Le=(c,m)=>{var v,x;const g=(x=(v=F==null?void 0:F[c])==null?void 0:v.slots)==null?void 0:x[m];return g!=null&&g.subject?n(g.subject):""},Ke=(c,m,g)=>{if(!i(c,m))return!1;const v=F[c];if(!v||v.slots[m]!==null||v.slots[m+1]!==null||!ae(u,g,m)||!ae(u,g,m+1))return!1;const x=n(g);if(x!=="PS"&&(!$(c,m,x)||!$(c,m+1,x)))return!1;const k=m>0&&![4,7].includes(m)?Le(c,m-1):"";if(k&&k===n(g))return!1;const L=m+2<9&&![4,7].includes(m+2)?Le(c,m+2):"";return!(L&&L===n(g))},We=(c,m,g)=>{const v=F[c],x=u?$(c,m,g):"",k=u?$(c,m+1,g):"";v.slots[m]={subject:g,teacher:x,teacher_initials:x,teacher_name:""},v.slots[m+1]={subject:g,teacher:k,teacher_initials:k,teacher_name:""},t(c,m,x),t(c,m+1,k),Ut(g,2)},Xe=(c,m,g)=>{const v=F[c];if(!v||!oe(c,m)||v.slots[m]!==null||!ae(u,g,m))return!1;const x=n(g);if(x!=="PS"&&!$(c,m,x))return!1;const k=m>0&&![4,7].includes(m)?Le(c,m-1):"";if(k&&k===n(g))return!1;const L=m+1<9&&![3,6].includes(m)?Le(c,m+1):"";return!(L&&L===n(g))},Ge=(c,m,g)=>{const v=F[c],x=u?$(c,m,g):"";v.slots[m]={subject:g,teacher:x,teacher_initials:x,teacher_name:""},t(c,m,x),Ut(g,1)},_s=c=>c[Math.floor(Math.random()*c.length)],Ft=[];X.forEach(c=>{a(c).forEach(m=>Ft.push({day:c,i:m}))}),Object.keys(T).forEach(c=>{const m=T[c]||0;for(let g=0;g<m;g+=1){const v=Ft.filter(({day:L,i:de})=>Ke(L,de,c));if(!v.length)break;const{day:x,i:k}=_s(v);We(x,k,c),T[c]-=1}});const qe=c=>{let m=0;return a(c).forEach(v=>{var L,de,we,Me;const x=(de=(L=F==null?void 0:F[c])==null?void 0:L.slots)==null?void 0:de[v],k=(Me=(we=F==null?void 0:F[c])==null?void 0:we.slots)==null?void 0:Me[v+1];x!=null&&x.subject&&(k!=null&&k.subject)&&String(x.subject)===String(k.subject)&&(m+=1)}),m},Ss=(c,m)=>{const g=n(m),v=F==null?void 0:F[c];return v?(v.slots||[]).some(x=>(x==null?void 0:x.subject)&&n(x.subject)===g):!1},ks=["ENG","B/MAT"].filter(c=>Ne(c)),js=(c,m)=>{const g=[4,0,1,2,3,5,6,7,8];for(let v=0;v<g.length;v+=1){const x=g[v];if(Xe(c,x,m))return Ge(c,x,m),z[m]=(z[m]||0)-1,!0}return!1},Ns=(c,m)=>{const g=a(c);for(let v=0;v<g.length;v+=1){const x=g[v];if(Ke(c,x,m))return We(c,x,m),T[m]=(T[m]||0)-1,!0}return!1},Cs=c=>{const m=a(c),g=Object.keys(T).filter(v=>(T[v]||0)>0).sort((v,x)=>(Ce[v]||0)-(Ce[x]||0));for(let v=0;v<m.length;v+=1){const x=m[v];for(let k=0;k<g.length;k+=1){const L=g[k];if(Ke(c,x,L))return We(c,x,L),T[L]=(T[L]||0)-1,!0}}return!1},ws=()=>Object.values(T).reduce((c,m)=>c+(Number(m)||0),0),Pt=2;for(;ws()>0;){const c=X.slice().sort((g,v)=>qe(g)-qe(v));let m=!1;for(let g=0;g<c.length;g+=1){const v=c[g];if(!(qe(v)>=Pt)&&Cs(v)){m=!0;break}}if(!m)break}X.forEach(c=>{ks.forEach(m=>{Ss(c,m)||(T[m]||0)>0&&qe(c)<Pt&&Ns(c,m)||(z[m]||0)>0&&js(c,m)||V.value.push(`Could not place ${m} for ${f}${y?` ${y}`:""} on ${c}.`)})}),Object.keys(T).forEach(c=>{for(;(T[c]||0)>0;){let m=!1;for(let g=0;g<X.length&&!m;g+=1){const v=X[g],x=a(v);for(let k=0;k<x.length;k+=1){const L=x[k];if(Ke(v,L,c)){We(v,L,c),T[c]-=1,m=!0;break}}}if(!m){V.value.push(`Could not place all required double periods for ${c} in ${f}${y?` ${y}`:""}.`);break}}}),Object.keys(z).forEach(c=>{for(;(z[c]||0)>0;){let m=!1;for(let g=0;g<X.length&&!m;g+=1){const v=X[g],x=c==="ENG"||c==="B/MAT"?[4,0,1,2,3,5,6,7,8]:[0,1,2,3,4,5,6,7,8];for(let k=0;k<x.length;k+=1){const L=x[k];if(Xe(v,L,c)){Ge(v,L,c),z[c]-=1,m=!0;break}}}if(!m){V.value.push(`Could not place all required single periods for ${c} in ${f}${y?` ${y}`:""}.`);break}}}),X.forEach(c=>{for(let m=0;m<9;m+=1){if(!oe(c,m)||F[c].slots[m]!==null)continue;const g=Object.keys(z).filter(x=>(z[x]||0)>0).filter(x=>Xe(c,m,x));if(!g.length)continue;g.sort((x,k)=>(z[k]||0)-(z[x]||0));const v=g[0];Ge(c,m,v),z[v]-=1}});const Is=(c,m)=>{const g=m>0&&![4,7].includes(m)?Le(c,m-1):"",v=ue.filter(x=>Xe(c,m,x)).filter(x=>!g||g!==n(x));return v.length?(v.sort((x,k)=>(Ce[x]||0)-(Ce[k]||0)),v[0]||He||""):He||""};X.forEach(c=>{for(let m=0;m<9;m+=1){if(!oe(c,m)||F[c].slots[m]!==null)continue;const g=Is(c,m);g&&Ge(c,m,g)}})}),H.value=rt(s),Fe()},nt=()=>{try{H.value={},yt.value+=1,xt(),ht()}catch(s){console.error(s);const e=s&&s.message?String(s.message):"Failed to regenerate timetable.";V.value=[e]}},as=async s=>{var i,a;const e=String(s||"").trim();if(!e||re.value)return!1;re.value=!0,P.value={...P.value||{},[e]:{status:"running",attempts:0,message:"Resolving..."}};const t=()=>(V.value||[]).some(l=>String(l)===e),o=t();let n=!1;for(let l=1;l<=ee;l+=1){if(P.value={...P.value||{},[e]:{status:"running",attempts:l,message:`Attempt ${l}/${ee}...`}},await new Promise(u=>setTimeout(u,0)),nt(),await new Promise(u=>setTimeout(u,0)),o&&!t()){n=!0;break}if(!o){n=!0;break}}return P.value={...P.value||{},[e]:{status:n?"success":"failed",attempts:((a=(i=P.value)==null?void 0:i[e])==null?void 0:a.attempts)||0,message:n?"Resolved.":`Failed after ${ee} attempts.`}},re.value=!1,n},os=async()=>{var n;if(re.value)return!1;const s=(V.value||[]).map(i=>String(i));if(!s.length)return ne.value={status:"success",attempts:0,message:"No limitations."},!0;re.value=!0,ne.value={status:"running",attempts:0,message:"Resolving all..."};const e={...P.value||{}};s.forEach(i=>{e[i]={status:"running",attempts:0,message:"Queued..."}}),P.value=e;const t=i=>(V.value||[]).some(a=>String(a)===String(i));let o=!1;for(let i=1;i<=ee;i+=1)if(ne.value={status:"running",attempts:i,message:`Attempt ${i}/${ee}...`},s.forEach(a=>{var u;const l=(u=P.value)==null?void 0:u[a];(l==null?void 0:l.status)!=="success"&&(P.value={...P.value||{},[a]:{status:"running",attempts:i,message:`Attempt ${i}/${ee}...`}})}),await new Promise(a=>setTimeout(a,0)),nt(),await new Promise(a=>setTimeout(a,0)),s.forEach(a=>{t(a)||(P.value={...P.value||{},[a]:{status:"success",attempts:i,message:"Resolved."}})}),!(V.value||[]).length){o=!0;break}return o||s.forEach(i=>{t(i)&&(P.value={...P.value||{},[i]:{status:"failed",attempts:ee,message:`Failed after ${ee} attempts.`}})}),ne.value=o?{status:"success",attempts:((n=ne.value)==null?void 0:n.attempts)||ee,message:"All limitations resolved."}:{status:"failed",attempts:ee,message:"Could not resolve all limitations."},re.value=!1,o},is=s=>{var u;const e=((u=H.value)==null?void 0:u[String(s)])||[],t=String(O.value||"ALL").toUpperCase().trim(),o=String(G.value||"ALL").toUpperCase().trim(),n=t!=="ALL"&&/^\d+$/.test(t)?Number(t):null,i=new Map,a=new Map;return(Array.isArray(w.classes)?w.classes:[]).forEach(d=>{if(!(d!=null&&d.id))return;const f=Number(d.id),y=d!=null&&d.parent_class_id?Number(d.parent_class_id):f;i.set(f,y),d!=null&&d.parent_class_id||a.set(f,d)}),(e||[]).filter(d=>{if(!d)return!1;if(t!=="ALL")if(n!==null){const f=d!=null&&d.school_class_id?Number(d.school_class_id):null;if((f?i.get(f)??f:null)!==n)return!1}else{const f=d!=null&&d.school_class_id?Number(d.school_class_id):null,y=f?i.get(f)??f:null,h=y&&a.get(y)||null,S=h?String(Se(h)||"").toUpperCase().trim():"",U=String(d.class_label||d.form||d.class_name||"").toUpperCase().trim(),Y=S||U;if(!Y||Y!==t)return!1}return!(o!=="ALL"&&String(d.stream||"").toUpperCase().trim()!==o)}).map((d,f)=>({row:d,originalIndex:f}))},_t=s=>{const e=is(s),t=new Map,o=new Map,n=new Map,i=new Map;(Array.isArray(w.classes)?w.classes:[]).forEach(l=>{if(!(l!=null&&l.id))return;const u=Number(l.id),d=l!=null&&l.parent_class_id?Number(l.parent_class_id):u;n.set(u,d),l!=null&&l.parent_class_id||i.set(u,l)}),(ke.value||[]).forEach(l=>{const u=l!=null&&l.id?Number(l.id):null;if(!u)return;const d=l!=null&&l.parent_class_id?Number(l.parent_class_id):u,f=i.get(d)||l,y=String(Se(f)||"").trim(),h=Number(d),S=Number.isFinite(h)?h:Ue(f);o.has(d)||o.set(d,{id:d,label:y,order:Number.isFinite(S)?S:Number.POSITIVE_INFINITY})}),(e||[]).forEach(l=>{const u=(l==null?void 0:l.row)||{},d=u!=null&&u.school_class_id?Number(u.school_class_id):null,f=d?n.get(d)??d:null,y=String(u.class_label||u.form||u.class_name||"").trim()||"CLASS",h=f?String(f):y,S=f?o.get(f):null;t.has(h)||t.set(h,{key:h,label:(S==null?void 0:S.label)||y,order:(S==null?void 0:S.order)??Number.POSITIVE_INFINITY,rows:[]}),t.get(h).rows.push(l)});const a=Array.from(t.values());return a.forEach(l=>{l.rows.sort((u,d)=>{var h,S;const f=String(((h=u==null?void 0:u.row)==null?void 0:h.stream)||"").toUpperCase(),y=String(((S=d==null?void 0:d.row)==null?void 0:S.stream)||"").toUpperCase();return f.localeCompare(y)})}),a.sort((l,u)=>{const d=Number.isFinite(l.order)?l.order:Number.POSITIVE_INFINITY,f=Number.isFinite(u.order)?u.order:Number.POSITIVE_INFINITY;return d!==f?d-f:String(l.label||"").localeCompare(String(u.label||""))}),a},us=s=>(_t(s)||[]).reduce((t,o)=>{var n;return t+(((n=o==null?void 0:o.rows)==null?void 0:n.length)||0)},0);Es(()=>{var e;if(le.value=ts(),(e=w.timetable)!=null&&e.schedule_json){H.value=rt(w.timetable.schedule_json),Fe();return}const s=ls();s?H.value=s:ht()});const St=()=>{N.schedule_json=H.value||{},N.post(route("timetables.store"),{preserveScroll:!0,onSuccess:()=>{showDetailsModal.value=!1,xt()}})},ds=()=>{window.print()},Pe=j(!1),kt=s=>{const e=String(s||"").trim();if(!e)return"";const t=e.split(/\s+/).filter(Boolean);return t.length===1?t[0]:`${t[0]} ${t[t.length-1]}`},jt=M(()=>{const s=new Set,e=H.value||{};return Object.values(e).forEach(t=>{(t||[]).forEach(o=>{((o==null?void 0:o.slots)||[]).forEach(n=>{const i=((n==null?void 0:n.teacher_initials)||(n==null?void 0:n.teacher)||"").toString().trim();i&&i.split("/").map(a=>a.trim()).filter(Boolean).forEach(a=>s.add(a))})})}),s}),Be=M(()=>{const s=Array.isArray(w.subjects)?w.subjects:[],e=new Map;s.forEach(n=>{(Array.isArray(n.teachers)?n.teachers:[]).forEach(a=>{if(!(a!=null&&a.id))return;const l=String(a.initials||"").trim()||String(a.name||"").trim(),u=String(a.name||"").trim();!l&&!u||e.has(a.id)||e.set(a.id,{id:a.id,initials:l,name:u,simple_name:kt(u)||u,used:!1})})});const t=jt.value;return Array.from(e.values()).map(n=>({...n,used:t.has(n.initials)})).sort((n,i)=>{const a=Number(i.used)-Number(n.used);if(a!==0)return a;const l=String(n.initials||"").localeCompare(String(i.initials||""));return l!==0?l:String(n.simple_name||"").localeCompare(String(i.simple_name||""))})}),cs=()=>{const s=Be.value,e=["Initials,Name,UsedInTimetable"];s.forEach(i=>{const a=String(i.initials||"").replaceAll('"','""'),l=String(i.simple_name||i.name||"").replaceAll('"','""'),u=i.used?"YES":"NO";e.push(`"${a}","${l}","${u}"`)});const t=new Blob([e.join(`
`)],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=`teacher-initials-${N.academic_year||"timetable"}.csv`,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(o)},Q=j(!1),C=j(""),Te=j(!1),me=j(!1),ie=j({}),lt=j(!1);j({});const te=j("subject_only"),be=j({}),pe=j({}),fe=j({}),ge=j({}),ye=j({}),ve=j({}),Re=j(!1);j(null);const ms=s=>{const e={"B/MAT":5,BIO:3,BUS:3,CHE:3,CS:4,ENG:5,GEO:2,HIS:3,HTM:3,KIS:4,PHY:3},t={"B/MAT":5,BIO:4,BUS:3,CHE:4,CIV:3,CS:4,ENG:5,FK:2,GEO:3,HIS:4,HTM:3,KIS:4,LIT:2,PHY:4};return s===1||s===2?e:s===3||s===4?t:{}},Oe=(s,e)=>`${s}:${e}`,B=s=>`${s}`,at=async()=>{var s;if(!C.value){be.value={},pe.value={},fe.value={},ge.value={},ye.value={},ve.value={};return}Te.value=!0,Re.value=!0;try{const t=await(await fetch(`${route("timetables.class-subject-limits.index")}?school_class_id=${encodeURIComponent(C.value)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json(),o={},n={},i={},a={},l={},u={};((t==null?void 0:t.limits)||[]).forEach(h=>{o[B(h.subject_id)]=h.periods_per_week,n[B(h.subject_id)]=!!h.is_double,i[B(h.subject_id)]=Number(h.morning_single||0),a[B(h.subject_id)]=Number(h.morning_double||0),l[B(h.subject_id)]=Number(h.afternoon_single||0),u[B(h.subject_id)]=Number(h.afternoon_double||0)});const d=((s=$e.value)==null?void 0:s[String(C.value)])||null,f=Ue(d),y=ms(f);Object.keys(y).forEach(h=>{var I;const S=((I=pt.value)==null?void 0:I[String(h)])||null;if(!S)return;const U=B(S);o[U]=Number(y[h]);const Y=Number(y[h]||0),$=String(h).toUpperCase();$==="ENG"||$==="B/MAT"?Y>=5&&(n[U]=!0):Y>=3&&(n[U]=!0)}),be.value=o,pe.value=n,fe.value=i,ge.value=a,ye.value=l,ve.value=u}catch{be.value={},pe.value={},fe.value={},ge.value={},ye.value={},ve.value={}}finally{Te.value=!1,window.setTimeout(()=>{Re.value=!1},0)}},ot=async()=>{if(!C.value){ie.value={};return}Te.value=!0,Re.value=!0;try{const e=await(await fetch(`${route("timetables.weekly-limits.index")}?school_class_id=${encodeURIComponent(C.value)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json(),t={};((e==null?void 0:e.limits)||[]).forEach(o=>{t[Oe(o.teacher_id,o.subject_id)]=o.periods_per_week}),ie.value=t}catch{ie.value={}}finally{Te.value=!1,window.setTimeout(()=>{Re.value=!1},0)}},bs=async({closeModal:s=!0}={})=>{if(C.value){me.value=!0;try{const e=teacherSubjectRows.value.map(t=>{const o=Oe(t.teacher_id,t.subject_id),n=ie.value[o];return{school_class_id:Number(C.value),subject_id:t.subject_id,teacher_id:t.teacher_id,periods_per_week:n===""||n===null||n===void 0?0:Number(n)}}).filter(t=>Number.isFinite(t.periods_per_week)&&t.periods_per_week>=0);await fetch(route("timetables.weekly-limits.save"),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":csrfToken()},credentials:"same-origin",body:JSON.stringify({limits:e})}),s&&(Q.value=!1)}finally{me.value=!1}}},ps=async({closeModal:s=!0}={})=>{if(C.value){me.value=!0;try{const e=classSubjectRows.value.map(n=>{var S,U,Y,$,I;const i=B(n.subject_id),a=be.value[i],l=!!((S=pe.value)!=null&&S[i]),u=Number(((U=fe.value)==null?void 0:U[i])??0)||0,d=Number(((Y=ge.value)==null?void 0:Y[i])??0)||0,f=Number((($=ye.value)==null?void 0:$[i])??0)||0,y=Number(((I=ve.value)==null?void 0:I[i])??0)||0,h=u>0||d>0||f>0||y>0;return{subject_id:n.subject_id,periods_per_week:h?null:a===""||a===null||a===void 0?0:Number(a),is_double:l,morning_single:u,morning_double:d,afternoon_single:f,afternoon_double:y}}).filter(n=>n.periods_per_week===null||Number.isFinite(n.periods_per_week)&&n.periods_per_week>=0),t=lt.value?(ke.value||[]).map(n=>Number(n==null?void 0:n.id)).filter(n=>Number.isFinite(n)&&n>0):[Number(C.value)],o=[];t.forEach(n=>{e.forEach(i=>{o.push({school_class_id:n,...i})})}),await fetch(route("timetables.class-subject-limits.save"),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":csrfToken()},credentials:"same-origin",body:JSON.stringify({limits:o})}),s&&(Q.value=!1)}finally{me.value=!1}}};Ie(Q,s=>{s&&(!C.value&&limitationClassOptions.value.length&&(C.value=limitationClassOptions.value[0].id),te.value==="subject_only"?at():ot())}),Ie(C,()=>{Q.value&&(te.value==="subject_only"?at():ot())}),Ie(te,()=>{Q.value&&(te.value==="subject_only"?at():ot())}),Ie(ie,()=>{Q.value&&te.value==="teacher_subject"&&syncSubjectPeriodsFromTeacherLimits()},{deep:!0}),Ie([ie,be,pe,fe,ge,ye,ve],()=>{scheduleAutoLimitSave()},{deep:!0});const se=j(null),je=j(""),Ve=j(!1),Ye=j(""),q=j({x:0,y:0}),W=j({day:"",rowIndex:-1,slotIndex:-1}),Nt=M(()=>{const s=(w.subjects||[]).map(e=>String((e==null?void 0:e.subject_code)||"").trim()).filter(Boolean);return Array.from(new Set(s)).sort((e,t)=>e.localeCompare(t))}),fs=M(()=>{var n,i;const s=W.value;if(s!=null&&s.day&&s.rowIndex>=0){const a=((i=(n=H.value)==null?void 0:n[String(s.day)])==null?void 0:i[Number(s.rowIndex)])||null,l=Number((a==null?void 0:a.school_class_id)||(a==null?void 0:a.id)||(a==null?void 0:a.class_id)||0)||null;return l?[l]:[]}const e=String(O.value||"ALL").toUpperCase().trim(),t=String(G.value||"ALL").toUpperCase().trim();return e==="ALL"?[]:(ke.value||[]).filter(a=>{if(!(a!=null&&a.id))return!1;const l=String(Se(a)||"").toUpperCase().trim();return!l||l!==e?!1:t==="ALL"?!0:(a!=null&&a.stream?String(a.stream).toUpperCase().trim():"")===t}).map(a=>Number(a.id)).filter(a=>Number.isFinite(a)&&a>0)}),Ct=M(()=>{const s=fs.value||[];if(!s.length)return Nt.value;const e=new Set;s.forEach(o=>{ft(o).forEach(n=>e.add(n))});const t=Array.from(e.values());return t.length?t.sort((o,n)=>o.localeCompare(n)):Nt.value}),wt=M(()=>{const s=String(Ye.value||"").trim().toUpperCase();return s?Ct.value.filter(e=>String(e).toUpperCase().includes(s)):Ct.value}),gs=M(()=>(wt.value||[]).filter(s=>String(s||"").toUpperCase()!=="PS")),Z=(s,e)=>e>=0&&e<=3?!0:e>=4&&e<=6?!(s==="FRIDAY"&&e===6):e>=7&&e<=8?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(s):!1,it=(s,e,t)=>{se.value={day:s,rowIndex:e,slotIndex:t}},It=s=>{const e=String(s||"").trim();if(!e){je.value="";return}if(!xe(e)){je.value="";return}je.value=e,se.value=null},ut=j(!1),dt=j({x:0,y:0}),At=()=>{var n,i;const s=Number(((n=q.value)==null?void 0:n.x)||0),e=Number(((i=q.value)==null?void 0:i.y)||0),t=Math.max(0,window.innerWidth-280),o=Math.max(0,window.innerHeight-260);q.value={x:Math.min(Math.max(12,s),t),y:Math.min(Math.max(12,e),o)}},ze=()=>{Ve.value=!1,Ye.value="",W.value={day:"",rowIndex:-1,slotIndex:-1}},ys=s=>{var o,n,i;(o=s==null?void 0:s.preventDefault)==null||o.call(s),ut.value=!0,dt.value={x:Number((s==null?void 0:s.clientX)||0)-Number(((n=q.value)==null?void 0:n.x)||0),y:Number((s==null?void 0:s.clientY)||0)-Number(((i=q.value)==null?void 0:i.y)||0)};const e=a=>{var l,u;ut.value&&(q.value={x:Number((a==null?void 0:a.clientX)||0)-Number(((l=dt.value)==null?void 0:l.x)||0),y:Number((a==null?void 0:a.clientY)||0)-Number(((u=dt.value)==null?void 0:u.y)||0)},At())},t=()=>{ut.value=!1,window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t,!0)};window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",t,!0)},vs=(s=null)=>{var o,n,i;(o=s==null?void 0:s.preventDefault)==null||o.call(s);const e=Number((s==null?void 0:s.clientX)||0),t=Number((s==null?void 0:s.clientY)||0);e&&t?q.value={x:e,y:t}:!Number((n=q.value)==null?void 0:n.x)&&!Number((i=q.value)==null?void 0:i.y)&&(q.value={x:140,y:140}),W.value={day:"",rowIndex:-1,slotIndex:-1},Ve.value=!0,At()},ct=(s,e,t,o)=>{var n;Z(e,o)&&((n=s==null?void 0:s.preventDefault)==null||n.call(s),q.value={x:Number((s==null?void 0:s.clientX)||0),y:Number((s==null?void 0:s.clientY)||0)},W.value={day:String(e),rowIndex:Number(t),slotIndex:Number(o)},Ve.value=!0,window.setTimeout(()=>{const i=()=>{ze(),document.removeEventListener("click",i,!0)};document.addEventListener("click",i,!0)},0))},Et=s=>{var n,i;const e=W.value;if(!(e!=null&&e.day)||e.rowIndex<0||e.slotIndex<0)return;const t=((i=(n=H.value)==null?void 0:n[String(e.day)])==null?void 0:i[Number(e.rowIndex)])||null,o=Number((t==null?void 0:t.school_class_id)||(t==null?void 0:t.id)||(t==null?void 0:t.class_id)||0)||null;o&&!ae(o,s,e.slotIndex)||(mt(e.day,e.rowIndex,e.slotIndex,s),ze())},xe=s=>{var n,i;const e=W.value;if(!(e!=null&&e.day)||e.rowIndex<0||e.slotIndex<0)return!0;const t=((i=(n=H.value)==null?void 0:n[String(e.day)])==null?void 0:i[Number(e.rowIndex)])||null,o=Number((t==null?void 0:t.school_class_id)||(t==null?void 0:t.id)||(t==null?void 0:t.class_id)||0)||null;return o?ae(o,s,e.slotIndex):!0},xs=M(()=>{var e,t;const s=W.value;if(s!=null&&s.day&&s.rowIndex>=0){const o=((t=(e=H.value)==null?void 0:e[String(s.day)])==null?void 0:t[Number(s.rowIndex)])||null,n=String((o==null?void 0:o.class_label)||(o==null?void 0:o.form)||"").trim(),i=String((o==null?void 0:o.stream)||"").trim();return n&&i?`${n} ${i}`:n||"Selected cell"}return O.value!=="ALL"&&G.value!=="ALL"?`${O.value} ${G.value}`:O.value!=="ALL"?`${O.value}`:"All Classes"}),hs=(s,e,t,o)=>{var h,S,U,Y;const n=String(s),i=Number(e),a=String(o||"").trim();if(!a)return!1;const l=(S=(h=H.value)==null?void 0:h[n])==null?void 0:S[Number(t)],u=Number((l==null?void 0:l.school_class_id)||(l==null?void 0:l.id)||(l==null?void 0:l.class_id)||0)||null,d=Ze(u,a,n,i),f=String(d||"").split("/").map($=>$.trim()).filter(Boolean);if(!f.length)return!1;const y=((U=H.value)==null?void 0:U[n])||[];for(let $=0;$<y.length;$+=1){if($===Number(t))continue;const I=y[$],ue=(Y=I==null?void 0:I.slots)==null?void 0:Y[i],Ne=ue!=null&&ue.subject?String(ue.subject):"";if(!Ne)continue;const He=Number((I==null?void 0:I.school_class_id)||(I==null?void 0:I.id)||(I==null?void 0:I.class_id)||0)||null,F=Ze(He,Ne,n,i),z=String(F||"").split("/").map(T=>T.trim()).filter(Boolean);if(z.length){for(let T=0;T<f.length;T+=1)if(z.includes(f[T]))return!0}}return!1},mt=(s,e,t,o)=>{var f,y;const n=String(s),i=Number(e),a=Number(t),l=String(o||"").trim();if(!Z(n,a))return!1;const u=(y=(f=H.value)==null?void 0:f[n])==null?void 0:y[i];if(!u)return!1;const d=Number((u==null?void 0:u.school_class_id)||(u==null?void 0:u.id)||(u==null?void 0:u.class_id)||0)||null;return l&&!ae(d,l,a)||l&&hs(n,a,i,l)?!1:(u.slots[a]=l?{subject:l,teacher:Ze(d,l,n,a)}:null,Fe(),!0)},bt=(s,e,t)=>{var S,U;if(je.value){mt(s,e,t,je.value),je.value="",se.value=null;return}if(!se.value)return;const o=se.value;if(o.day===s&&o.rowIndex===e&&o.slotIndex===t){se.value=null;return}const n=(S=H.value[o.day])==null?void 0:S[o.rowIndex],i=(U=H.value[s])==null?void 0:U[e];if(!n||!i){se.value=null;return}const a=n.slots[o.slotIndex],l=i.slots[t],u=a,d=Number((n==null?void 0:n.school_class_id)||(n==null?void 0:n.id)||(n==null?void 0:n.class_id)||(n==null?void 0:n.classId)||(n==null?void 0:n.schoolClassId)||0)||null,f=Number((i==null?void 0:i.school_class_id)||(i==null?void 0:i.id)||(i==null?void 0:i.class_id)||(i==null?void 0:i.classId)||(i==null?void 0:i.schoolClassId)||0)||null,y=!(l!=null&&l.subject)||ae(d,l.subject,o.slotIndex),h=!(u!=null&&u.subject)||ae(f,u.subject,t);if(!y||!h){se.value=null;return}n.slots[o.slotIndex]=l,i.slots[t]=u,Fe(),se.value=null};return(s,e)=>(p(),b(E,null,[Rt(A(Ts),{title:"Create School Timetable"}),Rt(Ms,null,{header:Ot(()=>[r("div",Ds,[e[37]||(e[37]=r("div",null,[r("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),r("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),V.value.length?(p(),b("div",$s,[e[36]||(e[36]=r("div",{class:"font-semibold"},"Limitations check:",-1)),r("div",Us,[(p(!0),b(E,null,K(V.value,(t,o)=>(p(),b("div",{key:o},_(t),1))),128))])])):D("",!0),r("div",Fs,[r("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=t=>s.showDetailsModal=!0)}," Create / Edit Timetable Details ")])])]),default:Ot(()=>[Pe.value?(p(),b("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[2]||(e[2]=De(t=>Pe.value=!1,["self"]))},[r("div",Ps,[r("div",Bs,[e[38]||(e[38]=r("div",null,[r("h3",{class:"text-sm font-semibold text-gray-800"}," Teacher Initials Details "),r("p",{class:"mt-0.5 text-[11px] text-gray-500"},' Orodha ya walimu wote na initials zao. Zilizotumika kwenye ratiba zitaonyesha "Used". ')],-1)),r("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[1]||(e[1]=t=>Pe.value=!1)}," Close ")]),r("div",Rs,[r("div",Os,[e[39]||(e[39]=ce(" Used initials: ",-1)),r("span",Vs,_(jt.value.size),1),e[40]||(e[40]=ce(" / Total teachers: ",-1)),r("span",Ys,_(Be.value.length),1)]),r("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:cs}," Download (CSV) ")]),r("div",zs,[r("table",Hs,[e[42]||(e[42]=r("thead",null,[r("tr",{class:"bg-gray-50 text-left"},[r("th",{class:"border-b border-gray-200 px-3 py-2"},"Initials"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Used")])],-1)),r("tbody",null,[Be.value.length?D("",!0):(p(),b("tr",Ks,[...e[41]||(e[41]=[r("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"}," No teachers found. ",-1)])])),(p(!0),b(E,null,K(Be.value,t=>(p(),b("tr",{key:t.id,class:"hover:bg-gray-50"},[r("td",Ws,_(t.initials),1),r("td",Xs,_(t.simple_name||t.name),1),r("td",Gs,[r("span",{class:_e(["inline-flex rounded-full px-2 py-0.5 text-[10px] font-semibold",t.used?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-700"])},_(t.used?"Used":"Not used"),3)])]))),128))])])])])])):D("",!0),r("div",qs,[r("div",Js,[e[60]||(e[60]=r("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),r("div",Zs,[r("div",Qs,[e[45]||(e[45]=r("span",{class:"font-semibold"},"View class:",-1)),R(r("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>O.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[43]||(e[43]=r("option",{value:"ALL"},"All Classes",-1)),(p(!0),b(E,null,K(gt.value,t=>(p(),b("option",{key:t,value:t},_(t),9,er))),128))],512),[[Ae,O.value]]),R(r("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>G.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[44]||(e[44]=r("option",{value:"ALL"},"All Streams",-1)),Ee.value.length?D("",!0):(p(),b("option",tr,"No streams")),(p(!0),b(E,null,K(Ee.value,t=>(p(),b("option",{key:t,value:t},"Stream "+_(t),9,sr))),128))],512),[[Ae,G.value]])]),r("div",rr,[r("button",{type:"button",class:"rounded-md bg-amber-50 px-2 py-1 text-[10px] font-semibold text-amber-800 ring-1 ring-amber-100 hover:bg-amber-100",disabled:!V.value.length,onClick:e[5]||(e[5]=t=>tt.value=!0)}," Resolve ("+_(V.value.length)+") ",9,nr),r("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[6]||(e[6]=t=>vs(t))}," Subjects "),r("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:nt}," Regenerate Sample Timetable "),r("button",{type:"button",class:"rounded-md bg-emerald-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:A(N).processing,onClick:St},_(A(N).processing?"Exporting...":"Export (Save to DB)"),9,lr),r("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[7]||(e[7]=t=>Pe.value=!0)}," Teacher Initials Details "),r("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:ds}," Print ")])]),tt.value?(p(),b("div",ar,[r("div",or,[r("div",ir," Limitations ("+_(V.value.length)+") ",1),r("div",ur,[r("button",{type:"button",class:"rounded-md bg-amber-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-1",disabled:re.value||!V.value.length,onClick:os},_(ne.value.status==="running"?"Resolving...":"Resolve All"),9,dr),r("button",{type:"button",class:"text-[11px] font-medium text-amber-900 hover:text-amber-950",onClick:e[8]||(e[8]=t=>tt.value=!1)}," Close ")])]),r("div",cr,[V.value.length?D("",!0):(p(),b("div",mr," No limitations. ")),V.value.length&&ne.value.message?(p(),b("div",br,_(ne.value.message),1)):D("",!0),(p(!0),b(E,null,K(V.value,(t,o)=>{var n,i,a;return p(),b("div",{key:`${o}-${t}`,class:"mb-2 rounded-md bg-white/70 px-2 py-2 text-[11px] text-amber-950 ring-1 ring-amber-200"},[r("div",pr,[r("div",fr,_(t),1),r("button",{type:"button",class:"shrink-0 rounded-md bg-amber-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-1",disabled:re.value||((n=P.value[String(t)])==null?void 0:n.status)==="running",onClick:l=>as(t)},_(((i=P.value[String(t)])==null?void 0:i.status)==="running"?"Resolving...":"Resolve"),9,gr)]),P.value[String(t)]?(p(),b("div",yr,_((a=P.value[String(t)])==null?void 0:a.message),1)):D("",!0)])}),128))])])):D("",!0),(p(),b("div",{id:"class-timetable-preview",key:yt.value,class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[11px] text-gray-800"},[r("div",vr,[e[48]||(e[48]=r("div",{class:"mb-1 flex justify-center"},[r("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),r("div",xr,_(Kt.value),1),r("div",hr,_(Wt.value)+" · "+_(Xt.value),1),e[49]||(e[49]=r("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),r("div",_r,[e[47]||(e[47]=ce(" Mwaka: ",-1)),r("span",Sr,_(A(N).academic_year||"____"),1),O.value!=="ALL"?(p(),b("span",kr,[e[46]||(e[46]=ce(" · Darasa: ",-1)),r("span",jr,_(es.value),1)])):D("",!0)])]),r("div",Nr,[r("div",null,[e[50]||(e[50]=r("span",{class:"font-semibold"},"Kichwa:",-1)),r("span",Cr,_(A(N).title||"Ratiba ya Darasa"),1)]),r("div",null,[e[51]||(e[51]=r("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),r("span",wr,_(A(N).start_time)+" - "+_(A(N).end_time),1)]),r("div",Ir,[e[52]||(e[52]=r("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),r("span",Ar,_(Gt.value),1)])]),r("div",Er,[r("table",Tr,[e[59]||(e[59]=r("thead",null,[r("tr",null,[r("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),r("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),r("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),r("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),r("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),r("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),r("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:40 - 11:05 AM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),r("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),r("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),r("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),r("tbody",null,[(p(),b(E,null,K(X,t=>(p(),b(E,{key:t},[(p(!0),b(E,null,K(_t(t),(o,n)=>(p(),b(E,{key:`${t}-${o.key}`},[(p(!0),b(E,null,K(o.rows,({row:i,originalIndex:a},l)=>(p(),b("tr",{key:`${t}-${o.key}-${i.stream}-${a}`},[n===0&&l===0?(p(),b("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:us(t)||1},_(t),9,Lr)):D("",!0),l===0?(p(),b("td",{key:1,class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold",rowspan:o.rows.length},_(o.label||i.class_label||i.form),9,Mr)):D("",!0),r("td",Dr,_(i.stream),1),e[53]||(e[53]=r("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[r("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[54]||(e[54]=r("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(p(!0),b(E,null,K(i.slots.slice(0,4),(u,d)=>{var f;return p(),b("td",{key:`am-${d}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center",draggable:Z(t,d),onDragstart:y=>Z(t,d)&&it(t,a,d),onContextmenu:y=>ct(y,t,a,d),onDragover:e[9]||(e[9]=De(()=>{},["prevent"])),onDrop:y=>Z(t,d)&&bt(t,a,d)},[u&&u.subject?(p(),b(E,{key:0},[r("div",null,[ce(_(u.subject)+" ",1),(f=i.slots[d+1])!=null&&f.subject&&i.slots[d+1].subject===u.subject?(p(),b("span",Ur," D ")):D("",!0)]),r("div",Fr,_(u.teacher),1)],64)):(p(),b("div",Pr," "))],40,$r)}),128)),e[55]||(e[55]=r("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(p(!0),b(E,null,K(i.slots.slice(4,7),(u,d)=>{var f;return p(),b("td",{key:`mid-${d}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center",draggable:Z(t,4+d),onDragstart:y=>Z(t,4+d)&&it(t,a,4+d),onContextmenu:y=>ct(y,t,a,4+d),onDragover:e[10]||(e[10]=De(()=>{},["prevent"])),onDrop:y=>Z(t,4+d)&&bt(t,a,4+d)},[t==="FRIDAY"&&d===2?(p(),b("div",Rr,"MEWAKA")):(p(),b(E,{key:1},[u&&u.subject?(p(),b(E,{key:0},[r("div",null,[ce(_(u.subject)+" ",1),(f=i.slots[4+d+1])!=null&&f.subject&&i.slots[4+d+1].subject===u.subject?(p(),b("span",Or," D ")):D("",!0)]),r("div",Vr,_(u.teacher),1)],64)):(p(),b("div",Yr," "))],64))],40,Br)}),128)),e[56]||(e[56]=r("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(p(!0),b(E,null,K(i.slots.slice(7,9),(u,d)=>{var f;return p(),b("td",{key:`pm-${d}`,class:_e(["border border-slate-300 px-1 py-1 text-center",t==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":t==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":t==="FRIDAY"?"bg-lime-300 text-[9px] font-semibold text-lime-900":"bg-indigo-50"]),draggable:Z(t,7+d),onDragstart:y=>Z(t,7+d)&&it(t,a,7+d),onContextmenu:y=>ct(y,t,a,7+d),onDragover:e[11]||(e[11]=De(()=>{},["prevent"])),onDrop:y=>Z(t,7+d)&&bt(t,a,7+d)},[t==="WEDNESDAY"?(p(),b("div",Hr,"RELIGION")):t==="THURSDAY"?(p(),b("div",Kr,"DEBATE OR CLUBS")):t==="FRIDAY"?(p(),b("div",Wr,"SPORTS AND GAMES")):(p(),b(E,{key:3},[u&&u.subject?(p(),b(E,{key:0},[r("div",null,[ce(_(u.subject)+" ",1),(f=i.slots[7+d+1])!=null&&f.subject&&i.slots[7+d+1].subject===u.subject?(p(),b("span",Xr," D ")):D("",!0)]),r("div",Gr,_(u.teacher),1)],64)):(p(),b("div",qr,"PS"))],64))],42,zr)}),128)),e[57]||(e[57]=r("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128))],64))),128)),e[58]||(e[58]=r("tr",null,[r("td",{colspan:17,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])]))]),s.showDetailsModal?(p(),b("div",Jr,[r("div",Zr,[r("div",Qr,[e[61]||(e[61]=r("div",null,[r("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),r("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),r("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[12]||(e[12]=t=>s.showDetailsModal=!1)}," Close ")]),r("div",en,[r("div",null,[e[62]||(e[62]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),r("div",tn,[r("button",{type:"button",class:_e(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",A(N).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[13]||(e[13]=t=>A(N).type="class")}," Class Timetable ",2),r("button",{type:"button",class:_e(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",A(N).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[14]||(e[14]=t=>A(N).type="invigilation")}," Invigilation ",2),r("button",{type:"button",class:_e(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",A(N).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[15]||(e[15]=t=>A(N).type="exams")}," Exams Timetable ",2)])]),r("div",null,[e[63]||(e[63]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),R(r("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>A(N).title=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[J,A(N).title]])]),r("div",sn,[r("div",null,[e[64]||(e[64]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),R(r("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>A(N).class_name=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[J,A(N).class_name]])]),r("div",null,[e[65]||(e[65]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),R(r("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>A(N).term=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[J,A(N).term]])])]),r("div",rn,[r("div",null,[e[66]||(e[66]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),R(r("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>A(N).academic_year=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[J,A(N).academic_year]])]),r("div",nn,[r("div",null,[e[67]||(e[67]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),R(r("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>A(N).start_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[J,A(N).start_time]])]),r("div",null,[e[68]||(e[68]=r("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),R(r("input",{"onUpdate:modelValue":e[21]||(e[21]=t=>A(N).end_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[J,A(N).end_time]])])])]),e[69]||(e[69]=r("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),r("div",ln,[r("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[22]||(e[22]=t=>s.showDetailsModal=!1)}," Cancel "),r("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:A(N).processing,onClick:St},_(A(N).processing?"Exporting...":"Export (Save to DB)"),9,an)])])])])):D("",!0),Q.value?(p(),b("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[29]||(e[29]=De(t=>Q.value=!1,["self"]))},[r("div",on,[r("div",un,[r("div",dn,[e[70]||(e[70]=r("div",null,[r("h3",{class:"text-sm font-semibold text-gray-800"}," Limitations & More "),r("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Weka vipindi kwa wiki kwa kila mwalimu na somo kwa darasa/stream. ")],-1)),r("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[23]||(e[23]=t=>Q.value=!1)}," Close ")]),r("div",cn,[r("div",null,[e[72]||(e[72]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Class",-1)),R(r("select",{"onUpdate:modelValue":e[24]||(e[24]=t=>C.value=t),class:"w-64 rounded-md border border-gray-300 bg-white px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[71]||(e[71]=r("option",{value:"",disabled:""},"Select class",-1)),(p(!0),b(E,null,K(s.limitationClassOptions,t=>(p(),b("option",{key:t.id,value:t.id},_(t.display),9,mn))),128))],512),[[Ae,C.value]])]),r("div",null,[e[74]||(e[74]=r("label",{class:"mb-1 block text-[11px] font-medium"},"Mode",-1)),R(r("select",{"onUpdate:modelValue":e[25]||(e[25]=t=>te.value=t),class:"w-56 rounded-md border border-gray-300 bg-white px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[...e[73]||(e[73]=[r("option",{value:"subject_only"},"Subject limitation",-1),r("option",{value:"teacher_subject"},"Teacher + Subject limitation",-1)])],512),[[Ae,te.value]])]),r("label",bn,[R(r("input",{"onUpdate:modelValue":e[26]||(e[26]=t=>lt.value=t),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"},null,512),[[Vt,lt.value]]),e[75]||(e[75]=ce(" Apply to all classes/streams ",-1))]),Te.value?(p(),b("div",pn,"Loading...")):D("",!0)])]),r("div",fn,[te.value==="subject_only"?(p(),b("table",gn,[e[77]||(e[77]=r("thead",null,[r("tr",{class:"bg-gray-50 text-left"},[r("th",{class:"border-b border-gray-200 px-3 py-2"},"Subject"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Session"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Morning (Single)"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Morning (Double)"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Afternoon (Single)"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Afternoon (Double)"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Periods / Week"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Double (80 mins)")])],-1)),r("tbody",null,[s.classSubjectRows.length?D("",!0):(p(),b("tr",yn,[r("td",vn,[C.value?C.value&&!s.selectedLimitClassHasSubjects?(p(),b("span",hn,"No subjects assigned to this class.")):(p(),b("span",_n,"No subjects found.")):(p(),b("span",xn,"Select a class to view subject limitations."))])])),(p(!0),b(E,null,K(s.classSubjectRows,t=>(p(),b("tr",{key:t.subject_id,class:"hover:bg-gray-50"},[r("td",Sn,[r("div",kn,_(t.subject_code),1),r("div",jn,_(t.subject_name),1)]),r("td",Nn,[r("select",{class:"w-48 rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value,value:zt.value[String(t.subject_id)]||"any",onChange:o=>Ht(t.subject_id,o.target.value)},[...e[76]||(e[76]=[r("option",{value:"any"},"Any time",-1),r("option",{value:"morning"},"Morning only (08:00 - 10:40)",-1),r("option",{value:"afternoon"},"Afternoon only (01:20 - 02:40)",-1)])],40,Cn)]),r("td",wn,[R(r("input",{"onUpdate:modelValue":o=>fe.value[B(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value},null,8,In),[[J,fe.value[B(t.subject_id)]]])]),r("td",An,[R(r("input",{"onUpdate:modelValue":o=>ge.value[B(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value},null,8,En),[[J,ge.value[B(t.subject_id)]]])]),r("td",Tn,[R(r("input",{"onUpdate:modelValue":o=>ye.value[B(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value},null,8,Ln),[[J,ye.value[B(t.subject_id)]]])]),r("td",Mn,[R(r("input",{"onUpdate:modelValue":o=>ve.value[B(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value},null,8,Dn),[[J,ve.value[B(t.subject_id)]]])]),r("td",$n,[R(r("input",{"onUpdate:modelValue":o=>be.value[B(t.subject_id)]=o,type:"number",min:"0",class:"w-24 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value},null,8,Un),[[J,be.value[B(t.subject_id)]]])]),r("td",Fn,[R(r("input",{"onUpdate:modelValue":o=>pe.value[B(t.subject_id)]=o,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",disabled:!C.value},null,8,Pn),[[Vt,pe.value[B(t.subject_id)]]])])]))),128))])])):(p(),b("table",Bn,[e[78]||(e[78]=r("thead",null,[r("tr",{class:"bg-gray-50 text-left"},[r("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Subject"),r("th",{class:"border-b border-gray-200 px-3 py-2"},"Periods / Week")])],-1)),r("tbody",null,[s.teacherSubjectRows.length?D("",!0):(p(),b("tr",Rn,[r("td",On,[C.value?C.value&&!s.selectedLimitClassHasSubjects?(p(),b("span",Yn,"No subjects assigned to this class.")):(p(),b("span",zn,"No teacher-subject mappings found.")):(p(),b("span",Vn,"Select a class to view teacher limitations."))])])),(p(!0),b(E,null,K(s.teacherSubjectRows,t=>(p(),b("tr",{key:`${t.teacher_id}-${t.subject_id}`,class:"hover:bg-gray-50"},[r("td",Hn,[r("div",Kn,_(t.teacher_name),1),r("div",Wn,_(t.teacher_initials),1)]),r("td",Xn,[r("div",Gn,_(t.subject_code),1),r("div",qn,_(t.subject_name),1)]),r("td",Jn,[r("input",{type:"number",min:"0",max:"50",class:"w-24 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!C.value,value:ie.value[Oe(t.teacher_id,t.subject_id)]??0,onInput:o=>{ie.value[Oe(t.teacher_id,t.subject_id)]=o.target.value}},null,40,Zn)])]))),128))])]))]),e[79]||(e[79]=r("div",{class:"mt-5 rounded-lg border border-gray-200 bg-gray-50 p-4"},[r("pre",{class:"whitespace-pre-wrap text-[11px] leading-relaxed text-gray-700"},`Jedwali la Muhtasari wa Mzigo wa Mwalimu (Kwa Zoezi):
No.	Subject	Form I & II	Form III & IV	Jumla kwa Wiki
1.	Hisabati	5	5	10
2.	Physics	3	4	7
3.	Computer Science	4	4	8
Jumla				25
Vipengele vya Zoezi Unaweza Kufanya:
Chagua mchanganyiko tofauti wa masomo.

Badilisha ngazi za masomo (mfano: Fomu I & II tu).

Ongeza idadi ya walimu na uhesabu usambazaji wa mzigo kwa shule nzima.

Tengeneza chati ya pie au bar kuonyesha usambazaji wa vipindi.

Kama unataka, naweza kukusaidia kuandaa hii kwenye Excel na kukupa faili iliyo na:

Jedwali linaloweza kurekebishwa

Fomu za kuhesabu automatikali

Chati za kuona

Tuambie unapendelea kuendelea vipi!

andika yote kama iluvo kwnye podf usibadilsihe andika kila kitu kama kilivyo
Hapa ni nakala kamili ya maudhui ya faili yako kama ilivyo, bila mabadiliko yoyote:

===== Page 1 =====

Table 4: Compulsory Core Subjects and the Number of Periods per Week
No.	Subject	Number of periods per week
Form I & II	Form III & IV
1.	Mathematics	5	5
2.	Kiswahili	4	4
3.	English	5	5
4.	Business studies	3	3
5.	Geography	2	3
6.	Historia ya Tanzania na Maadili	3	3
Table 5: Electric Subjects and Number of Periods per Week
No.	Subject	Number of periods per week
Form I & II	Form III & IV
1.	Physics	3	4
2.	Chemistry	3	4
3.	Biology	3	4
4.	Agriculture	5	5
5.	Computer science	4	4
6.	Food and Human Nutrition	5	5
7.	Sports	4	4
8.	Textile and Gurment Construction	5	5
9.	Fine Art	4	4
10.	Theatre Arts	4	4
11.	Additional Mathematics	–	3
12.	Literature in English	–	2
13.	Fasihi ya Kiswahili	–	2
14.	French	3	3
15.	Arabic	3	3
16.	Chinese	3	3
17.	Music	4	4
18.	History	3	4
19.	Book-kooping	3	4
20.	Bible Knowledge	3	3
21.	Dani ya Kislamu	3	3
 kwa kila osmo ziangtia usischangenye osmo lolote`)],-1)),r("div",Qn,[r("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",disabled:me.value,onClick:e[27]||(e[27]=t=>Q.value=!1)}," Cancel ",8,el),r("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:me.value||!C.value,onClick:e[28]||(e[28]=t=>te.value==="subject_only"?ps():bs())},_(me.value?"Saving...":"Save Limitations"),9,tl)])])])):D("",!0),Ve.value?(p(),b("div",{key:2,class:"fixed z-[60]",style:Ls({left:`${q.value.x}px`,top:`${q.value.y}px`})},[r("div",sl,[r("div",{class:"flex cursor-move items-center justify-between gap-2 bg-gray-50 px-3 py-2",onMousedown:ys},[e[80]||(e[80]=r("div",{class:"text-[11px] font-semibold text-gray-800"},"Subjects",-1)),r("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:ze}," Close ")],32),r("div",rl,[r("div",nl,[e[83]||(e[83]=r("div",{class:"mb-1 text-[10px] font-semibold text-gray-600"},"Filter",-1)),W.value.day?(p(),b("div",ll,_(xs.value),1)):(p(),b("div",al,[R(r("select",{"onUpdate:modelValue":e[30]||(e[30]=t=>O.value=t),class:"w-full rounded-md border border-gray-300 bg-white px-2 py-1 text-[11px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[81]||(e[81]=r("option",{value:"ALL"},"All Classes",-1)),(p(!0),b(E,null,K(gt.value,t=>(p(),b("option",{key:t,value:t},_(t),9,ol))),128))],512),[[Ae,O.value]]),R(r("select",{"onUpdate:modelValue":e[31]||(e[31]=t=>G.value=t),class:"w-full rounded-md border border-gray-300 bg-white px-2 py-1 text-[11px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[82]||(e[82]=r("option",{value:"ALL"},"All Streams",-1)),Ee.value.length?D("",!0):(p(),b("option",il,"No streams")),(p(!0),b(E,null,K(Ee.value,t=>(p(),b("option",{key:t,value:t},_(t),9,ul))),128))],512),[[Ae,G.value]])]))]),R(r("input",{"onUpdate:modelValue":e[32]||(e[32]=t=>Ye.value=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1 text-[11px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"Search subject..."},null,512),[[J,Ye.value]]),W.value.day?(p(),b("div",dl," Target: "+_(W.value.day)+" / Row "+_(W.value.rowIndex+1)+" / Slot "+_(W.value.slotIndex+1),1)):(p(),b("div",cl," Drag a subject and drop on a cell. "))]),r("div",ml,[wt.value.length?D("",!0):(p(),b("div",bl," No subjects found. ")),(p(!0),b(E,null,K(gs.value,t=>(p(),b("button",{key:t,type:"button",disabled:!xe(t),draggable:xe(t),class:_e(["mb-1 flex w-full items-center justify-between rounded-md border px-2 py-1 text-left text-[11px] font-semibold",xe(t)?"border-gray-200 bg-white text-gray-800 hover:bg-gray-50":"cursor-not-allowed border-gray-100 bg-gray-50 text-gray-400"]),onDragstart:o=>It(t),onClick:()=>Et(t)},[r("span",null,_(t),1),e[84]||(e[84]=r("span",{class:"text-[10px] font-medium text-gray-400"},"Drag",-1))],42,pl))),128)),r("button",{type:"button",disabled:!xe("PS"),draggable:xe("PS"),class:_e(["mt-2 flex w-full items-center justify-between rounded-md border px-2 py-1 text-left text-[11px] font-semibold",xe("PS")?"border-sky-200 bg-sky-50 text-sky-900 hover:bg-sky-100":"cursor-not-allowed border-gray-100 bg-gray-50 text-gray-400"]),onDragstart:e[33]||(e[33]=t=>It("PS")),onClick:e[34]||(e[34]=()=>Et("PS"))},[...e[85]||(e[85]=[r("span",null,"PS",-1),r("span",{class:"text-[10px] font-medium"},"Personal Study",-1)])],42,fl),W.value.day?(p(),b("button",{key:1,type:"button",class:"mt-2 w-full rounded-md bg-red-50 px-2 py-1 text-[11px] font-semibold text-red-700 ring-1 ring-red-100 hover:bg-red-100",onClick:e[35]||(e[35]=()=>{mt(W.value.day,W.value.rowIndex,W.value.slotIndex,""),ze()})}," Clear cell ")):D("",!0)])])],4)):D("",!0)])]),_:1})],64))}};export{xl as default};

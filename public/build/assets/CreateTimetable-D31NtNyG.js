import{j as F,i as M,y as xs,I as De,B as _s,c as f,a as Et,u as U,h as Ss,w as Tt,d as K,b as n,o as y,x as Ue,f as Fe,t as C,F as Y,r as Q,s as _e,k as H,p as qe,v as oe,q as Mt}from"./app-B6utKLpZ.js";import{_ as js}from"./AuthenticatedLayout-DQWoHvMx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ks={class:"flex items-center justify-between"},Ns={key:0,class:"mb-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[10px] text-amber-900"},Is={class:"mt-1 max-h-24 overflow-y-auto"},ws={class:"flex items-center gap-2"},As={class:"max-h-full w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},Cs={class:"mb-3 flex items-center justify-between"},Ds={class:"mb-3 flex flex-wrap items-center justify-between gap-2"},Es={class:"text-[11px] text-gray-600"},Ts={class:"font-semibold"},Ms={class:"font-semibold"},$s={class:"overflow-hidden rounded-lg border border-gray-200"},Ls={class:"min-w-full border-collapse text-[11px]"},Bs={key:0},Us={class:"border-b border-gray-100 px-3 py-2 font-semibold text-gray-800"},Fs={class:"border-b border-gray-100 px-3 py-2"},Os={class:"border-b border-gray-100 px-3 py-2"},Ps={class:"space-y-4"},Rs={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},Vs={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},zs={class:"flex flex-wrap items-center gap-2"},Ys=["value"],Hs={key:0,value:"",disabled:""},qs=["value"],Ks={class:"flex flex-wrap items-center gap-2"},Gs=["disabled"],Ws={id:"class-timetable-preview",class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[11px] text-gray-800"},Xs={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},Js={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},Qs={class:"text-[9px] text-gray-600"},Zs={class:"text-[9px] text-gray-700"},en={class:"font-semibold"},tn={key:0},sn={class:"font-semibold"},nn={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},rn={class:"ml-1"},on={class:"ml-1"},ln={class:"text-right"},an={class:"ml-1"},un={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},dn={class:"min-w-full border-collapse text-[10px] leading-tight"},cn=["rowspan"],bn=["rowspan"],mn={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},pn=["colspan","draggable","onDragstart","onDrop"],gn={class:"flex items-center justify-center gap-1"},fn={key:0,class:"rounded bg-emerald-600 px-1.5 py-0.5 text-[8px] font-bold uppercase tracking-wide text-white"},yn={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},vn={key:1},hn=["colspan","draggable","onDragstart","onDrop"],xn={key:0,class:"font-semibold text-orange-700"},_n={class:"flex items-center justify-center gap-1"},Sn={key:0,class:"rounded bg-indigo-600 px-1.5 py-0.5 text-[8px] font-bold uppercase tracking-wide text-white"},jn={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},kn={key:1},Nn={key:0},In={key:1},wn={key:2},An=["colspan","draggable","onDragstart","onDrop"],Cn={class:"flex items-center justify-center gap-1"},Dn={key:0,class:"rounded bg-indigo-600 px-1.5 py-0.5 text-[8px] font-bold uppercase tracking-wide text-white"},En={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},Tn={key:1,class:"font-semibold text-gray-400"},Mn={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},$n={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},Ln={class:"mb-3 flex items-center justify-between"},Bn={class:"space-y-3"},Un={class:"grid grid-cols-3 gap-2"},Fn={class:"grid grid-cols-2 gap-3"},On={class:"grid grid-cols-2 gap-3"},Pn={class:"grid grid-cols-2 gap-2"},Rn={class:"mt-3 flex items-center justify-end gap-2"},Vn=["disabled"],zn={class:"max-h-full w-full max-w-4xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},Yn={class:"sticky top-0 z-10 -mx-6 -mt-6 mb-3 border-b border-gray-200 bg-white/95 px-6 pt-6 pb-3 backdrop-blur"},Hn={class:"flex items-center justify-between"},qn={class:"mt-3 flex flex-wrap items-end gap-3"},Kn=["value"],Gn={class:"flex items-center gap-2 text-[11px] text-gray-600"},Wn={key:0,class:"text-[11px] text-gray-500"},Xn={class:"overflow-hidden rounded-lg border border-gray-200"},Jn={key:0,class:"min-w-full border-collapse text-[11px]"},Qn={key:0},Zn={colspan:"8",class:"px-3 py-3 text-center text-[11px] text-gray-500"},er={key:0},tr={key:1},sr={key:2},nr={class:"border-b border-gray-100 px-3 py-2"},rr={class:"font-medium text-gray-800"},or={class:"text-[10px] text-gray-500"},lr={class:"border-b border-gray-100 px-3 py-2"},ir=["disabled","value","onChange"],ar={class:"border-b border-gray-100 px-3 py-2"},ur=["onUpdate:modelValue","disabled"],dr={class:"border-b border-gray-100 px-3 py-2"},cr=["onUpdate:modelValue","disabled"],br={class:"border-b border-gray-100 px-3 py-2"},mr=["onUpdate:modelValue","disabled"],pr={class:"border-b border-gray-100 px-3 py-2"},gr=["onUpdate:modelValue","disabled"],fr={class:"border-b border-gray-100 px-3 py-2"},yr=["onUpdate:modelValue","disabled"],vr={class:"border-b border-gray-100 px-3 py-2"},hr=["onUpdate:modelValue","disabled"],xr={key:1,class:"min-w-full border-collapse text-[11px]"},_r={key:0},Sr={colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"},jr={key:0},kr={key:1},Nr={key:2},Ir={class:"border-b border-gray-100 px-3 py-2"},wr={class:"font-medium text-gray-800"},Ar={class:"text-[10px] text-gray-500"},Cr={class:"border-b border-gray-100 px-3 py-2"},Dr={class:"font-medium text-gray-800"},Er={class:"text-[10px] text-gray-500"},Tr={class:"border-b border-gray-100 px-3 py-2"},Mr=["disabled","value","onInput"],$r={class:"mt-4 flex items-center justify-end gap-2"},Lr=["disabled"],Br=["disabled"],Rr={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},teacherAssignments:{type:Object,default:()=>({})}},setup($t){var ht,xt,_t,St,jt;const $=$t,Lt=F(()=>{var e;const s=I.value?Number(I.value):null;return!Number.isFinite(s)||!s?{}:((e=he.value)==null?void 0:e[String(s)])||{}}),Bt=(s,e)=>{const t=I.value?Number(I.value):null;!Number.isFinite(t)||!t||(he.value[String(t)]||(he.value[String(t)]={}),e==="morning"||e==="afternoon"?he.value[String(t)][String(s)]=e:delete he.value[String(t)][String(s)],Gt())},T=xs({type:"class",title:((ht=$.timetable)==null?void 0:ht.title)||"",class_name:((xt=$.timetable)==null?void 0:xt.class_name)||"",academic_year:((_t=$.timetable)==null?void 0:_t.academic_year)||String(new Date().getFullYear()),term:((St=$.timetable)==null?void 0:St.term)||"",start_time:"07:30",end_time:"16:00",schedule_json:((jt=$.timetable)==null?void 0:jt.schedule_json)||null}),Ut=F(()=>$.school.name||"Your School Name"),Ft=F(()=>$.school.address||"P.O. Box 123, City"),Ot=F(()=>$.school.region||"Region"),Pt=F(()=>T.type==="invigilation"?"Invigilation Timetable":T.type==="exams"?"Exams Timetable":"School General Timetable"),Rt=F(()=>($.subjects||[]).map(s=>s.subject_code)),Se=F(()=>{const s={};return($.classes||[]).forEach(e=>{e!=null&&e.id&&(s[String(e.id)]=e)}),s}),Ee=F(()=>{const s={};return($.subjects||[]).forEach(e=>{!(e!=null&&e.subject_code)||!(e!=null&&e.id)||(s[String(e.subject_code)]=Number(e.id))}),s}),Vt=(s,e)=>{var b,_,j,S,D,E;const t=s?String(s):"",o=String(e||"").trim(),r=(b=Se.value)==null?void 0:b[t],i=r!=null&&r.parent_class_id?String(r.parent_class_id):"",l=(_=$.teacherAssignments)==null?void 0:_[t],u=l!==void 0?l:i?(j=$.teacherAssignments)==null?void 0:j[i]:null;if(u&&typeof u=="object"){const L=u==null?void 0:u[o];return L?String(L):""}const a=(D=(S=$.teacherAssignments)==null?void 0:S[t])==null?void 0:D[o];return a?String(a):((E=ut.value)==null?void 0:E[o])||""},Ke=(s,e,t,o)=>{const r=Vt(s,e),i=String(r||"").split("/").map(b=>b.trim()).filter(Boolean);if(!i.length)return"";if(i.length===1)return i[0];if(i.length===2)return`${i[0]}/${i[1]}`;const l=String(t||"").toUpperCase(),u=O.indexOf(l),a=Math.max(0,u)*31+Number(o||0);return i[a%i.length]},ut=F(()=>{const s={};return($.subjects||[]).forEach(e=>{const t=Array.isArray(e.teachers)?e.teachers:[];if(!(e!=null&&e.subject_code)||!t.length)return;const o=t.map(i=>String((i==null?void 0:i.initials)||"").trim()||ft(i==null?void 0:i.name)||String((i==null?void 0:i.name)||"").trim()).filter(Boolean);if(!o.length)return;const r=Array.from(new Set(o));s[e.subject_code]=r.join("/")}),s}),O=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],Ge=s=>{const e={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII"};if(s==null)return"";const t=String(s).trim();if(t==="")return"";const o=Number(t);if(!Number.isNaN(o)&&e[o])return e[o];const r=t.toUpperCase();if(/^[IVXLCDM]+$/.test(r))return r;const i=r.match(/\b(?:FORM|CLASS|STD|STANDARD)\s*([IVXLCDM]+|\d+)\b/);if(i){const l=i[1],u=Number(l);if(!Number.isNaN(u)&&e[u])return e[u];if(/^[IVXLCDM]+$/.test(l))return l}return""},zt=s=>{if(!s)return null;const e=String(s).toUpperCase().trim();if(!e)return null;const t={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};let o=0,r=0;for(let i=e.length-1;i>=0;i-=1){const l=t[e[i]];if(!l)return null;l<r?o-=l:(o+=l,r=l)}return o},Te=s=>{const e=We(s);if(!e)return Number.POSITIVE_INFINITY;const t=zt(e);return t===null?Number.POSITIVE_INFINITY:t},We=s=>Ge(s==null?void 0:s.parent_name)||Ge(s==null?void 0:s.level)||Ge(s==null?void 0:s.name),Me=s=>{const e=((s==null?void 0:s.parent_name)||"").trim();if(e)return e;const t=((s==null?void 0:s.name)||"").trim();if(t&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(t))return t;const o=((s==null?void 0:s.level)||"").trim();if(o&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(o))return o;const r=We(s);return r?`Form ${r}`:o||t},Oe=F(()=>{const s=Array.isArray($.classes)?$.classes:[],e=new Map;s.forEach(l=>{!l||!l.parent_class_id||!(l.stream&&String(l.stream).trim())||(e.has(l.parent_class_id)||e.set(l.parent_class_id,[]),e.get(l.parent_class_id).push(l))});const t=[];s.filter(l=>!(l!=null&&l.parent_class_id)).forEach(l=>{const u=e.get(l.id)||[];if(u.length){u.slice().sort((a,b)=>String(a.stream||"").localeCompare(String(b.stream||""))).forEach(a=>t.push(a));return}t.push(l)});const o=new Set(s.filter(l=>!(l!=null&&l.parent_class_id)).map(l=>l.id));s.filter(l=>(l==null?void 0:l.parent_class_id)&&!o.has(l.parent_class_id)).forEach(l=>t.push(l));const r=new Set;return t.filter(l=>{const u=l==null?void 0:l.id;return u==null||r.has(u)?!1:(r.add(u),!0)}).sort((l,u)=>{const a=l!=null&&l.parent_class_id&&s.find(w=>Number(w==null?void 0:w.id)===Number(l.parent_class_id))||l,b=u!=null&&u.parent_class_id&&s.find(w=>Number(w==null?void 0:w.id)===Number(u.parent_class_id))||u,_=Te(a),j=Te(b);if(_!==j)return Number(_||0)-Number(j||0);const S=l!=null&&l.parent_class_id?Number(l.parent_class_id):Number((l==null?void 0:l.id)||0),D=u!=null&&u.parent_class_id?Number(u.parent_class_id):Number((u==null?void 0:u.id)||0);if(S!==D)return S-D;const E=(l!=null&&l.stream?String(l.stream):"").toUpperCase(),L=(u!=null&&u.stream?String(u.stream):"").toUpperCase(),B=E.localeCompare(L);return B!==0?B:Number((l==null?void 0:l.id)||0)-Number((u==null?void 0:u.id)||0)})}),Yt=F(()=>{const s=new Set,e=[];return(Oe.value||[]).forEach(t=>{const o=Me(t);if(!o)return;const r=String(o);s.has(r)||(s.add(r),e.push(o))}),e}),Xe=F(()=>{const s=new Set;return Oe.value.forEach(e=>{const t=e.stream?String(e.stream).toUpperCase().trim():"";if(t){if(ee.value!=="ALL"){const o=Me(e);if(o&&o!==ee.value)return}s.add(t)}}),s.size===0?[]:Array.from(s.values())}),ee=M("ALL"),ce=M("ALL");De(ee,()=>{ce.value!=="ALL"&&(Xe.value.includes(ce.value)||(ce.value="ALL"))});const Ht=F(()=>ee.value!=="ALL"&&ce.value!=="ALL"?`${ee.value} ${ce.value}`:ee.value!=="ALL"?`${ee.value}`:T.class_name||"____"),q=M({}),be=M([]),qt=M(!1);M(!1);const dt=F(()=>{var e;return`timetable_subject_session_rules_v1_${((e=$.school)==null?void 0:e.id)??"school"}`}),he=M({}),Kt=()=>{try{const s=window.localStorage.getItem(dt.value);if(!s)return{};const e=JSON.parse(s);return e&&typeof e=="object"?e:{}}catch{return{}}},Gt=()=>{try{window.localStorage.setItem(dt.value,JSON.stringify(he.value||{}))}catch{}},$e=s=>s>=0&&s<=3?"morning":s>=7&&s<=8?"afternoon":"other",ct=(s,e)=>{var r;if(!s||!e)return"any";const t=((r=he.value)==null?void 0:r[String(s)])||{},o=t==null?void 0:t[String(e)];return o==="morning"||o==="afternoon"?o:"any"},G=(s,e,t)=>{var a;const o=new Set(["ENG","B/MAT","CS"]),r=String(e||"").trim().toUpperCase(),i=$e(t);if(o.has(r))return i==="morning";const l=((a=Ee.value)==null?void 0:a[String(e)])||null,u=ct(s,l);return u==="any"?!0:i===u},z=(s,e)=>e>=7&&e<=8?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(s):!(s==="FRIDAY"&&e===6),Wt=()=>{let s=0,e=0,t=0,o=0;return O.forEach(r=>{for(let i=0;i<9;i+=1){if(!z(r,i))continue;const l=$e(i);l==="morning"&&(s+=1),l==="afternoon"&&(e+=1)}for(let i=0;i<=2;i+=1)z(r,i)&&z(r,i+1)&&(t+=1);z(r,7)&&z(r,8)&&(o+=1)}),{morningSlots:s,afternoonSlots:e,morningDoubleStarts:t,afternoonDoubleStarts:o}},bt=F(()=>{var e;return`timetable_schedule_v3_${((e=$.school)==null?void 0:e.id)??"school"}`}),Xt=F(()=>{var e;return`timetable_limitations_draft_v1_${((e=$.school)==null?void 0:e.id)??"school"}`}),Jt=()=>{try{const s=window.localStorage.getItem(bt.value);if(!s)return null;const e=JSON.parse(s);return!e||typeof e!="object"?null:e}catch{return null}},Pe=()=>{try{window.localStorage.setItem(bt.value,JSON.stringify(q.value||{}))}catch{}},Qt=()=>{try{const s=window.localStorage.getItem(Xt.value);if(!s)return null;const e=JSON.parse(s);return e&&typeof e=="object"?e:null}catch{return null}},Zt=()=>{const s={};return O.forEach(e=>{(q.value[e]||[]).forEach(o=>{for(let r=0;r<8;r+=1){if(!canBeDoubleStart(r))continue;const i=o.slots[r],l=o.slots[r+1];if(i!=null&&i.subject&&(l!=null&&l.subject)&&String(i.subject)===String(l.subject)){const u=String(i.subject),b=`${o.school_class_id}_${u}`;s[b]=(s[b]||0)+1}}})}),Object.keys(s).forEach(e=>{const[t,o]=e.split("_"),r=String(o).toUpperCase();r==="ENG"||r==="B/MAT"?s[e]<2&&console.warn(`${o} for class ${t} has only ${s[e]} double(s), expected 2`):s[e]<1&&console.warn(`${o} for class ${t} has no double period, expected at least 1`)}),s},mt=()=>{const s={};be.value=[];const e=Rt.value,t=ut.value;if(!e.length){q.value={};return}O.forEach(o=>{s[o]=[]}),O.forEach(o=>{Array.from({length:9}).map(()=>new Set)}),Oe.value.forEach(o=>{var At,Ct;const r=o!=null&&o.id?Number(o.id):null,i=We(o),l=Me(o),u=o.stream?String(o.stream).toUpperCase().trim():"",a=Array.isArray(o.subject_codes)&&o.subject_codes.length?o.subject_codes:e,b={};O.forEach(d=>{b[d]={form:i,class_label:l,stream:u,school_class_id:r,class_name:o.name||`${l} ${u}`.trim(),slots:Array.from({length:9}).map(()=>null)}}),O.forEach(d=>{for(let c=0;c<9;c+=1)z(d,c)||(b[d].slots[c]={subject:"",teacher:"",teacher_initials:"",teacher_name:""})});const _=[],j=[],S=[];O.forEach(d=>{for(let c=0;c<9;c+=1){if(!z(d,c))continue;const p=$e(c),m={day:d,slotIndex:c};p==="morning"?_.push(m):p==="afternoon"?j.push(m):S.push(m)}});const D=d=>d.sort(()=>Math.random()-.5);D(_),D(j),D(S);const E=d=>{const c=(d||"").toString().trim();return c?c.split("/").map(p=>p.trim()).filter(Boolean):[]},L={},B={},w={},ae=Z.value==="subject_only"&&Ie.value;if(Z.value==="subject_only"&&(ae||I.value&&(String(r)===String(I.value)||String((o==null?void 0:o.parent_class_id)||"")===String(I.value)))){const d=((At=Se.value)==null?void 0:At[String(r)])||null,c=Te(d),p=Qe(c),m=ae?((Ct=ne.value)==null?void 0:Ct[String(r)])||{}:{periodsBySubjectId:le.value||{},doubleBySubjectId:pe.value||{},morningSingleBySubjectId:ge.value||{},morningDoubleBySubjectId:fe.value||{},afternoonSingleBySubjectId:ye.value||{},afternoonDoubleBySubjectId:ve.value||{}};a.forEach(h=>{var J,ue,de,He,lt,it,Dt;const R=((J=Ee.value)==null?void 0:J[String(h)])||null;if(!R)return;const A=P(R),g=(p==null?void 0:p[String(h)])??null;if(Number.isFinite(Number(g))&&Number(g)>0)L[String(h)]=Math.floor(Number(g));else{const Ne=(ue=m==null?void 0:m.periodsBySubjectId)==null?void 0:ue[A],at=Ne===""||Ne===null||Ne===void 0?null:Number(Ne);Number.isFinite(at)&&at>0&&(L[String(h)]=Math.floor(at))}(de=m==null?void 0:m.doubleBySubjectId)!=null&&de[A];const x=Number(((He=m==null?void 0:m.morningSingleBySubjectId)==null?void 0:He[A])??0)||0,k=Number(((lt=m==null?void 0:m.morningDoubleBySubjectId)==null?void 0:lt[A])??0)||0,V=Number(((it=m==null?void 0:m.afternoonSingleBySubjectId)==null?void 0:it[A])??0)||0,W=Number(((Dt=m==null?void 0:m.afternoonDoubleBySubjectId)==null?void 0:Dt[A])??0)||0;if(x>0||k>0||V>0||W>0){B[String(h)]={morning_single:x,morning_double:k,afternoon_single:V,afternoon_double:W};const Ne=x+V+2*k+2*W;(!L[String(h)]||L[String(h)]<Ne)&&(L[String(h)]=Ne)}const re=Number(L[String(h)]||0),X=String(h).toUpperCase();X==="ENG"||X==="B/MAT"?re>=5&&(w[String(h)]=2):re>=3&&(w[String(h)]=1)});const v=`${Me(o)||(o==null?void 0:o.name)||""}${o!=null&&o.stream?` ${String(o.stream).toUpperCase()}`:""}`.trim(),N=Wt();Object.keys(B).forEach(h=>{const R=B[String(h)]||{},A=Number(R.morning_single||0),g=Number(R.morning_double||0),x=Number(R.afternoon_single||0),k=Number(R.afternoon_double||0);A+2*g>N.morningSlots&&be.value.push(`${v}: ${h} morning quota exceeds available morning slots`),g>N.morningDoubleStarts&&be.value.push(`${v}: ${h} morning double quota exceeds available morning double slots`),x+2*k>N.afternoonSlots&&be.value.push(`${v}: ${h} afternoon quota exceeds available afternoon slots`),k>N.afternoonDoubleStarts&&be.value.push(`${v}: ${h} afternoon double quota exceeds available afternoon double slots`)})}hasQuotas&&Object.keys(B||{}).length>0&&Object.keys(B).forEach(d=>{const c=B[d];if(c){for(let p=0;p<(c.morning_double||0)&&!(!Ce(d,"morning")&&!Ce(d,"afternoon"));p+=1)bumpDoubleCount(d);for(let p=0;p<(c.morning_single||0)&&!(!Le(d,"morning")&&!Le(d,"afternoon"));p+=1);for(let p=0;p<(c.afternoon_double||0)&&Ce(d,"afternoon");p+=1)bumpDoubleCount(d);for(let p=0;p<(c.afternoon_single||0)&&Le(d,"afternoon");p+=1);}}),hasQuotas&&Object.keys(w||{}).length>0&&Object.keys(w).forEach(d=>{const c=Number(w[String(d)]||0);if(c<=0)return;const p=String(d).toUpperCase();for(;Number(placedDoublesByCode[String(d)]||0)<c&&Number(remainingNeeded[String(d)]||0)>=2;){if(p==="ENG"||p==="B/MAT"){if(!Ce(d,"morning")&&!tryPlaceDoubleForCode(d))break}else if(!tryPlaceDoubleForCode(d))break;bumpDoubleCount(d)}});const Ce=(d,c)=>{var R;const p=[],m=c==="morning"?[0,1,2]:[7],v=String(d||"").trim().toUpperCase(),N=String(d).toUpperCase(),h=N==="ENG"||N==="B/MAT";for(let A=0;A<O.length;A+=1){const g=O[A];if(!((R=subjectCountByDay[String(g)])!=null&&R[v]))for(let x=0;x<m.length;x+=1){const k=m[x];if(!canBeDoubleStartInSession(k,W)||!z(g,k)||!z(g,k+1)||b[g].slots[k]!==null||b[g].slots[k+1]!==null||r&&(!G(r,d,k)||!G(r,d,k+1)))continue;let V=0;const W=$e(k);h&&W==="morning"?V+=10:!h&&W==="morning"&&(V+=5),p.push({day:g,slotIndex:k,score:V})}}p.sort((A,g)=>g.score-A.score);for(let A=0;A<p.length;A+=1){const g=p[A],x=g.day,k=g.slotIndex;if(setSlot(x,k,d)){if(!setSlot(x,k+1,d)){clearSlot(x,k);continue}return remainingNeeded[String(d)]-=2,remainingNeeded[String(d)]<=0&&delete remainingNeeded[String(d)],!0}}return!1},Le=(d,c)=>{for(let p=0;p<O.length;p+=1){const m=O[p];for(let v=0;v<9;v+=1)if($e(v)===c&&isEmptyTeachableSlot(m,v)&&!(r&&!G(r,d,v))&&setSlot(m,v,d))return remainingNeeded[String(d)]-=1,remainingNeeded[String(d)]<=0&&delete remainingNeeded[String(d)],!0}return!1},Be=[];hasQuotas||a.forEach(d=>{var m;const c=((m=Ee.value)==null?void 0:m[String(d)])||null,p=ct(r,c);if(p==="morning"){const v=_.pop();v&&setSlot(v.day,v.slotIndex,d)}else if(p==="afternoon"){const v=j.pop();v&&setSlot(v.day,v.slotIndex,d)}else Be.push(d)});const te=[..._,...S,...j];D(te),hasQuotas||Be.filter(Boolean).forEach(d=>{let c=te.pop();if(c){if(r&&!G(r,d,c.slotIndex)){let p=-1;for(let m=te.length-1;m>=0;m-=1)if(G(r,d,te[m].slotIndex)){p=m;break}if(p>=0)te.push(c),c=te.splice(p,1)[0];else return}setSlot(c.day,c.slotIndex,d)}});const kt=[];O.forEach(d=>{for(let c=0;c<9;c+=1)z(d,c)&&b[d].slots[c]===null&&kt.push({day:d,slotIndex:c})});let rt=Math.floor(Math.random()*(a.length||1));const gs=d=>{const p=d.slotIndex>0&&![4,7].includes(d.slotIndex)?b[d.day].slots[d.slotIndex-1]:null,m=p!=null&&p.subject?String(p.subject):"";let v=null;const N=Object.keys(remainingNeeded).filter(A=>Number(remainingNeeded[A]||0)>0),h=N.length?[...N,...a.filter(A=>!N.includes(String(A)))]:a,R=subjectCountByDay[String(d.day)]||{};for(let A=0;A<h.length;A+=1){const g=h[(rt+A)%h.length];if(!(g&&m&&String(g)===m)&&!(g&&Number(R[String(g)]||0)>0)&&(!r||G(r,g,d.slotIndex))){v=g,rt=(rt+A+1)%h.length;break}}return v&&remainingNeeded[String(v)]>0&&(remainingNeeded[String(v)]-=1,remainingNeeded[String(v)]<=0&&delete remainingNeeded[String(v)]),v};kt.forEach(d=>{let c=gs(d);if(!c){const h=d.slotIndex>0&&![4,7].includes(d.slotIndex)?b[d.day].slots[d.slotIndex-1]:null,R=h!=null&&h.subject?String(h.subject):"",A=a.filter(g=>!g||R&&String(g)===R?!1:!r||G(r,g,d.slotIndex));c=A.length?A[Math.floor(Math.random()*A.length)]:a[Math.floor(Math.random()*(a.length||1))]||"",c&&remainingNeeded[String(c)]>0&&(remainingNeeded[String(c)]-=1,remainingNeeded[String(c)]<=0&&delete remainingNeeded[String(c)])}let p=!1;const m=[];c&&m.push(String(c)),Object.keys(remainingNeeded||{}).filter(N=>Number(remainingNeeded[N]||0)>0).forEach(N=>{m.includes(String(N))||m.push(String(N))}),(a||[]).forEach(N=>{m.includes(String(N))||m.push(String(N))});for(let N=0;N<m.length;N+=1){const h=m[N];if(h&&!(r&&!G(r,h,d.slotIndex))&&setSlot(d.day,d.slotIndex,h)){p=!0,remainingNeeded[String(h)]>0&&(remainingNeeded[String(h)]-=1,remainingNeeded[String(h)]<=0&&delete remainingNeeded[String(h)]);break}}p||(b[d.day].slots[d.slotIndex]=null)});const fs=()=>{const d=new Set;return O.forEach(c=>{(b[c].slots||[]).forEach(m=>{E((m==null?void 0:m.teacher_initials)||(m==null?void 0:m.teacher)).forEach(v=>d.add(v))})}),d},Nt=new Set;a.forEach(d=>{const c=(t==null?void 0:t[d])||"";E(c).forEach(p=>Nt.add(p))});const It=fs(),ys=Array.from(Nt).filter(d=>!It.has(d)),vs=d=>{for(let c=0;c<a.length;c+=1){const p=a[c],m=(t==null?void 0:t[p])||"";if(E(m).includes(d))return p}return null},hs=d=>{var c;for(let p=0;p<O.length;p+=1){const m=O[p];for(let v=0;v<9;v+=1){if(!z(m,v)||r&&!G(r,d,v))continue;const N=b[m].slots[v];N!=null&&N.subject&&String(N.subject);const h=v>0&&![4,7].includes(v),R=v<8&&![3,6].includes(v)?b[m].slots[v+1]:null,A=h?(c=b[m].slots[v-1])==null?void 0:c.subject:"",g=R!=null&&R.subject?String(R.subject):"";if(!(A&&A===String(d))&&!(g&&g===String(d)))return{day:m,slotIndex:v}}}return null};if(ys.slice(0,15).forEach(d=>{const c=vs(d);if(!c)return;const p=hs(c);p&&(setSlot(p.day,p.slotIndex,c),E((t==null?void 0:t[c])||"").forEach(m=>It.add(m)))}),hasQuotas&&Object.keys(L||{}).length>0){const d=()=>{const g={};return O.forEach(x=>{for(let k=0;k<9;k+=1){if(!z(x,k))continue;const V=b[x].slots[k],W=V!=null&&V.subject?String(V.subject):"";W&&(g[W]=Number(g[W]||0)+1)}}),g},c=(g,x)=>{if(!z(g,x)||!z(g,x+1)||![0,1,2,4,5,7].includes(x))return!1;const k=b[g].slots[x],V=b[g].slots[x+1];return!!(k!=null&&k.subject&&(V!=null&&V.subject)&&String(k.subject)===String(V.subject))},p=(g,x,k)=>{if(!z(g,x)||r&&!G(r,k,x)||c(g,x)||c(g,x-1))return!1;const V=x>0&&![4,7].includes(x),W=x<8&&![3,6].includes(x),re=V?b[g].slots[x-1]:null,X=W?b[g].slots[x+1]:null,J=re!=null&&re.subject?String(re.subject):"",ue=X!=null&&X.subject?String(X.subject):"";return!(J&&J===String(k)||ue&&ue===String(k))},m=(g,x,k)=>{const V=Number(k[String(g)]||0);if(Number(x[String(g)]||0)>=V)return!1;for(let re=0;re<O.length;re+=1){const X=O[re];for(let J=0;J<9;J+=1){if(!z(X,J))continue;const ue=b[X].slots[J],de=ue!=null&&ue.subject?String(ue.subject):"";if(!de||de===String(g))continue;const He=Number(k[String(de)]||0);if(Number(x[String(de)]||0)<=He||!p(X,J,g))continue;if(clearSlot(X,J),!setSlot(X,J,g)){setSlot(X,J,de);continue}return x[String(g)]=Number(x[String(g)]||0)+1,x[String(de)]=Math.max(0,Number(x[String(de)]||0)-1),!0}}return!1},v={...L};let N=d();const h=Object.keys(v);let R=0;for(;R<250;){R+=1;let g=!1;for(let x=0;x<h.length;x+=1){const k=h[x];if(Number(N[String(k)]||0)>=Number(v[String(k)]||0))continue;m(k,N,v)&&(g=!0)}if(!g)break}N=d();const A=`${String(l||(o==null?void 0:o.name)||"")}${u?` ${u}`:""}`.trim();h.forEach(g=>{const x=Number(v[String(g)]||0),k=Number(N[String(g)]||0);x>0&&k<x&&be.value.push(`${A}: ${g} missing ${x-k} periods`),x>0&&k>x&&be.value.push(`${A}: ${g} exceeds by ${k-x} periods`)})}const ot=(()=>{const d={};return O.forEach(c=>{for(let p=0;p<9;p+=1){if(!z(c,p))continue;const m=b[c].slots[p],v=m!=null&&m.subject?String(m.subject):"";v&&(d[v]=Number(d[v]||0)+1)}}),d})(),wt={...L};O.forEach(d=>{for(let c=0;c<9;c+=1){if(!z(d,c)||b[d].slots[c]!==null)continue;const m=[...Object.keys(wt).filter(N=>Number(wt[String(N)]||0)>Number(ot[String(N)]||0)),...(a||[]).map(N=>String(N))];let v=!1;for(let N=0;N<m.length;N+=1){const h=m[N];if(h&&!(r&&!G(r,h,c))&&setSlot(d,c,h)){ot[String(h)]=Number(ot[String(h)]||0)+1,v=!0;break}}v||(b[d].slots[c]=null)}}),O.forEach(d=>{s[d].push(b[d])})}),q.value=s,Pe(),Zt()},es=async()=>{Z.value==="subject_only"&&(Ie.value?await us():I.value&&await Ye()),mt()},Je=F(()=>{const s=I.value?Number(I.value):null;if(!Number.isFinite(s)||!s)return[];const t=(Array.isArray($.classes)?$.classes:[]).filter(o=>Number(o==null?void 0:o.parent_class_id)===s).map(o=>Number(o.id)).filter(o=>Number.isFinite(o));return t.length?t:[s]}),ts=F(()=>{const s=I.value?Number(I.value):null;if(!Number.isFinite(s)||!s)return[];const e=Array.isArray($.classes)?$.classes:[],t=e.find(i=>Number(i==null?void 0:i.id)===s)||null,o=e.filter(i=>Number(i==null?void 0:i.parent_class_id)===s),r=new Set;return o.length?o.forEach(i=>(Array.isArray(i==null?void 0:i.subject_codes)?i.subject_codes:[]).forEach(l=>r.add(String(l)))):(Array.isArray(t==null?void 0:t.subject_codes)?t.subject_codes:[]).forEach(i=>r.add(String(i))),Array.from(r.values()).filter(Boolean)}),ss=F(()=>{var i;const s=I.value?Number(I.value):null;if(!Number.isFinite(s)||!s)return{};const e=((i=Se.value)==null?void 0:i[String(s)])||null,t=Te(e),o=Qe(t),r={};return(ts.value||[]).forEach(l=>{var S,D;const u=((S=Ee.value)==null?void 0:S[String(l)])||null;if(!u)return;const a=P(u),b=(o==null?void 0:o[String(l)])??null;if(Number.isFinite(Number(b))&&Number(b)>0){r[String(l)]=Math.floor(Number(b));return}const _=(D=le.value)==null?void 0:D[a],j=_===""||_===null||_===void 0?null:Number(_);Number.isFinite(j)&&j>0&&(r[String(l)]=Math.floor(j))}),r}),ns=F(()=>{const s=new Set((Je.value||[]).map(t=>String(t))),e={};return(Je.value||[]).forEach(t=>{e[String(t)]={}}),O.forEach(t=>{var r;(((r=q.value)==null?void 0:r[t])||[]).forEach(i=>{var u;const l=i!=null&&i.school_class_id?String(i.school_class_id):"";if(s.has(l))for(let a=0;a<9;a+=1){if(!z(t,a))continue;const b=(u=i==null?void 0:i.slots)==null?void 0:u[a],_=b!=null&&b.subject?String(b.subject):"";_&&(e[l]||(e[l]={}),e[l][_]=Number(e[l][_]||0)+1)}})}),e}),rs=F(()=>{const s=ss.value||{},e=[];return(Je.value||[]).forEach(t=>{var l,u;const o=((l=Se.value)==null?void 0:l[String(t)])||null,r=`${Me(o)||(o==null?void 0:o.name)||""}${o!=null&&o.stream?` ${String(o.stream).toUpperCase()}`:""}`.trim(),i=((u=ns.value)==null?void 0:u[String(t)])||{};Object.keys(s).forEach(a=>{const b=Number(s[String(a)]||0),_=Number(i[String(a)]||0);e.push({class_id:Number(t),class_label:r,subject_code:String(a),desired:b,actual:_,completed:b<=0?!0:_>=b})})}),e.sort((t,o)=>{const r=Number(t.class_id)-Number(o.class_id);if(r!==0)return r;const i=String(t.class_label||"").localeCompare(String(o.class_label||""));return i!==0?i:String(t.subject_code||"").localeCompare(String(o.subject_code||""))})});F(()=>{const s=rs.value||[];if(!s.length)return{completed:!0,missingCount:0};const e=s.filter(t=>!t.completed);return{completed:e.length===0,missingCount:e.length}});const os=s=>(q.value[s]||[]).map((t,o)=>({row:t,originalIndex:o})).filter(({row:t})=>(ee.value==="ALL"||t.class_label===ee.value)&&(ce.value==="ALL"||t.stream===ce.value)),pt=s=>{const e=os(s),t=[],o=new Map;return e.forEach(r=>{const i=r.row.class_label||r.row.form||"",l=i.trim()||"UNKNOWN";o.has(l)||(o.set(l,t.length),t.push({key:l,label:i,rows:[]})),t[o.get(l)].rows.push(r)}),t.forEach(r=>{r.rows.sort((i,l)=>{var j,S,D,E,L,B;const u=Number(((j=i==null?void 0:i.row)==null?void 0:j.school_class_id)||((S=i==null?void 0:i.row)==null?void 0:S.class_id)||0),a=Number(((D=l==null?void 0:l.row)==null?void 0:D.school_class_id)||((E=l==null?void 0:l.row)==null?void 0:E.class_id)||0);if(u!==a)return u-a;const b=String(((L=i==null?void 0:i.row)==null?void 0:L.stream)||""),_=String(((B=l==null?void 0:l.row)==null?void 0:B.stream)||"");return b.localeCompare(_)})}),t.sort((r,i)=>{var E,L,B,w,ae,Ae;const l=((L=(E=r==null?void 0:r.rows)==null?void 0:E[0])==null?void 0:L.row)||null,u=((w=(B=i==null?void 0:i.rows)==null?void 0:B[0])==null?void 0:w.row)||null,a=Number((l==null?void 0:l.school_class_id)||(l==null?void 0:l.class_id)||0)||0,b=Number((u==null?void 0:u.school_class_id)||(u==null?void 0:u.class_id)||0)||0,_=((ae=Se.value)==null?void 0:ae[String(a)])||null,j=((Ae=Se.value)==null?void 0:Ae[String(b)])||null,S=_!=null&&_.parent_class_id?Number(_.parent_class_id):a,D=j!=null&&j.parent_class_id?Number(j.parent_class_id):b;return S!==D?S-D:a!==b?a-b:String(r.label||"").localeCompare(String(i.label||""))})},ls=s=>pt(s).reduce((t,o)=>{var r;return t+(((r=o==null?void 0:o.rows)==null?void 0:r.length)||0)},0);_s(()=>{var t;he.value=Kt();const s=Qt();if(s&&((s.mode==="teacher_subject"||s.mode==="subject_only")&&(Z.value=s.mode),s.selected_class_id&&(I.value=String(s.selected_class_id)),s.apply_to_all_classes!==null&&s.apply_to_all_classes!==void 0&&(Ie.value=!!s.apply_to_all_classes),s.limits_by_key&&typeof s.limits_by_key=="object"&&(me.value=s.limits_by_key),s.subject_limits_by_id&&typeof s.subject_limits_by_id=="object"&&(le.value=s.subject_limits_by_id),s.subject_double_by_id&&typeof s.subject_double_by_id=="object"&&(pe.value=s.subject_double_by_id),s.subject_morning_single_by_id&&typeof s.subject_morning_single_by_id=="object"&&(ge.value=s.subject_morning_single_by_id),s.subject_morning_double_by_id&&typeof s.subject_morning_double_by_id=="object"&&(fe.value=s.subject_morning_double_by_id),s.subject_afternoon_single_by_id&&typeof s.subject_afternoon_single_by_id=="object"&&(ye.value=s.subject_afternoon_single_by_id),s.subject_afternoon_double_by_id&&typeof s.subject_afternoon_double_by_id=="object"&&(ve.value=s.subject_afternoon_double_by_id)),(t=$.timetable)!=null&&t.schedule_json){q.value=$.timetable.schedule_json,Pe();return}const e=Jt();e?q.value=e:mt()});const gt=()=>{T.schedule_json=q.value||{},T.post(route("timetables.store"),{preserveScroll:!0,onSuccess:()=>{showDetailsModal.value=!1,clearStoredSchedule()}})},is=()=>{window.print()},Re=M(!1),ft=s=>{const e=String(s||"").trim();if(!e)return"";const t=e.split(/\s+/).filter(Boolean);return t.length===1?t[0]:`${t[0]} ${t[t.length-1]}`},yt=F(()=>{const s=new Set,e=q.value||{};return Object.values(e).forEach(t=>{(t||[]).forEach(o=>{((o==null?void 0:o.slots)||[]).forEach(r=>{const i=((r==null?void 0:r.teacher_initials)||(r==null?void 0:r.teacher)||"").toString().trim();i&&i.split("/").map(l=>l.trim()).filter(Boolean).forEach(l=>s.add(l))})})}),s}),Ve=F(()=>{const s=Array.isArray($.subjects)?$.subjects:[],e=new Map;s.forEach(r=>{(Array.isArray(r.teachers)?r.teachers:[]).forEach(l=>{if(!(l!=null&&l.id))return;const u=String(l.initials||"").trim()||String(l.name||"").trim(),a=String(l.name||"").trim();!u&&!a||e.has(l.id)||e.set(l.id,{id:l.id,initials:u,name:a,simple_name:ft(a)||a,used:!1})})});const t=yt.value;return Array.from(e.values()).map(r=>({...r,used:t.has(r.initials)})).sort((r,i)=>{const l=Number(i.used)-Number(r.used);if(l!==0)return l;const u=String(r.initials||"").localeCompare(String(i.initials||""));return u!==0?u:String(r.simple_name||"").localeCompare(String(i.simple_name||""))})}),as=()=>{const s=Ve.value,e=["Initials,Name,UsedInTimetable"];s.forEach(i=>{const l=String(i.initials||"").replaceAll('"','""'),u=String(i.simple_name||i.name||"").replaceAll('"','""'),a=i.used?"YES":"NO";e.push(`"${l}","${u}","${a}"`)});const t=new Blob([e.join(`
`)],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=`teacher-initials-${T.academic_year||"timetable"}.csv`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(o)},se=M(!1),I=M(""),je=M(!1),ke=M(!1),me=M({}),Ie=M(!1),ne=M({}),Z=M("subject_only"),le=M({}),pe=M({}),ge=M({}),fe=M({}),ye=M({}),ve=M({}),we=M(!1);M(null);const Qe=s=>{const e={"B/MAT":5,BIO:3,BUS:3,CHE:3,CS:4,ENG:5,GEO:2,HIS:3,HTM:3,KIS:4,PHY:3},t={"B/MAT":5,BIO:4,BUS:3,CHE:4,CIV:3,CS:4,ENG:5,FK:2,GEO:3,HIS:4,HTM:3,KIS:4,LIT:2,PHY:4};return s===1||s===2?e:s===3||s===4?t:{}},ze=(s,e)=>`${s}:${e}`,P=s=>`${s}`,Ye=async()=>{var s;if(!I.value){le.value={},pe.value={},ge.value={},fe.value={},ye.value={},ve.value={};return}je.value=!0,we.value=!0;try{const t=await(await fetch(`${route("timetables.class-subject-limits.index")}?school_class_id=${encodeURIComponent(I.value)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json(),o={},r={},i={},l={},u={},a={};((t==null?void 0:t.limits)||[]).forEach(S=>{o[P(S.subject_id)]=S.periods_per_week,r[P(S.subject_id)]=!!S.is_double,i[P(S.subject_id)]=Number(S.morning_single||0),l[P(S.subject_id)]=Number(S.morning_double||0),u[P(S.subject_id)]=Number(S.afternoon_single||0),a[P(S.subject_id)]=Number(S.afternoon_double||0)});const b=((s=Se.value)==null?void 0:s[String(I.value)])||null,_=Te(b),j=Qe(_);Object.keys(j).forEach(S=>{var w;const D=((w=Ee.value)==null?void 0:w[String(S)])||null;if(!D)return;const E=P(D);o[E]=Number(j[S]);const L=Number(j[S]||0),B=String(S).toUpperCase();B==="ENG"||B==="B/MAT"?L>=5&&(r[E]=!0):L>=3&&(r[E]=!0)}),le.value=o,pe.value=r,ge.value=i,fe.value=l,ye.value=u,ve.value=a}catch{le.value={},pe.value={},ge.value={},fe.value={},ye.value={},ve.value={}}finally{je.value=!1,window.setTimeout(()=>{we.value=!1},0)}},us=async()=>{je.value=!0,we.value=!0;try{ne.value={};const e=await(await fetch(`${route("timetables.class-subject-limits.index")}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();((e==null?void 0:e.limits)||[]).forEach(t=>{const o=t!=null&&t.school_class_id?String(t.school_class_id):"";if(!o)return;ne.value[o]||(ne.value[o]={periodsBySubjectId:{},doubleBySubjectId:{},morningSingleBySubjectId:{},morningDoubleBySubjectId:{},afternoonSingleBySubjectId:{},afternoonDoubleBySubjectId:{}});const r=P(t.subject_id);ne.value[o].periodsBySubjectId[r]=t.periods_per_week,ne.value[o].doubleBySubjectId[r]=!!t.is_double,ne.value[o].morningSingleBySubjectId[r]=Number(t.morning_single||0),ne.value[o].morningDoubleBySubjectId[r]=Number(t.morning_double||0),ne.value[o].afternoonSingleBySubjectId[r]=Number(t.afternoon_single||0),ne.value[o].afternoonDoubleBySubjectId[r]=Number(t.afternoon_double||0)})}catch{ne.value={}}finally{je.value=!1,window.setTimeout(()=>{we.value=!1},0)}},Ze=async()=>{if(!I.value){me.value={};return}je.value=!0,we.value=!0;try{const e=await(await fetch(`${route("timetables.weekly-limits.index")}?school_class_id=${encodeURIComponent(I.value)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json(),t={};((e==null?void 0:e.limits)||[]).forEach(o=>{t[ze(o.teacher_id,o.subject_id)]=o.periods_per_week}),me.value=t}catch{me.value={}}finally{je.value=!1,window.setTimeout(()=>{we.value=!1},0)}},ds=async({closeModal:s=!0}={})=>{if(I.value){ke.value=!0;try{const e=teacherSubjectRows.value.map(t=>{const o=ze(t.teacher_id,t.subject_id),r=me.value[o];return{school_class_id:Number(I.value),subject_id:t.subject_id,teacher_id:t.teacher_id,periods_per_week:r===""||r===null||r===void 0?0:Number(r)}}).filter(t=>Number.isFinite(t.periods_per_week)&&t.periods_per_week>=0);await fetch(route("timetables.weekly-limits.save"),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":csrfToken()},credentials:"same-origin",body:JSON.stringify({limits:e})}),s&&(se.value=!1)}finally{ke.value=!1}}},cs=async({closeModal:s=!0}={})=>{if(I.value){ke.value=!0;try{const e=classSubjectRows.value.map(r=>{var D,E,L,B,w;const i=P(r.subject_id),l=le.value[i],u=!!((D=pe.value)!=null&&D[i]),a=Number(((E=ge.value)==null?void 0:E[i])??0)||0,b=Number(((L=fe.value)==null?void 0:L[i])??0)||0,_=Number(((B=ye.value)==null?void 0:B[i])??0)||0,j=Number(((w=ve.value)==null?void 0:w[i])??0)||0,S=a>0||b>0||_>0||j>0;return{subject_id:r.subject_id,periods_per_week:S?null:l===""||l===null||l===void 0?0:Number(l),is_double:u,morning_single:a,morning_double:b,afternoon_single:_,afternoon_double:j}}).filter(r=>r.periods_per_week===null||Number.isFinite(r.periods_per_week)&&r.periods_per_week>=0),t=Ie.value?(Oe.value||[]).map(r=>Number(r==null?void 0:r.id)).filter(r=>Number.isFinite(r)&&r>0):[Number(I.value)],o=[];t.forEach(r=>{e.forEach(i=>{o.push({school_class_id:r,...i})})}),await fetch(route("timetables.class-subject-limits.save"),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":csrfToken()},credentials:"same-origin",body:JSON.stringify({limits:o})}),s&&(se.value=!1)}finally{ke.value=!1}}};De(se,s=>{s&&(!I.value&&limitationClassOptions.value.length&&(I.value=limitationClassOptions.value[0].id),Z.value==="subject_only"?Ye():Ze())}),De(I,()=>{se.value&&(Z.value==="subject_only"?Ye():Ze())}),De(Z,()=>{se.value&&(Z.value==="subject_only"?Ye():Ze())}),De(me,()=>{se.value&&Z.value==="teacher_subject"&&syncSubjectPeriodsFromTeacherLimits()},{deep:!0}),De([me,le,pe,ge,fe,ye,ve],()=>{scheduleAutoLimitSave()},{deep:!0});const xe=M(null),et=M("");M(!1);const bs=M("");M({x:0,y:0}),M({day:"",rowIndex:-1,slotIndex:-1});const vt=F(()=>{const s=($.subjects||[]).map(e=>String((e==null?void 0:e.subject_code)||"").trim()).filter(Boolean);return Array.from(new Set(s)).sort((e,t)=>e.localeCompare(t))});F(()=>{const s=String(bs.value||"").trim().toUpperCase();return s?vt.value.filter(e=>String(e).toUpperCase().includes(s)):vt.value});const ie=(s,e)=>e>=0&&e<=3?!0:e>=4&&e<=6?!(s==="FRIDAY"&&e===6):e>=7&&e<=8?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(s):!1,tt=(s,e,t)=>{xe.value={day:s,rowIndex:e,slotIndex:t}},ms=(s,e,t,o)=>{var S,D,E,L;const r=String(s),i=Number(e),l=String(o||"").trim();if(!l)return!1;const u=(D=(S=q.value)==null?void 0:S[r])==null?void 0:D[Number(t)],a=Number((u==null?void 0:u.school_class_id)||(u==null?void 0:u.id)||(u==null?void 0:u.class_id)||(u==null?void 0:u.classId)||(u==null?void 0:u.schoolClassId)||0)||null,b=Ke(a,l,r,i),_=String(b||"").split("/").map(B=>B.trim()).filter(Boolean);if(!_.length)return!1;const j=((E=q.value)==null?void 0:E[r])||[];for(let B=0;B<j.length;B+=1){if(B===Number(t))continue;const w=j[B],ae=(L=w==null?void 0:w.slots)==null?void 0:L[i],Ae=ae!=null&&ae.subject?String(ae.subject):"";if(!Ae)continue;const Ce=Number((w==null?void 0:w.school_class_id)||(w==null?void 0:w.id)||(w==null?void 0:w.class_id)||(w==null?void 0:w.classId)||(w==null?void 0:w.schoolClassId)||0)||null,Le=Ke(Ce,Ae,r,i),Be=String(Le||"").split("/").map(te=>te.trim()).filter(Boolean);if(Be.length){for(let te=0;te<_.length;te+=1)if(Be.includes(_[te]))return!0}}return!1},ps=(s,e,t,o)=>{var _,j;const r=String(s),i=Number(e),l=Number(t),u=String(o||"").trim();if(!ie(r,l))return!1;const a=(j=(_=q.value)==null?void 0:_[r])==null?void 0:j[i];if(!a)return!1;const b=Number((a==null?void 0:a.school_class_id)||(a==null?void 0:a.id)||(a==null?void 0:a.class_id)||(a==null?void 0:a.classId)||(a==null?void 0:a.schoolClassId)||0)||null;return u&&!G(b,u,l)||u&&ms(r,l,i,u)?!1:(a.slots[l]=u?{subject:u,teacher:Ke(b,u,r,l)}:null,Pe(),!0)},st=(s,e,t)=>{var D,E;if(et.value){ps(s,e,t,et.value),et.value="",xe.value=null;return}if(!xe.value)return;const o=xe.value;if(o.day===s&&o.rowIndex===e&&o.slotIndex===t){xe.value=null;return}const r=(D=q.value[o.day])==null?void 0:D[o.rowIndex],i=(E=q.value[s])==null?void 0:E[e];if(!r||!i){xe.value=null;return}const l=r.slots[o.slotIndex],u=i.slots[t],a=l,b=Number((r==null?void 0:r.school_class_id)||(r==null?void 0:r.id)||(r==null?void 0:r.class_id)||(r==null?void 0:r.classId)||(r==null?void 0:r.schoolClassId)||0)||null,_=Number((i==null?void 0:i.school_class_id)||(i==null?void 0:i.id)||(i==null?void 0:i.class_id)||(i==null?void 0:i.classId)||(i==null?void 0:i.schoolClassId)||0)||null,j=!(u!=null&&u.subject)||G(b,u.subject,o.slotIndex),S=!(a!=null&&a.subject)||G(_,a.subject,t);if(!j||!S){xe.value=null;return}r.slots[o.slotIndex]=u,i.slots[t]=a,Pe(),xe.value=null},nt=(s,e,t,o)=>{const r=[],i=Array.isArray(e)?e:[],l=String(s||""),u=Number(t||0),a=Number(o||0);for(let b=0;b<a;b+=1){const _=u+b,j=i[_]||null,S=i[_+1]||null,D=!!(j!=null&&j.subject&&(S!=null&&S.subject)&&String(S.subject)===String(j.subject)&&z(l,_)&&z(l,_+1));if(b>0){const E=i[_-1]||null;if(E!=null&&E.subject&&(j!=null&&j.subject)&&String(E.subject)===String(j.subject))continue}r.push({slotIndex:_,slot:j,colspan:D?2:1,isDouble:D}),D&&(b+=1)}return r};return(s,e)=>(y(),f(Y,null,[Et(U(Ss),{title:"Create School Timetable"}),Et(js,null,{header:Tt(()=>[n("div",ks,[e[30]||(e[30]=n("div",null,[n("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),n("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),be.value.length?(y(),f("div",Ns,[e[29]||(e[29]=n("div",{class:"font-semibold"},"Limitations check:",-1)),n("div",Is,[(y(!0),f(Y,null,Q(be.value,(t,o)=>(y(),f("div",{key:o},C(t),1))),128))])])):K("",!0),n("div",ws,[n("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=t=>s.showDetailsModal=!0)}," Create / Edit Timetable Details ")])])]),default:Tt(()=>[Re.value?(y(),f("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[2]||(e[2]=Ue(t=>Re.value=!1,["self"]))},[n("div",As,[n("div",Cs,[e[31]||(e[31]=n("div",null,[n("h3",{class:"text-sm font-semibold text-gray-800"}," Teacher Initials Details "),n("p",{class:"mt-0.5 text-[11px] text-gray-500"},' Orodha ya walimu wote na initials zao. Zilizotumika kwenye ratiba zitaonyesha "Used". ')],-1)),n("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[1]||(e[1]=t=>Re.value=!1)}," Close ")]),n("div",Ds,[n("div",Es,[e[32]||(e[32]=Fe(" Used initials: ",-1)),n("span",Ts,C(yt.value.size),1),e[33]||(e[33]=Fe(" / Total teachers: ",-1)),n("span",Ms,C(Ve.value.length),1)]),n("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:as}," Download (CSV) ")]),n("div",$s,[n("table",Ls,[e[35]||(e[35]=n("thead",null,[n("tr",{class:"bg-gray-50 text-left"},[n("th",{class:"border-b border-gray-200 px-3 py-2"},"Initials"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Used")])],-1)),n("tbody",null,[Ve.value.length?K("",!0):(y(),f("tr",Bs,[...e[34]||(e[34]=[n("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"}," No teachers found. ",-1)])])),(y(!0),f(Y,null,Q(Ve.value,t=>(y(),f("tr",{key:t.id,class:"hover:bg-gray-50"},[n("td",Us,C(t.initials),1),n("td",Fs,C(t.simple_name||t.name),1),n("td",Os,[n("span",{class:_e(["inline-flex rounded-full px-2 py-0.5 text-[10px] font-semibold",t.used?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-700"])},C(t.used?"Used":"Not used"),3)])]))),128))])])])])])):K("",!0),n("div",Ps,[n("div",Rs,[e[53]||(e[53]=n("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),n("div",Vs,[n("div",zs,[e[38]||(e[38]=n("span",{class:"font-semibold"},"View class:",-1)),H(n("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>ee.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[36]||(e[36]=n("option",{value:"ALL"},"All Classes",-1)),(y(!0),f(Y,null,Q(Yt.value,t=>(y(),f("option",{key:t,value:t},C(t),9,Ys))),128))],512),[[qe,ee.value]]),H(n("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>ce.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[37]||(e[37]=n("option",{value:"ALL"},"All Streams",-1)),Xe.value.length?K("",!0):(y(),f("option",Hs,"No streams")),(y(!0),f(Y,null,Q(Xe.value,t=>(y(),f("option",{key:t,value:t},"Stream "+C(t),9,qs))),128))],512),[[qe,ce.value]])]),n("div",Ks,[n("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:es}," Regenerate Sample Timetable "),n("button",{type:"button",class:"rounded-md bg-emerald-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:U(T).processing,onClick:gt},C(U(T).processing?"Saving...":"Save"),9,Gs),n("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[5]||(e[5]=t=>Re.value=!0)}," Teacher Initials Details "),n("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[6]||(e[6]=t=>se.value=!0)}," Limitations & More "),n("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:is}," Print "),n("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[7]||(e[7]=t=>qt.value=!0)}," Limitations & Resolve ")])]),n("div",Ws,[n("div",Xs,[e[41]||(e[41]=n("div",{class:"mb-1 flex justify-center"},[n("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),n("div",Js,C(Ut.value),1),n("div",Qs,C(Ft.value)+" · "+C(Ot.value),1),e[42]||(e[42]=n("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),n("div",Zs,[e[40]||(e[40]=Fe(" Mwaka: ",-1)),n("span",en,C(U(T).academic_year||"____"),1),ee.value!=="ALL"?(y(),f("span",tn,[e[39]||(e[39]=Fe(" · Darasa: ",-1)),n("span",sn,C(Ht.value),1)])):K("",!0)])]),n("div",nn,[n("div",null,[e[43]||(e[43]=n("span",{class:"font-semibold"},"Kichwa:",-1)),n("span",rn,C(U(T).title||"Ratiba ya Darasa"),1)]),n("div",null,[e[44]||(e[44]=n("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),n("span",on,C(U(T).start_time)+" - "+C(U(T).end_time),1)]),n("div",ln,[e[45]||(e[45]=n("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),n("span",an,C(Pt.value),1)])]),n("div",un,[n("table",dn,[e[52]||(e[52]=n("thead",null,[n("tr",null,[n("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),n("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),n("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),n("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),n("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),n("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),n("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:40 - 11:05 AM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),n("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),n("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),n("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),n("tbody",null,[(y(),f(Y,null,Q(O,t=>(y(),f(Y,{key:t},[(y(!0),f(Y,null,Q(pt(t),(o,r)=>(y(),f(Y,{key:`${t}-${o.key}`},[(y(!0),f(Y,null,Q(o.rows,({row:i,originalIndex:l},u)=>(y(),f("tr",{key:`${t}-${o.key}-${i.stream}-${l}`},[r===0&&u===0?(y(),f("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:ls(t)||1},C(t),9,cn)):K("",!0),u===0?(y(),f("td",{key:1,class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold",rowspan:o.rows.length},C(o.label||i.class_label||i.form),9,bn)):K("",!0),n("td",mn,C(i.stream),1),e[46]||(e[46]=n("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[n("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[47]||(e[47]=n("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(y(!0),f(Y,null,Q(nt(t,i.slots,0,4),a=>(y(),f("td",{key:`am-${a.slotIndex}`,colspan:a.colspan,class:_e(["border border-slate-300 px-1 py-1 text-center",a.isDouble?"bg-emerald-100":"bg-emerald-50"]),draggable:ie(t,a.slotIndex),onDragstart:b=>ie(t,a.slotIndex)&&tt(t,l,a.slotIndex),onDragover:e[8]||(e[8]=Ue(()=>{},["prevent"])),onDrop:b=>ie(t,a.slotIndex)&&st(t,l,a.slotIndex)},[a.slot&&a.slot.subject?(y(),f(Y,{key:0},[n("div",gn,[n("span",null,C(a.slot.subject),1),a.isDouble?(y(),f("span",fn," Double ")):K("",!0)]),n("div",yn,C(a.slot.teacher),1)],64)):(y(),f("div",vn," "))],42,pn))),128)),e[48]||(e[48]=n("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(y(!0),f(Y,null,Q(nt(t,i.slots,4,3),a=>(y(),f("td",{key:`mid-${a.slotIndex}`,colspan:a.colspan,class:_e(["border border-slate-300 px-1 py-1 text-center",a.isDouble?"bg-indigo-100":"bg-indigo-50"]),draggable:ie(t,a.slotIndex),onDragstart:b=>ie(t,a.slotIndex)&&tt(t,l,a.slotIndex),onDragover:e[9]||(e[9]=Ue(()=>{},["prevent"])),onDrop:b=>ie(t,a.slotIndex)&&st(t,l,a.slotIndex)},[t==="FRIDAY"&&a.slotIndex===6?(y(),f("div",xn,"MEWAKA")):(y(),f(Y,{key:1},[a.slot&&a.slot.subject?(y(),f(Y,{key:0},[n("div",_n,[n("span",null,C(a.slot.subject),1),a.isDouble?(y(),f("span",Sn," Double ")):K("",!0)]),n("div",jn,C(a.slot.teacher),1)],64)):(y(),f("div",kn," "))],64))],42,hn))),128)),e[49]||(e[49]=n("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),["WEDNESDAY","THURSDAY","FRIDAY"].includes(t)?(y(!0),f(Y,{key:2},Q(i.slots.slice(7,9),(a,b)=>(y(),f("td",{key:`pm-fixed-${b}`,class:_e(["border border-slate-300 px-1 py-1 text-center",t==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":t==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":"bg-lime-300 text-[9px] font-semibold text-lime-900"])},[t==="WEDNESDAY"?(y(),f("div",Nn,"RELIGION")):t==="THURSDAY"?(y(),f("div",In,"DEBATE OR CLUBS")):(y(),f("div",wn,"SPORTS AND GAMES"))],2))),128)):(y(!0),f(Y,{key:3},Q(nt(t,i.slots,7,2),a=>(y(),f("td",{key:`pm-${a.slotIndex}`,colspan:a.colspan,class:_e(["border border-slate-300 px-1 py-1 text-center",a.isDouble?"bg-indigo-100":"bg-indigo-50"]),draggable:ie(t,a.slotIndex),onDragstart:b=>ie(t,a.slotIndex)&&tt(t,l,a.slotIndex),onDragover:e[10]||(e[10]=Ue(()=>{},["prevent"])),onDrop:b=>ie(t,a.slotIndex)&&st(t,l,a.slotIndex)},[a.slot&&a.slot.subject?(y(),f(Y,{key:0},[n("div",Cn,[n("span",null,C(a.slot.subject),1),a.isDouble?(y(),f("span",Dn," Double ")):K("",!0)]),n("div",En,C(a.slot.teacher),1)],64)):(y(),f("div",Tn,"PS"))],42,An))),128)),e[50]||(e[50]=n("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128))],64))),128)),e[51]||(e[51]=n("tr",null,[n("td",{colspan:17,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])])]),s.showDetailsModal?(y(),f("div",Mn,[n("div",$n,[n("div",Ln,[e[54]||(e[54]=n("div",null,[n("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),n("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),n("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[11]||(e[11]=t=>s.showDetailsModal=!1)}," Close ")]),n("div",Bn,[n("div",null,[e[55]||(e[55]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),n("div",Un,[n("button",{type:"button",class:_e(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",U(T).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[12]||(e[12]=t=>U(T).type="class")}," Class Timetable ",2),n("button",{type:"button",class:_e(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",U(T).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[13]||(e[13]=t=>U(T).type="invigilation")}," Invigilation ",2),n("button",{type:"button",class:_e(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",U(T).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[14]||(e[14]=t=>U(T).type="exams")}," Exams Timetable ",2)])]),n("div",null,[e[56]||(e[56]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),H(n("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>U(T).title=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[oe,U(T).title]])]),n("div",Fn,[n("div",null,[e[57]||(e[57]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),H(n("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>U(T).class_name=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[oe,U(T).class_name]])]),n("div",null,[e[58]||(e[58]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),H(n("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>U(T).term=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[oe,U(T).term]])])]),n("div",On,[n("div",null,[e[59]||(e[59]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),H(n("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>U(T).academic_year=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[oe,U(T).academic_year]])]),n("div",Pn,[n("div",null,[e[60]||(e[60]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),H(n("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>U(T).start_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[oe,U(T).start_time]])]),n("div",null,[e[61]||(e[61]=n("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),H(n("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>U(T).end_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[oe,U(T).end_time]])])])]),e[62]||(e[62]=n("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),n("div",Rn,[n("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[21]||(e[21]=t=>s.showDetailsModal=!1)}," Cancel "),n("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:U(T).processing,onClick:gt},C(U(T).processing?"Saving...":"Generate & Save Timetable"),9,Vn)])])])])):K("",!0),se.value?(y(),f("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[28]||(e[28]=Ue(t=>se.value=!1,["self"]))},[n("div",zn,[n("div",Yn,[n("div",Hn,[e[63]||(e[63]=n("div",null,[n("h3",{class:"text-sm font-semibold text-gray-800"}," Limitations & More "),n("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Weka vipindi kwa wiki kwa kila mwalimu na somo kwa darasa/stream. ")],-1)),n("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[22]||(e[22]=t=>se.value=!1)}," Close ")]),n("div",qn,[n("div",null,[e[65]||(e[65]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Class",-1)),H(n("select",{"onUpdate:modelValue":e[23]||(e[23]=t=>I.value=t),class:"w-64 rounded-md border border-gray-300 bg-white px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[64]||(e[64]=n("option",{value:"",disabled:""},"Select class",-1)),(y(!0),f(Y,null,Q(s.limitationClassOptions,t=>(y(),f("option",{key:t.id,value:t.id},C(t.display),9,Kn))),128))],512),[[qe,I.value]])]),n("div",null,[e[67]||(e[67]=n("label",{class:"mb-1 block text-[11px] font-medium"},"Mode",-1)),H(n("select",{"onUpdate:modelValue":e[24]||(e[24]=t=>Z.value=t),class:"w-56 rounded-md border border-gray-300 bg-white px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[...e[66]||(e[66]=[n("option",{value:"subject_only"},"Subject limitation",-1),n("option",{value:"teacher_subject"},"Teacher + Subject limitation",-1)])],512),[[qe,Z.value]])]),n("label",Gn,[H(n("input",{"onUpdate:modelValue":e[25]||(e[25]=t=>Ie.value=t),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"},null,512),[[Mt,Ie.value]]),e[68]||(e[68]=Fe(" Apply to all classes/streams ",-1))]),je.value?(y(),f("div",Wn,"Loading...")):K("",!0)])]),n("div",Xn,[Z.value==="subject_only"?(y(),f("table",Jn,[e[70]||(e[70]=n("thead",null,[n("tr",{class:"bg-gray-50 text-left"},[n("th",{class:"border-b border-gray-200 px-3 py-2"},"Subject"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Session"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Morning (Single)"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Morning (Double)"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Afternoon (Single)"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Afternoon (Double)"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Periods / Week"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Double (80 mins)")])],-1)),n("tbody",null,[s.classSubjectRows.length?K("",!0):(y(),f("tr",Qn,[n("td",Zn,[I.value?I.value&&!s.selectedLimitClassHasSubjects?(y(),f("span",tr,"No subjects assigned to this class.")):(y(),f("span",sr,"No subjects found.")):(y(),f("span",er,"Select a class to view subject limitations."))])])),(y(!0),f(Y,null,Q(s.classSubjectRows,t=>(y(),f("tr",{key:t.subject_id,class:"hover:bg-gray-50"},[n("td",nr,[n("div",rr,C(t.subject_code),1),n("div",or,C(t.subject_name),1)]),n("td",lr,[n("select",{class:"w-48 rounded-md border border-gray-300 bg-white px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value,value:Lt.value[String(t.subject_id)]||"any",onChange:o=>Bt(t.subject_id,o.target.value)},[...e[69]||(e[69]=[n("option",{value:"any"},"Any time",-1),n("option",{value:"morning"},"Morning only (08:00 - 10:40)",-1),n("option",{value:"afternoon"},"Afternoon only (01:20 - 02:40)",-1)])],40,ir)]),n("td",ar,[H(n("input",{"onUpdate:modelValue":o=>ge.value[P(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value},null,8,ur),[[oe,ge.value[P(t.subject_id)]]])]),n("td",dr,[H(n("input",{"onUpdate:modelValue":o=>fe.value[P(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value},null,8,cr),[[oe,fe.value[P(t.subject_id)]]])]),n("td",br,[H(n("input",{"onUpdate:modelValue":o=>ye.value[P(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value},null,8,mr),[[oe,ye.value[P(t.subject_id)]]])]),n("td",pr,[H(n("input",{"onUpdate:modelValue":o=>ve.value[P(t.subject_id)]=o,type:"number",min:"0",class:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value},null,8,gr),[[oe,ve.value[P(t.subject_id)]]])]),n("td",fr,[H(n("input",{"onUpdate:modelValue":o=>le.value[P(t.subject_id)]=o,type:"number",min:"0",class:"w-24 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value},null,8,yr),[[oe,le.value[P(t.subject_id)]]])]),n("td",vr,[H(n("input",{"onUpdate:modelValue":o=>pe.value[P(t.subject_id)]=o,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500",disabled:!I.value},null,8,hr),[[Mt,pe.value[P(t.subject_id)]]])])]))),128))])])):(y(),f("table",xr,[e[71]||(e[71]=n("thead",null,[n("tr",{class:"bg-gray-50 text-left"},[n("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Subject"),n("th",{class:"border-b border-gray-200 px-3 py-2"},"Periods / Week")])],-1)),n("tbody",null,[s.teacherSubjectRows.length?K("",!0):(y(),f("tr",_r,[n("td",Sr,[I.value?I.value&&!s.selectedLimitClassHasSubjects?(y(),f("span",kr,"No subjects assigned to this class.")):(y(),f("span",Nr,"No teacher-subject mappings found.")):(y(),f("span",jr,"Select a class to view teacher limitations."))])])),(y(!0),f(Y,null,Q(s.teacherSubjectRows,t=>(y(),f("tr",{key:`${t.teacher_id}-${t.subject_id}`,class:"hover:bg-gray-50"},[n("td",Ir,[n("div",wr,C(t.teacher_name),1),n("div",Ar,C(t.teacher_initials),1)]),n("td",Cr,[n("div",Dr,C(t.subject_code),1),n("div",Er,C(t.subject_name),1)]),n("td",Tr,[n("input",{type:"number",min:"0",max:"50",class:"w-24 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!I.value,value:me.value[ze(t.teacher_id,t.subject_id)]??0,onInput:o=>{me.value[ze(t.teacher_id,t.subject_id)]=o.target.value}},null,40,Mr)])]))),128))])]))]),e[72]||(e[72]=n("div",{class:"mt-5 rounded-lg border border-gray-200 bg-gray-50 p-4"},[n("pre",{class:"whitespace-pre-wrap text-[11px] leading-relaxed text-gray-700"},`Jedwali la Muhtasari wa Mzigo wa Mwalimu (Kwa Zoezi):
No.	Subject	Form I & II	Form III & IV	Jumla kwa Wiki
1.	Hisabati	5	5	10
2.	Physics	3	4	7
3.	Computer Science	4	4	8
Jumla				25
Vipengele vya Zoezi Unaweza Kufanya:
Chagua mchanganyiko tofauti wa masomo.

Badilisha ngazi za masomo (mfano: Fomu I & II tu).

Ongeza idadi ya walimu na uhesabu usambazaji wa mzigo kwa shule nzima.

Tengeneza chati ya pie au bar kuonyesha usambazaji wa vipindi.

Kama unataka, naweza kukusaidia kuandaa hii kwenye Excel na kukupa faili iliyo na:

Jedwali linaloweza kurekebishwa

Fomu za kuhesabu automatikali

Chati za kuona

Tuambie unapendelea kuendelea vipi!

andika yote kama iluvo kwnye podf usibadilsihe andika kila kitu kama kilivyo
Hapa ni nakala kamili ya maudhui ya faili yako kama ilivyo, bila mabadiliko yoyote:

===== Page 1 =====

Table 4: Compulsory Core Subjects and the Number of Periods per Week
No.	Subject	Number of periods per week
Form I & II	Form III & IV
1.	Mathematics	5	5
2.	Kiswahili	4	4
3.	English	5	5
4.	Business studies	3	3
5.	Geography	2	3
6.	Historia ya Tanzania na Maadili	3	3
Table 5: Electric Subjects and Number of Periods per Week
No.	Subject	Number of periods per week
Form I & II	Form III & IV
1.	Physics	3	4
2.	Chemistry	3	4
3.	Biology	3	4
4.	Agriculture	5	5
5.	Computer science	4	4
6.	Food and Human Nutrition	5	5
7.	Sports	4	4
8.	Textile and Gurment Construction	5	5
9.	Fine Art	4	4
10.	Theatre Arts	4	4
11.	Additional Mathematics	–	3
12.	Literature in English	–	2
13.	Fasihi ya Kiswahili	–	2
14.	French	3	3
15.	Arabic	3	3
16.	Chinese	3	3
17.	Music	4	4
18.	History	3	4
19.	Book-kooping	3	4
20.	Bible Knowledge	3	3
21.	Dani ya Kislamu	3	3
 kwa kila osmo ziangtia usischangenye osmo lolote`)],-1)),n("div",$r,[n("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",disabled:ke.value,onClick:e[26]||(e[26]=t=>se.value=!1)}," Cancel ",8,Lr),n("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:ke.value||!I.value,onClick:e[27]||(e[27]=t=>Z.value==="subject_only"?cs():ds())},C(ke.value?"Saving...":"Save Limitations"),9,Br)])])])):K("",!0)])]),_:1})],64))}};export{Rr as default};

import{y as Le,j as f,i as w,I as X,B as je,c as d,a as me,u as g,h as Ee,w as ce,b as t,d as I,k as C,o as u,F as y,r as S,t as b,p as z,f as be,x as J,s as U,v as $}from"./app-CgUuIc12.js";import{_ as Re}from"./AuthenticatedLayout-DOax3iBg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"flex items-center justify-between"},Me={class:"flex items-center gap-2"},Fe={class:"space-y-4"},Ve={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},Oe={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},Ye={class:"flex flex-wrap items-center gap-2"},Ue=["value"],Pe={key:0,value:"",disabled:""},Be=["value"],Ke={class:"flex flex-wrap items-center gap-2"},We={id:"class-timetable-preview",class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[10px] text-gray-800"},qe={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},Ge={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},He={class:"text-[9px] text-gray-600"},Xe={class:"text-[9px] text-gray-700"},ze={class:"font-semibold"},Je={key:0},Qe={class:"font-semibold"},Ze={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},et={class:"ml-1"},tt={class:"ml-1"},st={class:"text-right"},rt={class:"ml-1"},lt={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},ot={class:"min-w-full border-collapse text-[9px] leading-tight"},at=["rowspan"],nt=["rowspan"],it={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},dt=["draggable","onDragstart","onDrop"],ut={class:"text-[8px] text-gray-600"},mt=["draggable","onDragstart","onDrop"],ct={key:0,class:"font-semibold text-orange-700"},bt={class:"text-[8px] text-gray-600"},pt=["draggable","onDragstart","onDrop"],gt={key:0},xt={key:1},ft={key:2},yt={class:"text-[8px] text-gray-600"},vt={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},ht={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},_t={class:"mb-3 flex items-center justify-between"},wt={class:"space-y-3"},St={class:"grid grid-cols-3 gap-2"},kt={class:"grid grid-cols-2 gap-3"},At={class:"grid grid-cols-2 gap-3"},Ct={class:"grid grid-cols-2 gap-2"},It={class:"mt-3 flex items-center justify-end gap-2"},Nt={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},Tt={class:"max-h-full w-full max-w-4xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},Dt={class:"mb-3 flex items-center justify-between"},Lt={class:"mb-3 flex flex-wrap items-end gap-3"},jt=["value"],Et={key:0,class:"text-[11px] text-gray-500"},Rt={class:"overflow-hidden rounded-lg border border-gray-200"},$t={class:"min-w-full border-collapse text-[11px]"},Mt={key:0},Ft={colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"},Vt={key:0},Ot={key:1},Yt={class:"border-b border-gray-100 px-3 py-2"},Ut={class:"font-medium text-gray-800"},Pt={class:"text-[10px] text-gray-500"},Bt={class:"border-b border-gray-100 px-3 py-2"},Kt={class:"font-medium text-gray-800"},Wt={class:"text-[10px] text-gray-500"},qt={class:"border-b border-gray-100 px-3 py-2"},Gt=["disabled","value","onInput"],Ht={class:"mt-4 flex items-center justify-end gap-2"},Xt=["disabled"],zt=["disabled"],es={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]}},setup(pe){var ae,ne,ie,de;const v=pe,c=Le({type:"class",title:((ae=v.timetable)==null?void 0:ae.title)||"",class_name:((ne=v.timetable)==null?void 0:ne.class_name)||"",academic_year:((ie=v.timetable)==null?void 0:ie.academic_year)||String(new Date().getFullYear()),term:((de=v.timetable)==null?void 0:de.term)||"",start_time:"07:30",end_time:"16:00"}),ge=f(()=>v.school.name||"Your School Name"),xe=f(()=>v.school.address||"P.O. Box 123, City"),fe=f(()=>v.school.region||"Region"),ye=f(()=>c.type==="invigilation"?"Invigilation Timetable":c.type==="exams"?"Exams Timetable":"School General Timetable"),ve=f(()=>(v.subjects||[]).map(r=>r.subject_code)),he=f(()=>{const r={};return(v.subjects||[]).forEach(e=>{const s=(e.teachers||[])[0];s&&(r[e.subject_code]=s.initials||s.name)}),r}),Q=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],N=r=>{const e={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII"};if(r==null)return"";const s=String(r).trim();if(s==="")return"";const o=Number(s);if(!Number.isNaN(o)&&e[o])return e[o];const i=s.toUpperCase();if(/^[IVXLCDM]+$/.test(i))return i;const n=i.match(/\b(?:FORM|CLASS|STD|STANDARD)\s*([IVXLCDM]+|\d+)\b/);if(n){const l=n[1],a=Number(l);if(!Number.isNaN(a)&&e[a])return e[a];if(/^[IVXLCDM]+$/.test(l))return l}return""},M=r=>{if(!r)return null;const e=String(r).toUpperCase().trim();if(!e)return null;const s={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};let o=0,i=0;for(let n=e.length-1;n>=0;n-=1){const l=s[e[n]];if(!l)return null;l<i?o-=l:(o+=l,i=l)}return o},Z=r=>{const e=P(r);if(!e)return Number.POSITIVE_INFINITY;const s=M(e);return s===null?Number.POSITIVE_INFINITY:s},P=r=>N(r==null?void 0:r.parent_name)||N(r==null?void 0:r.level)||N(r==null?void 0:r.name),V=r=>{const e=((r==null?void 0:r.parent_name)||"").trim();if(e)return e;const s=((r==null?void 0:r.name)||"").trim();if(s&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(s))return s;const o=((r==null?void 0:r.level)||"").trim();if(o&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(o))return o;const i=P(r);return i?`Form ${i}`:o||s},L=f(()=>{const r=Array.isArray(v.classes)?v.classes:[],e=new Map;r.forEach(l=>{!l||!l.parent_class_id||!(l.stream&&String(l.stream).trim())||(e.has(l.parent_class_id)||e.set(l.parent_class_id,[]),e.get(l.parent_class_id).push(l))});const s=[];r.filter(l=>!(l!=null&&l.parent_class_id)).forEach(l=>{const a=e.get(l.id)||[];if(a.length){a.slice().sort((p,m)=>String(p.stream||"").localeCompare(String(m.stream||""))).forEach(p=>s.push(p));return}s.push(l)});const o=new Set(r.filter(l=>!(l!=null&&l.parent_class_id)).map(l=>l.id));r.filter(l=>(l==null?void 0:l.parent_class_id)&&!o.has(l.parent_class_id)).forEach(l=>s.push(l));const i=new Set;return s.filter(l=>{const a=l==null?void 0:l.id;return a==null||i.has(a)?!1:(i.add(a),!0)}).sort((l,a)=>{const p=Z(l),m=Z(a);if(p!==m)return p-m;const _=(l!=null&&l.stream?String(l.stream):"").toUpperCase(),Y=(a!=null&&a.stream?String(a.stream):"").toUpperCase(),ue=_.localeCompare(Y);return ue!==0?ue:((l==null?void 0:l.id)||0)-((a==null?void 0:a.id)||0)})}),_e=f(()=>{const r=new Set;return L.value.forEach(s=>{const o=V(s);o&&r.add(o)}),r.size===0?["Form I","Form II","Form III","Form IV"]:Array.from(r.values()).sort((s,o)=>{const i=N(s),n=N(o),l=M(i)??Number.POSITIVE_INFINITY,a=M(n)??Number.POSITIVE_INFINITY;return l!==a?l-a:String(s).localeCompare(String(o))})}),B=f(()=>{const r=new Set;return L.value.forEach(e=>{const s=e.stream?String(e.stream).toUpperCase().trim():"";if(s){if(h.value!=="ALL"){const o=V(e);if(o&&o!==h.value)return}r.add(s)}}),r.size===0?[]:Array.from(r.values())}),h=w("ALL"),k=w("ALL");X(h,()=>{k.value!=="ALL"&&(B.value.includes(k.value)||(k.value="ALL"))});const we=f(()=>h.value!=="ALL"&&k.value!=="ALL"?`${h.value} ${k.value}`:h.value!=="ALL"?`${h.value}`:c.class_name||"____"),T=w({}),ee=f(()=>{var e;return`timetable_schedule_v1_${((e=v.school)==null?void 0:e.id)??"school"}`}),Se=()=>{try{const r=window.localStorage.getItem(ee.value);if(!r)return null;const e=JSON.parse(r);return!e||typeof e!="object"?null:e}catch{return null}},te=()=>{try{window.localStorage.setItem(ee.value,JSON.stringify(T.value||{}))}catch{}},se=()=>{const r={},e=ve.value,s=he.value;if(!e.length){T.value={};return}Q.forEach(o=>{r[o]=[],L.value.forEach(i=>{const n=P(i),l=V(i),a=i.stream?String(i.stream).toUpperCase().trim():"",p=Array.isArray(i.subject_codes)&&i.subject_codes.length?i.subject_codes:e,m={form:n,class_label:l,stream:a,class_name:i.name||`${l} ${a}`.trim(),slots:[]};for(let _=0;_<8;_+=1){const Y=p[Math.floor(Math.random()*p.length)];m.slots.push({subject:Y,teacher:s[Y]||""})}r[o].push(m)})}),T.value=r,te()},ke=r=>(T.value[r]||[]).map((s,o)=>({row:s,originalIndex:o})).filter(({row:s})=>(h.value==="ALL"||s.class_label===h.value)&&(k.value==="ALL"||s.stream===k.value)),re=r=>{const e=ke(r),s=[],o=new Map;return e.forEach(i=>{const n=i.row.class_label||i.row.form||"",l=n.trim()||"UNKNOWN";o.has(l)||(o.set(l,s.length),s.push({key:l,label:n,rows:[]})),s[o.get(l)].rows.push(i)}),s.sort((i,n)=>{const l=N(i.label),a=N(n.label),p=M(l)??Number.POSITIVE_INFINITY,m=M(a)??Number.POSITIVE_INFINITY;return p!==m?p-m:String(i.label||"").localeCompare(String(n.label||""))})},Ae=r=>re(r).reduce((e,s)=>e+s.rows.length,0);je(()=>{const r=Se();if(r){T.value=r;return}se()});const j=w(!1),Ce=()=>{c.post(route("timetables.store"),{preserveScroll:!0,onSuccess:()=>{j.value=!1}})},Ie=()=>{window.print()},D=w(!1),x=w(""),K=w(!1),F=w(!1),E=w({}),le=f(()=>{const r=x.value?Number(x.value):null;return Number.isFinite(r)&&L.value.find(e=>Number(e==null?void 0:e.id)===r)||null}),Ne=f(()=>{var e;return(Array.isArray((e=le.value)==null?void 0:e.subject_codes)?le.value.subject_codes:[]).length>0}),Te=()=>{var r;return((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},W=f(()=>{const r=[];(v.subjects||[]).forEach(n=>{(Array.isArray(n.teachers)?n.teachers:[]).forEach(a=>{a!=null&&a.id&&r.push({teacher_id:a.id,teacher_name:a.name,teacher_initials:a.initials,subject_id:n.id,subject_code:n.subject_code,subject_name:n.name})})});const e=x.value?Number(x.value):null,s=Number.isFinite(e)?L.value.find(n=>Number(n==null?void 0:n.id)===e):null,o=Array.isArray(s==null?void 0:s.subject_codes)?s.subject_codes:[];return(s?r.filter(n=>o.includes(n.subject_code)):r).sort((n,l)=>{const a=String(n.teacher_name||"").localeCompare(String(l.teacher_name||""));return a!==0?a:String(n.subject_code||"").localeCompare(String(l.subject_code||""))})}),q=f(()=>L.value.map(r=>{const e=V(r)||r.name||"",s=r.stream?String(r.stream).toUpperCase().trim():"",o=s?`${e} ${s}`:e;return{id:String(r.id),display:o}})),O=(r,e)=>`${r}:${e}`,oe=async()=>{if(!x.value){E.value={};return}K.value=!0;try{const e=await(await fetch(`${route("timetables.weekly-limits.index")}?school_class_id=${encodeURIComponent(x.value)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json(),s={};((e==null?void 0:e.limits)||[]).forEach(o=>{s[O(o.teacher_id,o.subject_id)]=o.periods_per_week}),E.value=s}catch{E.value={}}finally{K.value=!1}},De=async()=>{if(x.value){F.value=!0;try{const r=W.value.map(e=>{const s=O(e.teacher_id,e.subject_id),o=E.value[s];return{school_class_id:Number(x.value),subject_id:e.subject_id,teacher_id:e.teacher_id,periods_per_week:o===""||o===null||o===void 0?0:Number(o)}}).filter(e=>Number.isFinite(e.periods_per_week)&&e.periods_per_week>=0);await fetch(route("timetables.weekly-limits.save"),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Te()},credentials:"same-origin",body:JSON.stringify({limits:r})}),D.value=!1}finally{F.value=!1}}};X(D,r=>{r&&(!x.value&&q.value.length&&(x.value=q.value[0].id),oe())}),X(x,()=>{D.value&&oe()});const R=w(null),A=(r,e)=>e>=0&&e<=2?!0:e>=3&&e<=5?!(r==="FRIDAY"&&e===5):e>=6&&e<=7?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(r):!1,G=(r,e,s)=>{R.value={day:r,rowIndex:e,slotIndex:s}},H=(r,e,s)=>{var a,p;if(!R.value)return;const o=R.value;if(o.day===r&&o.rowIndex===e&&o.slotIndex===s){R.value=null;return}const i=(a=T.value[o.day])==null?void 0:a[o.rowIndex],n=(p=T.value[r])==null?void 0:p[e];if(!i||!n){R.value=null;return}const l=i.slots[o.slotIndex];i.slots[o.slotIndex]=n.slots[s],n.slots[s]=l,te(),R.value=null};return(r,e)=>(u(),d(y,null,[me(g(Ee),{title:"Create School Timetable"}),me(Re,null,{header:ce(()=>[t("div",$e,[e[22]||(e[22]=t("div",null,[t("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),t("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),t("div",Me,[t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=s=>j.value=!0)}," Create / Edit Timetable Details ")])])]),default:ce(()=>[t("div",Fe,[t("div",Ve,[e[40]||(e[40]=t("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),t("div",Oe,[t("div",Ye,[e[25]||(e[25]=t("span",{class:"font-semibold"},"View class:",-1)),C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[23]||(e[23]=t("option",{value:"ALL"},"All Classes",-1)),(u(!0),d(y,null,S(_e.value,s=>(u(),d("option",{key:s,value:s},b(s),9,Ue))),128))],512),[[z,h.value]]),C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[24]||(e[24]=t("option",{value:"ALL"},"All Streams",-1)),B.value.length?I("",!0):(u(),d("option",Pe,"No streams")),(u(!0),d(y,null,S(B.value,s=>(u(),d("option",{key:s,value:s},"Stream "+b(s),9,Be))),128))],512),[[z,k.value]])]),t("div",Ke,[t("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:se}," Regenerate Sample Timetable "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[3]||(e[3]=s=>D.value=!0)}," Limitations & More "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:Ie}," Print "),t("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[4]||(e[4]=s=>j.value=!0)}," Open Timetable Details ")])]),t("div",We,[t("div",qe,[e[28]||(e[28]=t("div",{class:"mb-1 flex justify-center"},[t("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),t("div",Ge,b(ge.value),1),t("div",He,b(xe.value)+" · "+b(fe.value),1),e[29]||(e[29]=t("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),t("div",Xe,[e[27]||(e[27]=be(" Mwaka: ",-1)),t("span",ze,b(g(c).academic_year||"____"),1),h.value!=="ALL"?(u(),d("span",Je,[e[26]||(e[26]=be(" · Darasa: ",-1)),t("span",Qe,b(we.value),1)])):I("",!0)])]),t("div",Ze,[t("div",null,[e[30]||(e[30]=t("span",{class:"font-semibold"},"Kichwa:",-1)),t("span",et,b(g(c).title||"Ratiba ya Darasa"),1)]),t("div",null,[e[31]||(e[31]=t("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),t("span",tt,b(g(c).start_time)+" - "+b(g(c).end_time),1)]),t("div",st,[e[32]||(e[32]=t("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),t("span",rt,b(ye.value),1)])]),t("div",lt,[t("table",ot,[e[39]||(e[39]=t("thead",null,[t("tr",null,[t("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),t("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),t("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),t("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),t("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),t("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),t("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),t("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),t("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),t("tbody",null,[(u(),d(y,null,S(Q,s=>(u(),d(y,{key:s},[(u(!0),d(y,null,S(re(s),(o,i)=>(u(),d(y,{key:`${s}-${o.key}`},[(u(!0),d(y,null,S(o.rows,({row:n,originalIndex:l},a)=>(u(),d("tr",{key:`${s}-${o.key}-${n.stream}-${l}`},[i===0&&a===0?(u(),d("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:Ae(s)||1},b(s),9,at)):I("",!0),a===0?(u(),d("td",{key:1,class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold",rowspan:o.rows.length},b(o.label||n.class_label||n.form),9,nt)):I("",!0),t("td",it,b(n.stream),1),e[33]||(e[33]=t("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[t("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[34]||(e[34]=t("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(u(!0),d(y,null,S(n.slots.slice(0,3),(p,m)=>(u(),d("td",{key:`am-${m}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center",draggable:A(s,m),onDragstart:_=>A(s,m)&&G(s,l,m),onDragover:e[5]||(e[5]=J(()=>{},["prevent"])),onDrop:_=>A(s,m)&&H(s,l,m)},[t("div",null,b(p.subject),1),t("div",ut,b(p.teacher),1)],40,dt))),128)),e[35]||(e[35]=t("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(u(!0),d(y,null,S(n.slots.slice(3,6),(p,m)=>(u(),d("td",{key:`mid-${m}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center",draggable:A(s,3+m),onDragstart:_=>A(s,3+m)&&G(s,l,3+m),onDragover:e[6]||(e[6]=J(()=>{},["prevent"])),onDrop:_=>A(s,3+m)&&H(s,l,3+m)},[s==="FRIDAY"&&m===2?(u(),d("div",ct,"MEWAKA")):(u(),d(y,{key:1},[t("div",null,b(p.subject),1),t("div",bt,b(p.teacher),1)],64))],40,mt))),128)),e[36]||(e[36]=t("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(u(!0),d(y,null,S(n.slots.slice(6,8),(p,m)=>(u(),d("td",{key:`pm-${m}`,class:U(["border border-slate-300 px-1 py-1 text-center",s==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":s==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":s==="FRIDAY"?"bg-lime-300 text-[9px] font-semibold text-lime-900":"bg-indigo-50"]),draggable:A(s,6+m),onDragstart:_=>A(s,6+m)&&G(s,l,6+m),onDragover:e[7]||(e[7]=J(()=>{},["prevent"])),onDrop:_=>A(s,6+m)&&H(s,l,6+m)},[s==="WEDNESDAY"?(u(),d("div",gt,"RELIGION")):s==="THURSDAY"?(u(),d("div",xt,"DEBATE OR CLUBS")):s==="FRIDAY"?(u(),d("div",ft,"SPORTS AND GAMES")):(u(),d(y,{key:3},[t("div",null,b(p.subject),1),t("div",yt,b(p.teacher),1)],64))],42,pt))),128)),e[37]||(e[37]=t("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128))],64))),128)),e[38]||(e[38]=t("tr",null,[t("td",{colspan:16,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])])]),j.value?(u(),d("div",vt,[t("div",ht,[t("div",_t,[e[41]||(e[41]=t("div",null,[t("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),t("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),t("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[8]||(e[8]=s=>j.value=!1)}," Close ")]),t("div",wt,[t("div",null,[e[42]||(e[42]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),t("div",St,[t("button",{type:"button",class:U(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",g(c).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[9]||(e[9]=s=>g(c).type="class")}," Class Timetable ",2),t("button",{type:"button",class:U(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",g(c).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[10]||(e[10]=s=>g(c).type="invigilation")}," Invigilation ",2),t("button",{type:"button",class:U(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",g(c).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[11]||(e[11]=s=>g(c).type="exams")}," Exams Timetable ",2)])]),t("div",null,[e[43]||(e[43]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),C(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>g(c).title=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[$,g(c).title]])]),t("div",kt,[t("div",null,[e[44]||(e[44]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),C(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>g(c).class_name=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[$,g(c).class_name]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),C(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>g(c).term=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[$,g(c).term]])])]),t("div",At,[t("div",null,[e[46]||(e[46]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),C(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>g(c).academic_year=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[$,g(c).academic_year]])]),t("div",Ct,[t("div",null,[e[47]||(e[47]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),C(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>g(c).start_time=s),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[$,g(c).start_time]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),C(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>g(c).end_time=s),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[$,g(c).end_time]])])])]),e[49]||(e[49]=t("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),t("div",It,[t("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[18]||(e[18]=s=>j.value=!1)}," Cancel "),t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:Ce}," Generate & Save Timetable ")])])])])):I("",!0),D.value?(u(),d("div",Nt,[t("div",Tt,[t("div",Dt,[e[50]||(e[50]=t("div",null,[t("h3",{class:"text-sm font-semibold text-gray-800"}," Limitations & More "),t("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Weka vipindi kwa wiki kwa kila mwalimu na somo kwa darasa/stream. ")],-1)),t("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[19]||(e[19]=s=>D.value=!1)}," Close ")]),t("div",Lt,[t("div",null,[e[52]||(e[52]=t("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Stream",-1)),C(t("select",{"onUpdate:modelValue":e[20]||(e[20]=s=>x.value=s),class:"w-64 rounded-md border border-gray-300 bg-white px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[51]||(e[51]=t("option",{value:"",disabled:""},"Select class",-1)),(u(!0),d(y,null,S(q.value,s=>(u(),d("option",{key:s.id,value:s.id},b(s.display),9,jt))),128))],512),[[z,x.value]])]),K.value?(u(),d("div",Et,"Loading...")):I("",!0)]),t("div",Rt,[t("table",$t,[e[53]||(e[53]=t("thead",null,[t("tr",{class:"bg-gray-50 text-left"},[t("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),t("th",{class:"border-b border-gray-200 px-3 py-2"},"Subject"),t("th",{class:"border-b border-gray-200 px-3 py-2"},"Periods / Week")])],-1)),t("tbody",null,[W.value.length?I("",!0):(u(),d("tr",Mt,[t("td",Ft,[x.value&&!Ne.value?(u(),d("span",Vt," No subjects assigned to this class. ")):(u(),d("span",Ot," No teacher-subject mappings found. "))])])),(u(!0),d(y,null,S(W.value,s=>(u(),d("tr",{key:`${s.teacher_id}-${s.subject_id}`,class:"hover:bg-gray-50"},[t("td",Yt,[t("div",Ut,b(s.teacher_name),1),t("div",Pt,b(s.teacher_initials),1)]),t("td",Bt,[t("div",Kt,b(s.subject_code),1),t("div",Wt,b(s.subject_name),1)]),t("td",qt,[t("input",{type:"number",min:"0",max:"50",class:"w-24 rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",disabled:!x.value,value:E.value[O(s.teacher_id,s.subject_id)]??0,onInput:o=>{E.value[O(s.teacher_id,s.subject_id)]=o.target.value}},null,40,Gt)])]))),128))])])]),t("div",Ht,[t("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",disabled:F.value,onClick:e[21]||(e[21]=s=>D.value=!1)}," Cancel ",8,Xt),t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:F.value||!x.value,onClick:De},b(F.value?"Saving...":"Save Limitations"),9,zt)])])])):I("",!0)])]),_:1})],64))}};export{es as default};

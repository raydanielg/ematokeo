import{i as N,j as k,y as Re,I as be,c,a as me,u as y,h as Ye,w as pe,d as S,b as s,o as u,x as O,f as T,t as p,F as v,r as V,s as P,k as E,v as U,p as ge}from"./app-CwhuH3Zz.js";import{_ as He}from"./AuthenticatedLayout-LrkSe8Qb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const We={class:"flex items-center justify-between"},Ge={key:0,class:"mb-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[10px] text-amber-900"},Xe={class:"mt-1 max-h-24 overflow-y-auto"},Je={class:"flex items-center gap-2"},qe={class:"max-h-full w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl ring-1 ring-gray-200"},Ze={class:"mb-3 flex items-center justify-between"},Qe={class:"mb-3 flex flex-wrap items-center justify-between gap-2"},et={class:"text-[11px] text-gray-600"},tt={class:"font-semibold"},st={class:"font-semibold"},rt={class:"overflow-hidden rounded-lg border border-gray-200"},ot={class:"min-w-full border-collapse text-[11px]"},at={key:0},lt={class:"border-b border-gray-100 px-3 py-2 font-semibold text-gray-800"},nt={class:"border-b border-gray-100 px-3 py-2"},it={class:"border-b border-gray-100 px-3 py-2"},dt={key:1,class:"fixed inset-0 z-50 pointer-events-none"},ct={class:"absolute inset-y-0 right-0 flex w-[340px] max-w-[90vw] pointer-events-auto"},ut={class:"flex h-full w-full flex-col overflow-hidden rounded-l-2xl bg-white shadow-2xl ring-1 ring-gray-200"},bt={class:"flex items-center justify-between border-b border-gray-100 px-4 py-3"},mt={class:"p-4"},pt={class:"mb-3 text-[11px] text-gray-500"},gt={class:"font-semibold"},xt={key:0},yt={class:"font-semibold"},ht={class:"flex-1 overflow-y-auto rounded-lg border border-gray-200 bg-gray-50 p-2"},ft={key:0,class:"px-2 py-6 text-center text-xs text-gray-500"},_t={key:1,class:"flex flex-wrap gap-2"},vt=["onDragstart"],kt={class:"space-y-4"},St={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},wt={class:"mt-2 mb-3 flex flex-wrap items-center justify-between gap-3 text-[9px] text-gray-600"},Nt={class:"flex flex-wrap items-center gap-2"},jt=["value"],Bt={key:0,value:"",disabled:""},Ct=["value"],It={class:"flex flex-wrap items-center gap-2"},Vt=["disabled"],At=["disabled"],Lt={key:1,class:"mb-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[10px] text-amber-900"},Dt={class:"mt-1 max-h-24 overflow-y-auto"},Tt={class:"border-b border-gray-300 bg-white px-4 py-3 text-center"},Et={class:"text-[11px] font-semibold uppercase tracking-wide text-gray-800"},Mt={class:"text-[9px] text-gray-600"},$t={class:"text-[9px] text-gray-700"},Ut={class:"font-semibold"},Ft={key:0},Pt={class:"font-semibold"},zt={class:"grid grid-cols-3 gap-2 border-b border-gray-200 bg-emerald-50/60 px-4 py-1.5 text-[9px] text-gray-700"},Ot={class:"ml-1"},Kt={class:"ml-1"},Rt={class:"text-right"},Yt={class:"ml-1"},Ht={class:"overflow-x-auto bg-slate-50 px-2 pb-3 pt-2"},Wt={class:"min-w-full border-collapse text-[10px] leading-tight"},Gt=["rowspan"],Xt=["rowspan"],Jt={class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center"},qt=["draggable","onDragstart","onDrop"],Zt={key:0,class:"ml-1 rounded bg-emerald-200 px-1 text-[8px] font-bold text-emerald-900"},Qt={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},es={key:1},ts=["draggable","onDragstart","onDrop"],ss={key:0,class:"font-semibold text-orange-700"},rs={key:0,class:"ml-1 rounded bg-indigo-200 px-1 text-[8px] font-bold text-indigo-900"},os={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},as={key:1},ls=["draggable","onDragstart","onDrop"],ns={key:0},is={key:1},ds={key:2},cs={key:0,class:"ml-1 rounded bg-slate-200 px-1 text-[8px] font-bold text-slate-900"},us={class:"break-words text-[9px] font-semibold leading-tight text-gray-700"},bs={key:1,class:"font-semibold text-gray-400"},ms={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 sm:px-0"},ps={class:"max-h-full w-full max-w-2xl overflow-y-auto rounded-xl bg-white p-5 text-xs text-gray-700 shadow-lg ring-1 ring-gray-200"},gs={class:"mb-3 flex items-center justify-between"},xs={class:"space-y-3"},ys={class:"grid grid-cols-3 gap-2"},hs={class:"grid grid-cols-2 gap-3"},fs={class:"grid grid-cols-2 gap-3"},_s={class:"grid grid-cols-2 gap-2"},vs={class:"mt-3 flex items-center justify-end gap-2"},ks=["disabled"];const Is={__name:"CreateTimetable",props:{school:{type:Object,default:()=>({})},timetable:{type:Object,default:()=>null},subjects:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},teacherAssignments:{type:Object,default:()=>({})}},setup(xe){var ae,le,ne,ie,de;const _=xe,K=N(""),$=N({}),R=N(!1),ye=N(!1),M=N({type:"",message:""}),Ss=k(()=>{var e;const r=K.value?Number(K.value):null;return!Number.isFinite(r)||!r?{}:((e=$.value)==null?void 0:e[String(r)])||{}}),ws=(r,e)=>{const t=K.value?Number(K.value):null;!Number.isFinite(t)||!t||($.value[String(t)]||($.value[String(t)]={}),e==="morning"||e==="afternoon"?$.value[String(t)][String(r)]=e:delete $.value[String(t)][String(r)],Te())},g=Re({type:"class",title:((ae=_.timetable)==null?void 0:ae.title)||"",class_name:((le=_.timetable)==null?void 0:le.class_name)||"",academic_year:((ne=_.timetable)==null?void 0:ne.academic_year)||String(new Date().getFullYear()),term:((ie=_.timetable)==null?void 0:ie.term)||"",start_time:"07:30",end_time:"16:00",schedule_json:((de=_.timetable)==null?void 0:de.schedule_json)||null}),he=k(()=>_.school.name||"Your School Name"),fe=k(()=>_.school.address||"P.O. Box 123, City"),_e=k(()=>_.school.region||"Region"),ve=k(()=>g.type==="invigilation"?"Invigilation Timetable":g.type==="exams"?"Exams Timetable":"School General Timetable");k(()=>(_.subjects||[]).map(r=>r.subject_code));const ke=k(()=>{const r={};return(_.classes||[]).forEach(e=>{e!=null&&e.id&&(r[String(e.id)]=e)}),r}),Se=k(()=>{const r={};return(_.subjects||[]).forEach(e=>{!(e!=null&&e.subject_code)||!(e!=null&&e.id)||(r[String(e.subject_code)]=Number(e.id))}),r});k(()=>{const r={};return(_.subjects||[]).forEach(e=>{(Array.isArray(e==null?void 0:e.teachers)?e.teachers:[]).forEach(l=>{if(!(l!=null&&l.id))return;const n=String((l==null?void 0:l.initials)||"").trim();n&&(r[n]||(r[n]=Number(l.id)))})}),r});const we=(r,e)=>{var b,m,h,B,w,C;const t=r?String(r):"",l=String(e||"").trim(),n=(b=ke.value)==null?void 0:b[t],d=n!=null&&n.parent_class_id?String(n.parent_class_id):"",a=(m=_.teacherAssignments)==null?void 0:m[t],o=a!==void 0?a:d?(h=_.teacherAssignments)==null?void 0:h[d]:null;if(o&&typeof o=="object"){const I=o==null?void 0:o[l];return I?String(I):""}const i=(w=(B=_.teacherAssignments)==null?void 0:B[t])==null?void 0:w[l];return i?String(i):((C=Ne.value)==null?void 0:C[l])||""},W=(r,e,t,l)=>{const n=we(r,e),d=String(e||"").trim().toUpperCase(),o=String(n||"").split("/").map(h=>h.trim()).filter(Boolean).filter(h=>String(h).trim().toUpperCase()!==d);if(!o.length)return"";if(o.length===1)return o[0];if(o.length===2)return`${o[0]}/${o[1]}`;const i=String(t||"").toUpperCase(),b=G.indexOf(i),m=Math.max(0,b)*31+Number(l||0);return o[m%o.length]},Ne=k(()=>{const r={};return(_.subjects||[]).forEach(e=>{const t=Array.isArray(e.teachers)?e.teachers:[];if(!(e!=null&&e.subject_code)||!t.length)return;const l=t.map(d=>String((d==null?void 0:d.initials)||"").trim()||simpleTeacherName(d==null?void 0:d.name)||String((d==null?void 0:d.name)||"").trim()).filter(Boolean);if(!l.length)return;const n=Array.from(new Set(l));r[e.subject_code]=n.join("/")}),r}),G=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],X=r=>{const e={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII"};if(r==null)return"";const t=String(r).trim();if(t==="")return"";const l=Number(t);if(!Number.isNaN(l)&&e[l])return e[l];const n=t.toUpperCase(),d={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7};if(d[n]&&e[d[n]])return e[d[n]];const a=n.match(/\b(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN)\b/);if(a){const i=d[a[1]];if(i&&e[i])return e[i]}if(/^[IVXLCDM]+$/.test(n))return n;const o=n.match(/\b(?:FORM|CLASS|STD|STANDARD)\s*(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN|[IVXLCDM]+|\d+)\b/);if(o){const i=o[1],b=d[i];if(b&&e[b])return e[b];const m=Number(i);if(!Number.isNaN(m)&&e[m])return e[m];if(/^[IVXLCDM]+$/.test(i))return i}return""},je=r=>{if(!r)return null;const e=String(r).toUpperCase().trim();if(!e)return null;const t={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};let l=0,n=0;for(let d=e.length-1;d>=0;d-=1){const a=t[e[d]];if(!a)return null;a<n?l-=a:(l+=a,n=a)}return l},se=r=>{const e=J(r);if(!e)return Number.POSITIVE_INFINITY;const t=je(e);return t===null?Number.POSITIVE_INFINITY:t},J=r=>X(r==null?void 0:r.parent_name)||X(r==null?void 0:r.level)||X(r==null?void 0:r.name),q=r=>{const e=((r==null?void 0:r.parent_name)||"").trim();if(e)return e;const t=((r==null?void 0:r.name)||"").trim();if(t&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(t))return t;const l=((r==null?void 0:r.level)||"").trim();if(l&&/\b(?:FORM|CLASS|STD|STANDARD)\b/i.test(l))return l;const n=J(r);return n?`Form ${n}`:l||t},Y=k(()=>{const r=Array.isArray(_.classes)?_.classes:[],e=new Map;r.forEach(a=>{!a||!a.parent_class_id||!(a.stream&&String(a.stream).trim())||(e.has(a.parent_class_id)||e.set(a.parent_class_id,[]),e.get(a.parent_class_id).push(a))});const t=[];r.filter(a=>!(a!=null&&a.parent_class_id)).forEach(a=>{const o=e.get(a.id)||[];if(o.length){o.slice().sort((i,b)=>String(i.stream||"").localeCompare(String(b.stream||""))).forEach(i=>t.push(i));return}t.push(a)});const l=new Set(r.filter(a=>!(a!=null&&a.parent_class_id)).map(a=>a.id));r.filter(a=>(a==null?void 0:a.parent_class_id)&&!l.has(a.parent_class_id)).forEach(a=>t.push(a));const n=new Set;return t.filter(a=>{const o=a==null?void 0:a.id;return o==null||n.has(o)?!1:(n.add(o),!0)}).sort((a,o)=>{const i=a!=null&&a.parent_class_id&&r.find(x=>Number(x==null?void 0:x.id)===Number(a.parent_class_id))||a,b=o!=null&&o.parent_class_id&&r.find(x=>Number(x==null?void 0:x.id)===Number(o.parent_class_id))||o,m=se(i),h=se(b);if(m!==h)return Number(m||0)-Number(h||0);const B=a!=null&&a.parent_class_id?Number(a.parent_class_id):Number((a==null?void 0:a.id)||0),w=o!=null&&o.parent_class_id?Number(o.parent_class_id):Number((o==null?void 0:o.id)||0);if(B!==w)return B-w;const C=(a!=null&&a.stream?String(a.stream):"").toUpperCase(),I=(o!=null&&o.stream?String(o.stream):"").toUpperCase(),f=C.localeCompare(I);return f!==0?f:Number((a==null?void 0:a.id)||0)-Number((o==null?void 0:o.id)||0)})}),Be=k(()=>{const r=new Set,e=[];return(Y.value||[]).forEach(t=>{const l=q(t);if(!l)return;const n=String(l);r.has(n)||(r.add(n),e.push(l))}),e}),Z=k(()=>{const r=new Set;return Y.value.forEach(e=>{const t=e.stream?String(e.stream).toUpperCase().trim():"";if(t){if(j.value!=="ALL"){const l=q(e);if(l&&l!==j.value)return}r.add(t)}}),r.size===0?[]:Array.from(r.values())}),j=N("ALL"),A=N("ALL");be(j,()=>{A.value!=="ALL"&&(Z.value.includes(A.value)||(A.value="ALL"))});const Ce=k(()=>j.value!=="ALL"&&A.value!=="ALL"?`${j.value} ${A.value}`:j.value!=="ALL"?`${j.value}`:g.class_name||"____"),re=r=>{var a;const e=String(r||"").toUpperCase(),l=(Array.isArray((a=L.value)==null?void 0:a[e])?L.value[e]:[]).map((o,i)=>({row:o,originalIndex:i})).filter(({row:o})=>!(!o||j.value!=="ALL"&&String(o.class_label||o.form||"").trim()!==j.value||A.value!=="ALL"&&String(o.stream||"").toUpperCase().trim()!==String(A.value||"").toUpperCase().trim())),n=new Map;l.forEach(({row:o,originalIndex:i})=>{const b=String(o.class_label||o.form||"").trim()||"CLASS",m=b;n.has(m)||n.set(m,{key:m,label:b,rows:[]}),n.get(m).rows.push({row:o,originalIndex:i})});const d=Array.from(n.values());return d.forEach(o=>{o.rows.sort((i,b)=>{var m,h;return String(((m=i.row)==null?void 0:m.stream)||"").localeCompare(String(((h=b.row)==null?void 0:h.stream)||""))})}),d},Ie=r=>re(r).reduce((e,t)=>{var l;return e+(((l=t==null?void 0:t.rows)==null?void 0:l.length)||0)},0),L=N({}),Ve=()=>{const r={};G.forEach(e=>{r[e]=[],(Y.value||[]).forEach(t=>{r[e].push({form:J(t),class_label:q(t),stream:t!=null&&t.stream?String(t.stream).toUpperCase().trim():"",school_class_id:t!=null&&t.id?Number(t.id):null,slots:Array.from({length:9}).map(()=>null)})})}),L.value=r};be(()=>Y.value,r=>{if(!r||!r.length)return;const e=L.value;e&&typeof e=="object"&&Object.keys(e).length||Ve()},{immediate:!0});const F=N([]),Ae=N(0),Le=N(!1);N(!1),N({}),N({status:"idle",attempts:0,message:""});const De=k(()=>{var e;return`timetable_subject_session_rules_v1_${((e=_.school)==null?void 0:e.id)??"school"}`}),Te=()=>{try{window.localStorage.setItem(De.value,JSON.stringify($.value||{}))}catch{}},Ee=r=>r>=0&&r<=3?"morning":r>=7&&r<=8?"afternoon":"other",Me=(r,e)=>{var n;if(!r||!e)return"any";const t=((n=$.value)==null?void 0:n[String(r)])||{},l=t==null?void 0:t[String(e)];return l==="morning"||l==="afternoon"?l:"any"},Q=(r,e,t)=>{var i;const l=new Set(["ENG","B/MAT"]),n=String(e||"").trim().toUpperCase(),d=Ee(t);if(l.has(n))return t===4?!0:d==="morning";const a=((i=Se.value)==null?void 0:i[String(e)])||null,o=Me(r,a);return o==="any"?!0:d===o},$e=(r,e)=>e>=7&&e<=8?!["WEDNESDAY","THURSDAY","FRIDAY"].includes(r):!(r==="FRIDAY"&&e===6),D=(r,e)=>{const t=String(r||"").toUpperCase(),l=Number(e);return!Number.isFinite(l)||l<0||l>8?!1:$e(t,l)},Ue=k(()=>{var e;return`timetable_schedule_v3_${((e=_.school)==null?void 0:e.id)??"school"}`}),oe=()=>{try{window.localStorage.setItem(Ue.value,JSON.stringify(L.value||{}))}catch{}},Fe=(r,e,t,l)=>{var w,C;const n=String(r),d=Number(e),a=Number(t),o=String(l||"").trim();if(!D(n,a))return!1;const i=(C=(w=L.value)==null?void 0:w[n])==null?void 0:C[d];if(!i)return!1;const b=I=>String(I||"").trim().toUpperCase(),m=b(o);if(m&&m!=="PS"){const I=(Array.isArray(i==null?void 0:i.slots)?i.slots:[]).map((f,x)=>({idx:x,subject:b(f==null?void 0:f.subject)})).filter(({subject:f})=>f===m).map(({idx:f})=>f).filter(f=>f!==a);if(I.length>=2)return M.value={type:"error",message:"This subject already appears twice today (max is 2)."},!1;if(I.length===1){const f=I[0];if(!(Math.abs(f-a)===1))return M.value={type:"error",message:"This subject can only appear twice in a day as a double period (place it next to the first one)."},!1}}const h=Number((i==null?void 0:i.school_class_id)||(i==null?void 0:i.id)||(i==null?void 0:i.class_id)||0)||null;if(o&&!Q(h,o,a))return M.value={type:"error",message:"This subject is not allowed in this period."},!1;if(o&&ze(n,a,d,o))return M.value={type:"error",message:"Teacher clash detected for this period."},!1;M.value={type:"",message:""};const B=o?W(h,o,n,a):"";return i.slots[a]=o?{subject:o,teacher:B,teacher_initials:B,teacher_name:""}:null,oe(),!0},ee=(r,e,t)=>{draggedCell.value={day:r,rowIndex:e,slotIndex:t}},Pe=r=>{draggedSubjectCode.value=String(r||"").trim(),draggedCell.value=null},ze=(r,e,t,l)=>{var B,w,C,I;const n=String(r),d=Number(e),a=String(l||"").trim();if(!a)return!1;const o=(w=(B=L.value)==null?void 0:B[n])==null?void 0:w[Number(t)],i=Number((o==null?void 0:o.school_class_id)||(o==null?void 0:o.id)||(o==null?void 0:o.class_id)||(o==null?void 0:o.classId)||(o==null?void 0:o.schoolClassId)||0)||null,b=W(i,a,n,d),m=String(b||"").split("/").map(f=>f.trim()).filter(Boolean);if(!m.length)return!1;const h=((C=L.value)==null?void 0:C[n])||[];for(let f=0;f<h.length;f+=1){if(f===Number(t))continue;const x=h[f],H=(I=x==null?void 0:x.slots)==null?void 0:I[d],ce=H!=null&&H.subject?String(H.subject):"";if(!ce)continue;const Oe=Number((x==null?void 0:x.school_class_id)||(x==null?void 0:x.id)||(x==null?void 0:x.class_id)||(x==null?void 0:x.classId)||(x==null?void 0:x.schoolClassId)||0)||null,Ke=W(Oe,ce,n,d),ue=String(Ke||"").split("/").map(z=>z.trim()).filter(Boolean);if(ue.length){for(let z=0;z<m.length;z+=1)if(ue.includes(m[z]))return!0}}return!1},te=(r,e,t)=>{var w,C;if(draggedSubjectCode.value){Fe(r,e,t,draggedSubjectCode.value),draggedSubjectCode.value="",draggedCell.value=null;return}if(!draggedCell.value)return;const l=draggedCell.value;if(l.day===r&&l.rowIndex===e&&l.slotIndex===t){draggedCell.value=null;return}const n=(w=L.value[l.day])==null?void 0:w[l.rowIndex],d=(C=L.value[r])==null?void 0:C[e];if(!n||!d){draggedCell.value=null;return}const a=n.slots[l.slotIndex],o=d.slots[t],i=a,b=Number((n==null?void 0:n.school_class_id)||(n==null?void 0:n.id)||(n==null?void 0:n.class_id)||(n==null?void 0:n.classId)||(n==null?void 0:n.schoolClassId)||0)||null,m=Number((d==null?void 0:d.school_class_id)||(d==null?void 0:d.id)||(d==null?void 0:d.class_id)||(d==null?void 0:d.classId)||(d==null?void 0:d.schoolClassId)||0)||null,h=!(o!=null&&o.subject)||Q(b,o.subject,l.slotIndex),B=!(i!=null&&i.subject)||Q(m,i.subject,t);if(!h||!B){draggedCell.value=null;return}n.slots[l.slotIndex]=o,d.slots[t]=i,oe(),draggedCell.value=null};return(r,e)=>(u(),c(v,null,[me(y(Ye),{title:"Create School Timetable"}),me(He,null,{header:pe(()=>[s("div",We,[e[38]||(e[38]=s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Create School Timetable "),s("p",{class:"mt-1 text-sm text-gray-500"}," Preview below shows the school general timetable. Use the popup to enter timetable details when you are ready to save. ")],-1)),F.value.length?(u(),c("div",Ge,[e[37]||(e[37]=s("div",{class:"font-semibold"},"Limitations check:",-1)),s("div",Xe,[(u(!0),c(v,null,V(F.value,(t,l)=>(u(),c("div",{key:l},p(t),1))),128))])])):S("",!0),s("div",Je,[s("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:e[0]||(e[0]=t=>r.showDetailsModal=!0)}," Create / Edit Timetable Details ")])])]),default:pe(()=>[R.value?(u(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 sm:px-0",onClick:e[3]||(e[3]=O(t=>R.value=!1,["self"]))},[s("div",qe,[s("div",Ze,[e[39]||(e[39]=s("div",null,[s("h3",{class:"text-sm font-semibold text-gray-800"}," Teacher Initials Details "),s("p",{class:"mt-0.5 text-[11px] text-gray-500"},' Orodha ya walimu wote na initials zao. Zilizotumika kwenye ratiba zitaonyesha "Used". ')],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[1]||(e[1]=t=>R.value=!1)}," Close ")]),s("div",Qe,[s("div",et,[e[40]||(e[40]=T(" Used initials: ",-1)),s("span",tt,p(r.usedTeacherInitials.size),1),e[41]||(e[41]=T(" / Total teachers: ",-1)),s("span",st,p(r.teacherInitialsList.length),1)]),s("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-emerald-500 focus:ring-offset-1",onClick:e[2]||(e[2]=(...t)=>r.downloadTeacherInitials&&r.downloadTeacherInitials(...t))}," Download (CSV) ")]),s("div",rt,[s("table",ot,[e[43]||(e[43]=s("thead",null,[s("tr",{class:"bg-gray-50 text-left"},[s("th",{class:"border-b border-gray-200 px-3 py-2"},"Initials"),s("th",{class:"border-b border-gray-200 px-3 py-2"},"Teacher"),s("th",{class:"border-b border-gray-200 px-3 py-2"},"Used")])],-1)),s("tbody",null,[r.teacherInitialsList.length?S("",!0):(u(),c("tr",at,[...e[42]||(e[42]=[s("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-500"}," No teachers found. ",-1)])])),(u(!0),c(v,null,V(r.teacherInitialsList,t=>(u(),c("tr",{key:t.id,class:"hover:bg-gray-50"},[s("td",lt,p(t.initials),1),s("td",nt,p(t.simple_name||t.name),1),s("td",it,[s("span",{class:P(["inline-flex rounded-full px-2 py-0.5 text-[10px] font-semibold",t.used?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-700"])},p(t.used?"Used":"Not used"),3)])]))),128))])])])])])):S("",!0),ye.value?(u(),c("div",dt,[s("div",ct,[s("div",ut,[s("div",bt,[e[44]||(e[44]=s("div",null,[s("div",{class:"text-sm font-semibold text-gray-800"},"Subjects"),s("div",{class:"text-[11px] text-gray-500"},"Drag and drop into the timetable.")],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[4]||(e[4]=(...t)=>r.closeSubjectsPopup&&r.closeSubjectsPopup(...t))}," Close ")]),s("div",mt,[E(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.subjectPaletteSearch=t),type:"text",placeholder:"Search subject...",class:"mb-2 w-full rounded-md border border-gray-300 px-3 py-2 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[U,r.subjectPaletteSearch]]),s("div",pt,[e[46]||(e[46]=T(" Filter: ",-1)),s("span",gt,p(j.value),1),A.value!=="ALL"?(u(),c("span",xt,[e[45]||(e[45]=T(" · Stream ",-1)),s("span",yt,p(A.value),1)])):S("",!0)]),s("div",ht,[r.filteredSubjectPaletteCodes.length?(u(),c("div",_t,[(u(!0),c(v,null,V(r.filteredSubjectPaletteCodes,t=>(u(),c("div",{key:t,draggable:"true",class:"cursor-grab select-none rounded-md bg-white px-3 py-2 text-xs font-semibold text-gray-800 shadow-sm ring-1 ring-gray-200 hover:bg-gray-50 active:cursor-grabbing",onDragstart:l=>Pe(t)},p(t),41,vt))),128))])):(u(),c("div",ft," No subjects found for this class/stream. "))])])])])])):S("",!0),s("div",kt,[s("div",St,[e[65]||(e[65]=s("h3",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"}," Timetable Preview ",-1)),s("div",wt,[s("div",Nt,[e[49]||(e[49]=s("span",{class:"font-semibold"},"View class:",-1)),E(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>j.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[47]||(e[47]=s("option",{value:"ALL"},"All Classes",-1)),(u(!0),c(v,null,V(Be.value,t=>(u(),c("option",{key:t,value:t},p(t),9,jt))),128))],512),[[ge,j.value]]),E(s("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>A.value=t),class:"rounded border border-gray-300 bg-white px-1 py-0.5 text-[9px] focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[e[48]||(e[48]=s("option",{value:"ALL"},"All Streams",-1)),Z.value.length?S("",!0):(u(),c("option",Bt,"No streams")),(u(!0),c(v,null,V(Z.value,t=>(u(),c("option",{key:t,value:t},"Stream "+p(t),9,Ct))),128))],512),[[ge,A.value]])]),s("div",It,[s("button",{type:"button",class:"rounded-md bg-amber-50 px-2 py-1 text-[10px] font-medium text-amber-800 ring-1 ring-amber-100 hover:bg-amber-100",disabled:!F.value.length,onClick:e[8]||(e[8]=t=>Le.value=!0)}," Resolve ("+p(F.value.length)+") ",9,Vt),s("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:e[9]||(e[9]=(...t)=>r.regenerateSampleTimetable&&r.regenerateSampleTimetable(...t))}," Regenerate Sample Timetable "),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[10]||(e[10]=(...t)=>r.openSubjectsPopup&&r.openSubjectsPopup(...t))}," Subjects "),s("button",{type:"button",class:"rounded-md bg-emerald-600 px-2 py-1 text-[10px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:y(g).processing,onClick:e[11]||(e[11]=(...t)=>r.saveTimetable&&r.saveTimetable(...t))},p(y(g).processing?"Saving...":"Save"),9,At),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[12]||(e[12]=t=>R.value=!0)}," Teacher Initials Details "),s("button",{type:"button",class:"rounded-md bg-white px-2 py-1 text-[10px] font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:e[13]||(e[13]=(...t)=>r.printTimetable&&r.printTimetable(...t))}," Print ")])]),M.value.message?(u(),c("div",{key:0,class:P(["mb-3 rounded-md border px-3 py-2 text-[11px]",M.value.type==="error"?"border-red-200 bg-red-50 text-red-900":"border-emerald-200 bg-emerald-50 text-emerald-900"])},p(M.value.message),3)):S("",!0),F.value.length?(u(),c("div",Lt,[e[50]||(e[50]=s("div",{class:"font-semibold"},"Limitations check:",-1)),s("div",Dt,[(u(!0),c(v,null,V(F.value,(t,l)=>(u(),c("div",{key:l},p(t),1))),128))])])):S("",!0),(u(),c("div",{id:"class-timetable-preview",key:Ae.value,class:"overflow-hidden rounded-lg border border-gray-300 bg-white text-[11px] text-gray-800",onContextmenu:e[17]||(e[17]=O(()=>{},["prevent"]))},[s("div",Tt,[e[53]||(e[53]=s("div",{class:"mb-1 flex justify-center"},[s("img",{src:"/images/emblem.png",alt:"Emblem",class:"h-8 w-8 object-contain",onerror:"this.style.display='none'"})],-1)),s("div",Et,p(he.value),1),s("div",Mt,p(fe.value)+" · "+p(_e.value),1),e[54]||(e[54]=s("div",{class:"mt-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-800"}," SCHOOL GENERAL TIME TABLE ",-1)),s("div",$t,[e[52]||(e[52]=T(" Mwaka: ",-1)),s("span",Ut,p(y(g).academic_year||"____"),1),j.value!=="ALL"?(u(),c("span",Ft,[e[51]||(e[51]=T(" · Darasa: ",-1)),s("span",Pt,p(Ce.value),1)])):S("",!0)])]),s("div",zt,[s("div",null,[e[55]||(e[55]=s("span",{class:"font-semibold"},"Kichwa:",-1)),s("span",Ot,p(y(g).title||"Ratiba ya Darasa"),1)]),s("div",null,[e[56]||(e[56]=s("span",{class:"font-semibold"},"Muda wa vipindi:",-1)),s("span",Kt,p(y(g).start_time)+" - "+p(y(g).end_time),1)]),s("div",Rt,[e[57]||(e[57]=s("span",{class:"font-semibold"},"Aina ya ratiba:",-1)),s("span",Yt,p(ve.value),1)])]),s("div",Ht,[s("table",Wt,[e[64]||(e[64]=s("thead",null,[s("tr",null,[s("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," DAY "),s("th",{class:"w-10 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," CLASS "),s("th",{class:"w-12 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," STREAM "),s("th",{class:"w-20 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:00 - 07:30 AM "),s("th",{class:"w-14 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 07:30 - 07:50 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:00 - 08:40 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 08:40 - 09:20 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 09:20 - 10:00 AM "),s("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:00 - 10:40 AM "),s("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 10:40 - 11:05 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:05 - 11:45 AM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 11:45 - 12:25 PM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 12:25 - 01:05 PM "),s("th",{class:"w-18 border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:05 - 01:20 PM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 01:20 - 02:00 PM "),s("th",{class:"border border-slate-300 bg-slate-100 px-1 py-1 text-center align-middle"}," 02:00 - 02:40 PM "),s("th",{class:"w-20 border border-slate-300 bg-emerald-100 px-1 py-1 text-center align-middle"}," 03:30 - 05:30 PM ")])],-1)),s("tbody",null,[(u(),c(v,null,V(G,t=>(u(),c(v,{key:t},[(u(!0),c(v,null,V(re(t),(l,n)=>(u(),c(v,{key:`${t}-${l.key}`},[(u(!0),c(v,null,V(l.rows,({row:d,originalIndex:a},o)=>(u(),c("tr",{key:`${t}-${l.key}-${d.stream}-${a}`},[n===0&&o===0?(u(),c("td",{key:0,class:"border border-slate-300 bg-sky-100 px-1 py-4 text-center text-[10px] font-semibold uppercase text-sky-900",rowspan:Ie(t)||1},p(t),9,Gt)):S("",!0),o===0?(u(),c("td",{key:1,class:"border border-slate-300 bg-slate-50 px-1 py-1 text-center font-semibold",rowspan:l.rows.length},p(l.label||d.class_label||d.form),9,Xt)):S("",!0),s("td",Jt,p(d.stream),1),e[58]||(e[58]=s("td",{class:"border border-slate-300 bg-sky-50 px-1 py-1 text-center"},[s("div",{class:"font-semibold"},"ARRIVAL & CLEANING")],-1)),e[59]||(e[59]=s("td",{class:"border border-slate-300 bg-fuchsia-100 px-1 py-1 text-center font-semibold text-fuchsia-900"}," PREP ",-1)),(u(!0),c(v,null,V(d.slots.slice(0,4),(i,b)=>{var m;return u(),c("td",{key:`am-${b}`,class:"border border-slate-300 bg-emerald-50 px-1 py-1 text-center",draggable:D(t,b),onDragstart:h=>D(t,b)&&ee(t,a,b),onDragover:e[14]||(e[14]=O(()=>{},["prevent"])),onDrop:h=>D(t,b)&&te(t,a,b)},[i&&i.subject?(u(),c(v,{key:0},[s("div",null,[T(p(i.subject)+" ",1),(m=d.slots[b+1])!=null&&m.subject&&d.slots[b+1].subject===i.subject?(u(),c("span",Zt," D ")):S("",!0)]),s("div",Qt,p(i.teacher),1)],64)):(u(),c("div",es," "))],40,qt)}),128)),e[60]||(e[60]=s("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(u(!0),c(v,null,V(d.slots.slice(4,7),(i,b)=>{var m;return u(),c("td",{key:`mid-${b}`,class:"border border-slate-300 bg-indigo-50 px-1 py-1 text-center",draggable:D(t,4+b),onDragstart:h=>D(t,4+b)&&ee(t,a,4+b),onDragover:e[15]||(e[15]=O(()=>{},["prevent"])),onDrop:h=>D(t,4+b)&&te(t,a,4+b)},[t==="FRIDAY"&&b===2?(u(),c("div",ss,"MEWAKA")):(u(),c(v,{key:1},[i&&i.subject?(u(),c(v,{key:0},[s("div",null,[T(p(i.subject)+" ",1),(m=d.slots[4+b+1])!=null&&m.subject&&d.slots[4+b+1].subject===i.subject?(u(),c("span",rs," D ")):S("",!0)]),s("div",os,p(i.teacher),1)],64)):(u(),c("div",as," "))],64))],40,ts)}),128)),e[61]||(e[61]=s("td",{class:"border border-slate-300 bg-sky-200 px-1 py-1 text-center font-semibold text-sky-900"}," BREAK ",-1)),(u(!0),c(v,null,V(d.slots.slice(7,9),(i,b)=>{var m;return u(),c("td",{key:`pm-${b}`,class:P(["border border-slate-300 px-1 py-1 text-center",t==="WEDNESDAY"?"bg-amber-100 text-[9px] font-semibold text-amber-900":t==="THURSDAY"?"bg-amber-200 text-[9px] font-semibold text-amber-900":t==="FRIDAY"?"bg-lime-300 text-[9px] font-semibold text-lime-900":"bg-indigo-50"]),draggable:D(t,7+b),onDragstart:h=>D(t,7+b)&&ee(t,a,7+b),onDragover:e[16]||(e[16]=O(()=>{},["prevent"])),onDrop:h=>D(t,7+b)&&te(t,a,7+b)},[t==="WEDNESDAY"?(u(),c("div",ns,"RELIGION")):t==="THURSDAY"?(u(),c("div",is,"DEBATE OR CLUBS")):t==="FRIDAY"?(u(),c("div",ds,"SPORTS AND GAMES")):(u(),c(v,{key:3},[i&&i.subject?(u(),c(v,{key:0},[s("div",null,[T(p(i.subject)+" ",1),(m=d.slots[7+b+1])!=null&&m.subject&&d.slots[7+b+1].subject===i.subject?(u(),c("span",cs," D ")):S("",!0)]),s("div",us,p(i.teacher),1)],64)):(u(),c("div",bs," "))],64))],42,ls)}),128)),e[62]||(e[62]=s("td",{class:"border border-slate-300 bg-emerald-200 px-1 py-1 text-center font-semibold text-emerald-900"}," REMEDIAL ",-1))]))),128))],64))),128)),e[63]||(e[63]=s("tr",null,[s("td",{colspan:17,class:"h-1 bg-yellow-300"})],-1))],64))),64))])])])],32))]),r.showDetailsModal?(u(),c("div",ms,[s("div",ps,[s("div",gs,[e[66]||(e[66]=s("div",null,[s("h3",{class:"text-sm font-semibold text-gray-800"}," School Timetable Details "),s("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Set timetable type, class, year and time range. These details will appear in the preview header when you save. ")],-1)),s("button",{type:"button",class:"text-[11px] text-gray-500 hover:text-gray-700",onClick:e[18]||(e[18]=t=>r.showDetailsModal=!1)}," Close ")]),s("div",xs,[s("div",null,[e[67]||(e[67]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Timetable Type",-1)),s("div",ys,[s("button",{type:"button",class:P(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",y(g).type==="class"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[19]||(e[19]=t=>y(g).type="class")}," Class Timetable ",2),s("button",{type:"button",class:P(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",y(g).type==="invigilation"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[20]||(e[20]=t=>y(g).type="invigilation")}," Invigilation ",2),s("button",{type:"button",class:P(["rounded-md px-2 py-1.5 text-[11px] font-semibold ring-1",y(g).type==="exams"?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-gray-700 ring-gray-200 hover:bg-gray-50"]),onClick:e[21]||(e[21]=t=>y(g).type="exams")}," Exams Timetable ",2)])]),s("div",null,[e[68]||(e[68]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Title",-1)),E(s("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>y(g).title=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A - Term I Timetable"},null,512),[[U,y(g).title]])]),s("div",hs,[s("div",null,[e[69]||(e[69]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Group",-1)),E(s("input",{"onUpdate:modelValue":e[23]||(e[23]=t=>y(g).class_name=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Form I A"},null,512),[[U,y(g).class_name]])]),s("div",null,[e[70]||(e[70]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Term",-1)),E(s("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>y(g).term=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Term I"},null,512),[[U,y(g).term]])])]),s("div",fs,[s("div",null,[e[71]||(e[71]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Academic Year",-1)),E(s("input",{"onUpdate:modelValue":e[25]||(e[25]=t=>y(g).academic_year=t),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 2025"},null,512),[[U,y(g).academic_year]])]),s("div",_s,[s("div",null,[e[72]||(e[72]=s("label",{class:"mb-1 block text-[11px] font-medium"},"Start Time",-1)),E(s("input",{"onUpdate:modelValue":e[26]||(e[26]=t=>y(g).start_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[U,y(g).start_time]])]),s("div",null,[e[73]||(e[73]=s("label",{class:"mb-1 block text-[11px] font-medium"},"End Time",-1)),E(s("input",{"onUpdate:modelValue":e[27]||(e[27]=t=>y(g).end_time=t),type:"time",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[U,y(g).end_time]])])])]),e[74]||(e[74]=s("p",{class:"mt-2 text-[11px] text-gray-500"}," Hifadhi ratiba hii kwa matumizi ya baadaye kama timetable ya darasa au shule nzima. ",-1)),s("div",vs,[s("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-medium text-gray-700 hover:bg-gray-200",onClick:e[28]||(e[28]=t=>r.showDetailsModal=!1)}," Cancel "),s("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:y(g).processing,onClick:e[29]||(e[29]=(...t)=>r.saveTimetable&&r.saveTimetable(...t))},p(y(g).processing?"Saving...":"Generate & Save Timetable"),9,ks)])])])])):S("",!0),S("",!0)])]),_:1})],64))}};export{Is as default};

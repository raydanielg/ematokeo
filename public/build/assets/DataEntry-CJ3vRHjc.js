import{n as U,i as p,j as te,I as Oe,B as Pe,L as Be,c as d,a as se,u as ze,h as Re,w as re,d as b,b as t,o as u,F as k,r as _,t as x,f as w,s as W,x as ye,M as De,k as qe,v as Le,T as Fe,K as Ve,m as ae}from"./app-Ci9FRhk_.js";import{_ as Xe}from"./AuthenticatedLayout-Dd0mZX38.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const He={class:"flex flex-wrap items-center justify-between gap-3"},Ke={class:"flex flex-wrap items-center gap-3 text-xs"},Ge={key:0,class:"flex items-center gap-2"},Ue=["value","selected"],We={key:1,class:"flex flex-col text-right text-xs text-gray-600"},Ye={class:"text-gray-900"},Je=["disabled"],Qe={key:0},Ze={key:1},Ie={key:0,class:"mb-4 rounded-xl bg-white p-4 shadow-sm ring-1 ring-gray-100"},et={class:"overflow-x-auto"},tt={class:"min-w-full text-left text-[11px]"},st={key:0},rt={class:"px-3 py-1.5 align-top"},at={class:"font-medium text-gray-900"},nt={class:"px-3 py-1.5 align-top"},lt={class:"flex flex-col"},ot={key:0,class:"text-[10px] text-gray-500"},it={class:"px-3 py-1.5 align-top"},dt={class:"flex justify-end"},ut=["onClick"],ct={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 backdrop-blur-sm"},ft={class:"w-full max-w-sm rounded-xl bg-white p-5 text-xs text-gray-700 shadow-xl"},mt={class:"flex justify-end gap-2 text-[11px]"},xt={key:2,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 backdrop-blur-sm"},gt={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},yt={key:0,class:"py-10 text-center text-xs text-gray-500"},pt={key:1,class:"py-10 text-center text-xs text-gray-500"},bt={key:2,class:"space-y-4"},vt={class:"text-xs text-gray-600"},ht={class:"flex flex-wrap gap-2"},kt=["onClick"],wt={key:3,class:"space-y-4"},St={class:"text-xs text-gray-600"},Ct={class:"flex flex-wrap gap-2"},_t=["onClick"],Mt={key:4,class:"space-y-4"},Nt={class:"relative flex flex-wrap items-center justify-between gap-2 text-xs text-gray-600"},Et={class:"flex flex-wrap gap-2"},jt=["onClick"],$t={class:"flex items-center gap-2"},Tt=["disabled"],At=["disabled"],Ot={key:0,class:"pointer-events-auto absolute right-0 top-full z-20 mt-2 w-64 rounded-xl border border-red-200 bg-white p-3 text-[11px] text-gray-700 shadow-lg"},Pt={class:"mb-2 flex items-center justify-between gap-2"},Bt={class:"text-[11px] text-gray-700"},zt={class:"flex flex-wrap items-center gap-2 text-[11px] text-gray-600"},Rt={class:"font-semibold text-gray-800"},Dt={class:"font-semibold text-gray-800"},qt={class:"overflow-x-auto"},Lt={class:"min-w-full border-collapse text-[11px]"},Ft={class:"bg-gray-50 text-gray-600"},Vt={class:"border-t border-gray-100 px-2 py-1 align-top"},Xt={class:"border-t border-gray-100 px-2 py-1 align-top font-mono"},Ht={class:"border-t border-gray-100 px-2 py-1 align-top"},Kt=["value","disabled","data-student-id","data-subject-id","onInput","onKeydown","onBlur"],Gt={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Ut={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Wt={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Yt={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Jt={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Qt={key:3,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6"},Zt={class:"w-full max-w-xs rounded-xl bg-white p-5 text-xs text-gray-700 shadow-xl"},It={class:"mb-4"},es={class:"flex justify-end gap-2 text-[11px]"},ts=["disabled"],ss={key:0},rs={key:1},as={key:0,class:"fixed bottom-4 right-4 z-40 flex items-center gap-2 rounded-lg bg-white px-3 py-2 text-[11px] shadow-lg ring-1 ring-gray-200"},ns={key:0,class:"flex flex-col gap-1 text-gray-600"},ls={class:"flex items-center gap-2"},os={key:0},is={key:1},ds={key:0,class:"w-52"},us={class:"h-1.5 w-full overflow-hidden rounded-full bg-gray-100 ring-1 ring-gray-200"},cs={class:"mt-1 flex justify-between text-[10px] text-gray-500"},fs={key:0,class:"text-red-600"},ms={key:1,class:"flex items-center gap-2 text-emerald-700"},ps={__name:"DataEntry",props:{exams:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},students:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},existingMarks:{type:Array,default:()=>[]},gradingSchemes:{type:Array,default:()=>[]},streamSubjectsByStream:{type:Object,default:()=>({})},filters:{type:Object,default:()=>({exam:null,class:null})}},setup(f){const i=f,v=U({}),S=p(!1),M=p(!1),q=p(0),T=p(!1),A=p(0),O=p(0),L=p(""),ne=te(()=>{if(!T.value||A.value<=0)return 0;const r=Math.round(O.value/A.value*100);return r<0?0:r>100?100:r}),C=U({}),P=U({}),j=p(null),Y=p(!1);let $=null;const B=p(!1),F=p(""),N=p(!1),E=p(!1),z=p(""),J=p(!1),V=U({}),R=p(!1),pe=te(()=>{const r=i.filters.class;if(!r)return"";const e=(i.classes||[]).find(s=>String(s.id)===String(r));return e?e.name:String(r)}),le=()=>{var r;return((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},X=(r,e)=>`${r}-${e}`,be=te(()=>{const r=new Map;return(i.students||[]).forEach(e=>r.set(String(e.id),e)),r}),h=(r,e)=>{const s=be.value.get(String(r));if(!s)return!1;const n=s.stream?String(s.stream).trim():"";if(!n)return!1;const o=i.streamSubjectsByStream&&Object.prototype.hasOwnProperty.call(i.streamSubjectsByStream,n)?i.streamSubjectsByStream[n]:null;return!Array.isArray(o)||o.length===0?!1:!o.map(l=>String(l)).includes(String(e))},oe=(r,e,s=!0)=>{const n=X(r,e);if(s){C[n]=!0;return}Object.prototype.hasOwnProperty.call(C,n)&&delete C[n]},ie=(r,e,s)=>{const n=X(r,e);C[n]||(v[n]=s==null?"":String(s))},ve=async(r,e)=>{if(!i.filters.exam||!i.filters.class)return;const s=X(r,e),n=v[s],o=n===""||n===void 0?null:Number(n);if(H(n)){q.value+=1,S.value=!0;try{const l=await fetch(route("exams.marks.save-cell"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":le()},body:JSON.stringify({exam_id:i.filters.exam,class_id:i.filters.class,student_id:r,subject_id:e,marks:o===null?null:Number(o)})});if(!l.ok){z.value=`Save failed (${l.status}). Please try again.`,E.value=!0;return}const a=await l.json();ie(r,e,a.marks),oe(r,e,!1),a.updated_at&&(j.value=a.updated_at)}catch{z.value="Could not save mark. Please check your connection.",E.value=!0}finally{q.value=Math.max(0,q.value-1),q.value===0&&(S.value=!1,M.value=!0,setTimeout(()=>{M.value=!1},900))}}},Q=(r,e,s=700)=>{const n=X(r,e);P[n]&&clearTimeout(P[n]),P[n]=setTimeout(()=>{ve(r,e),delete P[n]},s)},de=async()=>{if(!Y.value&&!(!i.filters.exam||!i.filters.class)){Y.value=!0;try{const r=new URLSearchParams;r.set("exam",String(i.filters.exam)),r.set("class",String(i.filters.class)),j.value&&r.set("since",String(j.value));const e=route("exams.marks.live")+`?${r.toString()}`,s=await fetch(e,{credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)return;const n=await s.json();Array.isArray(n.rows)&&n.rows.forEach(o=>{ie(o.student_id,o.subject_id,o.marks)}),n.max_updated_at?j.value=n.max_updated_at:n.server_time&&(j.value=n.server_time)}finally{Y.value=!1}}},ue=()=>{$&&clearInterval($),$=setInterval(de,4e3)},ce=()=>{$&&clearInterval($),$=null};Oe(()=>[i.filters.exam,i.filters.class],()=>{j.value=null,ce(),i.filters.exam&&i.filters.class&&(de(),ue())},{immediate:!0}),Pe(()=>{i.filters.exam&&i.filters.class&&ue()}),Be(()=>{ce(),Object.values(P).forEach(r=>{try{clearTimeout(r)}catch{}})}),i.existingMarks.forEach(r=>{const e=`${r.student_id}-${r.subject_id}`;r.marks!==null&&r.marks!==void 0&&(v[e]=String(r.marks))});const he=r=>{const e=r.target.value||null;ae.get(route("exams.marks"),{exam:e},{preserveState:!0,preserveScroll:!0,replace:!0})},ke=r=>{r&&ae.get(route("exams.marks"),{exam:r},{preserveState:!0,preserveScroll:!0,replace:!0})},Z=r=>{const e=r||null;ae.get(route("exams.marks"),{exam:i.filters.exam,class:e},{preserveState:!0,preserveScroll:!0,replace:!0})},we=(r,e)=>{const s=`${r}-${e}`;return v[s]??""},D=(r,e,s)=>{const n=`${r}-${e}`;if(h(r,e))return;const o=s===""?"":Number(s);(o===""||Number.isInteger(o)&&o>=0&&o<=100)&&(v[n]=s,oe(r,e,!0),Q(r,e))},fe=(r,e)=>{var c;if(!i.students.length||!i.subjects.length)return;const s=i.students.findIndex(g=>g.id===r),n=i.subjects.findIndex(g=>g.id===e);if(s===-1||n===-1)return;const o=i.students[s+1];if(!o)return;const l=`input[data-student-id="${o.id}"][data-subject-id="${e}"]`,a=document.querySelector(l);a&&(a.focus(),(c=a.select)==null||c.call(a))},I=r=>{let e=0,s=0;i.subjects.forEach(o=>{if(h(r,o.id))return;const l=`${r}-${o.id}`,a=v[l],c=a===""||a===void 0?null:Number(a);c!==null&&!Number.isNaN(c)&&(e+=c,s+=1)});const n=s>0?(e/s).toFixed(1):"";return{total:s>0?e:"",average:n}},Se=r=>{const{average:e}=I(r);if(!e)return"-";const s=me(e);return(s==null?void 0:s.grade)??"-"},me=r=>{if(r==null||r==="")return null;const e=Number(r);return Number.isNaN(e)?null:e>=75&&e<=100?{grade:"A",points:1}:e>=65&&e<=74?{grade:"B",points:2}:e>=45&&e<=64?{grade:"C",points:3}:e>=30&&e<=44?{grade:"D",points:4}:e>=0&&e<=29?{grade:"F",points:5}:null},xe=r=>{const e=[];if(i.subjects.forEach(a=>{if(h(r,a.id))return;const c=`${r}-${a.id}`,g=v[c],m=g===""||g===void 0?null:Number(g);if(m!==null&&!Number.isNaN(m)){const y=me(m);y&&y.points!==null&&y.points!==void 0&&e.push(Number(y.points))}}),!e.length)return{division:"-",points:"-"};const o=[...e].sort((a,c)=>a-c).slice(0,7).reduce((a,c)=>a+c,0);let l;return o>=34?l="0":o>=26?l="IV":o>=22?l="III":o>=18?l="II":l="I",{division:l,points:o}},H=r=>{if(r===""||r===null||r===void 0)return!0;const e=Number(r);return Number.isInteger(e)&&e>=0&&e<=100},K=(r,e,s)=>{const n=`${r}-${e}`;s?V[n]=!0:Object.prototype.hasOwnProperty.call(V,n)&&delete V[n]},Ce=(r,e)=>{const s=`${r}-${e}`;return!!V[s]},_e=(r,e,s)=>{var o,l;if(h(r,e)){fe(r,e);return}const n=s.target.value;if(!H(n)){z.value="Mark must be a whole number between 0 and 100.",E.value=!0,K(r,e,!0),s.target.focus(),(l=(o=s.target).select)==null||l.call(o);return}K(r,e,!1),E.value=!1,Q(r,e,0),fe(r,e)},Me=(r,e,s)=>{var o,l;if(h(r,e))return;const n=s.target.value;if(!H(n)){z.value="Mark must be a whole number between 0 and 100.",E.value=!0,K(r,e,!0),s.target.focus(),(l=(o=s.target).select)==null||l.call(o);return}K(r,e,!1),E.value=!1,Q(r,e,0)},Ne=()=>{J.value=!0},ge=()=>{J.value=!1},Ee=()=>{if(!i.students.length||!i.subjects.length){R.value=!1;return}i.students.forEach(r=>{i.subjects.forEach(e=>{const s=`${r.id}-${e.id}`;v[s]=""})}),R.value=!1},je=()=>{!i.students.length||!i.subjects.length||(R.value=!0)},$e=()=>{if(!i.filters.exam||!i.filters.class)return;const r=[];if(Object.keys(C).forEach(l=>{if(!C[l])return;const a=String(l).split("-");if(a.length!==2)return;const c=Number(a[0]),g=Number(a[1]);if(!c||!g||h(c,g))return;const m=v[l];if(!H(m))return;const y=m===""||m===void 0?null:Number(m);r.push({student_id:c,subject_id:g,marks:y,key:l})}),!r.length){M.value=!0,setTimeout(()=>{M.value=!1},1e3);return}const e=200,s=[];for(let l=0;l<r.length;l+=e)s.push(r.slice(l,l+e));const n=async l=>{const a=new Map;l.forEach(m=>{a.has(m.student_id)||a.set(m.student_id,[]),a.get(m.student_id).push({subject_id:m.subject_id,marks:m.marks})});const c=Array.from(a.entries()).map(([m,y])=>({student_id:m,marks:y})),g=await fetch("/exams/marks/save",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":le()},body:JSON.stringify({exam_id:i.filters.exam,class_id:i.filters.class,rows:c,save_snapshot:!1})});if(!g.ok){let m="";try{const y=await g.json();m=(y==null?void 0:y.message)||""}catch{m=""}throw new Error(m||`Save failed (${g.status})`)}};(async()=>{L.value="",A.value=r.length,O.value=0,S.value=!0,T.value=!0;try{for(const l of s)await n(l),O.value+=l.length,l.forEach(a=>{C[a.key]&&delete C[a.key]});M.value=!0,setTimeout(()=>{M.value=!1},1400)}catch(l){L.value=l!=null&&l.message?String(l.message):"Save failed."}finally{S.value=!1,T.value=!1,A.value=0,O.value=0}})()},Te=()=>{!i.students.length||!i.subjects.length||(F.value="",B.value=!0)},Ae=()=>{if(N.value)return;const r=String(F.value??"").trim(),e=r===""?null:Number(r);N.value=!0;const s=a=>{const c=Math.round(Number(a));return Number.isNaN(c)||c<0?0:c>100?100:c},n=(a,c)=>a+Math.random()*(c-a),o=()=>{let a=0,c=0;for(;a===0;)a=Math.random();for(;c===0;)c=Math.random();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*c)},l=()=>{const a=Math.random();return a<.15?[0,29]:a<.6?[30,54]:a<.9?[55,74]:[75,100]};if(e===null){const a=new Map;i.students.forEach(c=>{const[g,m]=l(),y=n(g,m);a.set(String(c.id),y)}),i.students.forEach(c=>{const g=a.get(String(c.id))??50;i.subjects.forEach(m=>{if(h(c.id,m.id))return;const y=o()*4,G=o()*7,ee=s(g+y+G);D(c.id,m.id,String(ee))})}),N.value=!1,B.value=!1;return}if(Number.isNaN(e)||!Number.isInteger(e)||e<0||e>100){N.value=!1;return}i.students.forEach(a=>{i.subjects.forEach(c=>{if(h(a.id,c.id))return;const g=`${a.id}-${c.id}`,m=v[g];if(m===""||m===void 0||m===null){D(a.id,c.id,String(e));return}const y=Number(m);if(Number.isNaN(y)){D(a.id,c.id,String(e));return}if(y>=75)return;const G=y+e,ee=G>100?100:G;D(a.id,c.id,String(ee))})}),N.value=!1,B.value=!1};return(r,e)=>(u(),d(k,null,[se(ze(Re),{title:"Data Entry"}),se(Xe,null,{header:re(()=>[t("div",He,[e[6]||(e[6]=t("div",null,[t("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Data Entry - Enter Marks "),t("p",{class:"mt-1 text-sm text-gray-500"}," Choose an exam and class, then enter subject marks for each student in an Excel-style grid. ")],-1)),t("div",Ke,[f.filters.exam?(u(),d("div",We,[e[5]||(e[5]=t("span",{class:"font-medium text-gray-700"},"Exam:",-1)),t("span",Ye,x((f.exams.find(s=>String(s.id)===String(f.filters.exam))||{}).name||"Selected Exam"),1)])):(u(),d("div",Ge,[e[4]||(e[4]=t("label",{class:"font-medium text-gray-600"},"Exam",-1)),t("select",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",onChange:he},[e[3]||(e[3]=t("option",{value:""},"Select exam",-1)),(u(!0),d(k,null,_(f.exams,s=>(u(),d("option",{key:s.id,value:s.id,selected:String(f.filters.exam)===String(s.id)},x(s.name),9,Ue))),128))],32)])),f.filters.exam&&f.filters.class?(u(),d("button",{key:2,type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-70",disabled:S.value,onClick:$e},[S.value?(u(),d("span",Qe,"Saving...")):(u(),d("span",Ze,"Save Marks"))],8,Je)):b("",!0)])])]),default:re(()=>[f.filters.exam?b("",!0):(u(),d("div",Ie,[e[10]||(e[10]=t("h3",{class:"mb-2 text-xs font-semibold uppercase tracking-wide text-gray-500"}," Exams ",-1)),e[11]||(e[11]=t("p",{class:"mb-3 text-[11px] text-gray-500"}," Pick an exam from the list or use the filter above. Click the arrow button to move forward to entering marks. ",-1)),t("div",et,[t("table",tt,[e[9]||(e[9]=t("thead",null,[t("tr",{class:"border-b border-gray-200 bg-gray-50 text-[11px] font-semibold uppercase tracking-wide text-gray-500"},[t("th",{class:"px-3 py-1.5"},"Name"),t("th",{class:"px-3 py-1.5"},"Year / Type"),t("th",{class:"px-3 py-1.5 text-right"},"Action")])],-1)),t("tbody",null,[f.exams.length?b("",!0):(u(),d("tr",st,[...e[7]||(e[7]=[t("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-400"}," No exams available yet. ",-1)])])),(u(!0),d(k,null,_(f.exams,s=>(u(),d("tr",{key:s.id,class:"border-b border-gray-100 text-[11px] text-gray-700 hover:bg-gray-50"},[t("td",rt,[t("span",at,x(s.name),1)]),t("td",nt,[t("div",lt,[t("span",null,x(s.academic_year||"—"),1),s.type?(u(),d("span",ot,x(s.type),1)):b("",!0)])]),t("td",it,[t("div",dt,[t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:n=>ke(s.id)},[...e[8]||(e[8]=[t("span",{class:"mr-1"},"Enter marks",-1),t("span",{"aria-hidden":"true"},"→",-1)])],8,ut)])])]))),128))])])])])),R.value?(u(),d("div",ct,[t("div",ft,[e[12]||(e[12]=t("h3",{class:"mb-2 text-sm font-semibold text-gray-900"}," Clear all marks? ",-1)),e[13]||(e[13]=t("p",{class:"mb-4 text-[11px] text-gray-600"}," This will remove all entered marks for this exam and class in the grid. You can only restore them by re-entering the marks. ",-1)),t("div",mt,[t("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:e[0]||(e[0]=s=>R.value=!1)}," Cancel "),t("button",{type:"button",class:"rounded-md bg-red-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-red-700",onClick:Ee}," Yes, clear all ")])])])):b("",!0),J.value?(u(),d("div",xt,[t("div",{class:"w-full max-w-xl rounded-2xl bg-white p-6 text-xs text-gray-700 shadow-2xl"},[t("div",{class:"mb-3 flex items-start justify-between gap-4"},[e[14]||(e[14]=t("div",null,[t("h3",{class:"text-sm font-semibold text-gray-900"}," How marks are entered and calculated "),t("p",{class:"mt-1 text-[11px] text-gray-500"}," Each cell represents a subject mark for one student in this exam and class. Marks must be whole numbers between 0 and 100. ")],-1)),t("button",{type:"button",class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-gray-100 text-[11px] font-bold text-gray-600 hover:bg-gray-200",onClick:ge}," × ")]),e[15]||(e[15]=t("div",{class:"space-y-2 text-[11px] text-gray-700"},[t("p",null,[t("span",{class:"font-semibold"},"Allowed marks:"),w(" 0–100 only. If you type a value outside this range, the cell will stay focused until you correct it. ")]),t("p",null,[t("span",{class:"font-semibold"},"Totals & averages:"),w(" The grid automatically sums all valid subject marks per student to show the "),t("span",{class:"font-semibold"},"Total"),w(" and "),t("span",{class:"font-semibold"},"Average"),w(". ")]),t("p",null,[t("span",{class:"font-semibold"},"Grade, Division & Points:"),w(" These are calculated live using the NECTA-style grading scale (A–F) and best seven subjects for points. ")]),t("p",null,[t("span",{class:"font-semibold"},"Saving:"),w(" When you click "),t("span",{class:"font-semibold"},"Save Marks"),w(", all current values in the grid are stored for this exam, class, school and subject combination. ")])],-1)),t("div",{class:"mt-4 flex justify-end gap-2 text-[11px]"},[t("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:ge}," Close ")])])])):b("",!0),t("div",gt,[f.filters.exam?f.filters.exam&&f.classes.length===0?(u(),d("div",pt," No classes are assigned to this exam yet. ")):f.filters.exam&&f.classes.length>0&&!f.filters.class?(u(),d("div",bt,[t("div",vt,[e[16]||(e[16]=t("p",{class:"mb-2 font-medium"},"Classes assigned to this exam",-1)),t("div",ht,[(u(!0),d(k,null,_(f.classes,s=>(u(),d("button",{key:s.id,type:"button",class:W(["rounded-full border px-3 py-1 text-[11px] font-medium",String(f.filters.class)===String(s.id)?"border-emerald-600 bg-emerald-50 text-emerald-700":"border-gray-300 bg-gray-50 text-gray-700 hover:bg-gray-100"]),onClick:n=>Z(s.id)},x(s.level||s.name),11,kt))),128))]),e[17]||(e[17]=t("p",{class:"mt-3 text-[11px] text-gray-500"}," Choose a class above to load its students for this exam and start entering marks. ",-1))])])):f.filters.exam&&f.filters.class&&f.students.length===0?(u(),d("div",wt,[t("div",St,[e[18]||(e[18]=t("p",{class:"mb-2 font-medium"},"Classes assigned to this exam",-1)),t("div",Ct,[(u(!0),d(k,null,_(f.classes,s=>(u(),d("button",{key:s.id,type:"button",class:W(["rounded-full border px-3 py-1 text-[11px] font-medium",String(f.filters.class)===String(s.id)?"border-emerald-600 bg-emerald-50 text-emerald-700":"border-gray-300 bg-gray-50 text-gray-700 hover:bg-gray-100"]),onClick:n=>Z(s.id)},x(s.level||s.name),11,_t))),128))])]),e[19]||(e[19]=t("div",{class:"py-6 text-center text-xs text-gray-500"}," No students found for this class. ",-1))])):(u(),d("div",Mt,[t("div",Nt,[t("div",Et,[e[20]||(e[20]=t("span",{class:"font-medium"},"Classes:",-1)),(u(!0),d(k,null,_(f.classes,s=>(u(),d("button",{key:s.id,type:"button",class:W(["rounded-full border px-3 py-1 text-[11px] font-medium",String(f.filters.class)===String(s.id)?"border-emerald-600 bg-emerald-50 text-emerald-700":"border-gray-300 bg-gray-50 text-gray-700 hover:bg-gray-100"]),onClick:n=>Z(s.id)},x(s.level||s.name),11,jt))),128))]),t("div",$t,[t("button",{type:"button",class:"rounded-md bg-white px-3 py-1 text-[11px] font-medium text-red-600 ring-1 ring-red-200 hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-60",disabled:!f.students.length||!f.subjects.length,onClick:je}," Clear All Marks ",8,Tt),t("button",{type:"button",class:"rounded-md bg-emerald-50 px-3 py-1 text-[11px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!f.students.length||!f.subjects.length,onClick:Te}," Standardization ",8,At)]),E.value?(u(),d("div",Ot,[e[22]||(e[22]=t("div",{class:"absolute -top-1 right-6 h-2 w-2 rotate-45 border-l border-t border-red-200 bg-white"},null,-1)),t("div",Pt,[e[21]||(e[21]=t("span",{class:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-red-100 text-[10px] font-bold text-red-700"},"!",-1)),t("button",{type:"button",class:"text-[10px] font-medium text-emerald-700 underline-offset-2 hover:underline",onClick:ye(Ne,["stop"])}," Learn more ")]),t("p",Bt,x(z.value||"Marks must be whole numbers between 0 and 100."),1)])):b("",!0)]),t("div",zt,[t("span",null,[e[23]||(e[23]=w(" Exam: ",-1)),t("span",Rt,x(f.filters.exam||"—"),1)]),e[25]||(e[25]=t("span",{class:"text-gray-300"},"|",-1)),t("span",null,[e[24]||(e[24]=w(" Class: ",-1)),t("span",Dt,x(pe.value||"—"),1)])]),t("div",qt,[t("table",Lt,[t("thead",null,[t("tr",Ft,[e[26]||(e[26]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-left"},"#",-1)),e[27]||(e[27]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-left"},"Exam No",-1)),e[28]||(e[28]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-left"},"Student Name",-1)),(u(!0),d(k,null,_(f.subjects,s=>(u(),d("th",{key:s.id,class:"border-b border-gray-200 px-2 py-1 text-center"},x(s.code),1))),128)),e[29]||(e[29]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Total",-1)),e[30]||(e[30]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Grade",-1)),e[31]||(e[31]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Average",-1)),e[32]||(e[32]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Div",-1)),e[33]||(e[33]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Pts",-1))])]),t("tbody",null,[(u(!0),d(k,null,_(f.students,(s,n)=>(u(),d("tr",{key:s.id,class:"odd:bg-white even:bg-gray-50"},[t("td",Vt,x(n+1),1),t("td",Xt,x(s.exam_number),1),t("td",Ht,x(s.full_name),1),(u(!0),d(k,null,_(f.subjects,o=>(u(),d("td",{key:o.id,class:"border-t border-gray-100 px-1 py-0.5 text-center align-top"},[t("input",{value:we(s.id,o.id),type:"text",inputmode:"numeric",placeholder:"-",disabled:h(s.id,o.id),class:W(["w-12 rounded px-1 py-0.5 text-[11px] text-center focus:outline-none focus:ring-emerald-500",h(s.id,o.id)?"cursor-not-allowed border border-gray-200 bg-gray-100 text-gray-400":"",Ce(s.id,o.id)?"border border-red-400 bg-red-50 focus:border-red-500":"border border-gray-300 focus:border-emerald-500"]),"data-student-id":s.id,"data-subject-id":o.id,onInput:l=>D(s.id,o.id,l.target.value),onKeydown:De(ye(l=>_e(s.id,o.id,l),["prevent"]),["enter"]),onBlur:l=>Me(s.id,o.id,l)},null,42,Kt)]))),128)),t("td",Gt,x(I(s.id).total||"-"),1),t("td",Ut,x(Se(s.id)),1),t("td",Wt,x(I(s.id).average||"-"),1),t("td",Yt,x(xe(s.id).division),1),t("td",Jt,x(xe(s.id).points),1)]))),128))])])]),e[34]||(e[34]=t("div",{class:"mt-3 flex items-center justify-between gap-3"},[t("p",{class:"text-[10px] text-gray-400"}," This is an Excel-style entry grid for marks. ")],-1))])):(u(),d("div",yt," Please select an exam first. "))]),B.value?(u(),d("div",Qt,[t("div",Zt,[e[36]||(e[36]=t("h3",{class:"mb-2 text-sm font-semibold text-gray-800"}," Standardization ",-1)),e[37]||(e[37]=t("p",{class:"mb-3 text-[11px] text-gray-500"}," Leave blank to generate realistic random marks (0-100) with a pass/fail balance. Or enter a bonus (0-100) to add to weaker marks. ",-1)),t("div",It,[e[35]||(e[35]=t("label",{class:"mb-1 block font-medium"},"Bonus (optional)",-1)),qe(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>F.value=s),type:"number",min:"0",max:"100",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[Le,F.value]])]),t("div",es,[t("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:e[2]||(e[2]=s=>B.value=!1)}," Cancel "),t("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:N.value,onClick:Ae},[N.value?(u(),d("span",rs,"Applying...")):(u(),d("span",ss,"Apply"))],8,ts)])])])):b("",!0),se(Fe,{name:"fade"},{default:re(()=>[S.value||M.value?(u(),d("div",as,[S.value?(u(),d("div",ns,[t("div",ls,[e[38]||(e[38]=t("span",{class:"inline-flex h-3 w-3 animate-spin rounded-full border border-emerald-500 border-t-transparent"},null,-1)),T.value?(u(),d("span",os,"Saving marks... "+x(ne.value)+"%",1)):(u(),d("span",is,"Saving mark..."))]),T.value?(u(),d("div",ds,[t("div",us,[t("div",{class:"h-1.5 bg-emerald-600",style:Ve({width:ne.value+"%"})},null,4)]),t("div",cs,[t("span",null,x(O.value)+"/"+x(A.value),1),L.value?(u(),d("span",fs,x(L.value),1)):b("",!0)])])):b("",!0)])):(u(),d("div",ms,[...e[39]||(e[39]=[t("span",{class:"inline-flex h-4 w-4 items-center justify-center rounded-full bg-emerald-100 text-[9px] font-bold"},"✓",-1),t("span",null,"Marks saved successfully",-1)])]))])):b("",!0)]),_:1})]),_:1})],64))}};export{ps as default};

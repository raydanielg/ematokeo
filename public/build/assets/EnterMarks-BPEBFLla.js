import{n as K,j as u,i as v,I as G,c as r,a as M,u as J,h as R,w as T,b as s,d as V,t as i,k as w,v as j,o as n,F as y,r as E,s as X,m as C}from"./app-CWZD6_dF.js";import{_ as Y}from"./AuthenticatedLayout-B6-gQ16C.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"space-y-6"},W={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},Z={class:"flex flex-wrap items-center justify-between gap-3"},ee={class:"text-xs text-gray-500"},te={class:"ml-1"},se={class:"mt-4 grid gap-4 sm:grid-cols-3"},ae={id:"teacher-exams"},le=["value"],re=["disabled"],ne={id:"teacher-classes"},oe=["value"],de=["disabled"],ue={id:"teacher-subjects"},ie=["value"],ce={key:0,class:"mt-4 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},me={key:0,class:"rounded-lg bg-white p-6 text-sm text-gray-600 shadow-sm ring-1 ring-gray-100"},xe={key:1,class:"overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-100"},ge={class:"overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-100 text-left text-sm"},ye={class:"divide-y divide-gray-100"},pe={key:0},be={class:"px-5 py-3 font-medium text-gray-900"},fe={class:"px-5 py-3 text-gray-800"},he={class:"px-5 py-3 text-gray-700"},ke={class:"px-5 py-3"},_e=["onUpdate:modelValue","disabled","onBlur"],Ee={__name:"EnterMarks",props:{exams:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},students:{type:Array,default:()=>[]},existingMarks:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({exam:null,class:null,subject:null})}},setup(o){const l=o,p=K({});l.existingMarks.forEach(t=>{const e=String(t.student_id);t.marks!==null&&t.marks!==void 0&&(p[e]=String(t.marks))});const d=u(()=>{var t;return(t=l.filters)!=null&&t.exam?String(l.filters.exam):""}),c=u(()=>{var t;return(t=l.filters)!=null&&t.class?String(l.filters.class):""}),x=u(()=>{var t;return(t=l.filters)!=null&&t.subject?String(l.filters.subject):""}),b=v(""),f=v(""),h=v(""),N=u(()=>{const t={};return(l.exams||[]).forEach(e=>{t[String(e.id)]=`${e.name}${e.academic_year?` (${e.academic_year})`:""}`}),t}),$=u(()=>{const t={};return(l.classes||[]).forEach(e=>{t[String(e.id)]=String(e.name||"")}),t}),I=u(()=>{const t={};return(l.subjects||[]).forEach(e=>{t[String(e.id)]=String(e.code||"")}),t});G(()=>l.filters,()=>{b.value=d.value&&N.value[d.value]||"",f.value=c.value&&$.value[c.value]||"",h.value=x.value&&I.value[x.value]||""},{immediate:!0,deep:!0});const B=u(()=>!!d.value&&!!c.value&&!!x.value),A=()=>{var t;return((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},m=t=>String(t||"").trim().toLowerCase(),F=()=>{const t=m(b.value);if(!t)return null;const e=(l.exams||[]).find(a=>m(`${a.name}${a.academic_year?` (${a.academic_year})`:""}`)===t);return e?e.id:null},L=()=>{const t=m(f.value);if(!t)return null;const e=(l.classes||[]).find(a=>m(a.name)===t);return e?e.id:null},P=()=>{const t=m(h.value);if(!t)return null;const e=(l.subjects||[]).find(a=>m(a.code)===t);return e?e.id:null},U=()=>{const t=F();C.get(route("teacher.exams.marks"),{exam:t},{preserveState:!0,preserveScroll:!0,replace:!0})},q=()=>{const t=L();C.get(route("teacher.exams.marks"),{exam:l.filters.exam,class:t},{preserveState:!0,preserveScroll:!0,replace:!0})},O=()=>{const t=P();C.get(route("teacher.exams.marks"),{exam:l.filters.exam,class:l.filters.class,subject:t},{preserveState:!0,preserveScroll:!0,replace:!0})},k=v(null),g=v(""),Q=async t=>{if(!B.value)return;g.value="";const e=p[String(t)]??"",a=e===""?null:Number(e);if(a!==null&&(!Number.isInteger(a)||a<0||a>100)){g.value="Marks must be a whole number between 0 and 100.";return}k.value=String(t);const _={exam_id:Number(l.filters.exam),class_id:Number(l.filters.class),subject_id:Number(l.filters.subject),student_id:Number(t),marks:a};try{const S=await fetch(route("teacher.exams.marks.save-cell"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":A(),Accept:"application/json"},body:JSON.stringify(_)});if(!S.ok){const D=await S.text();throw new Error(D||"Failed to save")}await S.json()}catch{g.value="Failed to save marks. Please try again."}finally{k.value=null}},z=t=>{const e="h-9 w-24 rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500";return k.value===String(t)?e+" opacity-60":e};return(t,e)=>(n(),r(y,null,[M(J(R),{title:"Enter Marks"}),M(Y,null,{header:T(()=>[...e[3]||(e[3]=[s("div",null,[s("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"},"Enter Marks"),s("p",{class:"mt-1 text-sm text-gray-500"},"You can enter marks for your subject only.")],-1)])]),default:T(()=>[s("div",H,[s("div",W,[s("div",Z,[s("div",ee,[e[4]||(e[4]=s("span",{class:"font-semibold text-gray-800"},"Selected:",-1)),s("span",te,i(d.value&&N.value[d.value]||"—"),1),e[5]||(e[5]=s("span",{class:"mx-1"},"/",-1)),s("span",null,i(c.value&&$.value[c.value]||"—"),1),e[6]||(e[6]=s("span",{class:"mx-1"},"/",-1)),s("span",null,i(x.value&&I.value[x.value]||"—"),1)])]),s("div",se,[s("div",null,[e[7]||(e[7]=s("label",{class:"block text-xs font-semibold text-gray-700"},"Exam",-1)),w(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),list:"teacher-exams",class:"mt-1 block w-full rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500",placeholder:"Type exam name...",onChange:U},null,544),[[j,b.value]]),s("datalist",ae,[(n(!0),r(y,null,E(o.exams,a=>(n(),r("option",{key:a.id,value:`${a.name}${a.academic_year?` (${a.academic_year})`:""}`},null,8,le))),128))])]),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-xs font-semibold text-gray-700"},"Class",-1)),w(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),list:"teacher-classes",class:"mt-1 block w-full rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500 disabled:bg-gray-50",placeholder:"Type class name...",disabled:!d.value,onChange:q},null,40,re),[[j,f.value]]),s("datalist",ne,[(n(!0),r(y,null,E(o.classes,a=>(n(),r("option",{key:a.id,value:a.name},null,8,oe))),128))])]),s("div",null,[e[9]||(e[9]=s("label",{class:"block text-xs font-semibold text-gray-700"},"Subject",-1)),w(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>h.value=a),list:"teacher-subjects",class:"mt-1 block w-full rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500 disabled:bg-gray-50",placeholder:"Type subject code...",disabled:!d.value||!c.value,onChange:O},null,40,de),[[j,h.value]]),s("datalist",ue,[(n(!0),r(y,null,E(o.subjects,a=>(n(),r("option",{key:a.id,value:a.code},null,8,ie))),128))])])]),g.value?(n(),r("div",ce,i(g.value),1)):V("",!0)]),B.value?(n(),r("div",xe,[s("div",ge,[s("table",ve,[e[11]||(e[11]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Exam #"),s("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Student"),s("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Stream"),s("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Marks")])],-1)),s("tbody",ye,[!o.students||o.students.length===0?(n(),r("tr",pe,[...e[10]||(e[10]=[s("td",{colspan:"4",class:"px-5 py-6 text-center text-sm text-gray-500"}," No students found in this class. ",-1)])])):V("",!0),(n(!0),r(y,null,E(o.students,a=>(n(),r("tr",{key:a.id,class:"hover:bg-gray-50"},[s("td",be,i(a.exam_number),1),s("td",fe,i(a.full_name),1),s("td",he,i(a.stream||"—"),1),s("td",ke,[w(s("input",{class:X(z(a.id)),inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":_=>p[String(a.id)]=_,disabled:k.value===String(a.id),onBlur:_=>Q(a.id)},null,42,_e),[[j,p[String(a.id)]]])])]))),128))])])])])):(n(),r("div",me," Select Exam, Class and Subject to start entering marks. "))])]),_:1})],64))}};export{Ee as default};

import{n as T,j as y,i as S,c as l,a as _,u as V,h as O,w,b as e,d as j,o as n,F as u,r as b,t as o,k as I,s as D,v as K,m as f}from"./app-uKkBaC-C.js";import{_ as P}from"./AuthenticatedLayout-CVtEkm0p.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"space-y-6"},$={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},q={class:"grid gap-4 sm:grid-cols-3"},z=["value"],G=["value"],J=["disabled","value"],L=["value"],R=["disabled","value"],X=["value"],Y={key:0,class:"mt-4 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},H={key:0,class:"rounded-lg bg-white p-6 text-sm text-gray-600 shadow-sm ring-1 ring-gray-100"},Q={key:1,class:"overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-100"},W={class:"overflow-x-auto"},Z={class:"min-w-full divide-y divide-gray-100 text-left text-sm"},ee={class:"divide-y divide-gray-100"},te={key:0},se={class:"px-5 py-3 font-medium text-gray-900"},ae={class:"px-5 py-3 text-gray-800"},re={class:"px-5 py-3 text-gray-700"},le={class:"px-5 py-3"},ne=["onUpdate:modelValue","disabled","onBlur"],ue={__name:"EnterMarks",props:{exams:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},students:{type:Array,default:()=>[]},existingMarks:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({exam:null,class:null,subject:null})}},setup(d){const r=d,c=T({});r.existingMarks.forEach(s=>{const t=String(s.student_id);s.marks!==null&&s.marks!==void 0&&(c[t]=String(s.marks))});const m=y(()=>{var s;return(s=r.filters)!=null&&s.exam?String(r.filters.exam):""}),p=y(()=>{var s;return(s=r.filters)!=null&&s.class?String(r.filters.class):""}),k=y(()=>{var s;return(s=r.filters)!=null&&s.subject?String(r.filters.subject):""}),h=y(()=>!!m.value&&!!p.value&&!!k.value),C=()=>{var s;return((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},E=s=>{const t=s.target.value||null;f.get(route("teacher.exams.marks"),{exam:t},{preserveState:!0,preserveScroll:!0,replace:!0})},N=s=>{const t=s.target.value||null;f.get(route("teacher.exams.marks"),{exam:r.filters.exam,class:t},{preserveState:!0,preserveScroll:!0,replace:!0})},M=s=>{const t=s.target.value||null;f.get(route("teacher.exams.marks"),{exam:r.filters.exam,class:r.filters.class,subject:t},{preserveState:!0,preserveScroll:!0,replace:!0})},g=S(null),i=S(""),A=async s=>{if(!h.value)return;i.value="";const t=c[String(s)]??"",a=t===""?null:Number(t);if(a!==null&&(!Number.isInteger(a)||a<0||a>100)){i.value="Marks must be a whole number between 0 and 100.";return}g.value=String(s);const x={exam_id:Number(r.filters.exam),class_id:Number(r.filters.class),subject_id:Number(r.filters.subject),student_id:Number(s),marks:a};try{const v=await fetch(route("teacher.exams.marks.save-cell"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C(),Accept:"application/json"},body:JSON.stringify(x)});if(!v.ok){const F=await v.text();throw new Error(F||"Failed to save")}await v.json()}catch{i.value="Failed to save marks. Please try again."}finally{g.value=null}},B=s=>{const t="h-9 w-24 rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500";return g.value===String(s)?t+" opacity-60":t};return(s,t)=>(n(),l(u,null,[_(V(O),{title:"Enter Marks"}),_(P,null,{header:w(()=>[...t[0]||(t[0]=[e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"},"Enter Marks"),e("p",{class:"mt-1 text-sm text-gray-500"},"You can enter marks for your subject only.")],-1)])]),default:w(()=>[e("div",U,[e("div",$,[e("div",q,[e("div",null,[t[2]||(t[2]=e("label",{class:"block text-xs font-semibold text-gray-700"},"Exam",-1)),e("select",{class:"mt-1 block w-full rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500",value:m.value,onChange:E},[t[1]||(t[1]=e("option",{value:""},"Select exam",-1)),(n(!0),l(u,null,b(d.exams,a=>(n(),l("option",{key:a.id,value:a.id},o(a.name)+" ("+o(a.academic_year||"—")+")",9,G))),128))],40,z)]),e("div",null,[t[4]||(t[4]=e("label",{class:"block text-xs font-semibold text-gray-700"},"Class",-1)),e("select",{class:"mt-1 block w-full rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500",disabled:!m.value,value:p.value,onChange:N},[t[3]||(t[3]=e("option",{value:""},"Select class",-1)),(n(!0),l(u,null,b(d.classes,a=>(n(),l("option",{key:a.id,value:a.id},o(a.name),9,L))),128))],40,J)]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-xs font-semibold text-gray-700"},"Subject",-1)),e("select",{class:"mt-1 block w-full rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500",disabled:!m.value||!p.value,value:k.value,onChange:M},[t[5]||(t[5]=e("option",{value:""},"Select subject",-1)),(n(!0),l(u,null,b(d.subjects,a=>(n(),l("option",{key:a.id,value:a.id},o(a.code),9,X))),128))],40,R)])]),i.value?(n(),l("div",Y,o(i.value),1)):j("",!0)]),h.value?(n(),l("div",Q,[e("div",W,[e("table",Z,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Exam #"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Student"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Stream"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Marks")])],-1)),e("tbody",ee,[!d.students||d.students.length===0?(n(),l("tr",te,[...t[7]||(t[7]=[e("td",{colspan:"4",class:"px-5 py-6 text-center text-sm text-gray-500"}," No students found in this class. ",-1)])])):j("",!0),(n(!0),l(u,null,b(d.students,a=>(n(),l("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",se,o(a.exam_number),1),e("td",ae,o(a.full_name),1),e("td",re,o(a.stream||"—"),1),e("td",le,[I(e("input",{class:D(B(a.id)),inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":x=>c[String(a.id)]=x,disabled:g.value===String(a.id),onBlur:x=>A(a.id)},null,42,ne),[[K,c[String(a.id)]]])])]))),128))])])])])):(n(),l("div",H," Select Exam, Class and Subject to start entering marks. "))])]),_:1})],64))}};export{ue as default};

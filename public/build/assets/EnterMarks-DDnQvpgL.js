import{n as E,i as h,c as a,a as M,u as R,h as H,w as I,b as t,d as p,o as l,F as g,r as y,t as x,s as S,f as A,M as J,x as Q,m as k,k as W,v as X,T as Z}from"./app-D_wv2evS.js";import{_ as ee}from"./AuthenticatedLayout-CBksOQ8E.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"flex flex-wrap items-center justify-between gap-3"},se={class:"flex flex-wrap items-center gap-3 text-xs"},re={class:"flex items-center gap-2"},ne=["value","selected"],ae={class:"mb-4 rounded-xl bg-white p-4 shadow-sm ring-1 ring-gray-100"},le={class:"overflow-x-auto"},de={class:"min-w-full text-left text-[11px]"},ie={key:0},oe={class:"px-3 py-1.5 align-top"},ue={class:"font-medium text-gray-900"},xe={class:"px-3 py-1.5 align-top"},me={class:"flex flex-col"},ce={key:0,class:"text-[10px] text-gray-500"},ge={class:"px-3 py-1.5 align-top"},ye={class:"flex justify-end"},fe=["onClick"],be={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},pe={key:0,class:"py-10 text-center text-xs text-gray-500"},ve={key:1,class:"py-10 text-center text-xs text-gray-500"},he={key:2,class:"space-y-4"},ke={class:"text-xs text-gray-600"},we={class:"flex flex-wrap gap-2"},Se=["onClick"],$e={key:3,class:"space-y-4"},Ce={class:"text-xs text-gray-600"},Ne={class:"flex flex-wrap gap-2"},je=["onClick"],Ee={key:4,class:"space-y-4"},Me={class:"flex flex-wrap items-center justify-between gap-3 rounded-md bg-gray-50 px-3 py-2 text-[11px] text-gray-700"},Ie={class:"flex flex-wrap items-center gap-4"},Ae={class:"ml-1"},ze={key:0,class:"ml-1 text-gray-500"},Te={class:"ml-1"},Fe={class:"flex flex-wrap items-center gap-3"},Ve={class:"flex flex-wrap items-center justify-between gap-2 text-xs text-gray-600"},De={class:"flex flex-wrap gap-2"},_e=["onClick"],Pe=["disabled"],Re={class:"overflow-x-auto"},Be={class:"min-w-full border-collapse text-[11px]"},Ke={class:"bg-gray-50 text-gray-600"},qe={class:"border-t border-gray-100 px-2 py-1 align-top"},Ge={class:"flex items-center gap-1"},Le={key:0,class:"inline-flex items-center justify-center rounded-full bg-emerald-100 px-1 text-[9px] font-semibold text-emerald-700"},Oe={class:"border-t border-gray-100 px-2 py-1 align-top font-mono"},Ue={class:"border-t border-gray-100 px-2 py-1 align-top"},Ye=["value","data-student-id","data-subject-id","onInput","onKeydown"],He={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Je={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Qe={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},We={class:"border-t border-gray-100 px-2 py-1 text-center align-top"},Xe={class:"mt-3 flex items-center justify-between gap-3"},Ze={class:"flex items-center gap-2"},et=["disabled"],tt={key:0},st={key:1},rt={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6"},nt={class:"w-full max-w-xs rounded-xl bg-white p-5 text-xs text-gray-700 shadow-xl"},at={class:"mb-4"},lt={class:"flex justify-end gap-2 text-[11px]"},dt=["disabled"],it={key:0},ot={key:1},ut={key:0,class:"fixed bottom-4 right-4 z-40 flex items-center gap-2 rounded-lg bg-white px-3 py-2 text-[11px] shadow-lg ring-1 ring-gray-200"},xt={key:0,class:"flex items-center gap-2 text-gray-600"},mt={key:1,class:"flex items-center gap-2 text-emerald-700"},ft={__name:"EnterMarks",props:{exams:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},students:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},existingMarks:{type:Array,default:()=>[]},gradingSchemes:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({exam:null,class:null})}},setup(r){const m=r,f=E({}),z=E({}),$=E({}),v=h(!1),C=h(!1),T=h([]),F=h(!1),V=h(""),D=h(!1);m.existingMarks.forEach(n=>{const e=`${n.student_id}-${n.subject_id}`;n.marks!==null&&n.marks!==void 0&&(f[e]=String(n.marks))});const B=n=>{const e=n.target.value||null;k.get(route("exams.marks"),{exam:e},{preserveState:!0,preserveScroll:!0,replace:!0})},K=n=>{if(n==null||n==="")return null;const e=Number(n);return Number.isNaN(e)?null:e>=75&&e<=100?{grade:"A",points:1}:e>=65&&e<=74?{grade:"B",points:2}:e>=45&&e<=64?{grade:"C",points:3}:e>=30&&e<=44?{grade:"D",points:4}:e>=0&&e<=29?{grade:"F",points:5}:null},_=n=>{const e=[];if(m.subjects.forEach(o=>{const c=`${n}-${o.id}`,b=f[c],j=b===""||b===void 0?null:Number(b);if(j!==null&&!Number.isNaN(j)){const w=K(j);w&&w.points!==null&&w.points!==void 0&&e.push(Number(w.points))}}),!e.length)return{division:"—",points:"—"};const i=[...e].sort((o,c)=>o-c).slice(0,7).reduce((o,c)=>o+c,0);let u;return i>=34?u="0":i>=26?u="IV":i>=22?u="III":i>=18?u="II":u="I",{division:u,points:i}},q=n=>m.subjects.some(e=>{const d=`${n}-${e.id}`,s=f[d],i=s===""||s===void 0?null:Number(s);return i!==null&&!Number.isNaN(i)}),G=n=>{n&&k.get(route("exams.marks"),{exam:n},{preserveState:!0,preserveScroll:!0,replace:!0})},N=n=>{const e=n||null;k.get(route("exams.marks"),{exam:m.filters.exam,class:e},{preserveState:!0,preserveScroll:!0,replace:!0})},L=(n,e)=>{const d=`${n}-${e}`;return f[d]??""},O=(n,e,d)=>{const s=`${n}-${e}`,i=d===""?"":Number(d);$[s]=!1,i===""||Number.isInteger(i)&&i>=0&&i<=100?(f[s]=d,z[s]=!0):$[s]=!0},U=(n,e)=>{var c;if(!m.students.length||!m.subjects.length)return;const d=m.students.findIndex(b=>b.id===n),s=m.subjects.findIndex(b=>b.id===e);if(d===-1||s===-1)return;const i=m.students[d+1];if(!i)return;const u=`input[data-student-id="${i.id}"][data-subject-id="${e}"]`,o=document.querySelector(u);o&&(o.focus(),(c=o.select)==null||c.call(o))},P=n=>{let e=0,d=0;m.subjects.forEach(i=>{const u=`${n}-${i.id}`,o=f[u],c=o===""||o===void 0?null:Number(o);c!==null&&!Number.isNaN(c)&&(e+=c,d+=1)});const s=d>0?(e/d).toFixed(1):"";return{total:d>0?e:"",average:s}},Y=()=>{if(!m.filters.exam||!m.filters.class)return;const n=m.students.map(e=>{const d=[];return m.subjects.forEach(s=>{const i=`${e.id}-${s.id}`,u=f[i],o=u===""||u===void 0?null:Number(u);d.push({subject_id:s.id,marks:o})}),{student_id:e.id,marks:d}});v.value=!0,k.post(route("exams.marks.save"),{exam_id:m.filters.exam,class_id:m.filters.class,rows:n},{preserveScroll:!0,onFinish:()=>{v.value=!1,T.value=m.students.filter(e=>q(e.id)).map(e=>e.id),C.value=!0,setTimeout(()=>{C.value=!1},1800)}})};return(n,e)=>(l(),a(g,null,[M(R(H),{title:"Enter Marks"}),M(ee,null,{header:I(()=>[t("div",te,[e[7]||(e[7]=t("div",null,[t("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Enter Marks "),t("p",{class:"mt-1 text-sm text-gray-500"}," Choose an exam and class, then enter subject marks for each student in an Excel-style grid. ")],-1)),t("div",se,[t("div",re,[e[6]||(e[6]=t("label",{class:"font-medium text-gray-600"},"Exam",-1)),t("select",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",onChange:B},[e[5]||(e[5]=t("option",{value:""},"Select exam",-1)),(l(!0),a(g,null,y(r.exams,d=>(l(),a("option",{key:d.id,value:d.id,selected:String(r.filters.exam)===String(d.id)},x(d.name),9,ne))),128))],32)])])])]),default:I(()=>{var d;return[t("div",ae,[e[11]||(e[11]=t("h3",{class:"mb-2 text-xs font-semibold uppercase tracking-wide text-gray-500"}," Exams ",-1)),e[12]||(e[12]=t("p",{class:"mb-3 text-[11px] text-gray-500"}," Pick an exam from the list or use the filter above. Click the arrow button to move forward to entering marks. ",-1)),t("div",le,[t("table",de,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"border-b border-gray-200 bg-gray-50 text-[11px] font-semibold uppercase tracking-wide text-gray-500"},[t("th",{class:"px-3 py-1.5"},"Name"),t("th",{class:"px-3 py-1.5"},"Year / Type"),t("th",{class:"px-3 py-1.5 text-right"},"Action")])],-1)),t("tbody",null,[r.exams.length?p("",!0):(l(),a("tr",ie,[...e[8]||(e[8]=[t("td",{colspan:"3",class:"px-3 py-3 text-center text-[11px] text-gray-400"}," No exams available yet. ",-1)])])),(l(!0),a(g,null,y(r.exams,s=>(l(),a("tr",{key:s.id,class:"border-b border-gray-100 text-[11px] text-gray-700 hover:bg-gray-50"},[t("td",oe,[t("span",ue,x(s.name),1)]),t("td",xe,[t("div",me,[t("span",null,x(s.academic_year||"—"),1),s.type?(l(),a("span",ce,x(s.type),1)):p("",!0)])]),t("td",ge,[t("div",ye,[t("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-50 px-2 py-1 text-[10px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:i=>G(s.id)},[...e[9]||(e[9]=[t("span",{class:"mr-1"},"Enter marks",-1),t("span",{"aria-hidden":"true"},"→",-1)])],8,fe)])])]))),128))])])])]),t("div",be,[r.filters.exam?r.filters.exam&&r.classes.length===0?(l(),a("div",ve," No classes are assigned to this exam yet. ")):r.filters.exam&&r.classes.length>0&&!r.filters.class?(l(),a("div",he,[t("div",ke,[e[13]||(e[13]=t("p",{class:"mb-2 font-medium"},"Classes assigned to this exam",-1)),t("div",we,[(l(!0),a(g,null,y(r.classes,s=>(l(),a("button",{key:s.id,type:"button",class:S(["rounded-full border px-3 py-1 text-[11px] font-medium",String(r.filters.class)===String(s.id)?"border-emerald-600 bg-emerald-50 text-emerald-700":"border-gray-300 bg-gray-50 text-gray-700 hover:bg-gray-100"]),onClick:i=>N(s.id)},x(s.level?s.stream?`${s.level} - ${s.stream}`:s.level:s.name),11,Se))),128))]),e[14]||(e[14]=t("p",{class:"mt-3 text-[11px] text-gray-500"}," Choose a class above to load its students for this exam and start entering marks. ",-1))])])):r.filters.exam&&r.filters.class&&r.students.length===0?(l(),a("div",$e,[t("div",Ce,[e[15]||(e[15]=t("p",{class:"mb-2 font-medium"},"Classes assigned to this exam",-1)),t("div",Ne,[(l(!0),a(g,null,y(r.classes,s=>(l(),a("button",{key:s.id,type:"button",class:S(["rounded-full border px-3 py-1 text-[11px] font-medium",String(r.filters.class)===String(s.id)?"border-emerald-600 bg-emerald-50 text-emerald-700":"border-gray-300 bg-gray-50 text-gray-700 hover:bg-gray-100"]),onClick:i=>N(s.id)},x(s.name),11,je))),128))])]),e[16]||(e[16]=t("div",{class:"py-6 text-center text-xs text-gray-500"}," No students found for this class. ",-1))])):(l(),a("div",Ee,[t("div",Me,[t("div",Ie,[t("div",null,[e[17]||(e[17]=t("span",{class:"font-semibold text-gray-800"},"Exam:",-1)),t("span",Ae,[A(x(r.exams.find(s=>String(s.id)===String(r.filters.exam))?r.exams.find(s=>String(s.id)===String(r.filters.exam)).name:"—")+" ",1),(d=r.exams.find(s=>String(s.id)===String(r.filters.exam)))!=null&&d.academic_year?(l(),a("span",ze," ("+x(r.exams.find(s=>String(s.id)===String(r.filters.exam)).academic_year)+") ",1)):p("",!0)])]),t("div",null,[e[18]||(e[18]=t("span",{class:"font-semibold text-gray-800"},"Class:",-1)),t("span",Te,x(r.filters.class),1)])]),t("div",Fe,[t("span",null,[e[19]||(e[19]=t("span",{class:"font-semibold"},"Students:",-1)),A(" "+x(r.students.length),1)]),t("span",null,[e[20]||(e[20]=t("span",{class:"font-semibold"},"Subjects:",-1)),A(" "+x(r.subjects.length),1)])])]),t("div",Ve,[t("div",De,[e[21]||(e[21]=t("span",{class:"font-medium"},"Classes:",-1)),(l(!0),a(g,null,y(r.classes,s=>(l(),a("button",{key:s.id,type:"button",class:S(["rounded-full border px-3 py-1 text-[11px] font-medium",String(r.filters.class)===String(s.id)?"border-emerald-600 bg-emerald-50 text-emerald-700":"border-gray-300 bg-gray-50 text-gray-700 hover:bg-gray-100"]),onClick:i=>N(s.id)},x(s.level?s.stream?`${s.level} - ${s.stream}`:s.level:s.name),11,_e))),128))]),t("button",{type:"button",class:"rounded-md bg-emerald-50 px-3 py-1 text-[11px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!r.students.length||!r.subjects.length,onClick:e[0]||(e[0]=(...s)=>n.openStandardization&&n.openStandardization(...s))}," Standardization ",8,Pe)]),t("div",Re,[t("table",Be,[t("thead",null,[t("tr",Ke,[e[22]||(e[22]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-left"},"#",-1)),e[23]||(e[23]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-left"},"Exam No",-1)),e[24]||(e[24]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-left"},"Student Name",-1)),(l(!0),a(g,null,y(r.subjects,s=>(l(),a("th",{key:s.id,class:"border-b border-gray-200 px-2 py-1 text-center"},x(s.code),1))),128)),e[25]||(e[25]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Total",-1)),e[26]||(e[26]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Average",-1)),e[27]||(e[27]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Div",-1)),e[28]||(e[28]=t("th",{class:"border-b border-gray-200 px-2 py-1 text-center"},"Pts",-1))])]),t("tbody",null,[(l(!0),a(g,null,y(r.students,(s,i)=>(l(),a("tr",{key:s.id,class:"odd:bg-white even:bg-gray-50"},[t("td",qe,[t("div",Ge,[t("span",null,x(i+1),1),T.value.includes(s.id)?(l(),a("span",Le," ✓ ")):p("",!0)])]),t("td",Oe,x(s.exam_number),1),t("td",Ue,x(s.full_name),1),(l(!0),a(g,null,y(r.subjects,u=>(l(),a("td",{key:u.id,class:"border-t border-gray-100 px-1 py-0.5 text-center align-top"},[t("input",{value:L(s.id,u.id),type:"number",min:"0",max:"100",class:S(["w-14 rounded px-1 py-0.5 text-[11px] text-center focus:outline-none focus:ring-emerald-500",[r.existingMarks.some(o=>o.student_id===s.id&&o.subject_id===u.id&&o.marks!==null&&o.marks!==void 0)?"bg-emerald-50 border border-emerald-100":"border border-gray-300",z[`${s.id}-${u.id}`]?"border-blue-400":"",$[`${s.id}-${u.id}`]?"border-red-500 bg-red-50":""]]),"data-student-id":s.id,"data-subject-id":u.id,onInput:o=>O(s.id,u.id,o.target.value),onKeydown:J(Q(o=>U(s.id,u.id),["prevent"]),["enter"])},null,42,Ye)]))),128)),t("td",He,x(P(s.id).total),1),t("td",Je,x(P(s.id).average),1),t("td",Qe,x(_(s.id).division),1),t("td",We,x(_(s.id).points),1)]))),128))])])]),t("div",Xe,[e[29]||(e[29]=t("p",{class:"text-[10px] text-gray-400"}," This is an Excel-style entry grid for marks. Division and points are calculated automatically from the grading scheme using the best seven subjects. ",-1)),t("div",Ze,[r.filters.exam?(l(),a("button",{key:0,type:"button",class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-[11px] font-medium text-gray-700 shadow-sm hover:bg-gray-50",onClick:e[1]||(e[1]=s=>R(k).get(n.route("exams.results",r.filters.exam)))}," View Results ")):p("",!0),t("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-70",disabled:v.value,onClick:Y},[v.value?(l(),a("span",tt,"Saving...")):(l(),a("span",st,"Save Marks"))],8,et)])])])):(l(),a("div",pe," Please select an exam first. "))]),F.value?(l(),a("div",rt,[t("div",nt,[e[31]||(e[31]=t("h3",{class:"mb-2 text-sm font-semibold text-gray-800"}," Standardization ",-1)),e[32]||(e[32]=t("p",{class:"mb-3 text-[11px] text-gray-500"}," Enter a single mark (0\x007f\x007f\x007f\x007f\x007f\x007f\x007f\x007f100) to apply to all students and all subjects in this class for the selected exam. ",-1)),t("div",at,[e[30]||(e[30]=t("label",{class:"mb-1 block font-medium"},"Standard mark",-1)),W(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s),type:"number",min:"0",max:"100",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[X,V.value]])]),t("div",lt,[t("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:e[3]||(e[3]=s=>F.value=!1)}," Cancel "),t("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:D.value,onClick:e[4]||(e[4]=(...s)=>n.applyStandardization&&n.applyStandardization(...s))},[D.value?(l(),a("span",ot,"Applying...")):(l(),a("span",it,"Apply"))],8,dt)])])])):p("",!0),M(Z,{name:"fade"},{default:I(()=>[v.value||C.value?(l(),a("div",ut,[v.value?(l(),a("div",xt,[...e[33]||(e[33]=[t("span",{class:"inline-flex h-3 w-3 animate-spin rounded-full border border-emerald-500 border-t-transparent"},null,-1),t("span",null,"Saving marks...",-1)])])):(l(),a("div",mt,[...e[34]||(e[34]=[t("span",{class:"inline-flex h-4 w-4 items-center justify-center rounded-full bg-emerald-100 text-[9px] font-bold"},"✓",-1),t("span",null,"Marks saved successfully",-1)])]))])):p("",!0)]),_:1})]}),_:1})],64))}};export{ft as default};

import{n as Q,j as c,i as v,I as D,c as r,a as C,u as K,h as P,w as E,b as t,d as N,t as o,o as n,F as x,r as h,k as U,s as q,v as z,m as k}from"./app-B6eS_iC8.js";import{_ as G}from"./AuthenticatedLayout-B5zucoMp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"space-y-6"},R={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},X={class:"flex flex-wrap items-center justify-between gap-3"},Y={class:"text-xs text-gray-500"},H={class:"ml-1"},W={class:"mt-4 grid gap-4 sm:grid-cols-3"},Z=["value"],ee=["value"],te=["disabled","value"],se=["value"],ae=["disabled","value"],le=["value"],re={key:0,class:"mt-4 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},ne={key:0,class:"rounded-lg bg-white p-6 text-sm text-gray-600 shadow-sm ring-1 ring-gray-100"},oe={key:1,class:"overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-100"},de={class:"overflow-x-auto"},ue={class:"min-w-full divide-y divide-gray-100 text-left text-sm"},ie={class:"divide-y divide-gray-100"},ce={key:0},me={class:"px-5 py-3 font-medium text-gray-900"},ge={class:"px-5 py-3 text-gray-800"},ve={class:"px-5 py-3 text-gray-700"},xe={class:"px-5 py-3"},ye=["onUpdate:modelValue","disabled","onBlur"],he={__name:"EnterMarks",props:{exams:{type:Array,default:()=>[]},classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},students:{type:Array,default:()=>[]},existingMarks:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({exam:null,class:null,subject:null})}},setup(u){const l=u,y=Q({});l.existingMarks.forEach(s=>{const e=String(s.student_id);s.marks!==null&&s.marks!==void 0&&(y[e]=String(s.marks))});const d=c(()=>{var s;return(s=l.filters)!=null&&s.exam?String(l.filters.exam):""}),i=c(()=>{var s;return(s=l.filters)!=null&&s.class?String(l.filters.class):""}),m=c(()=>{var s;return(s=l.filters)!=null&&s.subject?String(l.filters.subject):""}),B=v(""),M=v(""),A=v(""),S=c(()=>{const s={};return(l.exams||[]).forEach(e=>{s[String(e.id)]=`${e.name}${e.academic_year?` (${e.academic_year})`:""}`}),s}),w=c(()=>{const s={};return(l.classes||[]).forEach(e=>{s[String(e.id)]=String(e.name||"")}),s}),_=c(()=>{const s={};return(l.subjects||[]).forEach(e=>{s[String(e.id)]=String(e.code||"")}),s});D(()=>l.filters,()=>{B.value=d.value&&S.value[d.value]||"",M.value=i.value&&w.value[i.value]||"",A.value=m.value&&_.value[m.value]||""},{immediate:!0,deep:!0});const j=c(()=>!!d.value&&!!i.value&&!!m.value),I=()=>{var s;return((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},$=s=>{const e=s.target.value||null;k.get(route("teacher.exams.marks"),{exam:e},{preserveState:!0,preserveScroll:!0,replace:!0})},F=s=>{const e=s.target.value||null;k.get(route("teacher.exams.marks"),{exam:l.filters.exam,class:e},{preserveState:!0,preserveScroll:!0,replace:!0})},T=s=>{const e=s.target.value||null;k.get(route("teacher.exams.marks"),{exam:l.filters.exam,class:l.filters.class,subject:e},{preserveState:!0,preserveScroll:!0,replace:!0})},b=v(null),g=v(""),V=async s=>{if(!j.value)return;g.value="";const e=y[String(s)]??"",a=e===""?null:Number(e);if(a!==null&&(!Number.isInteger(a)||a<0||a>100)){g.value="Marks must be a whole number between 0 and 100.";return}b.value=String(s);const p={exam_id:Number(l.filters.exam),class_id:Number(l.filters.class),subject_id:Number(l.filters.subject),student_id:Number(s),marks:a};try{const f=await fetch(route("teacher.exams.marks.save-cell"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":I(),Accept:"application/json"},body:JSON.stringify(p)});if(!f.ok){const O=await f.text();throw new Error(O||"Failed to save")}await f.json()}catch{g.value="Failed to save marks. Please try again."}finally{b.value=null}},L=s=>{const e="h-9 w-24 rounded-md border-gray-300 text-sm focus:border-emerald-500 focus:ring-emerald-500";return b.value===String(s)?e+" opacity-60":e};return(s,e)=>(n(),r(x,null,[C(K(P),{title:"Enter Marks"}),C(G,null,{header:E(()=>[...e[0]||(e[0]=[t("div",null,[t("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"},"Enter Marks"),t("p",{class:"mt-1 text-sm text-gray-500"},"You can enter marks for your subject only.")],-1)])]),default:E(()=>[t("div",J,[t("div",R,[t("div",X,[t("div",Y,[e[1]||(e[1]=t("span",{class:"font-semibold text-gray-800"},"Selected:",-1)),t("span",H,o(d.value&&S.value[d.value]||"—"),1),e[2]||(e[2]=t("span",{class:"mx-1"},"/",-1)),t("span",null,o(i.value&&w.value[i.value]||"—"),1),e[3]||(e[3]=t("span",{class:"mx-1"},"/",-1)),t("span",null,o(m.value&&_.value[m.value]||"—"),1)])]),t("div",W,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-xs font-semibold text-gray-700"},"Exam",-1)),t("select",{class:"mt-1 block w-full rounded-md border-gray-300 bg-white text-sm shadow-sm focus:border-emerald-500 focus:ring-emerald-500",value:d.value,onChange:$},[e[4]||(e[4]=t("option",{value:""},"Select exam",-1)),(n(!0),r(x,null,h(u.exams,a=>(n(),r("option",{key:a.id,value:a.id},o(a.name)+o(a.academic_year?` (${a.academic_year})`:""),9,ee))),128))],40,Z)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs font-semibold text-gray-700"},"Class",-1)),t("select",{class:"mt-1 block w-full rounded-md border-gray-300 bg-white text-sm shadow-sm focus:border-emerald-500 focus:ring-emerald-500 disabled:bg-gray-50",disabled:!d.value,value:i.value,onChange:F},[e[6]||(e[6]=t("option",{value:""},"Select class",-1)),(n(!0),r(x,null,h(u.classes,a=>(n(),r("option",{key:a.id,value:a.id},o(a.name),9,se))),128))],40,te)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-xs font-semibold text-gray-700"},"Subject",-1)),t("select",{class:"mt-1 block w-full rounded-md border-gray-300 bg-white text-sm shadow-sm focus:border-emerald-500 focus:ring-emerald-500 disabled:bg-gray-50",disabled:!d.value||!i.value,value:m.value,onChange:T},[e[8]||(e[8]=t("option",{value:""},"Select subject",-1)),(n(!0),r(x,null,h(u.subjects,a=>(n(),r("option",{key:a.id,value:a.id},o(a.code),9,le))),128))],40,ae)])]),g.value?(n(),r("div",re,o(g.value),1)):N("",!0)]),j.value?(n(),r("div",oe,[t("div",de,[t("table",ue,[e[11]||(e[11]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Exam #"),t("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Student"),t("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Stream"),t("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Marks")])],-1)),t("tbody",ie,[!u.students||u.students.length===0?(n(),r("tr",ce,[...e[10]||(e[10]=[t("td",{colspan:"4",class:"px-5 py-6 text-center text-sm text-gray-500"}," No students found in this class. ",-1)])])):N("",!0),(n(!0),r(x,null,h(u.students,a=>(n(),r("tr",{key:a.id,class:"hover:bg-gray-50"},[t("td",me,o(a.exam_number),1),t("td",ge,o(a.full_name),1),t("td",ve,o(a.stream||"—"),1),t("td",xe,[U(t("input",{class:q(L(a.id)),inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":p=>y[String(a.id)]=p,disabled:b.value===String(a.id),onBlur:p=>V(a.id)},null,42,ye),[[z,y[String(a.id)]]])])]))),128))])])])])):(n(),r("div",ne," Select Exam, Class and Subject to start entering marks. "))])]),_:1})],64))}};export{he as default};

import{i as c,y as B,j as G,c as o,a as N,u as n,h as D,w as U,b as e,d as i,o as a,F as b,r as _,t as d,f as j,k as p,v as g,p as H}from"./app-QwzqcD60.js";import{_ as E}from"./AuthenticatedLayout-CjLxhKVI.js";import"./ApplicationLogo-H9yvCvIP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"space-y-4"},q={class:"overflow-x-auto rounded-xl bg-white p-4 shadow-sm ring-1 ring-gray-100"},I={class:"min-w-full border-collapse text-left text-[11px]"},P={key:0},J={class:"px-3 py-2 align-top"},K={class:"px-3 py-2 align-top"},O={class:"px-3 py-2 align-top"},Q={class:"px-3 py-2 align-top"},W={class:"px-3 py-2 align-top"},X={class:"px-3 py-2 align-top text-right"},Y={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6 backdrop-blur-sm"},Z={class:"w-full max-w-xl rounded-2xl bg-white p-5 text-xs text-gray-700 shadow-2xl"},ee={class:"mb-3 flex items-start justify-between gap-4 border-b border-gray-100 pb-3"},te={class:"mt-1 text-[11px] text-gray-500"},se={key:0},le={key:1},oe={class:"space-y-3"},ae={key:0},ne={class:"relative mt-1"},de={key:0,class:"absolute z-10 mt-1 max-h-40 w-full overflow-auto rounded-md border border-gray-200 bg-white text-[11px] shadow-lg"},re=["onClick"],ie={class:"font-semibold"},ue={key:0,class:"ml-1 text-[10px] text-gray-500"},pe={class:"text-[10px] text-gray-500"},xe={key:1,class:"mt-1 text-[10px] text-gray-400"},me={key:0,class:"mt-2 text-[11px] text-gray-700"},ce={class:"ml-1 font-semibold text-gray-900"},ge={key:0,class:"ml-1 text-[10px] text-gray-500"},ye={key:1,class:"ml-2 text-[10px] text-gray-500"},be={key:1,class:"space-y-3"},fe={class:"rounded-md bg-emerald-50 px-3 py-2 text-[11px] text-emerald-800"},ve={key:0,class:"ml-1 text-[10px] text-emerald-700"},he={class:"grid gap-3 md:grid-cols-2"},_e={class:"grid gap-3 md:grid-cols-2"},we=["value"],ke=["value"],Se={class:"grid gap-3 md:grid-cols-2"},Ae={class:"mt-4 flex justify-end gap-2 text-[11px]"},Ce=["disabled"],Ve=["disabled"],Fe={__name:"HostelAllocations",props:{allocations:{type:Array,default:()=>[]},hostels:{type:Array,default:()=>[]},rooms:{type:Array,default:()=>[]}},setup(f){const F=f,v=c(!1),x=c(1),y=c(""),m=c([]),w=c(!1),r=c(null),l=B({student_id:"",hostel_id:"",hostel_room_id:"",fee_amount:0,guardian_name:"",guardian_phone:"",guardian_relationship:"",notes:""}),M=G(()=>l.hostel_id?F.rooms.filter(u=>String(u.hostel_id)===String(l.hostel_id)):[]),T=()=>{v.value=!0,x.value=1,y.value="",m.value=[],r.value=null,l.reset()},S=()=>{v.value=!1},R=async()=>{const u=y.value.trim();if(u.length<2){m.value=[];return}w.value=!0;try{const t=await window.axios.get(route("hostel-students.search"),{params:{q:u}});m.value=t.data||[]}catch{m.value=[]}finally{w.value=!1}},$=u=>{r.value=u,l.student_id=u.id,y.value=`${u.full_name} (${u.exam_number||""})`,m.value=[]},z=()=>{l.post(route("hostel-allocations.store"),{preserveScroll:!0,onSuccess:()=>{v.value=!1,l.reset()}})};return(u,t)=>(a(),o(b,null,[N(n(D),{title:"Hostel Allocations"}),N(E,null,{header:U(()=>[e("div",{class:"flex flex-wrap items-center justify-between gap-3"},[t[9]||(t[9]=e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Allocations "),e("p",{class:"mt-1 text-sm text-gray-500"}," See which students are allocated to which hostel rooms and beds. ")],-1)),e("div",{class:"flex flex-wrap items-center gap-2 text-xs"},[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700",onClick:T}," + Add Student in Hostel ")])])]),default:U(()=>{var A,C;return[e("div",L,[e("div",q,[e("table",I,[t[12]||(t[12]=e("thead",null,[e("tr",{class:"border-b border-gray-200 bg-gray-50 text-[11px] font-semibold uppercase tracking-wide text-gray-500"},[e("th",{class:"px-3 py-2"},"#"),e("th",{class:"px-3 py-2"},"Student"),e("th",{class:"px-3 py-2"},"Class"),e("th",{class:"px-3 py-2"},"Hostel"),e("th",{class:"px-3 py-2"},"Room"),e("th",{class:"px-3 py-2 text-right"},"Fee"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[f.allocations.length?i("",!0):(a(),o("tr",P,[...t[10]||(t[10]=[e("td",{colspan:"7",class:"px-3 py-6 text-center text-[11px] text-gray-400"}," No hostel allocations yet. ",-1)])])),(a(!0),o(b,null,_(f.allocations,(s,k)=>{var h,V;return a(),o("tr",{key:s.id||k,class:"border-b border-gray-100 text-[11px] text-gray-700 hover:bg-gray-50"},[e("td",J,d(k+1),1),e("td",K,d(s.student_name||"-"),1),e("td",O,d(s.class_name||"-"),1),e("td",Q,d(s.hostel_name||"-"),1),e("td",W,d(s.room_name||"-"),1),e("td",X,"TSh "+d(((V=(h=s.fee_amount)==null?void 0:h.toLocaleString)==null?void 0:V.call(h))??s.fee_amount),1),t[11]||(t[11]=e("td",{class:"px-3 py-2 align-top text-right"},[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-white px-2 py-1 text-[10px] font-semibold text-indigo-600 ring-1 ring-indigo-200 hover:bg-indigo-50"}," Preview ")],-1))])}),128))])])])]),v.value?(a(),o("div",Y,[e("div",Z,[e("div",ee,[e("div",null,[t[13]||(t[13]=e("h3",{class:"text-sm font-semibold text-emerald-800"}," Add Student in Hostel ",-1)),e("p",te,[j(" Step "+d(x.value)+" of 2 — ",1),x.value===1?(a(),o("span",se,"Search and select the student from your school.")):(a(),o("span",le,"Fill guardian details, choose hostel and set hostel fee."))])]),e("button",{type:"button",class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-gray-100 text-[11px] font-bold text-gray-600 hover:bg-gray-200",onClick:S}," × ")]),e("div",oe,[x.value===1?(a(),o("div",ae,[t[15]||(t[15]=e("label",{class:"text-[11px] font-medium text-emerald-700"},"Search student",-1)),e("div",ne,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),onInput:R,type:"text",class:"w-full rounded-md border border-gray-300 px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"Type name or exam number"},null,544),[[g,y.value]]),m.value.length?(a(),o("div",de,[(a(!0),o(b,null,_(m.value,s=>(a(),o("button",{key:s.id,type:"button",class:"flex w-full items-start justify-between px-3 py-1.5 text-left hover:bg-emerald-50",onClick:k=>$(s)},[e("span",null,[e("span",ie,d(s.full_name),1),s.exam_number?(a(),o("span",ue,"("+d(s.exam_number)+")",1)):i("",!0)]),e("span",pe,d(s.class_level)+" "+d(s.stream),1)],8,re))),128))])):i("",!0),w.value?(a(),o("p",xe," Searching... ")):i("",!0)]),r.value?(a(),o("p",me,[t[14]||(t[14]=e("span",{class:"font-semibold"},"Selected student:",-1)),e("span",ce,d(r.value.full_name),1),r.value.exam_number?(a(),o("span",ge,"("+d(r.value.exam_number)+")",1)):i("",!0),r.value.class_level?(a(),o("span",ye," Class: "+d(r.value.class_level)+" "+d(r.value.stream),1)):i("",!0)])):i("",!0)])):i("",!0),x.value===2?(a(),o("div",be,[e("div",fe,[t[16]||(t[16]=e("p",{class:"font-semibold"},"Student:",-1)),e("p",null,[j(d((A=r.value)==null?void 0:A.full_name)+" ",1),(C=r.value)!=null&&C.class_level?(a(),o("span",ve," ("+d(r.value.class_level)+" "+d(r.value.stream)+") ",1)):i("",!0)])]),e("div",he,[e("div",null,[t[17]||(t[17]=e("label",{class:"text-[11px] font-medium text-gray-600"},"Guardian name",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n(l).guardian_name=s),type:"text",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[g,n(l).guardian_name]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"text-[11px] font-medium text-gray-600"},"Guardian phone",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n(l).guardian_phone=s),type:"text",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. 07xx xxx xxx"},null,512),[[g,n(l).guardian_phone]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"text-[11px] font-medium text-gray-600"},"Relationship",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n(l).guardian_relationship=s),type:"text",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Mother, Father, Guardian"},null,512),[[g,n(l).guardian_relationship]])])]),e("div",_e,[e("div",null,[t[21]||(t[21]=e("label",{class:"text-[11px] font-medium text-emerald-700"},"Hostel",-1)),p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n(l).hostel_id=s),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[t[20]||(t[20]=e("option",{value:"",disabled:""},"Select hostel",-1)),(a(!0),o(b,null,_(f.hostels,s=>(a(),o("option",{key:s.id,value:String(s.id)},d(s.name)+" ("+d(s.type)+") ",9,we))),128))],512),[[H,n(l).hostel_id]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"text-[11px] font-medium text-emerald-700"},"Room (optional)",-1)),p(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>n(l).hostel_room_id=s),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[t[22]||(t[22]=e("option",{value:""},"No specific room",-1)),(a(!0),o(b,null,_(M.value,s=>(a(),o("option",{key:s.id,value:String(s.id)},d(s.name),9,ke))),128))],512),[[H,n(l).hostel_room_id]])])]),e("div",Se,[e("div",null,[t[24]||(t[24]=e("label",{class:"text-[11px] font-medium text-gray-600"},"Hostel fee (TSh)",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>n(l).fee_amount=s),type:"number",min:"0",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[g,n(l).fee_amount,void 0,{number:!0}]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"text-[11px] font-medium text-gray-600"},"Notes (optional)",-1)),p(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=s=>n(l).notes=s),rows:"2",class:"mt-1 w-full resize-none rounded-md border border-gray-300 px-3 py-1.5 text-[11px] text-gray-800 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"Extra info e.g. special needs, payment plan, etc."},null,512),[[g,n(l).notes]])])])])):i("",!0)]),e("div",Ae,[e("button",{type:"button",class:"rounded-md bg-gray-50 px-3 py-1.5 font-medium text-gray-700 ring-1 ring-gray-200 hover:bg-gray-100",onClick:S}," Cancel "),x.value===1?(a(),o("button",{key:0,type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:!r.value||n(l).processing,onClick:t[8]||(t[8]=s=>x.value=2)}," Next ",8,Ce)):(a(),o("button",{key:1,type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:n(l).processing||!n(l).student_id||!n(l).hostel_id||!n(l).guardian_name||!n(l).guardian_phone||!n(l).fee_amount,onClick:z}," Save allocation ",8,Ve))])])])):i("",!0)]}),_:1})],64))}};export{Fe as default};

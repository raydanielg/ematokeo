import{j as v,i as L,c as i,a as O,u as F,h as z,w as U,b as e,d as m,o as r,F as g,r as _,t as d,k as E,p as M,f as C,s as R,m as I}from"./app-Bv3pXQiw.js";import{_ as H}from"./AuthenticatedLayout-Bs3ktz0D.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"space-y-6"},Q={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},W={class:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"},q={class:"mt-2 flex flex-wrap gap-2"},G={key:0,class:"text-sm text-gray-500"},K={class:"flex flex-wrap items-end gap-3"},X=["value"],Z={key:0,value:null},ee=["value"],te={class:"text-xs text-gray-500"},se={class:"font-semibold text-gray-800"},ae={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},le={class:"flex flex-wrap items-start justify-between gap-3"},ie={class:"mt-1 text-xs text-gray-500"},re={class:"font-semibold text-gray-800"},ne={key:0},oe={class:"font-semibold text-gray-800"},de={class:"flex gap-2"},ue=["disabled"],ce=["disabled"],me={class:"mt-4 overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-100 text-left text-sm"},ye={class:"divide-y divide-gray-100"},ge={key:0},xe={class:"px-4 py-2 font-semibold text-gray-900"},be={class:"px-4 py-2 text-gray-700"},fe={class:"px-4 py-2 text-gray-700"},ve={class:"px-4 py-2 text-gray-700"},_e={class:"px-4 py-2 font-semibold text-emerald-800"},he={class:"overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-100"},ke={class:"overflow-x-auto"},we={class:"min-w-full divide-y divide-gray-100 text-left text-sm"},Ce={class:"divide-y divide-gray-100"},Se={key:0},Ae={class:"px-5 py-3 font-medium text-gray-900"},Ne={class:"px-5 py-3 text-gray-700"},Te={class:"px-5 py-3 text-gray-700"},je={key:0},$e={key:1},De={key:2},Le={class:"px-5 py-3"},Oe={class:"flex justify-end gap-2"},Ue=["onClick"],Ee=["onClick"],Me=["disabled","onClick"],Be={__name:"MyTimetable",props:{timetables:{type:Array,default:()=>[]},assignedClasses:{type:Array,default:()=>[]},teacherInitials:{type:String,default:""}},setup(x){const p=x;v(()=>Array.isArray(p.timetables)?p.timetables.length:0);const h=a=>String(a||"").trim().toUpperCase(),S=L("ALL"),A=L(null),P=v(()=>(Array.isArray(p.assignedClasses)?p.assignedClasses:[]).map(l=>String(l||"").trim()).filter(Boolean)),y=v(()=>{const a=Array.isArray(p.timetables)?p.timetables:[],t=h(S.value);return!t||t==="ALL"?a:a.filter(l=>h(l==null?void 0:l.class_name).includes(t))}),c=v(()=>{const a=Number(A.value||0)||null,t=y.value;return a?t.find(l=>Number((l==null?void 0:l.id)||0)===a)||(t==null?void 0:t[0])||null:(t==null?void 0:t[0])||null}),V=a=>({0:"08:00 - 08:40",1:"08:40 - 09:20",2:"09:20 - 10:00",3:"10:00 - 10:40",4:"11:05 - 11:45",5:"11:45 - 12:25",6:"12:25 - 01:05",7:"01:20 - 02:00",8:"02:00 - 02:40"})[a]||`Slot ${Number(a)+1}`,T=v(()=>{const a=c.value,t=h(p.teacherInitials);if(!a||!a.schedule_json||!t)return[];let l=a.schedule_json;if(typeof l=="string")try{l=JSON.parse(l)}catch{l=null}if(!l||typeof l!="object")return[];const b=[];Object.keys(l).forEach(s=>{(Array.isArray(l[s])?l[s]:[]).forEach(o=>{const k=String((o==null?void 0:o.class_label)||(o==null?void 0:o.form)||"").trim(),w=String((o==null?void 0:o.stream)||"").trim();(Array.isArray(o==null?void 0:o.slots)?o.slots:[]).forEach((u,Y)=>{if(!u||typeof u!="object")return;const D=String((u==null?void 0:u.teacher_initials)||(u==null?void 0:u.teacher)||"").trim();!D||!D.split("/").map(B=>h(B)).filter(Boolean).includes(t)||b.push({day:String(s||"").toUpperCase(),class_label:k,stream:w,subject:String((u==null?void 0:u.subject)||"").trim(),slot_index:Number(Y)||0})})})});const f={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5};return b.sort((s,n)=>{const o=f[String(s.day||"").toUpperCase()]||99,k=f[String(n.day||"").toUpperCase()]||99;if(o!==k)return o-k;const w=String(s.class_label||"").localeCompare(String(n.class_label||""));if(w!==0)return w;const N=String(s.stream||"").localeCompare(String(n.stream||""));return N!==0?N:Number(s.slot_index||0)-Number(n.slot_index||0)})}),j=a=>{I.get(route("timetables.show",a))},$=a=>{I.get(route("timetables.periods",a))};return(a,t)=>(r(),i(g,null,[O(F(z),{title:"My Timetable"}),O(H,null,{header:U(()=>[...t[4]||(t[4]=[e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"},"My Timetable"),e("p",{class:"mt-1 text-sm text-gray-500"}," Open a saved timetable and view only your own periods automatically. ")],-1)])]),default:U(()=>{var l,b,f;return[e("div",J,[e("div",Q,[e("div",W,[e("div",null,[t[5]||(t[5]=e("div",{class:"text-sm font-semibold text-gray-800"},"Assigned classes",-1)),e("div",q,[(r(!0),i(g,null,_(x.assignedClasses,s=>(r(),i("span",{key:s,class:"inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-100"},d(s),1))),128)),!x.assignedClasses||x.assignedClasses.length===0?(r(),i("span",G,"—")):m("",!0)])]),e("div",K,[e("div",null,[t[7]||(t[7]=e("div",{class:"mb-1 text-[11px] font-semibold text-gray-700"},"Filter class",-1)),E(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>S.value=s),class:"w-56 rounded-md border border-gray-300 bg-white px-2 py-1 text-[11px] text-gray-800 focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[t[6]||(t[6]=e("option",{value:"ALL"},"All my classes",-1)),(r(!0),i(g,null,_(P.value,s=>(r(),i("option",{key:s,value:s},d(s),9,X))),128))],512),[[M,S.value]])]),e("div",null,[t[8]||(t[8]=e("div",{class:"mb-1 text-[11px] font-semibold text-gray-700"},"Filter timetable",-1)),E(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>A.value=s),class:"w-64 rounded-md border border-gray-300 bg-white px-2 py-1 text-[11px] text-gray-800 focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[y.value.length?m("",!0):(r(),i("option",Z,"No timetables")),(r(!0),i(g,null,_(y.value,s=>(r(),i("option",{key:s.id,value:s.id},d(s.title),9,ee))),128))],512),[[M,A.value]])]),e("div",te,[t[9]||(t[9]=C(" Showing ",-1)),e("span",se,d(y.value.length),1),t[10]||(t[10]=C(" timetable(s) ",-1))])])])]),e("div",ae,[e("div",le,[e("div",null,[t[13]||(t[13]=e("div",{class:"text-sm font-semibold text-gray-800"},"Quick preview (my periods)",-1)),e("div",ie,[t[12]||(t[12]=C(" Initials: ",-1)),e("span",re,d(x.teacherInitials||"—"),1),(l=c.value)!=null&&l.title?(r(),i("span",ne,[t[11]||(t[11]=C(" · Timetable: ",-1)),e("span",oe,d(c.value.title),1)])):m("",!0)])]),e("div",de,[e("button",{type:"button",class:"rounded-md bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",disabled:!((b=c.value)!=null&&b.id),onClick:t[2]||(t[2]=s=>{var n;return((n=c.value)==null?void 0:n.id)&&$(c.value.id)})}," Open My Periods ",8,ue),e("button",{type:"button",class:"rounded-md bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",disabled:!((f=c.value)!=null&&f.id),onClick:t[3]||(t[3]=s=>{var n;return((n=c.value)==null?void 0:n.id)&&j(c.value.id)})}," Open Timetable ",8,ce)])]),e("div",me,[e("table",pe,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Day"),e("th",{class:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Class"),e("th",{class:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Stream"),e("th",{class:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Time"),e("th",{class:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Subject")])],-1)),e("tbody",ye,[T.value.length?m("",!0):(r(),i("tr",ge,[...t[14]||(t[14]=[e("td",{colspan:"5",class:"px-4 py-5 text-center text-sm text-gray-500"}," No periods found for your initials in the selected timetable. ",-1)])])),(r(!0),i(g,null,_(T.value,(s,n)=>(r(),i("tr",{key:`${s.day}-${s.class_label}-${s.stream}-${s.slot_index}-${n}`,class:"hover:bg-gray-50"},[e("td",xe,d(s.day),1),e("td",be,d(s.class_label||"—"),1),e("td",fe,d(s.stream||"—"),1),e("td",ve,d(V(s.slot_index)),1),e("td",_e,d(s.subject||"—"),1)]))),128))])])])]),e("div",he,[e("div",ke,[e("table",we,[t[17]||(t[17]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Title"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Class"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Year / Term"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600 text-right"},"Actions")])],-1)),e("tbody",Ce,[!y.value||y.value.length===0?(r(),i("tr",Se,[...t[16]||(t[16]=[e("td",{colspan:"4",class:"px-5 py-6 text-center text-sm text-gray-500"}," No saved timetables found yet. Ask the admin to generate and save a timetable. ",-1)])])):m("",!0),(r(!0),i(g,null,_(y.value,s=>(r(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Ae,d(s.title),1),e("td",Ne,d(s.class_name||"—"),1),e("td",Te,[s.academic_year?(r(),i("span",je,d(s.academic_year),1)):m("",!0),s.term?(r(),i("span",$e," • "+d(s.term),1)):m("",!0),!s.academic_year&&!s.term?(r(),i("span",De,"—")):m("",!0)]),e("td",Le,[e("div",Oe,[e("button",{type:"button",class:"rounded-md bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",onClick:n=>j(s.id)}," Preview ",8,Ue),e("button",{type:"button",class:"rounded-md bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:n=>$(s.id)}," My Periods ",8,Ee),e("button",{type:"button",disabled:!s.file_path,class:R(["rounded-md px-3 py-1.5 text-xs font-semibold ring-1",s.file_path?"bg-emerald-50 text-emerald-700 ring-emerald-100 hover:bg-emerald-100":"bg-gray-50 text-gray-400 ring-gray-100 cursor-not-allowed"]),onClick:n=>s.file_path&&a.window.open(a.route("timetables.download",s.id),"_blank")}," Download ",10,Me)])])]))),128))])])])])])]}),_:1})],64))}};export{Be as default};

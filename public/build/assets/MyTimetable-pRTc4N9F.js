import{j as A,i as U,I as z,c as r,a as Y,u as H,h as W,w as I,b as e,d as b,o as a,F as u,r as m,t as d,k as B,p as O,f as _,s as J,m as M}from"./app-C9RUFQHJ.js";import{_ as Q}from"./AuthenticatedLayout-Bh1xxpYm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"space-y-6"},G={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},X={class:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"},Z={class:"mt-2 flex flex-wrap gap-2"},ee={key:0,class:"text-sm text-gray-500"},te={class:"w-full sm:w-auto sm:min-w-[560px]"},se={class:"grid gap-3 sm:grid-cols-3 sm:items-end"},le={class:"sm:col-span-1"},re=["value"],ae={class:"sm:col-span-2"},ne={key:0,value:null},oe=["value"],ie={class:"text-xs text-gray-500 sm:col-span-3 sm:text-right"},de={class:"font-semibold text-gray-800"},ue={class:"rounded-lg bg-white p-5 shadow-sm ring-1 ring-gray-100"},ce={class:"flex flex-wrap items-start justify-between gap-3"},be={class:"mt-1 text-xs text-gray-500"},me={class:"font-semibold text-gray-800"},pe={key:0},xe={class:"font-semibold text-gray-800"},ge={class:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row"},ye=["disabled"],fe=["disabled"],ve={class:"mt-4 -mx-5 overflow-x-auto px-5"},he={class:"min-w-[980px] border-collapse text-[10px] sm:min-w-full sm:text-[11px] text-gray-800"},_e={key:0},ke={class:"border border-slate-200 bg-sky-50 px-2 py-2 text-left font-semibold"},we={class:"font-semibold text-emerald-900"},Ae={class:"text-[10px] text-gray-700"},Ce={key:0},Se={class:"font-semibold text-indigo-900"},Ne={class:"text-[10px] text-gray-700"},$e={key:0},De={class:"font-semibold text-indigo-900"},Te={class:"text-[10px] text-gray-700"},je={key:0},Ee={class:"overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-100"},Le={class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-100 text-left text-sm"},Ye={class:"divide-y divide-gray-100"},Ie={key:0},Be={class:"px-5 py-3 font-medium text-gray-900"},Oe={class:"px-5 py-3 text-gray-700"},Me={class:"px-5 py-3 text-gray-700"},Re={key:0},Fe={key:1},Pe={key:2},Ve={class:"px-5 py-3"},Ke={class:"flex justify-end gap-2"},ze=["onClick"],He=["onClick"],We=["disabled","onClick"],Xe={__name:"MyTimetable",props:{timetables:{type:Array,default:()=>[]},assignedClasses:{type:Array,default:()=>[]},teacherInitials:{type:String,default:""}},setup(C){const f=C;A(()=>Array.isArray(f.timetables)?f.timetables.length:0);const k=n=>String(n||"").trim().toUpperCase(),w=U("ALL"),v=U(null),R=A(()=>(Array.isArray(f.assignedClasses)?f.assignedClasses:[]).map(o=>String(o||"").trim()).filter(Boolean)),x=A(()=>{const n=Array.isArray(f.timetables)?f.timetables:[],t=k(w.value);return!t||t==="ALL"?n:n.filter(o=>k(o==null?void 0:o.class_name).includes(t))});z([w,x],()=>{const n=x.value||[],t=Number(v.value||0)||null;if(!n.length){v.value=null;return}(!t||!n.some(o=>Number((o==null?void 0:o.id)||0)===t))&&(v.value=n[0].id)},{immediate:!0});const F=()=>{w.value="ALL",v.value=null},g=A(()=>{const n=Number(v.value||0)||null,t=x.value;return n?t.find(o=>Number((o==null?void 0:o.id)||0)===n)||(t==null?void 0:t[0])||null:(t==null?void 0:t[0])||null}),P=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],D=A(()=>{const n=g.value,t=k(f.teacherInitials);if(!n||!n.schedule_json||!t)return[];let o=n.schedule_json;if(typeof o=="string")try{o=JSON.parse(o)}catch{o=null}if(!o||typeof o!="object")return[];const h=[];Object.keys(o).forEach(s=>{(Array.isArray(o[s])?o[s]:[]).forEach(l=>{const p=String((l==null?void 0:l.class_label)||(l==null?void 0:l.form)||"").trim(),S=String((l==null?void 0:l.stream)||"").trim();(Array.isArray(l==null?void 0:l.slots)?l.slots:[]).forEach((c,V)=>{if(!c||typeof c!="object")return;const L=String((c==null?void 0:c.teacher_initials)||(c==null?void 0:c.teacher)||"").trim();!L||!L.split("/").map(K=>k(K)).filter(Boolean).includes(t)||h.push({day:String(s||"").toUpperCase(),class_label:p,stream:S,subject:String((c==null?void 0:c.subject)||"").trim(),slot_index:Number(V)||0})})})});const y={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5};return h.sort((s,i)=>{const l=y[String(s.day||"").toUpperCase()]||99,p=y[String(i.day||"").toUpperCase()]||99;if(l!==p)return l-p;const S=String(s.class_label||"").localeCompare(String(i.class_label||""));if(S!==0)return S;const $=String(s.stream||"").localeCompare(String(i.stream||""));return $!==0?$:Number(s.slot_index||0)-Number(i.slot_index||0)})}),T=A(()=>{const n=k(w.value);return!n||n==="ALL"?D.value:D.value.filter(t=>k(t==null?void 0:t.class_label).includes(n))}),N=(n,t)=>{const o=String(n||"").toUpperCase(),h=Number(t);return T.value.filter(y=>String(y.day||"").toUpperCase()===o&&Number(y.slot_index)===h)},j=n=>{M.get(route("timetables.show",n))},E=n=>{M.get(route("timetables.periods",n))};return(n,t)=>(a(),r(u,null,[Y(H(W),{title:"My Timetable"}),Y(Q,null,{header:I(()=>[...t[4]||(t[4]=[e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"},"My Timetable"),e("p",{class:"mt-1 text-sm text-gray-500"}," Open a saved timetable and view only your own periods automatically. ")],-1)])]),default:I(()=>{var o,h,y;return[e("div",q,[e("div",G,[e("div",X,[e("div",null,[t[5]||(t[5]=e("div",{class:"text-sm font-semibold text-gray-800"},"Assigned classes",-1)),e("div",Z,[(a(!0),r(u,null,m(C.assignedClasses,s=>(a(),r("span",{key:s,class:"inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-100"},d(s),1))),128)),!C.assignedClasses||C.assignedClasses.length===0?(a(),r("span",ee,"—")):b("",!0)])]),e("div",te,[e("div",{class:"mb-2 flex items-center justify-between gap-2"},[t[6]||(t[6]=e("div",null,[e("div",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"Filters"),e("div",{class:"text-[11px] text-gray-500"},"Chuja ratiba kwa darasa lako na ratiba iliyochapishwa.")],-1)),e("button",{type:"button",class:"rounded-md bg-white px-3 py-1.5 text-[11px] font-semibold text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50",onClick:F}," Clear ")]),e("div",se,[e("div",le,[t[8]||(t[8]=e("div",{class:"mb-1 text-[11px] font-semibold text-gray-700"},"Class",-1)),B(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s),class:"w-full rounded-md border border-gray-300 bg-white px-2 py-2 text-[11px] text-gray-800 focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[t[7]||(t[7]=e("option",{value:"ALL"},"All my classes",-1)),(a(!0),r(u,null,m(R.value,s=>(a(),r("option",{key:s,value:s},d(s),9,re))),128))],512),[[O,w.value]])]),e("div",ae,[t[9]||(t[9]=e("div",{class:"mb-1 text-[11px] font-semibold text-gray-700"},"Timetable",-1)),B(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),class:"w-full rounded-md border border-gray-300 bg-white px-2 py-2 text-[11px] text-gray-800 focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[x.value.length?b("",!0):(a(),r("option",ne,"No timetables")),(a(!0),r(u,null,m(x.value,s=>(a(),r("option",{key:s.id,value:s.id},d(s.title),9,oe))),128))],512),[[O,v.value]])]),e("div",ie,[t[10]||(t[10]=_(" Showing ",-1)),e("span",de,d(x.value.length),1),t[11]||(t[11]=_(" timetable(s) ",-1))])])])])]),e("div",ue,[e("div",ce,[e("div",null,[t[14]||(t[14]=e("div",{class:"text-sm font-semibold text-gray-800"},"Quick preview (my periods)",-1)),e("div",be,[t[13]||(t[13]=_(" Initials: ",-1)),e("span",me,d(C.teacherInitials||"—"),1),(o=g.value)!=null&&o.title?(a(),r("span",pe,[t[12]||(t[12]=_(" · Timetable: ",-1)),e("span",xe,d(g.value.title),1)])):b("",!0)])]),e("div",ge,[e("button",{type:"button",class:"rounded-md bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",disabled:!((h=g.value)!=null&&h.id),onClick:t[2]||(t[2]=s=>{var i;return((i=g.value)==null?void 0:i.id)&&E(g.value.id)})}," Open My Periods ",8,ye),e("button",{type:"button",class:"rounded-md bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",disabled:!((y=g.value)!=null&&y.id),onClick:t[3]||(t[3]=s=>{var i;return((i=g.value)==null?void 0:i.id)&&j(g.value.id)})}," Open Timetable ",8,fe)])]),e("div",ve,[e("table",he,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",{class:"w-20 border border-slate-200 bg-slate-100 px-2 py-2 text-left"},"Day"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"08:00"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"08:40"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"09:20"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"10:00"),e("th",{class:"border border-slate-200 bg-sky-100 px-2 py-2 text-center"},"BREAK"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"11:05"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"11:45"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"12:25"),e("th",{class:"border border-slate-200 bg-sky-100 px-2 py-2 text-center"},"BREAK"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"01:20"),e("th",{class:"border border-slate-200 bg-slate-100 px-2 py-2 text-center"},"02:00")])],-1)),e("tbody",null,[T.value.length?b("",!0):(a(),r("tr",_e,[...t[15]||(t[15]=[e("td",{colspan:"12",class:"border border-slate-200 px-4 py-6 text-center text-sm text-gray-500"}," No periods found for your initials in the selected timetable. ",-1)])])),(a(),r(u,null,m(P,s=>e("tr",{key:s,class:"hover:bg-gray-50"},[e("td",ke,d(s),1),(a(),r(u,null,m(4,i=>e("td",{key:`am-${s}-${i}`,class:"border border-slate-200 px-2 py-2 align-top"},[(a(!0),r(u,null,m(N(s,i-1),(l,p)=>(a(),r("div",{key:`p-${s}-${i}-${p}`,class:"mb-1 rounded bg-emerald-50 px-2 py-1"},[e("div",we,d(l.subject||"—"),1),e("div",Ae,[_(d(l.class_label)+" ",1),l.stream?(a(),r("span",Ce,"· "+d(l.stream),1)):b("",!0)])]))),128))])),64)),t[16]||(t[16]=e("td",{class:"border border-slate-200 bg-sky-100 px-2 py-2 text-center font-semibold text-sky-900"},"BREAK",-1)),(a(),r(u,null,m(3,i=>e("td",{key:`mid-${s}-${i}`,class:"border border-slate-200 px-2 py-2 align-top"},[(a(!0),r(u,null,m(N(s,3+i),(l,p)=>(a(),r("div",{key:`p-${s}-m-${i}-${p}`,class:"mb-1 rounded bg-indigo-50 px-2 py-1"},[e("div",Se,d(l.subject||"—"),1),e("div",Ne,[_(d(l.class_label)+" ",1),l.stream?(a(),r("span",$e,"· "+d(l.stream),1)):b("",!0)])]))),128))])),64)),t[17]||(t[17]=e("td",{class:"border border-slate-200 bg-sky-100 px-2 py-2 text-center font-semibold text-sky-900"},"BREAK",-1)),(a(),r(u,null,m(2,i=>e("td",{key:`pm-${s}-${i}`,class:"border border-slate-200 px-2 py-2 align-top"},[(a(!0),r(u,null,m(N(s,6+i),(l,p)=>(a(),r("div",{key:`p-${s}-p-${i}-${p}`,class:"mb-1 rounded bg-indigo-50 px-2 py-1"},[e("div",De,d(l.subject||"—"),1),e("div",Te,[_(d(l.class_label)+" ",1),l.stream?(a(),r("span",je,"· "+d(l.stream),1)):b("",!0)])]))),128))])),64))])),64))])])])]),e("div",Ee,[e("div",Le,[e("table",Ue,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Title"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Class"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600"},"Year / Term"),e("th",{class:"px-5 py-3 text-xs font-semibold uppercase tracking-wide text-gray-600 text-right"},"Actions")])],-1)),e("tbody",Ye,[!x.value||x.value.length===0?(a(),r("tr",Ie,[...t[19]||(t[19]=[e("td",{colspan:"4",class:"px-5 py-6 text-center text-sm text-gray-500"}," No saved timetables found yet. Ask the admin to generate and save a timetable. ",-1)])])):b("",!0),(a(!0),r(u,null,m(x.value,s=>(a(),r("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Be,d(s.title),1),e("td",Oe,d(s.class_name||"—"),1),e("td",Me,[s.academic_year?(a(),r("span",Re,d(s.academic_year),1)):b("",!0),s.term?(a(),r("span",Fe," • "+d(s.term),1)):b("",!0),!s.academic_year&&!s.term?(a(),r("span",Pe,"—")):b("",!0)]),e("td",Ve,[e("div",Ke,[e("button",{type:"button",class:"rounded-md bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",onClick:i=>j(s.id)}," Preview ",8,ze),e("button",{type:"button",class:"rounded-md bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:i=>E(s.id)}," My Periods ",8,He),e("button",{type:"button",disabled:!s.file_path,class:J(["rounded-md px-3 py-1.5 text-xs font-semibold ring-1",s.file_path?"bg-emerald-50 text-emerald-700 ring-emerald-100 hover:bg-emerald-100":"bg-gray-50 text-gray-400 ring-gray-100 cursor-not-allowed"]),onClick:i=>s.file_path&&n.window.open(n.route("timetables.download",s.id),"_blank")}," Download ",10,We)])])]))),128))])])])])])]}),_:1})],64))}};export{Xe as default};

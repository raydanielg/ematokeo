import{i as g,j as C,c as l,a as h,u as Z,h as Q,w as _,b as e,o as n,d as p,F as b,r as f,t as a,T as V,f as u,m as $}from"./app-Df21l2Ix.js";import{_ as j}from"./AuthenticatedLayout-vlQh8Mn4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"flex flex-wrap items-center justify-between gap-3"},te={class:"flex flex-wrap items-center gap-3 text-xs"},se={class:"flex items-center gap-2"},ae=["value","selected"],re={class:"flex items-center gap-2"},le=["value","selected"],ne={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},oe={key:0,class:"py-10 text-center text-xs text-gray-400"},de={key:1,class:"overflow-x-auto"},ie={class:"min-w-full border-collapse text-[11px]"},xe={key:0},ue={class:"px-3 py-1.5 align-top text-sm font-medium text-gray-900"},pe={class:"px-3 py-1.5 align-top font-mono"},ce={class:"px-3 py-1.5 align-top"},me=["onClick"],ye={class:"px-3 py-1.5 align-top"},ge={class:"px-3 py-1.5 align-top text-center"},be={class:"px-3 py-1.5 align-top text-center"},fe={class:"px-3 py-1.5 align-top text-center"},ve={class:"px-3 py-1.5 align-top text-center"},he={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-8"},_e={class:"max-h-full w-full max-w-4xl overflow-y-auto rounded-xl bg-white p-6 text-xs text-gray-800 shadow-xl"},ke={class:"border border-gray-200 bg-white p-4",id:"ranking-document"},we={class:"mb-3 text-center"},Se={class:"text-[10px] text-gray-500"},Ce={class:"font-medium"},Ne={key:0},Ee={class:"w-full border-collapse text-[11px]"},Pe={key:0},Me={class:"border border-emerald-100 px-2 py-1 bg-white"},Te={class:"border border-emerald-100 px-2 py-1 bg-white font-mono"},Ae={class:"border border-emerald-100 px-2 py-1 bg-white"},Re=["onClick"],Ye={class:"border border-emerald-100 px-2 py-1 bg-white"},De={class:"border border-emerald-100 px-2 py-1 text-center bg-white"},ze={class:"border border-emerald-100 px-2 py-1 text-center bg-white"},We={class:"border border-emerald-100 px-2 py-1 text-center bg-white"},Oe={class:"border border-emerald-100 px-2 py-1 text-center bg-white"},Fe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8"},Le={class:"max-h-full w-full max-w-3xl overflow-y-auto rounded-xl bg-white p-6 text-xs text-gray-800 shadow-xl"},Ve={key:0,class:"py-10 text-center text-[11px] text-gray-500"},$e={key:1,class:"rounded-md bg-red-50 px-3 py-2 text-[11px] text-red-700 ring-1 ring-red-100"},Be={key:2,class:"space-y-3"},qe={class:"rounded-md bg-gray-50 px-3 py-2 text-[11px] text-gray-700 ring-1 ring-gray-100"},He={class:"font-semibold text-gray-900"},Ue={class:"mt-0.5 text-gray-600"},Xe={class:"font-medium"},Ge={class:"font-medium"},Ie={class:"font-medium"},Je={class:"mt-1 text-gray-600"},Ke={class:"font-semibold"},Ze={class:"font-semibold"},Qe={class:"font-semibold"},je={class:"font-semibold"},et={class:"mt-1 text-[10px] text-gray-500"},tt={class:"font-semibold"},st={class:"font-semibold"},at={key:0,class:"mt-1 text-[10px] text-gray-500"},rt={class:"flex items-center justify-between"},lt={class:"overflow-x-auto"},nt={class:"min-w-full border-collapse text-[11px]"},ot={key:0},dt={class:"px-3 py-1.5 align-top font-mono"},it={class:"px-3 py-1.5 align-top"},xt={class:"px-3 py-1.5 align-top text-center"},ut={key:0},pt={key:1,class:"text-gray-400"},ct={class:"px-3 py-1.5 align-top text-center"},mt={class:"font-semibold"},yt={key:0,class:"ml-1 rounded bg-amber-50 px-1 py-0.5 text-[9px] font-semibold text-amber-700 ring-1 ring-amber-100"},gt={class:"px-3 py-1.5 align-top text-center"},bt={class:"font-semibold"},ft={key:0,class:"ml-1 rounded bg-amber-50 px-1 py-0.5 text-[9px] font-semibold text-amber-700 ring-1 ring-amber-100"},kt={__name:"Ranking",props:{years:{type:Array,default:()=>[]},exams:{type:Array,default:()=>[]},ranking:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({year:null,exam:null})}},setup(i){const k=i,w=g(!1),S=g(!1),v=g(!1),m=g(null),d=g(null),y=g(!1),B=C(()=>{var t;return(((t=d.value)==null?void 0:t.subjects)||[]).filter(s=>s==null?void 0:s.entered).length}),q=C(()=>{var t;return(((t=d.value)==null?void 0:t.subjects)||[]).length}),N=C(()=>{var t;const x=((t=d.value)==null?void 0:t.subjects)||[];return y.value?x:x.filter(s=>s==null?void 0:s.entered)}),H=x=>{const t=x.target.value||null;$.get(route("results.ranking"),{year:t,exam:null},{preserveState:!0,preserveScroll:!0,replace:!0})},U=x=>{const t=x.target.value||null;$.get(route("results.ranking"),{year:k.filters.year,exam:t},{preserveState:!0,preserveScroll:!0,replace:!0})},X=()=>{w.value=!0},G=()=>{w.value=!1},I=()=>{S.value=!1,d.value=null,m.value=null,v.value=!1,y.value=!1},E=async x=>{var t;if(!(!(x!=null&&x.student_id)||!((t=k.filters)!=null&&t.exam))){S.value=!0,v.value=!0,m.value=null,d.value=null,y.value=!1;try{const s=route("results.student-details",{exam:k.filters.exam,student:x.student_id}),o=await fetch(s,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),c=await o.json().catch(()=>null);if(!o.ok){m.value=(c==null?void 0:c.message)||"Failed to load student results.";return}d.value=c}catch{m.value="Failed to load student results."}finally{v.value=!1}}},J=()=>{window.print()};return(x,t)=>(n(),l(b,null,[h(Z(Q),{title:"Ranking"}),h(j,null,{header:_(()=>[e("div",ee,[t[5]||(t[5]=e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Students Ranking "),e("p",{class:"mt-1 text-sm text-gray-500"}," Overall ranking of students based on exam performance. Use filters to select the exam you want to analyse. ")],-1)),e("div",te,[e("div",se,[t[2]||(t[2]=e("label",{class:"text-xs font-medium uppercase tracking-wide text-gray-500"},"Year",-1)),e("select",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",onChange:H},[t[1]||(t[1]=e("option",{value:""},"All Years",-1)),(n(!0),l(b,null,f(i.years,s=>(n(),l("option",{key:s,value:s,selected:i.filters.year===s},a(s),9,ae))),128))],32)]),e("div",re,[t[4]||(t[4]=e("label",{class:"text-xs font-medium uppercase tracking-wide text-gray-500"},"Exam",-1)),e("select",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",onChange:U},[t[3]||(t[3]=e("option",{value:""},"Select Exam",-1)),(n(!0),l(b,null,f(i.exams,s=>(n(),l("option",{key:s.id,value:s.id,selected:String(i.filters.exam)===String(s.id)},a(s.name)+" ("+a(s.academic_year||"—")+") ",9,le))),128))],32)])])])]),default:_(()=>[e("div",ne,[t[8]||(t[8]=e("div",{class:"mb-3 text-xs text-gray-600"},[e("p",{class:"mb-1 font-medium"},"Ranking Summary"),e("p",{class:"text-[11px] text-gray-500"}," The list below shows students ordered by their average marks and points for the selected exam. ")],-1)),e("div",{class:"mb-3 flex items-center justify-end"},[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700",onClick:X}," Preview Document ")]),i.filters.exam?(n(),l("div",de,[e("table",ie,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"bg-gray-50 text-gray-600"},[e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-left"},"Pos"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-left"},"Exam No"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-left"},"Student Name"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-left"},"Class"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"Total"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"Average"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"Division"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"Points")])],-1)),e("tbody",null,[i.filters.exam&&i.ranking.length===0?(n(),l("tr",xe,[...t[6]||(t[6]=[e("td",{colspan:"8",class:"px-3 py-4 text-center text-[11px] text-gray-400"}," No ranking data found for this exam yet. ",-1)])])):p("",!0),(n(!0),l(b,null,f(i.ranking,s=>(n(),l("tr",{key:s.exam_number,class:"border-b border-gray-100 text-gray-700 odd:bg-white even:bg-gray-50"},[e("td",ue,a(s.position),1),e("td",pe,a(s.exam_number),1),e("td",ce,[e("button",{type:"button",class:"text-left font-semibold text-emerald-700 hover:underline",onClick:o=>E(s)},a(s.full_name),9,me)]),e("td",ye,a(s.class_level||"—"),1),e("td",ge,a(s.total??"—"),1),e("td",be,a(s.average??"—"),1),e("td",fe,a(s.division||"—"),1),e("td",ve,a(s.points??"—"),1)]))),128))])])])):(n(),l("div",oe," Please select an exam to view ranking. "))]),h(V,{name:"fade"},{default:_(()=>{var s;return[w.value?(n(),l("div",he,[e("div",_e,[e("div",{class:"mb-4 flex items-center justify-between"},[t[9]||(t[9]=e("div",null,[e("h3",{class:"text-sm font-semibold uppercase tracking-wide text-gray-800"}," Ripoti Ya Orodha Ya Wanafunzi (Ranking) "),e("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Huu ni waraka wa kuchapishwa unaoonyesha orodha ya wanafunzi kwa mpangilio wa ufaulu kwa mtihani uliouchagua. ")],-1)),e("div",{class:"flex items-center gap-2"},[e("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-semibold text-gray-700 hover:bg-gray-200",onClick:G}," Close "),e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700",onClick:J}," Print ")])]),e("div",ke,[e("div",we,[t[11]||(t[11]=e("div",{class:"mb-2 flex justify-center"},[e("img",{src:"/images/emblem.png",alt:"National Emblem",class:"h-10 w-10 object-contain"})],-1)),t[12]||(t[12]=e("div",{class:"leading-tight"},[e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-gray-700"}," Jamhuri Ya Muungano Wa Tanzania "),e("div",{class:"text-[10px] text-gray-700"}," Wizara Ya Elimu, Sayansi Na Teknolojia "),e("div",{class:"mt-0.5 text-[10px] text-gray-500"}," Mfumo Wa Taarifa Za Mitihani Na Matokeo Ya Shule (E-Matokeo) ")],-1)),t[13]||(t[13]=e("div",{class:"mt-3 text-[11px] font-semibold uppercase tracking-wide text-gray-800"}," Orodha Ya Wanafunzi Kwa Mpangilio Wa Ufaulu ",-1)),e("div",Se,[t[10]||(t[10]=u(" Exam: ",-1)),e("span",Ce,a(((s=i.exams.find(o=>String(o.id)===String(i.filters.exam)))==null?void 0:s.name)||"Selected Exam"),1),i.filters.year?(n(),l("span",Ne," • Year: "+a(i.filters.year),1)):p("",!0)])]),e("table",Ee,[t[15]||(t[15]=e("thead",null,[e("tr",{class:"bg-emerald-50 text-emerald-800"},[e("th",{class:"border border-emerald-100 px-2 py-1 text-left"},"Pos"),e("th",{class:"border border-emerald-100 px-2 py-1 text-left"},"Exam No"),e("th",{class:"border border-emerald-100 px-2 py-1 text-left"},"Student Name"),e("th",{class:"border border-emerald-100 px-2 py-1 text-left"},"Class"),e("th",{class:"border border-emerald-100 px-2 py-1 text-center"},"Total"),e("th",{class:"border border-emerald-100 px-2 py-1 text-center"},"Average"),e("th",{class:"border border-emerald-100 px-2 py-1 text-center"},"Division"),e("th",{class:"border border-emerald-100 px-2 py-1 text-center"},"Points")])],-1)),e("tbody",null,[i.ranking.length?p("",!0):(n(),l("tr",Pe,[...t[14]||(t[14]=[e("td",{colspan:"8",class:"border border-gray-200 px-2 py-3 text-center text-[11px] text-gray-400"}," No ranking data available yet for this exam. ",-1)])])),(n(!0),l(b,null,f(i.ranking,o=>(n(),l("tr",{key:o.exam_number,class:"text-gray-700"},[e("td",Me,a(o.position),1),e("td",Te,a(o.exam_number),1),e("td",Ae,[e("button",{type:"button",class:"text-left font-semibold text-emerald-700 hover:underline",onClick:c=>E(o)},a(o.full_name),9,Re)]),e("td",Ye,a(o.class_level||"—"),1),e("td",De,a(o.total??"—"),1),e("td",ze,a(o.average??"—"),1),e("td",We,a(o.division||"—"),1),e("td",Oe,a(o.points??"—"),1)]))),128))])])])])])):p("",!0)]}),_:1}),h(V,{name:"fade"},{default:_(()=>{var s,o,c,P,M,T,A,R,Y;return[S.value?(n(),l("div",Fe,[e("div",Le,[e("div",{class:"mb-4 flex items-center justify-between"},[t[16]||(t[16]=e("div",null,[e("h3",{class:"text-sm font-semibold uppercase tracking-wide text-gray-800"}," Student Results "),e("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Detailed subject results for the selected exam. ")],-1)),e("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-semibold text-gray-700 hover:bg-gray-200",onClick:I}," Close ")]),v.value?(n(),l("div",Ve," Loading student results... ")):m.value?(n(),l("div",$e,a(m.value),1)):d.value?(n(),l("div",Be,[e("div",qe,[e("div",He,a((s=d.value.student)==null?void 0:s.full_name),1),e("div",Ue,[t[17]||(t[17]=u(" Exam No: ",-1)),e("span",Xe,a((o=d.value.student)==null?void 0:o.exam_number),1),t[18]||(t[18]=e("span",{class:"mx-1"},"|",-1)),t[19]||(t[19]=u(" Class: ",-1)),e("span",Ge,a((c=d.value.student)==null?void 0:c.class_level),1),t[20]||(t[20]=e("span",{class:"mx-1"},"|",-1)),t[21]||(t[21]=u(" Sex: ",-1)),e("span",Ie,a(((P=d.value.student)==null?void 0:P.gender)??"—"),1)]),e("div",Je,[t[22]||(t[22]=u(" Total: ",-1)),e("span",Ke,a(((M=d.value.summary)==null?void 0:M.total)??"—"),1),t[23]||(t[23]=e("span",{class:"mx-1"},"|",-1)),t[24]||(t[24]=u(" Avg: ",-1)),e("span",Ze,a(((T=d.value.summary)==null?void 0:T.average)??"—"),1),t[25]||(t[25]=e("span",{class:"mx-1"},"|",-1)),t[26]||(t[26]=u(" Points: ",-1)),e("span",Qe,a(((A=d.value.summary)==null?void 0:A.points)??"—"),1),t[27]||(t[27]=e("span",{class:"mx-1"},"|",-1)),t[28]||(t[28]=u(" Div: ",-1)),e("span",je,a(((R=d.value.summary)==null?void 0:R.division)??"—"),1)]),e("div",et,[t[29]||(t[29]=u(" Entered: ",-1)),e("span",tt,a(B.value),1),t[30]||(t[30]=u("/",-1)),e("span",st,a(q.value),1),t[31]||(t[31]=u(" subjects ",-1))]),((Y=d.value.summary)==null?void 0:Y.points)===null?(n(),l("div",at," Points/Division are based on available captured subjects. If fewer than 7 subjects have marks/points, points total is not shown. ")):p("",!0)]),e("div",rt,[t[32]||(t[32]=e("div",{class:"text-[11px] font-semibold text-gray-700"},"Subjects",-1)),e("button",{type:"button",class:"rounded-md bg-gray-100 px-3 py-1.5 text-[11px] font-semibold text-gray-700 hover:bg-gray-200",onClick:t[0]||(t[0]=r=>y.value=!y.value)},a(y.value?"Show Entered Only":"Show All"),1)]),e("div",lt,[e("table",nt,[t[34]||(t[34]=e("thead",null,[e("tr",{class:"bg-gray-50 text-gray-600"},[e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-left"},"Code"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-left"},"Subject"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"Marks"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"GRD"),e("th",{class:"border-b border-gray-200 px-3 py-1.5 text-center"},"PTS")])],-1)),e("tbody",null,[N.value.length?p("",!0):(n(),l("tr",ot,[...t[33]||(t[33]=[e("td",{colspan:"5",class:"px-3 py-4 text-center text-[11px] text-gray-400"}," No entered subject results found. ",-1)])])),(n(!0),l(b,null,f(N.value,(r,K)=>{var D,z,W,O,F,L;return n(),l("tr",{key:r.code||K,class:"border-b border-gray-100 text-gray-700 odd:bg-white even:bg-gray-50"},[e("td",dt,a(r.code),1),e("td",it,a(r.name),1),e("td",xt,[r.entered?(n(),l("span",ut,a(r.marks??"—"),1)):(n(),l("span",pt,"Not entered"))]),e("td",ct,[e("span",mt,a(r.grade??"—"),1),r.entered&&!((D=r==null?void 0:r.saved)!=null&&D.grade)&&((z=r==null?void 0:r.computed)!=null&&z.grade)?(n(),l("span",yt," calc ")):p("",!0)]),e("td",gt,[e("span",bt,a(r.points??"—"),1),r.entered&&(((W=r==null?void 0:r.saved)==null?void 0:W.points)===null||((O=r==null?void 0:r.saved)==null?void 0:O.points)===void 0)&&((F=r==null?void 0:r.computed)==null?void 0:F.points)!==null&&((L=r==null?void 0:r.computed)==null?void 0:L.points)!==void 0?(n(),l("span",ft," calc ")):p("",!0)])])}),128))])])])])):p("",!0)])])):p("",!0)]}),_:1})]),_:1})],64))}};export{kt as default};

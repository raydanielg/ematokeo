import{i as $,c as g,a as w,u as D,h as q,w as T,b as e,d as _,t as u,o as p,F as N,r as J,s as v,x as W,m as E}from"./app-CPAbp00B.js";import{_ as G}from"./AuthenticatedLayout-kN5sGNvB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"flex items-center justify-between"},Q={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},X={class:"mb-3 flex items-center justify-between gap-3"},Z={class:"text-sm font-medium text-gray-700"},tt={class:"overflow-x-auto"},et={class:"min-w-full text-left text-sm"},st={key:0},nt={class:"px-3 py-2 align-top"},rt={class:"px-3 py-2 align-top"},lt={class:"px-3 py-2 align-top text-xs text-gray-600"},at={key:0},ot={key:1},it={key:2},dt={class:"px-3 py-2 align-top"},ct={class:"flex flex-wrap items-center gap-1"},ut={class:"px-3 py-2 align-top text-xs text-gray-600"},gt={class:"px-3 py-2 align-top"},pt={class:"flex justify-end gap-2"},ft=["onClick"],xt=["onClick"],mt=["disabled","onClick"],bt=["onClick"],ht={class:"flex h-[85vh] w-full max-w-5xl flex-col overflow-hidden rounded-xl bg-white shadow-xl"},yt={class:"flex items-center justify-between border-b border-gray-100 px-4 py-3"},_t={class:"min-w-0"},vt={class:"truncate text-sm font-semibold text-gray-800"},kt={class:"mt-0.5 text-[11px] text-gray-500"},Ft={class:"flex items-center gap-2"},Et=["disabled"],St={class:"flex-1 bg-gray-50"},Ct={key:0,class:"p-6 text-center text-xs text-gray-500"},Dt={key:1,class:"p-6 text-center text-xs text-gray-600"},At=["src"],wt={__name:"Timetables",props:{timetables:{type:Array,default:()=>[]}},setup(S){const k=$(!1),c=$(null),U=s=>{c.value=s||null,k.value=!0},Y=s=>{confirm("Delete this timetable?")&&E.delete(route("timetables.destroy",s))},B=s=>{E.post(route("timetables.publish",s))},L=s=>{if(!s)return"-";const t=new Date(s);return Number.isNaN(t.getTime())?String(s):t.toLocaleString()},h=s=>{const t=s==null?void 0:s.schedule_json;return t?Array.isArray(t)?t.length>0:typeof t=="object"?Object.keys(t).length>0:!1:!1},z=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],A=["P1","P2","P3","P4","P5","P6","P7","P8","P9"],O=s=>{try{let t=s;if(!t)return{};if(typeof t=="string"){const l=String(t).trim();if(!l)return{};t=JSON.parse(l)}if(!t||typeof t!="object")return{};const d={};return Object.keys(t).forEach(l=>{const n=Array.isArray(t[l])?t[l]:[];d[l]=n.map(a=>{const r=Array.isArray(a==null?void 0:a.slots)?a.slots:[],f=Array.from({length:9}).map((x,o)=>{const i=r[o];if(i==null)return null;if(typeof i=="string"){const b=String(i||"").trim();return b?{subject:b,teacher_initials:""}:null}if(typeof i=="object"){const b=String((i==null?void 0:i.subject)??"").trim(),F=String((i==null?void 0:i.teacher_initials)??(i==null?void 0:i.teacher)??"").trim();return!b&&!F?null:{subject:b,teacher_initials:F}}return null});return{...a||{},slots:f}})}),d}catch{return{}}},m=s=>String(s??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),R=s=>{const t=String(s||"").trim().toUpperCase();if(!t)return{bg:"#ffffff",fg:"#111827"};const d=[{bg:"#ECFDF5",fg:"#065F46"},{bg:"#EFF6FF",fg:"#1D4ED8"},{bg:"#FEF3C7",fg:"#92400E"},{bg:"#FCE7F3",fg:"#9D174D"},{bg:"#EDE9FE",fg:"#5B21B6"},{bg:"#FFE4E6",fg:"#9F1239"},{bg:"#F1F5F9",fg:"#0F172A"},{bg:"#E0F2FE",fg:"#075985"}];let l=0;for(let a=0;a<t.length;a+=1)l=(l<<5)-l+t.charCodeAt(a),l|=0;const n=Math.abs(l)%d.length;return d[n]},M=s=>{const t=O(s==null?void 0:s.schedule_json),d=String((s==null?void 0:s.title)||"Timetable").trim()||"Timetable",l=String((s==null?void 0:s.class_name)||"").trim(),n=String((s==null?void 0:s.academic_year)||"").trim(),a=String((s==null?void 0:s.term)||"").trim();let r='<!DOCTYPE html><html><head><meta charset="utf-8" />';return r+="<style>",r+="table{border-collapse:collapse;font-family:Calibri,Arial,sans-serif;font-size:11px;}",r+="th,td{border:1px solid #CBD5E1;padding:4px 6px;vertical-align:middle;}",r+="th{background:#F1F5F9;font-weight:700;text-align:center;}",r+=".meta{border:0;padding:2px 0;}",r+=".meta strong{font-weight:700;}",r+="</style></head><body>",r+=`<div class="meta"><strong>${m(d)}</strong></div>`,r+=`<div class="meta">${m([l,n,a].filter(Boolean).join(" · "))}</div>`,r+="<br/>",r+="<table>",r+="<thead><tr>",r+="<th>DAY</th><th>CLASS</th><th>STREAM</th>",A.forEach(f=>{r+=`<th>${m(f)}</th>`}),r+="</tr></thead><tbody>",z.forEach(f=>{const x=Array.isArray(t==null?void 0:t[f])?t[f]:[];if(!x.length){r+=`<tr><td>${m(f)}</td><td></td><td></td>`,A.forEach(()=>{r+="<td></td>"}),r+="</tr>";return}x.forEach(o=>{const i=String((o==null?void 0:o.class_label)||(o==null?void 0:o.form)||(o==null?void 0:o.class_name)||"").trim(),b=String((o==null?void 0:o.stream)||"").trim(),F=Array.isArray(o==null?void 0:o.slots)?o.slots:[];r+="<tr>",r+=`<td>${m(f)}</td>`,r+=`<td>${m(i)}</td>`,r+=`<td>${m(b)}</td>`;for(let C=0;C<9;C+=1){const y=F[C],j=String((y==null?void 0:y.subject)||"").trim(),V=String((y==null?void 0:y.teacher_initials)||"").trim(),I=[j,V].filter(Boolean).join(" "),P=R(j);r+=`<td style="background:${P.bg};color:${P.fg};text-align:center;">${m(I)}</td>`}r+="</tr>"})}),r+="</tbody></table></body></html>",r},H=s=>{const t=s||null;if(!t||!t.schedule_json||!h(t))return;const d=M(t),l=new Blob([d],{type:"application/vnd.ms-excel;charset=utf-8"}),n=URL.createObjectURL(l),f=`${(String((t==null?void 0:t.title)||"timetable").trim()||"timetable").replace(/[\\/:*?"<>|]+/g,"-")}_${(t==null?void 0:t.id)||""}.xls`,x=document.createElement("a");x.href=n,x.download=f,document.body.appendChild(x),x.click(),x.remove(),setTimeout(()=>URL.revokeObjectURL(n),5e3)};return(s,t)=>(p(),g(N,null,[w(D(q),{title:"Timetables"}),w(G,null,{header:T(()=>[e("div",K,[t[5]||(t[5]=e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Timetables "),e("p",{class:"mt-1 text-sm text-gray-500"}," View and manage class timetables. You can preview, download or delete a timetable from the list below. ")],-1)),e("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:t[0]||(t[0]=d=>D(E).get(s.route("timetables.create")))}," Create Timetable ")])]),default:T(()=>{var d,l;return[e("div",Q,[e("div",X,[e("p",Z," Timetables ("+u(S.timetables.length)+") ",1),t[6]||(t[6]=e("p",{class:"text-[11px] text-gray-500"}," Hizi ni ratiba ulizohifadhi (kwa madarasa au shule). Unaweza ku-preview, ku-print au kufuta. ",-1))]),e("div",tt,[e("table",et,[t[8]||(t[8]=e("thead",null,[e("tr",{class:"border-b border-gray-200 bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-500"},[e("th",{class:"px-3 py-2"},"Title"),e("th",{class:"px-3 py-2"},"Class"),e("th",{class:"px-3 py-2"},"Year / Term"),e("th",{class:"px-3 py-2"},"Status"),e("th",{class:"px-3 py-2"},"Created"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[S.timetables.length===0?(p(),g("tr",st,[...t[7]||(t[7]=[e("td",{colspan:"6",class:"px-3 py-4 text-center text-xs text-gray-500"}," No timetables created yet. ",-1)])])):_("",!0),(p(!0),g(N,null,J(S.timetables,n=>(p(),g("tr",{key:n.id,class:"border-b border-gray-100 text-xs text-gray-700 hover:bg-gray-50"},[e("td",nt,u(n.title),1),e("td",rt,u(n.class_name||"-"),1),e("td",lt,[n.academic_year?(p(),g("span",at,u(n.academic_year),1)):_("",!0),n.term?(p(),g("span",ot," • "+u(n.term),1)):_("",!0),!n.academic_year&&!n.term?(p(),g("span",it,"-")):_("",!0)]),e("td",dt,[e("div",ct,[e("span",{class:v(["inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ring-1",h(n)?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-amber-50 text-amber-800 ring-amber-100"])},u(h(n)?"Saved":"No schedule"),3),e("span",{class:v(["inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ring-1",n.is_published?"bg-violet-50 text-violet-700 ring-violet-100":"bg-gray-50 text-gray-600 ring-gray-100"])},u(n.is_published?"Published":"Draft"),3),e("span",{class:v(["inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ring-1",n.file_path?"bg-blue-50 text-blue-700 ring-blue-100":"bg-gray-50 text-gray-500 ring-gray-100"])},u(n.file_path?"PDF":"No PDF"),3)])]),e("td",ut,u(L(n.created_at)),1),e("td",gt,[e("div",pt,[e("button",{type:"button",class:"rounded-md bg-blue-50 px-2 py-1 text-[11px] font-medium text-blue-700 ring-1 ring-blue-100 hover:bg-blue-100",onClick:a=>U(n)}," Preview ",8,ft),e("button",{type:"button",class:"rounded-md bg-violet-50 px-2 py-1 text-[11px] font-medium text-violet-700 ring-1 ring-violet-100 hover:bg-violet-100",onClick:a=>B(n.id)},u(n.is_published?"Unpublish":"Publish"),9,xt),e("button",{type:"button",disabled:!n.file_path,class:v(["rounded-md px-2 py-1 text-[11px] font-medium ring-1",n.file_path?"bg-emerald-50 text-emerald-700 ring-emerald-100 hover:bg-emerald-100":"bg-gray-50 text-gray-400 ring-gray-100 cursor-not-allowed"]),onClick:a=>n.file_path&&s.window.open(s.route("timetables.download",n.id),"_blank")}," Download ",10,mt),e("button",{type:"button",class:"rounded-md bg-red-50 px-2 py-1 text-[11px] font-medium text-red-700 ring-1 ring-red-100 hover:bg-red-100",onClick:a=>Y(n.id)}," Delete ",8,bt)])])]))),128))])])]),k.value?(p(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-6",onClick:t[4]||(t[4]=W(n=>k.value=!1,["self"]))},[e("div",ht,[e("div",yt,[e("div",_t,[e("div",vt,u(((d=c.value)==null?void 0:d.title)||"Timetable Preview"),1),e("div",kt,u(((l=c.value)==null?void 0:l.class_name)||"-"),1)]),e("div",Ft,[e("button",{type:"button",disabled:!h(c.value),class:v(["rounded-md px-2 py-1 text-[11px] font-medium ring-1",h(c.value)?"bg-blue-50 text-blue-700 ring-blue-100 hover:bg-blue-100":"bg-gray-50 text-gray-400 ring-gray-100 cursor-not-allowed"]),onClick:t[1]||(t[1]=n=>h(c.value)&&H(c.value))}," Download Excel ",10,Et),e("button",{type:"button",class:"rounded-md bg-emerald-50 px-2 py-1 text-[11px] font-medium text-emerald-700 ring-1 ring-emerald-100 hover:bg-emerald-100",onClick:t[2]||(t[2]=n=>{var a;return((a=c.value)==null?void 0:a.id)&&D(E).get(s.route("timetables.show",c.value.id))})}," Edit "),e("button",{type:"button",class:"rounded-md bg-gray-50 px-2 py-1 text-[11px] font-medium text-gray-700 ring-1 ring-gray-100 hover:bg-gray-100",onClick:t[3]||(t[3]=n=>k.value=!1)}," Close ")])]),e("div",St,[c.value?c.value.file_path?(p(),g("iframe",{key:2,src:s.route("timetables.preview",c.value.id),class:"h-full w-full"},null,8,At)):(p(),g("div",Dt," This timetable has no PDF yet. Use Export to generate a PDF. ")):(p(),g("div",Ct," No timetable selected. "))])])])):_("",!0)])]}),_:1})],64))}};export{wt as default};

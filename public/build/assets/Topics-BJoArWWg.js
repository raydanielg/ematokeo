import{y,j as P,c as o,a as v,u as d,h as F,w as h,b as e,x as V,k as p,o as l,F as u,r as x,t as r,p as _,v as w,d as k,s as A,m as B}from"./app-CXaJsOnQ.js";import{_ as D}from"./AuthenticatedLayout-CAayGm0o.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"space-y-4"},N={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},E={class:"md:col-span-1"},M=["value"],L={class:"md:col-span-1"},R=["value"],z={class:"md:col-span-1"},I={class:"md:col-span-2"},$={class:"md:col-span-2 flex justify-end"},q=["disabled"],G={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},H={class:"mb-3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},J={class:"flex items-center gap-2"},K=["href"],O={class:"space-y-3 text-xs"},Q={class:"flex flex-col gap-2 md:flex-row md:items-center md:gap-3"},W=["disabled"],X={key:0,class:"mt-3 rounded-md border border-emerald-100 bg-emerald-50 p-3"},Y={class:"mb-2 flex items-center justify-between text-[11px]"},Z={class:"font-medium text-emerald-900"},ee={class:"max-h-64 overflow-auto text-[11px]"},te={class:"min-w-full border-collapse text-left"},se={class:"border-b border-gray-200 px-2 py-1"},oe={class:"border-b border-gray-200 px-2 py-1"},le={class:"border-b border-gray-200 px-2 py-1"},re={class:"border-b border-gray-200 px-2 py-1"},de={class:"border-b border-gray-200 px-2 py-1 text-center"},ie={key:0,class:"rounded bg-red-100 px-2 py-0.5 text-[10px] font-semibold text-red-700"},ne={key:1,class:"rounded bg-emerald-100 px-2 py-0.5 text-[10px] font-semibold text-emerald-800"},ae={class:"rounded-xl bg-white p-5 shadow-sm ring-1 ring-gray-100"},ce={class:"mb-3 flex items-center justify-between"},ue={class:"text-sm font-medium text-gray-700"},me={key:0,class:"text-[11px] text-gray-500"},be={key:1,class:"space-y-2 text-xs"},pe={class:"flex items-center justify-between"},xe={class:"font-semibold text-gray-800"},fe={class:"text-[10px] text-gray-500"},ge={class:"mt-0.5 text-[11px] text-gray-600"},ye={class:"font-medium"},ve={key:0,class:"mt-0.5 text-[11px] text-gray-600"},ke={__name:"Topics",props:{subjects:{type:Array,default:()=>[]},classLevels:{type:Array,default:()=>[]},topics:{type:Array,default:()=>[]},bulkPreview:{type:Array,default:()=>[]}},setup(i){const m=i,n=y({subject_id:"",class_level:"",title:"",description:""}),c=y({file:null}),j=()=>{n.post(route("topics.store"))},S=a=>{const[t]=a.target.files;c.file=t||null},C=()=>{c.file&&c.post(route("topics.bulk-preview"),{forceFormData:!0,preserveScroll:!0})},T=()=>{if(!m.bulkPreview||m.bulkPreview.length===0)return;const a=m.bulkPreview.filter(t=>!t.has_error);a.length!==0&&B.post(route("topics.bulk-store"),{rows:a},{preserveScroll:!0})},f=P(()=>{const a={};return(m.subjects||[]).forEach(t=>{a[t.id]=t}),a});return(a,t)=>(l(),o(u,null,[v(d(F),{title:"Topics"}),v(D,null,{header:h(()=>[...t[4]||(t[4]=[e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h2",{class:"text-2xl font-semibold leading-tight text-gray-800"}," Topics "),e("p",{class:"mt-1 text-sm text-gray-500"}," Add topics based on subject and class/form level. ")])],-1)])]),default:h(()=>[e("div",U,[e("div",N,[t[11]||(t[11]=e("h3",{class:"mb-3 text-sm font-semibold text-gray-800"}," Add Topic ",-1)),e("form",{class:"grid gap-3 text-xs md:grid-cols-2",onSubmit:V(j,["prevent"])},[e("div",E,[t[6]||(t[6]=e("label",{class:"mb-1 block text-[11px] font-medium"},"Subject",-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d(n).subject_id=s),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[t[5]||(t[5]=e("option",{value:"",disabled:""},"Select subject",-1)),(l(!0),o(u,null,x(i.subjects,s=>(l(),o("option",{key:s.id,value:s.id},r(s.subject_code)+" - "+r(s.name),9,M))),128))],512),[[_,d(n).subject_id]])]),e("div",L,[t[8]||(t[8]=e("label",{class:"mb-1 block text-[11px] font-medium"},"Class / Form",-1)),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>d(n).class_level=s),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},[t[7]||(t[7]=e("option",{value:""},"Select class/form (optional)",-1)),(l(!0),o(u,null,x(i.classLevels,s=>(l(),o("option",{key:s,value:s},r(s),9,R))),128))],512),[[_,d(n).class_level]])]),e("div",z,[t[9]||(t[9]=e("label",{class:"mb-1 block text-[11px] font-medium"},"Topic Title",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>d(n).title=s),type:"text",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",placeholder:"e.g. Introduction to Algebra"},null,512),[[w,d(n).title]])]),e("div",I,[t[10]||(t[10]=e("label",{class:"mb-1 block text-[11px] font-medium"},"Short Description (optional)",-1)),p(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>d(n).description=s),rows:"2",class:"w-full rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500"},null,512),[[w,d(n).description]])]),e("div",$,[e("button",{type:"submit",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:d(n).processing}," Save Topic ",8,q)])],32)]),e("div",G,[e("div",H,[t[12]||(t[12]=e("div",null,[e("h3",{class:"text-sm font-semibold text-gray-800"}," Bulk Upload Topics "),e("p",{class:"mt-0.5 text-[11px] text-gray-500"}," Download the template, fill topics in Excel/CSV, then upload to preview before saving. ")],-1)),e("div",J,[e("a",{href:a.route("topics.template"),class:"rounded-md bg-white px-3 py-1.5 text-[11px] font-medium text-emerald-700 ring-1 ring-emerald-200 hover:bg-emerald-50"}," Download Template ",8,K)])]),e("div",O,[e("div",Q,[e("input",{type:"file",accept:".csv,.txt,.xlsx,.xls",class:"w-full max-w-xs rounded-md border border-gray-300 px-2 py-1.5 text-xs focus:border-emerald-500 focus:outline-none focus:ring-emerald-500",onChange:S},null,32),e("button",{type:"button",class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",disabled:d(c).processing||!d(c).file,onClick:C}," Upload & Preview ",8,W)]),i.bulkPreview&&i.bulkPreview.length?(l(),o("div",X,[e("div",Y,[e("span",Z," Preview ("+r(i.bulkPreview.length)+" rows) ",1),e("button",{type:"button",class:"rounded-md bg-emerald-600 px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",onClick:T}," Confirm & Save Valid Rows ")]),e("div",ee,[e("table",te,[t[13]||(t[13]=e("thead",{class:"bg-emerald-100"},[e("tr",null,[e("th",{class:"border-b border-emerald-200 px-2 py-1"},"Subject Code"),e("th",{class:"border-b border-emerald-200 px-2 py-1"},"Class / Form"),e("th",{class:"border-b border-emerald-200 px-2 py-1"},"Title"),e("th",{class:"border-b border-emerald-200 px-2 py-1"},"Description"),e("th",{class:"border-b border-emerald-200 px-2 py-1 text-center"},"Status")])],-1)),e("tbody",null,[(l(!0),o(u,null,x(i.bulkPreview,(s,b)=>(l(),o("tr",{key:b,class:A(s.has_error?"bg-red-50":"bg-white")},[e("td",se,r(s.subject_code||"-"),1),e("td",oe,r(s.class_level||"-"),1),e("td",le,r(s.title||"-"),1),e("td",re,r(s.description||"-"),1),e("td",de,[s.has_error?(l(),o("span",ie," Fix subject/title ")):(l(),o("span",ne," Ready "))])],2))),128))])])]),t[14]||(t[14]=e("p",{class:"mt-1 text-[10px] text-gray-500"}," Rows marked in red have missing or unknown subject code or title and will be skipped when saving. ",-1))])):k("",!0)])]),e("div",ae,[e("div",ce,[e("p",ue," Existing Topics ("+r(i.topics.length)+") ",1)]),i.topics.length===0?(l(),o("div",me," No topics added yet. ")):(l(),o("div",be,[(l(!0),o(u,null,x(i.topics,s=>{var b,g;return l(),o("div",{key:s.id,class:"rounded border border-gray-200 bg-slate-50 px-3 py-2"},[e("div",pe,[e("div",xe,r(s.title),1),e("div",fe,r(s.class_level||"No class level"),1)]),e("div",ge,[e("span",ye,r((b=f.value[s.subject_id])==null?void 0:b.subject_code)+" - "+r((g=f.value[s.subject_id])==null?void 0:g.name),1)]),s.description?(l(),o("div",ve,r(s.description),1)):k("",!0)])}),128))]))])])]),_:1})],64))}};export{ke as default};
